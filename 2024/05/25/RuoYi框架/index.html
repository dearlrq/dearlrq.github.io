<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="dearlrq">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2024/05/25/ruoyi框架/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="一、1- 介绍1、开源项目 2、学习目标：  使用，减少自己的工作量 学习优秀开源项目底层的编程思想，设计思路，提高自己的编程能力  3、官网：  介绍 | RuoYi   4、基础：  Spring Boot + Vue  5、环境：  JDK 1.8 MySQL Redis Maven Vue  6、使用步骤  下载并运行 看懂业务流程 进行二次开发  2- 使用2-1 结构介绍2-1-1 后">
<meta property="og:type" content="article">
<meta property="og:title" content="RuoYi框架">
<meta property="og:url" content="http://example.com/2024/05/25/RuoYi%E6%A1%86%E6%9E%B6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="一、1- 介绍1、开源项目 2、学习目标：  使用，减少自己的工作量 学习优秀开源项目底层的编程思想，设计思路，提高自己的编程能力  3、官网：  介绍 | RuoYi   4、基础：  Spring Boot + Vue  5、环境：  JDK 1.8 MySQL Redis Maven Vue  6、使用步骤  下载并运行 看懂业务流程 进行二次开发  2- 使用2-1 结构介绍2-1-1 后">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528142439009.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528142544193.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240525222739816.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240525222917137.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526090733159.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526090814027.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526090932731.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526091141931.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526092508638.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528154630969.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528154657836.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528154809411.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528164545407.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240529200143986.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240530205740821.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240530205811054.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240530170350824.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240531141555881.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240531222541280.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240531222558574.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705153600650.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602160352961.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602160655452.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602160928700.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602161001621.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602161220369.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708195813114.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708195923608.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708202813444.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708202923556.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708203032924.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708203733187.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708204437129.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708205033594.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708205601791.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708211525297.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708211943558.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708213749693.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708214021407.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708214058966.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709070952141.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712094912300.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712095235714.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-09%20071120.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709073639071.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709073534331.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709074207425.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709074241216.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709074513823.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709082908972.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709082848507.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709153631564.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710114025772.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710140056696.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710140526678.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710143158539.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-10%20195050.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710201035866.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710202842829.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710203018232.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710204309895.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710204501738.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-10%20205220.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710205501666.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710205745198.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710211404517.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710215422345.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710211601428.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710213631662.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710214750713.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710215944691.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710220432554.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710220839461.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709145830321.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709150959410.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709151051003.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709151232639.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709084430177.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709085818488.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711171905312.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711172606344.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711173123954.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711173231869.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711174406926.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711174429699.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711174728640.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711190634131.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711190658071.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711191926076.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711192535578.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711193259481.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711193429389.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711195312961.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711205916107.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711210245638.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711211258908.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711211909838.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711211643638.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711213906667.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711213843946.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711212835486.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711214148886.png">
<meta property="og:image" content="c:\Users\31518\AppData\Roaming\Typora\typora-user-images\image-20240711214353527.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711214245838.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711220815190.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711221117211.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712073118606.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712072211214.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712074948445.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712075551937.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712085826645.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712092132636.png">
<meta property="og:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712092253598.png">
<meta property="article:published_time" content="2024-05-25T13:55:34.000Z">
<meta property="article:modified_time" content="2024-07-12T08:23:51.954Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="自研笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528142439009.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/%E7%AB%99%E7%82%B9.jpg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/%E7%AB%99%E7%82%B9.jpg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/%E7%AB%99%E7%82%B9.jpg">
    <!--- Page Info-->
    
    <title>
        
            RuoYi框架 -
        
        dearlrq
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    
        <style>
    :root {
        --preloader-background-color: #fff;
        --preloader-text-color: #000;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --preloader-background-color: #202124;
            --preloader-text-color: #fff;
        }
    }

    @media (prefers-color-scheme: light) {
        :root {
            --preloader-background-color: #fff;
            --preloader-text-color: #000;
        }
    }

    @media (max-width: 600px) {
        .ml13 {
            font-size: 2.6rem !important; /* Adjust this value as needed */
        }
    }

    .preloader {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Tailwind 'gap-4' is 1rem */
        align-items: center;
        justify-content: center;
        position: fixed;
        padding: 12px;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh; /* 'h-screen' is 100% of the viewport height */
        background-color: var(--preloader-background-color);
        z-index: 1100; /* 'z-[1100]' sets the z-index */
        transition: opacity 0.2s ease-in-out;
    }

    .ml13 {
        font-size: 3.2rem;
        /* text-transform: uppercase; */
        color: var(--preloader-text-color);
        letter-spacing: -1px;
        font-weight: 500;
        font-family: 'Chillax-Variable', sans-serif;
        text-align: center;
    }

    .ml13 .word {
        display: inline-flex;
        flex-wrap: wrap;
        white-space: nowrap;
    }

    .ml13 .letter {
        display: inline-block;
        line-height: 1em;
    }
</style>

<div class="preloader">
    
<script src="/js/libs/anime.min.js"></script>

    <h1 class="ml13">
        dearlrq
    </h1>
    <script>
        var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });


        anime.timeline({loop: true})
            .add({
                targets: '.ml13 .letter',
                translateY: [100,0],
                translateZ: 0,
                opacity: [0,1],
                easing: "easeOutExpo",
                duration: 1400,
                delay: (el, i) => 300 + 30 * i
            }).add({
            targets: '.ml13 .letter',
            translateY: [0,-100],
            opacity: [1,0],
            easing: "easeInExpo",
            duration: 1200,
            delay: (el, i) => 100 + 30 * i
        });

        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            hidePreloaderAfterTimeout(1000); // Hide after 1000 milliseconds once the window has loaded
        });

        // Backup failsafe: Hide preloader after a maximum of 5000 milliseconds, regardless of the window load event
        hidePreloaderAfterTimeout(5000);

        function hidePreloaderAfterTimeout(delay) {
            setTimeout(function () {
                var preloader = document.querySelector('.preloader');
                preloader.style.opacity = '0';
                setTimeout(function () {
                    preloader.style.display = 'none';
                }, 200);
            }, delay);
        }
    </script>
</div>
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    <!--- Font Part-->
    
    
    
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    
        <link href="https://fonts.googleapis.com/css2?family=Farsan&display=swap" rel="stylesheet">
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left"},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":6,"number":true,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null},"global":{"fonts":{"chinese":{"enable":true,"family":"Noto Sans SC","url":"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"},"english":{"enable":true,"family":"Farsan","url":"https://fonts.googleapis.com/css2?family=Farsan&display=swap"}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":true},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/白.jpg","dark":"/images/夜.jpg"},"title":"Hello,World!","subtitle":{"text":["若待上林花似锦，出门俱是看花人。"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"links":{"github":null,"instagram":null,"zhihu":null,"twitter":null,"email":null},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.6.0","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"首页":{"path":"/","icon":"fa-regular fa-house"},"归档":{"path":"/archives","icon":"fa-regular fa-archive"},"分类":{"path":"/categories","icon":"fa-regular fa-folder"},"关于":{"icon":"fa-regular fa-user","submenus":{"Me":"/about"}},"链接":{"icon":"fa-regular fa-link","submenus":{"Github":"https://github.com/dearlrq"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":"欢迎来到dearlrq的blog,网站正在建设中...","links":{"归档":{"path":"/archives","icon":"fa-regular fa-archive"},"标签":{"path":"/tags","icon":"fa-regular fa-tags"},"分类":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":50,"Categories":{"icon":"fa-solid fa-folder","path":"/categories/"}},"tags":{"enable":true,"limit":50,"Tags":{"icon":"fa-solid fa-tags","path":"/tags/"}}},"footerStart":"2024/1/13 11:45:14"};
    window.lang_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
        
<link rel="stylesheet" href="/fontawesome/thin.min.css">

    
    
        
<link rel="stylesheet" href="/fontawesome/light.min.css">

    
    
        
<link rel="stylesheet" href="/fontawesome/duotone.min.css">

    
    
        
<link rel="stylesheet" href="/fontawesome/sharp-solid.min.css">

    
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
<!--        <span class="swup-progress-icon">-->
<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
<!--        </span>-->
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">

    <div class="navbar-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/%E7%AB%99%E7%82%B9.jpg">
                </a>
            
            <a class="logo-title" href="/">
                
                dearlrq
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    首页
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    归档
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/categories"
                                        >
                                    <i class="fa-regular fa-folder fa-fw"></i>
                                    分类
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    关于
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a href="/about">
                                                    ME
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-link fa-fw"></i>
                                    链接
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/dearlrq">
                                                    GITHUB
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                首页
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                归档
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/categories"
                        >
                            <span>
                                分类
                            </span>
                            
                                <i class="fa-regular fa-folder fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-关于"
                        >
                            <span>
                                关于
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-关于">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/about">ME</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-链接"
                        >
                            <span>
                                链接
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-链接">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/dearlrq">GITHUB</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">2</div>
        <div class="label text-third-text-color text-sm">标签</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">16</div>
        <div class="label text-third-text-color text-sm">分类</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">12</div>
        <div class="label text-third-text-color text-sm">文章</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container flex relative justify-between box-border w-full h-full">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color text-4xl md:text-6xl font-bold px-2 sm:px-6 md:px-8 py-3">RuoYi框架</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/%E7%AB%99%E7%82%B9.jpg">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">dearlrq</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv2</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-05-25 21:55:34</span>
        <span class="mobile">2024-05-25 21:55:34</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-07-12 16:23:51</span>
            <span class="mobile">2024-07-12 16:23:51</span>
            <span class="hover-info">更新</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/RuoYi/">RuoYi</a>&nbsp;
                        </li>
                    
                    
                
                    
                        
                            <li>></li>
                        
                        <li>
                            <a href="/categories/RuoYi/RuoYi%E6%A1%86%E6%9E%B6/">RuoYi框架</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E8%87%AA%E7%A0%94%E7%AC%94%E8%AE%B0/">自研笔记</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>13k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>63 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h1 id="一、"><a href="#一、" class="headerlink" title="一、"></a>一、</h1><h1 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1- 介绍"></a>1- 介绍</h1><p>1、开源项目</p>
<p>2、学习目标：</p>
<ul>
<li>使用，减少自己的工作量</li>
<li>学习优秀开源项目底层的编程思想，设计思路，提高自己的编程能力</li>
</ul>
<p>3、官网：</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://doc.ruoyi.vip/ruoyi-vue/" >介绍 | RuoYi <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<p>4、基础：</p>
<ul>
<li>Spring Boot + Vue</li>
</ul>
<p>5、环境：</p>
<ul>
<li>JDK 1.8</li>
<li>MySQL</li>
<li>Redis</li>
<li>Maven</li>
<li>Vue</li>
</ul>
<p>6、使用步骤</p>
<ul>
<li>下载并运行</li>
<li>看懂业务流程</li>
<li>进行二次开发</li>
</ul>
<h1 id="2-使用"><a href="#2-使用" class="headerlink" title="2- 使用"></a>2- 使用</h1><h2 id="2-1-结构介绍"><a href="#2-1-结构介绍" class="headerlink" title="2-1 结构介绍"></a>2-1 结构介绍</h2><h3 id="2-1-1-后端结构"><a href="#2-1-1-后端结构" class="headerlink" title="2-1-1 后端结构"></a>2-1-1 后端结构</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528142439009.png"
                      alt="image-20240528142439009"
                ></p>
<h3 id="2-1-2-前端结构"><a href="#2-1-2-前端结构" class="headerlink" title="2-1-2 前端结构"></a>2-1-2 前端结构</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528142544193.png"
                      alt="image-20240528142544193"
                ></p>
<h2 id="2-2-下载"><a href="#2-2-下载" class="headerlink" title="2-2 下载"></a>2-2 下载</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://gitee.com/y_project/RuoYi-Vue.git</span><br></pre></td></tr></table></figure></div>

<h2 id="2-3-启动后端"><a href="#2-3-启动后端" class="headerlink" title="2-3 启动后端"></a>2-3 启动后端</h2><h3 id="2-3-1-配置MySQL"><a href="#2-3-1-配置MySQL" class="headerlink" title="2-3-1 配置MySQL"></a>2-3-1 配置MySQL</h3><ul>
<li>1、执行 sql 文件夹下的 sql脚本</li>
<li>2、修改数据库连接（application-druid.yml）</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240525222739816.png"
                      alt="image-20240525222739816"
                ></li>
</ul>
<h3 id="2-3-2-配置Redis"><a href="#2-3-2-配置Redis" class="headerlink" title="2-3-2 配置Redis"></a>2-3-2 配置Redis</h3><ul>
<li><p>修改Redis连接（application.yml）</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240525222917137.png"
                      alt="image-20240525222917137"
                ></p>
</li>
</ul>
<h2 id="2-4-启动前端"><a href="#2-4-启动前端" class="headerlink" title="2-4 启动前端"></a>2-4 启动前端</h2><p>安装依赖：</p>
<ul>
<li>npm install</li>
</ul>
<p>启动服务：</p>
<ul>
<li>npm run dev</li>
</ul>
<p>浏览器访问：</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="http://localhost/" >http://localhost:80 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<h1 id="3-登录"><a href="#3-登录" class="headerlink" title="3- 登录"></a>3- 登录</h1><h2 id="3-1-验证码"><a href="#3-1-验证码" class="headerlink" title="3-1 验证码"></a>3-1 验证码</h2><h3 id="3-1-1-思路"><a href="#3-1-1-思路" class="headerlink" title="3-1-1 思路"></a>3-1-1 思路</h3><p>后端生成一个表达式，1+1&#x3D;2</p>
<p>1+1&#x3D;?@2</p>
<p>1+1&#x3D;? 转成图片，传到前端进行展示</p>
<p>2 存入 Redis</p>
<p>前端提交登录表单，把表单的 2 和 Redis 的 2 比较</p>
<h3 id="3-1-2-前端实现"><a href="#3-1-2-前端实现" class="headerlink" title="3-1-2 前端实现"></a>3-1-2 前端实现</h3><ul>
<li>login.vue</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526090733159.png"
                      alt="image-20240526090733159"
                ></p>
<ul>
<li>ruoyi-ui.src.api.login.js</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526090814027.png"
                      alt="image-20240526090814027"
                ></p>
<ul>
<li>ruoyi-ui.src.utils.request.js</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526090932731.png"
                      alt="image-20240526090932731"
                ></p>
<ul>
<li>.env.development</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526091141931.png"
                      alt="image-20240526091141931"
                ></p>
<ul>
<li>http: &#x2F;&#x2F;localhost&#x2F;dev-api&#x2F;captchalmage</li>
</ul>
<p>是前端请求，但Vue是从后端获取图片，为什么：</p>
<p>反向代理，url请求前端，进行代理，映射到后端，解决跨越问题。</p>
<ul>
<li>vue.config.js</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526092508638.png"
                      alt="image-20240526092508638"
                ></p>
<p>pathRewrite：路径重写，将 &#x2F;dev-api 替换为 ‘ ‘。</p>
<p>然后再映射到 http: &#x2F;&#x2F;localhost:8080 。</p>
<h3 id="3-1-3-后端实现"><a href="#3-1-3-后端实现" class="headerlink" title="3-1-3 后端实现"></a>3-1-3 后端实现</h3><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.common.CaptchaController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证码操作处理</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CaptchaController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource(name = &quot;captchaProducer&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Producer captchaProducer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;captchaProducerMath&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Producer captchaProducerMath;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ISysConfigService configService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成验证码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/captchaImage&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">getCode</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">captchaEnabled</span> <span class="operator">=</span> configService.selectCaptchaEnabled(); <span class="comment">//检验是否开启验证码</span></span><br><span class="line">        ajax.put(<span class="string">&quot;captchaEnabled&quot;</span>, captchaEnabled);</span><br><span class="line">        <span class="keyword">if</span> (!captchaEnabled)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> ajax;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存验证码信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> IdUtils.simpleUUID(); <span class="comment">//获取uuid</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">verifyKey</span> <span class="operator">=</span> CacheConstants.CAPTCHA_CODE_KEY + uuid; <span class="comment">//将uuid与前缀拼接，变成key值</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">capStr</span> <span class="operator">=</span> <span class="literal">null</span>, code = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">captchaType</span> <span class="operator">=</span> RuoYiConfig.getCaptchaType();</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;math&quot;</span>.equals(captchaType))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">capText</span> <span class="operator">=</span> captchaProducerMath.createText(); <span class="comment">//获取验证码</span></span><br><span class="line">            capStr = capText.substring(<span class="number">0</span>, capText.lastIndexOf(<span class="string">&quot;@&quot;</span>)); <span class="comment">//@分割，@前的表达式 </span></span><br><span class="line">            code = capText.substring(capText.lastIndexOf(<span class="string">&quot;@&quot;</span>) + <span class="number">1</span>); <span class="comment">//@后的答案</span></span><br><span class="line">            image = captchaProducerMath.createImage(capStr); <span class="comment">//生成图片</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;char&quot;</span>.equals(captchaType))</span><br><span class="line">        &#123;</span><br><span class="line">            capStr = code = captchaProducer.createText();</span><br><span class="line">            image = captchaProducer.createImage(capStr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将key值，答案，有效期，分钟一起存入Redis</span></span><br><span class="line">        redisCache.setCacheObject(verifyKey, code, Constants.CAPTCHA_EXPIRATION, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">// 转换流信息写出</span></span><br><span class="line">        <span class="type">FastByteArrayOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastByteArrayOutputStream</span>();</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            ImageIO.write(image, <span class="string">&quot;jpg&quot;</span>, os);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> AjaxResult.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ajax.put(<span class="string">&quot;uuid&quot;</span>, uuid);</span><br><span class="line">        ajax.put(<span class="string">&quot;img&quot;</span>, Base64.encode(os.toByteArray()));</span><br><span class="line">        <span class="keyword">return</span> ajax; <span class="comment">//将uuid和验证码图片返回前端</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="3-2-登录"><a href="#3-2-登录" class="headerlink" title="3-2 登录"></a>3-2 登录</h2><h3 id="3-2-1-后端思路"><a href="#3-2-1-后端思路" class="headerlink" title="3-2-1 后端思路"></a>3-2-1 后端思路</h3><ul>
<li>1、校验验证码</li>
<li>2、校验用户名和密码</li>
<li>3、生成 Token</li>
<li>使用异步任务管理器，结合线程池，实现了异步的操作日志记录，和业务逻辑实现异步解耦合。</li>
</ul>
<h3 id="3-2-2-后端实现"><a href="#3-2-2-后端实现" class="headerlink" title="3-2-2 后端实现"></a>3-2-2 后端实现</h3><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysLoginController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SysLoginService loginService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录方法</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> loginBody 登录信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginBody loginBody)</span> <span class="comment">//前端提交的登录表单内容</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">    <span class="comment">// 生成令牌</span></span><br><span class="line">    <span class="comment">//得到用户名、密码、验证码答案、uuid</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> loginService.login(loginBody.getUsername(), loginBody.getPassword(), 				                    loginBody.getCode(),loginBody.getUuid()); <span class="comment">//调用login</span></span><br><span class="line">    ajax.put(Constants.TOKEN, token);</span><br><span class="line">    <span class="keyword">return</span> ajax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-framework.com.ruoyi.framework.web.service.SysLoginService</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录校验方法</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysLoginService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenService tokenService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ISysUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ISysConfigService configService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录验证</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uuid 唯一标识</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(String username, String password, String code, String uuid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 验证码校验</span></span><br><span class="line">        validateCaptcha(username, code, uuid);</span><br><span class="line">        <span class="comment">// 登录前置校验</span></span><br><span class="line">        loginPreCheck(username, password);</span><br><span class="line">        <span class="comment">// 用户验证</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span>                             <span class="title class_">UsernamePasswordAuthenticationToken</span>(username, password);</span><br><span class="line">            AuthenticationContextHolder.setContext(authenticationToken);</span><br><span class="line">            <span class="comment">// 该方法会去调用UserDetailsServiceImpl.loadUserByUsername</span></span><br><span class="line">            authentication = authenticationManager.authenticate(authenticationToken);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> BadCredentialsException)</span><br><span class="line">            &#123;</span><br><span class="line">                AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL,   MessageUtils.message(<span class="string">&quot;user.password.not.match&quot;</span>)));</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserPasswordNotMatchException</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL,   e.getMessage()));</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span></span><br><span class="line">        &#123;</span><br><span class="line">            AuthenticationContextHolder.clearContext();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//记录操作日志</span></span><br><span class="line">        AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_SUCCESS, MessageUtils.message(<span class="string">&quot;user.login.success&quot;</span>)));</span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> (LoginUser) authentication.getPrincipal();</span><br><span class="line">        <span class="comment">//记录用户最新的登录信息</span></span><br><span class="line">        recordLoginInfo(loginUser.getUserId());</span><br><span class="line">        <span class="comment">// 生成token</span></span><br><span class="line">        <span class="keyword">return</span> tokenService.createToken(loginUser); <span class="comment">//调用createToken</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验验证码</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uuid 唯一标识</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validateCaptcha</span><span class="params">(String username, String code, String uuid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">captchaEnabled</span> <span class="operator">=</span> configService.selectCaptchaEnabled();</span><br><span class="line">        <span class="keyword">if</span> (captchaEnabled)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">verifyKey</span> <span class="operator">=</span> CacheConstants.CAPTCHA_CODE_KEY + StringUtils.nvl(uuid, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">captcha</span> <span class="operator">=</span> redisCache.getCacheObject(verifyKey); <span class="comment">//从Redis里面获取key值对应的答案  </span></span><br><span class="line">            redisCache.deleteObject(verifyKey); <span class="comment">//从Redis里面删除key值</span></span><br><span class="line">            <span class="keyword">if</span> (captcha == <span class="literal">null</span>) <span class="comment">//如果Redis答案不存在</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//异步日志</span></span><br><span class="line">                AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;user.jcaptcha.expire&quot;</span>)));</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CaptchaExpireException</span>(); <span class="comment">//抛出过期异常</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!code.equalsIgnoreCase(captcha)) <span class="comment">//如果验证码答案和Redis答案不一致</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//异步日志</span></span><br><span class="line">                AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;user.jcaptcha.error&quot;</span>)));</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CaptchaException</span>(); <span class="comment">//抛出错误异常</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录前置校验</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 用户密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loginPreCheck</span><span class="params">(String username, String password)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 用户名或密码为空 错误</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(username) || StringUtils.isEmpty(password))</span><br><span class="line">        &#123;</span><br><span class="line">            AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;not.null&quot;</span>)));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserNotExistsException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 密码如果不在指定范围内 错误</span></span><br><span class="line">        <span class="keyword">if</span> (password.length() &lt; UserConstants.PASSWORD_MIN_LENGTH</span><br><span class="line">                || password.length() &gt; UserConstants.PASSWORD_MAX_LENGTH)</span><br><span class="line">        &#123;</span><br><span class="line">            AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;user.password.not.match&quot;</span>)));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserPasswordNotMatchException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 用户名不在指定范围内 错误</span></span><br><span class="line">        <span class="keyword">if</span> (username.length() &lt; UserConstants.USERNAME_MIN_LENGTH</span><br><span class="line">                || username.length() &gt; UserConstants.USERNAME_MAX_LENGTH)</span><br><span class="line">        &#123;</span><br><span class="line">            AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;user.password.not.match&quot;</span>)));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserPasswordNotMatchException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// IP黑名单校验</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">blackStr</span> <span class="operator">=</span> configService.selectConfigByKey(<span class="string">&quot;sys.login.blackIPList&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (IpUtils.isMatchedIp(blackStr, IpUtils.getIpAddr()))</span><br><span class="line">        &#123;</span><br><span class="line">            AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;login.blocked&quot;</span>)));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BlackListException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 记录登录信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordLoginInfo</span><span class="params">(Long userId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SysUser</span>();</span><br><span class="line">        sysUser.setUserId(userId);</span><br><span class="line">        sysUser.setLoginIp(IpUtils.getIpAddr());</span><br><span class="line">        sysUser.setLoginDate(DateUtils.getNowDate());</span><br><span class="line">        userService.updateUserProfile(sysUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-framework.com.ruoyi.framework.web.service.TokenService</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * token验证处理</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(TokenService.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 令牌自定义标识</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;token.header&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String header;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 令牌秘钥</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;token.secret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String secret;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 令牌有效期（默认30分钟）</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;token.expireTime&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> expireTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">MILLIS_SECOND</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">MILLIS_MINUTE</span> <span class="operator">=</span> <span class="number">60</span> * MILLIS_SECOND;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Long</span> <span class="variable">MILLIS_MINUTE_TEN</span> <span class="operator">=</span> <span class="number">20</span> * <span class="number">60</span> * <span class="number">1000L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户身份信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> LoginUser <span class="title function_">getLoginUser</span><span class="params">(HttpServletRequest request)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取请求携带的令牌</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> getToken(request);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(token))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> parseToken(token);</span><br><span class="line">                <span class="comment">// 解析对应的权限以及用户信息</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> (String) claims.get(Constants.LOGIN_USER_KEY);</span><br><span class="line">                <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> getTokenKey(uuid);</span><br><span class="line">                <span class="type">LoginUser</span> <span class="variable">user</span> <span class="operator">=</span> redisCache.getCacheObject(userKey);</span><br><span class="line">                <span class="keyword">return</span> user;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                log.error(<span class="string">&quot;获取用户信息异常&#x27;&#123;&#125;&#x27;&quot;</span>, e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置用户身份信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLoginUser</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotNull(loginUser) &amp;&amp; StringUtils.isNotEmpty(loginUser.getToken()))</span><br><span class="line">        &#123;</span><br><span class="line">            refreshToken(loginUser);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除用户身份信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delLoginUser</span><span class="params">(String token)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(token))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> getTokenKey(token);</span><br><span class="line">            redisCache.deleteObject(userKey);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建令牌</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginUser 用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 令牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createToken</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> IdUtils.fastUUID();</span><br><span class="line">        loginUser.setToken(token);</span><br><span class="line">        setUserAgent(loginUser);</span><br><span class="line">        refreshToken(loginUser);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        claims.put(Constants.LOGIN_USER_KEY, token);</span><br><span class="line">        <span class="keyword">return</span> createToken(claims);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 验证令牌有效期，相差不足20分钟，自动刷新缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginUser</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 令牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">verifyToken</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">expireTime</span> <span class="operator">=</span> loginUser.getExpireTime();</span><br><span class="line">        <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">if</span> (expireTime - currentTime &lt;= MILLIS_MINUTE_TEN)</span><br><span class="line">        &#123;</span><br><span class="line">            refreshToken(loginUser);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 刷新令牌有效期</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginUser 登录信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refreshToken</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        loginUser.setLoginTime(System.currentTimeMillis());</span><br><span class="line">        loginUser.setExpireTime(loginUser.getLoginTime() + expireTime * MILLIS_MINUTE);</span><br><span class="line">        <span class="comment">// 根据uuid将loginUser缓存</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> getTokenKey(loginUser.getToken());</span><br><span class="line">        redisCache.setCacheObject(userKey, loginUser, expireTime, TimeUnit.MINUTES);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置用户代理信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginUser 登录信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserAgent</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UserAgent</span> <span class="variable">userAgent</span> <span class="operator">=</span> UserAgent.parseUserAgentString(ServletUtils.getRequest().getHeader(<span class="string">&quot;User-Agent&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> IpUtils.getIpAddr();</span><br><span class="line">        loginUser.setIpaddr(ip);</span><br><span class="line">        loginUser.setLoginLocation(AddressUtils.getRealAddressByIP(ip));</span><br><span class="line">        loginUser.setBrowser(userAgent.getBrowser().getName());</span><br><span class="line">        loginUser.setOs(userAgent.getOperatingSystem().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从数据声明生成令牌</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> claims 数据声明</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 令牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">createToken</span><span class="params">(Map&lt;String, Object&gt; claims)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">                .setClaims(claims)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS512, secret).compact();</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从令牌中获取数据声明</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token 令牌</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 数据声明</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Claims <span class="title function_">parseToken</span><span class="params">(String token)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.parser()</span><br><span class="line">                .setSigningKey(secret)</span><br><span class="line">                .parseClaimsJws(token)</span><br><span class="line">                .getBody();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从令牌中获取用户名</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token 令牌</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsernameFromToken</span><span class="params">(String token)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> parseToken(token);</span><br><span class="line">        <span class="keyword">return</span> claims.getSubject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取请求token</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getToken</span><span class="params">(HttpServletRequest request)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(header);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(token) &amp;&amp; token.startsWith(Constants.TOKEN_PREFIX))</span><br><span class="line">        &#123;</span><br><span class="line">            token = token.replace(Constants.TOKEN_PREFIX, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getTokenKey</span><span class="params">(String uuid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> CacheConstants.LOGIN_TOKEN_KEY + uuid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="3-2-3-前端实现"><a href="#3-2-3-前端实现" class="headerlink" title="3-2-3 前端实现"></a>3-2-3 前端实现</h3><ul>
<li>login.vue</li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleLogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">loginForm</span>.<span class="title function_">validate</span>(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">loginForm</span>.<span class="property">rememberMe</span>) &#123; <span class="comment">//检验是否保存密码</span></span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">set</span>(<span class="string">&quot;username&quot;</span>, <span class="variable language_">this</span>.<span class="property">loginForm</span>.<span class="property">username</span>, &#123; <span class="attr">expires</span>: <span class="number">30</span> &#125;);</span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">set</span>(<span class="string">&quot;password&quot;</span>, <span class="title function_">encrypt</span>(<span class="variable language_">this</span>.<span class="property">loginForm</span>.<span class="property">password</span>), &#123; <span class="attr">expires</span>: <span class="number">30</span> &#125;);</span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">set</span>(<span class="string">&#x27;rememberMe&#x27;</span>, <span class="variable language_">this</span>.<span class="property">loginForm</span>.<span class="property">rememberMe</span>, &#123; <span class="attr">expires</span>: <span class="number">30</span> &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">remove</span>(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">remove</span>(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">remove</span>(<span class="string">&#x27;rememberMe&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&quot;Login&quot;</span>, <span class="variable language_">this</span>.<span class="property">loginForm</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//调用Login</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="variable language_">this</span>.<span class="property">redirect</span> || <span class="string">&quot;/&quot;</span> &#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;&#125;);</span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">captchaEnabled</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">getCode</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.store.modules.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录</span></span><br><span class="line"><span class="title class_">Login</span>(&#123; commit &#125;, userInfo) &#123;</span><br><span class="line">    <span class="keyword">const</span> username = userInfo.<span class="property">username</span>.<span class="title function_">trim</span>()</span><br><span class="line">    <span class="keyword">const</span> password = userInfo.<span class="property">password</span></span><br><span class="line">    <span class="keyword">const</span> code = userInfo.<span class="property">code</span></span><br><span class="line">    <span class="keyword">const</span> uuid = userInfo.<span class="property">uuid</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">login</span>(username, password, code, uuid).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123; <span class="comment">//调用login</span></span><br><span class="line">            <span class="title function_">setToken</span>(res.<span class="property">token</span>)</span><br><span class="line">            <span class="title function_">commit</span>(<span class="string">&#x27;SET_TOKEN&#x27;</span>, res.<span class="property">token</span>)</span><br><span class="line">            <span class="title function_">resolve</span>()</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(error)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.login.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">username, password, code, uuid</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = &#123;</span><br><span class="line">    username,</span><br><span class="line">    password,</span><br><span class="line">    code,</span><br><span class="line">    uuid</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="attr">isToken</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">repeatSubmit</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="4-获取用户角色和权限"><a href="#4-获取用户角色和权限" class="headerlink" title="4- 获取用户角色和权限"></a>4- 获取用户角色和权限</h1><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>获取当前用户的角色和权限信息，存储到 vuex 中。</p>
<h2 id="4-1-前端实现"><a href="#4-1-前端实现" class="headerlink" title="4-1 前端实现"></a>4-1 前端实现</h2><ul>
<li>permission.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全局路由管理器，前端每个页面跳转都要进入他</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title class_">NProgress</span>.<span class="title function_">start</span>()</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">getToken</span>()) &#123;</span><br><span class="line">    to.<span class="property">meta</span>.<span class="property">title</span> &amp;&amp; store.<span class="title function_">dispatch</span>(<span class="string">&#x27;settings/setTitle&#x27;</span>, to.<span class="property">meta</span>.<span class="property">title</span>)</span><br><span class="line">    <span class="comment">/* has token*/</span></span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">      <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(to.<span class="property">path</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">roles</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        isRelogin.<span class="property">show</span> = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// 判断当前用户是否已拉取完user_info信息</span></span><br><span class="line">        store.<span class="title function_">dispatch</span>(<span class="string">&#x27;GetInfo&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//调用GetInfo</span></span><br><span class="line">          isRelogin.<span class="property">show</span> = <span class="literal">false</span></span><br><span class="line">          store.<span class="title function_">dispatch</span>(<span class="string">&#x27;GenerateRoutes&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">accessRoutes</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 根据roles权限生成可访问的路由表</span></span><br><span class="line">            router.<span class="title function_">addRoutes</span>(accessRoutes) <span class="comment">// 动态添加可访问路由表</span></span><br><span class="line">            <span class="title function_">next</span>(&#123; ...to, <span class="attr">replace</span>: <span class="literal">true</span> &#125;) <span class="comment">// hack方法 确保addRoutes已完成</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            store.<span class="title function_">dispatch</span>(<span class="string">&#x27;LogOut&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="title class_">Message</span>.<span class="title function_">error</span>(err)</span><br><span class="line">              <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 没有token</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(to.<span class="property">path</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// 在免登录白名单，直接进入</span></span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">`/login?redirect=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(to.fullPath)&#125;</span>`</span>) <span class="comment">// 否则全部重定向到登录页</span></span><br><span class="line">      <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.store.modules.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户信息</span></span><br><span class="line"><span class="title class_">GetInfo</span>(&#123; commit, state &#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">getInfo</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123; <span class="comment">//调用getInfo</span></span><br><span class="line">            <span class="keyword">const</span> user = res.<span class="property">user</span></span><br><span class="line">            <span class="keyword">const</span> avatar = (user.<span class="property">avatar</span> == <span class="string">&quot;&quot;</span> || user.<span class="property">avatar</span> == <span class="literal">null</span>) ? <span class="built_in">require</span>(<span class="string">&quot;@/assets/images/profile.jpg&quot;</span>) : process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span> + user.<span class="property">avatar</span>;</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">roles</span> &amp;&amp; res.<span class="property">roles</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 验证返回的roles是否是一个非空数组</span></span><br><span class="line">                <span class="comment">//如果存在，将角色与权限存到vuex里面，做全局存储</span></span><br><span class="line">                <span class="title function_">commit</span>(<span class="string">&#x27;SET_ROLES&#x27;</span>, res.<span class="property">roles</span>)</span><br><span class="line">                <span class="title function_">commit</span>(<span class="string">&#x27;SET_PERMISSIONS&#x27;</span>, res.<span class="property">permissions</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">commit</span>(<span class="string">&#x27;SET_ROLES&#x27;</span>, [<span class="string">&#x27;ROLE_DEFAULT&#x27;</span>])</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">commit</span>(<span class="string">&#x27;SET_ID&#x27;</span>, user.<span class="property">userId</span>)</span><br><span class="line">            <span class="title function_">commit</span>(<span class="string">&#x27;SET_NAME&#x27;</span>, user.<span class="property">userName</span>)</span><br><span class="line">            <span class="title function_">commit</span>(<span class="string">&#x27;SET_AVATAR&#x27;</span>, avatar)</span><br><span class="line">            <span class="title function_">resolve</span>(res)</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(error)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.login.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/getInfo&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="4-2-后端实现"><a href="#4-2-后端实现" class="headerlink" title="4-2 后端实现"></a>4-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysLoginController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SysPermissionService permissionService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 获取用户信息</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> 用户信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getInfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">getInfo</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">SysUser</span> <span class="variable">user</span> <span class="operator">=</span> SecurityUtils.getLoginUser().getUser(); <span class="comment">//获取用户信息</span></span><br><span class="line">    <span class="comment">// 角色集合</span></span><br><span class="line">    Set&lt;String&gt; roles = permissionService.getRolePermission(user);</span><br><span class="line">    <span class="comment">// 权限集合</span></span><br><span class="line">    Set&lt;String&gt; permissions = permissionService.getMenuPermission(user);</span><br><span class="line">    <span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">    ajax.put(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line">    ajax.put(<span class="string">&quot;roles&quot;</span>, roles);</span><br><span class="line">    ajax.put(<span class="string">&quot;permissions&quot;</span>, permissions);</span><br><span class="line">    <span class="keyword">return</span> ajax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-framework.com.ruoyi.framework.web.service.SysPermissionService</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取角色数据权限</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 角色权限信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">getRolePermission</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    Set&lt;String&gt; roles = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line">    <span class="comment">// 管理员拥有所有权限</span></span><br><span class="line">    <span class="keyword">if</span> (user.isAdmin()) <span class="comment">//判断是否为超级管理员</span></span><br><span class="line">    &#123;</span><br><span class="line">        roles.add(<span class="string">&quot;admin&quot;</span>); <span class="comment">//&quot;admin&quot;代表超级管理员</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        roles.addAll(roleService.selectRolePermissionByUserId(user.getUserId()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> roles;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取菜单数据权限</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 菜单权限信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">getMenuPermission</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    Set&lt;String&gt; perms = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line">    <span class="comment">// 管理员拥有所有权限</span></span><br><span class="line">    <span class="keyword">if</span> (user.isAdmin()) <span class="comment">//判断是否为超级管理员</span></span><br><span class="line">    &#123;</span><br><span class="line">        perms.add(<span class="string">&quot;*:*:*&quot;</span>); <span class="comment">//&quot;*:*:*&quot;代表有所有权限</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SysRole&gt; roles = user.getRoles();</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(roles))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 多角色设置permissions属性，以便数据权限匹配权限</span></span><br><span class="line">            <span class="keyword">for</span> (SysRole role : roles)</span><br><span class="line">            &#123;</span><br><span class="line">                Set&lt;String&gt; rolePerms = menuService.selectMenuPermsByRoleId(role.getRoleId());</span><br><span class="line">                role.setPermissions(rolePerms);</span><br><span class="line">                perms.addAll(rolePerms);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            perms.addAll(menuService.selectMenuPermsByUserId(user.getUserId()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> perms;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="4-3-数据库"><a href="#4-3-数据库" class="headerlink" title="4-3 数据库"></a>4-3 数据库</h2><ul>
<li>sys-role（角色表）</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528154630969.png"
                      alt="image-20240528154630969"
                ></p>
<ul>
<li>sys-user（用户表）</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528154657836.png"
                      alt="image-20240528154657836"
                ></p>
<ul>
<li>sys-user-role（中间链接表）</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528154809411.png"
                      alt="image-20240528154809411"
                ></p>
<h1 id="5-获取动态菜单路由"><a href="#5-获取动态菜单路由" class="headerlink" title="5- 获取动态菜单路由"></a>5- 获取动态菜单路由</h1><h2 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h2><p>根据当前用户的权限获取动态路由。</p>
<h2 id="5-1-前端实现"><a href="#5-1-前端实现" class="headerlink" title="5-1 前端实现"></a>5-1 前端实现</h2><ul>
<li>permission.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全局路由管理器，前端每个页面跳转都要进入他</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title class_">NProgress</span>.<span class="title function_">start</span>()</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">getToken</span>()) &#123;</span><br><span class="line">    to.<span class="property">meta</span>.<span class="property">title</span> &amp;&amp; store.<span class="title function_">dispatch</span>(<span class="string">&#x27;settings/setTitle&#x27;</span>, to.<span class="property">meta</span>.<span class="property">title</span>)</span><br><span class="line">    <span class="comment">/* has token*/</span></span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">      <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(to.<span class="property">path</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">roles</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        isRelogin.<span class="property">show</span> = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// 判断当前用户是否已拉取完user_info信息</span></span><br><span class="line">        store.<span class="title function_">dispatch</span>(<span class="string">&#x27;GetInfo&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          isRelogin.<span class="property">show</span> = <span class="literal">false</span></span><br><span class="line">          store.<span class="title function_">dispatch</span>(<span class="string">&#x27;GenerateRoutes&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">accessRoutes</span> =&gt;</span> &#123; <span class="comment">//调用GenerateRoutes</span></span><br><span class="line">            <span class="comment">// 根据roles权限生成可访问的路由表</span></span><br><span class="line">            router.<span class="title function_">addRoutes</span>(accessRoutes) <span class="comment">// 动态添加可访问路由表</span></span><br><span class="line">            <span class="title function_">next</span>(&#123; ...to, <span class="attr">replace</span>: <span class="literal">true</span> &#125;) <span class="comment">// hack方法 确保addRoutes已完成</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            store.<span class="title function_">dispatch</span>(<span class="string">&#x27;LogOut&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="title class_">Message</span>.<span class="title function_">error</span>(err)</span><br><span class="line">              <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 没有token</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(to.<span class="property">path</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// 在免登录白名单，直接进入</span></span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">`/login?redirect=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(to.fullPath)&#125;</span>`</span>) <span class="comment">// 否则全部重定向到登录页</span></span><br><span class="line">      <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.store.modules.permission.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">  <span class="comment">// 生成路由</span></span><br><span class="line">  <span class="title class_">GenerateRoutes</span>(&#123; commit &#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 向后端请求路由数据</span></span><br><span class="line">      <span class="title function_">getRouters</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123; <span class="comment">//调用getRouters</span></span><br><span class="line">        <span class="keyword">const</span> sdata = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>))</span><br><span class="line">        <span class="keyword">const</span> rdata = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>))</span><br><span class="line">        <span class="keyword">const</span> sidebarRoutes = <span class="title function_">filterAsyncRouter</span>(sdata)</span><br><span class="line">        <span class="keyword">const</span> rewriteRoutes = <span class="title function_">filterAsyncRouter</span>(rdata, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">const</span> asyncRoutes = <span class="title function_">filterDynamicRoutes</span>(dynamicRoutes);</span><br><span class="line">        rewriteRoutes.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>, <span class="attr">redirect</span>: <span class="string">&#x27;/404&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">        router.<span class="title function_">addRoutes</span>(asyncRoutes);</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;SET_ROUTES&#x27;</span>, rewriteRoutes)</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;SET_SIDEBAR_ROUTERS&#x27;</span>, constantRoutes.<span class="title function_">concat</span>(sidebarRoutes))</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;SET_DEFAULT_ROUTES&#x27;</span>, sidebarRoutes)</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;SET_TOPBAR_ROUTES&#x27;</span>, sidebarRoutes)</span><br><span class="line">        <span class="title function_">resolve</span>(rewriteRoutes)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.menu.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getRouters</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/getRouters&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="5-2-后端实现"><a href="#5-2-后端实现" class="headerlink" title="5-2 后端实现"></a>5-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysLoginController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ISysMenuService menuService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取路由信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 路由信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getRouters&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">getRouters</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> SecurityUtils.getUserId(); <span class="comment">//获取用户id</span></span><br><span class="line">    List&lt;SysMenu&gt; menus = menuService.selectMenuTreeByUserId(userId); <span class="comment">//获取对应的分级菜单列表</span></span><br><span class="line">    <span class="keyword">return</span> AjaxResult.success(menuService.buildMenus(menus)); <span class="comment">//构建前端路由所需要的菜单，返回</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysMenuServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户ID查询菜单</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId 用户名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 菜单列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SysMenu&gt; <span class="title function_">selectMenuTreeByUserId</span><span class="params">(Long userId)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysMenu&gt; menus = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (SecurityUtils.isAdmin(userId)) <span class="comment">//判断是否为超级管理员</span></span><br><span class="line">    &#123;</span><br><span class="line">    	menus = menuMapper.selectMenuTreeAll(); <span class="comment">//调用selectMenuTreeAll，根据用户ID查询菜单树信息（所有）</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    	menus = menuMapper.selectMenuTreeByUserId(userId); <span class="comment">//调用selectMenuTreeByUserId，根据用户ID查询菜单树信息</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> getChildPerms(menus, <span class="number">0</span>); <span class="comment">//调用getChildPerms，把菜单树信息转换成分级菜单列表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysMenuServiceImpl</li>
</ul>
<p>本代码是先得到上面（数据库的24条数据和parentId为0），然后找到 parentId为0 的4条数据；</p>
<p>然后从4条数据中的 ”系统管理“ 的menuId和24条数据的 parentId 比较，得到  parentId为1 的9条数据；</p>
<p>然后判断这9条数据是否还有子节点，如果有，则递归，将 “日志管理” 的menuId和24条数据的 parentId 比较，得到 parentId为108 的2条数据。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据父节点的ID获取所有子节点</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> list 分类表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parentId 传入的父节点ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SysMenu&gt; <span class="title function_">getChildPerms</span><span class="params">(List&lt;SysMenu&gt; list, <span class="type">int</span> parentId)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysMenu&gt; returnList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;SysMenu&gt;(); </span><br><span class="line">    <span class="keyword">for</span> (Iterator&lt;SysMenu&gt; iterator = list.iterator(); iterator.hasNext();) <span class="comment">//遍历每个节点  </span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysMenu</span> <span class="variable">t</span> <span class="operator">=</span> (SysMenu) iterator.next();</span><br><span class="line">        <span class="comment">// 一、根据传入的某个父节点ID,遍历该父节点的所有子节点</span></span><br><span class="line">        <span class="keyword">if</span> (t.getParentId() == parentId)</span><br><span class="line">        &#123;</span><br><span class="line">            recursionFn(list, t); <span class="comment">//调用recursionFn，为每个节点设置子节点（如果有） </span></span><br><span class="line">            returnList.add(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> returnList; <span class="comment">//返回分级菜单列表</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递归列表</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> list 分类表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> t 子节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">recursionFn</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 得到子节点列表</span></span><br><span class="line">    List&lt;SysMenu&gt; childList = getChildList(list, t); <span class="comment">//调用getChildList，得到子节点列表</span></span><br><span class="line">    t.setChildren(childList); <span class="comment">//设置子节点</span></span><br><span class="line">    <span class="keyword">for</span> (SysMenu tChild : childList) <span class="comment">//遍历子节点</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasChild(list, tChild))  <span class="comment">//调用hasChild，判断是否子节点还有子节点</span></span><br><span class="line">        &#123;</span><br><span class="line">            recursionFn(list, tChild); <span class="comment">//递归处理</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到子节点列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;SysMenu&gt; <span class="title function_">getChildList</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysMenu&gt; tlist = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;SysMenu&gt;();</span><br><span class="line">    Iterator&lt;SysMenu&gt; it = list.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysMenu</span> <span class="variable">n</span> <span class="operator">=</span> (SysMenu) it.next();</span><br><span class="line">        <span class="keyword">if</span> (n.getParentId().longValue() == t.getMenuId().longValue())</span><br><span class="line">        &#123;</span><br><span class="line">            tlist.add(n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tlist;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断是否有子节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">hasChild</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> getChildList(list, t).size() &gt; <span class="number">0</span>; <span class="comment">//调用getChildList</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="5-3-数据库"><a href="#5-3-数据库" class="headerlink" title="5-3 数据库"></a>5-3 数据库</h2><ul>
<li>sys-menu</li>
</ul>
<p>菜单表是通过 menu-id 与 parent-id 来形成分级菜单的。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528164545407.png"
                      alt="image-20240528164545407"
                ></p>
<h1 id="6-首页数据加载"><a href="#6-首页数据加载" class="headerlink" title="6- 首页数据加载"></a>6- 首页数据加载</h1><h2 id="6-1-侧边栏菜单"><a href="#6-1-侧边栏菜单" class="headerlink" title="6-1 侧边栏菜单"></a>6-1 侧边栏菜单</h2><ul>
<li>ruoyi-ui.src.layout.components.Sidebar.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;sidebar-item       </span><br><span class="line">    v-for=&quot;(route, index) in sidebarRouters&quot;  //通过遍历，实现侧边栏菜单。   </span><br><span class="line">    :key=&quot;route.path  + index&quot;</span><br><span class="line">    :item=&quot;route&quot;</span><br><span class="line">    :base-path=&quot;route.path&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="6-2-主页面"><a href="#6-2-主页面" class="headerlink" title="6-2 主页面"></a>6-2 主页面</h2><ul>
<li>ruoyi-ui.src.router.index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="title class_">Layout</span>, <span class="comment">//登录后跳向 layout.index.vue </span></span><br><span class="line">  <span class="attr">redirect</span>: <span class="string">&#x27;index&#x27;</span>, <span class="comment">//重定向，从 layout.index.vue 自动跳向 views/index.vue</span></span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/index&#x27;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Index&#x27;</span>,</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;首页&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;dashboard&#x27;</span>, <span class="attr">affix</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.layout.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div :class=&quot;classObj&quot; class=&quot;app-wrapper&quot; :style=&quot;&#123;&#x27;--current-color&#x27;: theme&#125;&quot;&gt;</span><br><span class="line">    &lt;div v-if=&quot;device===&#x27;mobile&#x27;&amp;&amp;sidebar.opened&quot; class=&quot;drawer-bg&quot; @click=&quot;handleClickOutside&quot;/&gt;</span><br><span class="line">    &lt;sidebar v-if=&quot;!sidebar.hide&quot; class=&quot;sidebar-container&quot;/&gt; //侧边栏</span><br><span class="line">    &lt;div :class=&quot;&#123;hasTagsView:needTagsView,sidebarHide:sidebar.hide&#125;&quot; class=&quot;main-container&quot;&gt;</span><br><span class="line">      &lt;div :class=&quot;&#123;&#x27;fixed-header&#x27;:fixedHeader&#125;&quot;&gt;</span><br><span class="line">        &lt;navbar/&gt;</span><br><span class="line">        &lt;tags-view v-if=&quot;needTagsView&quot;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;app-main/&gt; //主页面</span><br><span class="line">      &lt;right-panel&gt;</span><br><span class="line">        &lt;settings/&gt;</span><br><span class="line">      &lt;/right-panel&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.index.vue</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240529200143986.png"
                      alt="image-20240529200143986"
                ></p>
<h2 id="6-3-页面跳转"><a href="#6-3-页面跳转" class="headerlink" title="6-3 页面跳转"></a>6-3 页面跳转</h2><p>从数据库 sys-menu 表中的 component 得到对应功能的 前端页面路径，默认是其下面的 index.vue。</p>
<h1 id="7-用户管理-分页查询"><a href="#7-用户管理-分页查询" class="headerlink" title="7- 用户管理-分页查询"></a>7- 用户管理-分页查询</h1><h2 id="7-1-前端实现"><a href="#7-1-前端实现" class="headerlink" title="7-1 前端实现"></a>7-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 查询用户列表 */</span></span><br><span class="line"><span class="title function_">getList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">true</span>; <span class="comment">//是否开启加载效果</span></span><br><span class="line">    <span class="comment">//调用listUser，携带参数 页数和每页条数</span></span><br><span class="line">    <span class="title function_">listUser</span>(<span class="variable language_">this</span>.<span class="title function_">addDateRange</span>(<span class="variable language_">this</span>.<span class="property">queryParams</span>, <span class="variable language_">this</span>.<span class="property">dateRange</span>)).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">userList</span> = response.<span class="property">rows</span>; <span class="comment">//所有的数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">total</span> = response.<span class="property">total</span>; <span class="comment">//数据总数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span>; <span class="comment">//当加载完毕后，关闭加载效果</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询用户列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">listUser</span>(<span class="params">query</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user/list&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: query</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="7-2-后端实现"><a href="#7-2-后端实现" class="headerlink" title="7-2 后端实现"></a>7-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:list&#x27;)&quot;)</span> <span class="comment">//判断用户是否有权限</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> TableDataInfo <span class="title function_">list</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    startPage(); <span class="comment">// 调用startPage，此方法配合前端完成自动分页</span></span><br><span class="line">    List&lt;SysUser&gt; list = userService.selectUserList(user); <span class="comment">//调用selectUserList，从数据库查询数据</span></span><br><span class="line">    <span class="keyword">return</span> getDataTable(list); <span class="comment">//返回表格分页数据对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><ul>
<li>ruoyi-common.com.ruoyi.common.utils.PageUtils</li>
</ul>
<p>PageHelper 中的 reasonable 对参数进行逻辑处理，保证参数的正确性。</p>
<p>比如 pageNum &#x3D; 0、-1，那 pageNum 默认 &#x3D;1。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置请求分页数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">startPage</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//1.创建一个PageDomain对象，用于接收前端分页的参数；</span></span><br><span class="line">    <span class="type">PageDomain</span> <span class="variable">pageDomain</span> <span class="operator">=</span> TableSupport.buildPageRequest(); <span class="comment">//调用buildPageRequest，获取分页参数</span></span><br><span class="line">    <span class="comment">//2.从PageDomain对象中提取出当前页码、每页大小、排序条件；</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">pageNum</span> <span class="operator">=</span> pageDomain.getPageNum(); <span class="comment">//获取当前页码</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">pageSize</span> <span class="operator">=</span> pageDomain.getPageSize(); <span class="comment">//获取每页大小</span></span><br><span class="line">    <span class="comment">//3.对排序条件进行转义处理，防止SQL注入；</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">orderBy</span> <span class="operator">=</span> SqlUtil.escapeOrderBySql(pageDomain.getOrderBy());</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">reasonable</span> <span class="operator">=</span> pageDomain.getReasonable(); <span class="comment">//获取是否合理分页</span></span><br><span class="line">    <span class="comment">//4.使用PageHelper开启分页，设置页码、每页大小、排序条件和是否合理分页。</span></span><br><span class="line">    PageHelper.startPage(pageNum, pageSize, orderBy).setReasonable(reasonable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-common.com.ruoyi.common.core.page.TableSupport</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当前记录起始索引</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAGE_NUM</span> <span class="operator">=</span> <span class="string">&quot;pageNum&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 每页显示记录数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAGE_SIZE</span> <span class="operator">=</span> <span class="string">&quot;pageSize&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 排序列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDER_BY_COLUMN</span> <span class="operator">=</span> <span class="string">&quot;orderByColumn&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 排序的方向 &quot;desc&quot; 或者 &quot;asc&quot;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">IS_ASC</span> <span class="operator">=</span> <span class="string">&quot;isAsc&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页参数合理化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REASONABLE</span> <span class="operator">=</span> <span class="string">&quot;reasonable&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装分页对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> PageDomain <span class="title function_">getPageDomain</span><span class="params">()</span> <span class="comment">//获取前端传入的分页参数</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">PageDomain</span> <span class="variable">pageDomain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageDomain</span>();</span><br><span class="line">    pageDomain.setPageNum(Convert.toInt(ServletUtils.getParameter(PAGE_NUM), <span class="number">1</span>));</span><br><span class="line">    pageDomain.setPageSize(Convert.toInt(ServletUtils.getParameter(PAGE_SIZE), <span class="number">10</span>));</span><br><span class="line">    pageDomain.setOrderByColumn(ServletUtils.getParameter(ORDER_BY_COLUMN));</span><br><span class="line">    pageDomain.setIsAsc(ServletUtils.getParameter(IS_ASC));</span><br><span class="line">    pageDomain.setReasonable(ServletUtils.getParameterToBool(REASONABLE));</span><br><span class="line">    <span class="keyword">return</span> pageDomain;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> PageDomain <span class="title function_">buildPageRequest</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> getPageDomain(); <span class="comment">//调用getPageDomain</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<p>注解 @DataScope(deptAlias &#x3D; “d”, userAlias &#x3D; “u”)  作用：</p>
<p>给表设置别名的，sys_dept 是 d，sys_user 是 u。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据条件分页查询用户列表</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 用户信息集合信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@DataScope(deptAlias = &quot;d&quot;, userAlias = &quot;u&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SysUser&gt; <span class="title function_">selectUserList</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> userMapper.selectUserList(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="8-用户管理-公司树状图"><a href="#8-用户管理-公司树状图" class="headerlink" title="8- 用户管理-公司树状图"></a>8- 用户管理-公司树状图</h1><h2 id="8-1-前端实现"><a href="#8-1-前端实现" class="headerlink" title="8-1 前端实现"></a>8-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 查询部门下拉树结构 */</span></span><br><span class="line"><span class="title function_">getDeptTree</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">deptTreeSelect</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; <span class="comment">//调用deptTreeSelect</span></span><br><span class="line">    	<span class="variable language_">this</span>.<span class="property">deptOptions</span> = response.<span class="property">data</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询部门下拉树结构</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deptTreeSelect</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user/deptTree&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="8-2-后端实现"><a href="#8-2-后端实现" class="headerlink" title="8-2 后端实现"></a>8-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取部门树列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:list&#x27;)&quot;)</span>  <span class="comment">//判断用户是否有权限</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/deptTree&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">deptTree</span><span class="params">(SysDept dept)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> success(deptService.selectDeptTreeList(dept)); <span class="comment">//调用selectDeptTreeList</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysDeptServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询部门树结构信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dept 部门信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 部门树信息集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;TreeSelect&gt; <span class="title function_">selectDeptTreeList</span><span class="params">(SysDept dept)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//调用selectDeptList，得到所有部门数据</span></span><br><span class="line">    List&lt;SysDept&gt; depts = SpringUtils.getAopProxy(<span class="built_in">this</span>).selectDeptList(dept); </span><br><span class="line">    <span class="keyword">return</span> buildDeptTreeSelect(depts); <span class="comment">//调用buildDeptTreeSelect，将得到的部门数据构造成树 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="查询-1"><a href="#查询-1" class="headerlink" title="查询"></a>查询</h3><ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysDeptServiceImpl</li>
</ul>
<p>注解 @DataScope(deptAlias &#x3D; “d”)  作用：</p>
<p>给表设置别名的，sys_dept 是 d。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询部门管理数据</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dept 部门信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 部门信息集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@DataScope(deptAlias = &quot;d&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SysDept&gt; <span class="title function_">selectDeptList</span><span class="params">(SysDept dept)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> deptMapper.selectDeptList(dept);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="构造树"><a href="#构造树" class="headerlink" title="构造树"></a>构造树</h3><ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysDeptServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构建前端所需要下拉树结构</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> depts 部门列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 下拉树结构列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;TreeSelect&gt; <span class="title function_">buildDeptTreeSelect</span><span class="params">(List&lt;SysDept&gt; depts)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysDept&gt; deptTrees = buildDeptTree(depts); <span class="comment">//调用buildDeptTree（核心方法），将传入的部门数据构造成树状图</span></span><br><span class="line">    <span class="comment">//将泛型 SysDept 转成 TreeSelect</span></span><br><span class="line">    <span class="keyword">return</span> deptTrees.stream().map(TreeSelect::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>构造树状图</p>
<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysDeptServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构建前端所需要树结构</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> depts 部门列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 树结构列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SysDept&gt; <span class="title function_">buildDeptTree</span><span class="params">(List&lt;SysDept&gt; depts)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysDept&gt; returnList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;SysDept&gt;();</span><br><span class="line">    List&lt;Long&gt; tempList = depts.stream().map(SysDept::getDeptId).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">for</span> (SysDept dept : depts) <span class="comment">//遍历节点</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果是顶级节点, 遍历该父节点的所有子节点</span></span><br><span class="line">        <span class="keyword">if</span> (!tempList.contains(dept.getParentId()))</span><br><span class="line">        &#123;</span><br><span class="line">            recursionFn(depts, dept); <span class="comment">//调用recursionFn，为每个节点设置子节点（如果有） </span></span><br><span class="line">            returnList.add(dept);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (returnList.isEmpty())</span><br><span class="line">    &#123;</span><br><span class="line">        returnList = depts;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> returnList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysMenuServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递归列表</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> list 分类表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> t 子节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">recursionFn</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 得到子节点列表</span></span><br><span class="line">    List&lt;SysMenu&gt; childList = getChildList(list, t); <span class="comment">//调用getChildList，得到子节点列表</span></span><br><span class="line">    t.setChildren(childList); <span class="comment">//设置子节点</span></span><br><span class="line">    <span class="keyword">for</span> (SysMenu tChild : childList) <span class="comment">//遍历子节点</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasChild(list, tChild))  <span class="comment">//调用hasChild，判断是否子节点还有子节点</span></span><br><span class="line">        &#123;</span><br><span class="line">            recursionFn(list, tChild); <span class="comment">//递归处理</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到子节点列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;SysMenu&gt; <span class="title function_">getChildList</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysMenu&gt; tlist = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;SysMenu&gt;();</span><br><span class="line">    Iterator&lt;SysMenu&gt; it = list.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysMenu</span> <span class="variable">n</span> <span class="operator">=</span> (SysMenu) it.next();</span><br><span class="line">        <span class="keyword">if</span> (n.getParentId().longValue() == t.getMenuId().longValue())</span><br><span class="line">        &#123;</span><br><span class="line">            tlist.add(n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tlist;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断是否有子节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">hasChild</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> getChildList(list, t).size() &gt; <span class="number">0</span>; <span class="comment">//调用getChildList</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>转换泛型</p>
<ul>
<li>ruoyi-common.com.ruoyi.common.core.domain.TreeSelect</li>
</ul>
<p>通过构造方法，将 数据库对应的部门树状图 转变为 前端对应的部门树状图</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 节点ID */</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 节点名称 */</span></span><br><span class="line"><span class="keyword">private</span> String label;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 子节点 */</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_EMPTY)</span></span><br><span class="line"><span class="keyword">private</span> List&lt;TreeSelect&gt; children;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">TreeSelect</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">TreeSelect</span><span class="params">(SysDept dept)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">this</span>.id = dept.getDeptId();</span><br><span class="line">    <span class="built_in">this</span>.label = dept.getDeptName();</span><br><span class="line">    <span class="built_in">this</span>.children = dept.getChildren().stream().map(TreeSelect::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>数据库对应</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240530205740821.png"
                      alt="image-20240530205740821"
                ></p>
<ul>
<li>前端对应</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240530205811054.png"
                      alt="image-20240530205811054"
                ></p>
<h2 id="8-3-数据库"><a href="#8-3-数据库" class="headerlink" title="8-3 数据库"></a>8-3 数据库</h2><ul>
<li>sys-dept</li>
</ul>
<p>公司树是通过 dept-id 与 parent-id 来形成树状图的。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240530170350824.png"
                      alt="image-20240530170350824"
                ></p>
<h1 id="9-用户管理-点击树状图查询"><a href="#9-用户管理-点击树状图查询" class="headerlink" title="9- 用户管理-点击树状图查询"></a>9- 用户管理-点击树状图查询</h1><h2 id="9-1-前端实现"><a href="#9-1-前端实现" class="headerlink" title="9-1 前端实现"></a>9-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;head-container&quot;&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">         :data=&quot;deptOptions&quot;</span><br><span class="line">         :props=&quot;defaultProps&quot;</span><br><span class="line">         :expand-on-click-node=&quot;false&quot;</span><br><span class="line">         :filter-node-method=&quot;filterNode&quot;</span><br><span class="line">         ref=&quot;tree&quot;</span><br><span class="line">         node-key=&quot;id&quot;</span><br><span class="line">         default-expand-all</span><br><span class="line">         highlight-current</span><br><span class="line">         @node-click=&quot;handleNodeClick&quot; //点击方法</span><br><span class="line">         /&gt;</span><br><span class="line">&lt;/div&gt;        </span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 节点单击事件</span></span><br><span class="line"><span class="title function_">handleNodeClick</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queryParams</span>.<span class="property">deptId</span> = data.<span class="property">id</span>; <span class="comment">//得到点击的部门ID，作为参数传入后端</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">handleQuery</span>(); <span class="comment">//调用handleQuery</span></span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"><span class="comment">/** 搜索按钮操作 */</span></span><br><span class="line"><span class="title function_">handleQuery</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queryParams</span>.<span class="property">pageNum</span> = <span class="number">1</span>; <span class="comment">//将页数设置为1</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getList</span>(); <span class="comment">//调用getList，获取用户</span></span><br><span class="line">&#125;,    </span><br></pre></td></tr></table></figure></div>

<h2 id="9-2-后端实现"><a href="#9-2-后端实现" class="headerlink" title="9-2 后端实现"></a>9-2 后端实现</h2><p>和 用户管理-分页查询 的后端流程一样，只是会多加一个参数 dept-id，参与查询。</p>
<h1 id="10-添加用户数据预加载（表单）"><a href="#10-添加用户数据预加载（表单）" class="headerlink" title="10- 添加用户数据预加载（表单）"></a>10- 添加用户数据预加载（表单）</h1><h2 id="10-1-前端实现"><a href="#10-1-前端实现" class="headerlink" title="10-1 前端实现"></a>10-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 新增按钮 --&gt;</span><br><span class="line">&lt;el-col :span=&quot;1.5&quot;&gt;</span><br><span class="line">    &lt;el-button</span><br><span class="line">    	type=&quot;primary&quot;</span><br><span class="line">        plain</span><br><span class="line">        icon=&quot;el-icon-plus&quot;</span><br><span class="line">        size=&quot;mini&quot;</span><br><span class="line">        @click=&quot;handleAdd&quot;</span><br><span class="line">        v-hasPermi=&quot;[&#x27;system:user:add&#x27;]&quot;</span><br><span class="line">     &gt;新增&lt;/el-button&gt;</span><br><span class="line">&lt;/el-col&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 新增按钮操作 */</span></span><br><span class="line"><span class="title function_">handleAdd</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">reset</span>(); <span class="comment">//调用reset，表单重置</span></span><br><span class="line">    <span class="title function_">getUser</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; <span class="comment">//调用getUser，获取岗位和角色 </span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">postOptions</span> = response.<span class="property">posts</span>; <span class="comment">//岗位</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">roleOptions</span> = response.<span class="property">roles</span>; <span class="comment">//角色</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">true</span>; <span class="comment">//打开用户表单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&quot;添加用户&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">password</span> = <span class="variable language_">this</span>.<span class="property">initPassword</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 表单重置</span></span><br><span class="line"><span class="title function_">reset</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">form</span> = &#123;</span><br><span class="line">        <span class="attr">userId</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">deptId</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">userName</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">nickName</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">phonenumber</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">email</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">sex</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="attr">remark</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">postIds</span>: [],</span><br><span class="line">        <span class="attr">roleIds</span>: []</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">resetForm</span>(<span class="string">&quot;form&quot;</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询用户详细</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getUser</span>(<span class="params">userId</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user/&#x27;</span> + <span class="title function_">parseStrEmpty</span>(userId),</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="10-2-后端实现"><a href="#10-2-后端实现" class="headerlink" title="10-2 后端实现"></a>10-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<p>添加和修改使用同一个，有 userId 是修改，无 userId 是添加。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据用户编号获取详细信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:query&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(value = &#123; &quot;/&quot;, &quot;/&#123;userId&#125;&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;userId&quot;, required = false)</span> Long userId)</span></span><br><span class="line">&#123;</span><br><span class="line">    userService.checkUserDataScope(userId); <span class="comment">//调用checkUserDataScope，判断用户是否有数据权限，只有管理员可以</span></span><br><span class="line">    <span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">    List&lt;SysRole&gt; roles = roleService.selectRoleAll();</span><br><span class="line">    <span class="comment">//如果是管理员，获取所有角色；如果不是管理员，则排除管理员角色</span></span><br><span class="line">    ajax.put(<span class="string">&quot;roles&quot;</span>, SysUser.isAdmin(userId) ? roles : roles.stream().filter(r -&gt; !r.isAdmin()).collect(Collectors.toList()));</span><br><span class="line">    <span class="comment">//获取所有岗位</span></span><br><span class="line">    ajax.put(<span class="string">&quot;posts&quot;</span>, postService.selectPostAll());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断是否有userId，如果没有，直接返回；如果有，则获取他的用户信息、角色、岗位返回</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotNull(userId))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> userService.selectUserById(userId);</span><br><span class="line">        ajax.put(AjaxResult.DATA_TAG, sysUser);</span><br><span class="line">        ajax.put(<span class="string">&quot;postIds&quot;</span>, postService.selectPostListByUserId(userId));                                ajax.put(<span class="string">&quot;roleIds&quot;</span>,sysUser.getRoles().stream().map(SysRole::getRoleId).collect(Collectors.toList()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ajax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 校验用户是否有数据权限</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId 用户id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkUserDataScope</span><span class="params">(Long userId)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!SysUser.isAdmin(SecurityUtils.getUserId()))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SysUser</span>();</span><br><span class="line">        user.setUserId(userId);</span><br><span class="line">        List&lt;SysUser&gt; users = SpringUtils.getAopProxy(<span class="built_in">this</span>).selectUserList(user);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(users))</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;没有权限访问用户数据！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="10-3-数据库"><a href="#10-3-数据库" class="headerlink" title="10-3 数据库"></a>10-3 数据库</h2><ul>
<li>sys-post</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240531141555881.png"
                      alt="image-20240531141555881"
                ></p>
<h1 id="11-添加用户"><a href="#11-添加用户" class="headerlink" title="11- 添加用户"></a>11- 添加用户</h1><h2 id="11-1-前端实现"><a href="#11-1-前端实现" class="headerlink" title="11-1 前端实现"></a>11-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<p>归属部门：deptOptions 是 公司树状图的 this.deptOptions &#x3D; response.data，得到树状图。</p>
<p>岗位：item in postOptions 是 this.postOptions &#x3D; response.posts，通过 添加预加载 得到的岗位数据，然后遍历显示。</p>
<p>角色：item in roleOptions 是 this.roleOptions &#x3D; response.roles，通过 添加预加载 得到的角色数据，然后遍历显示。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 添加或修改用户配置对话框 --&gt;</span><br><span class="line">    &lt;el-dialog :title=&quot;title&quot; :visible.sync=&quot;open&quot; width=&quot;600px&quot; append-to-body&gt;</span><br><span class="line">      &lt;el-form ref=&quot;form&quot; :model=&quot;form&quot; :rules=&quot;rules&quot; label-width=&quot;80px&quot;&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;用户昵称&quot; prop=&quot;nickName&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.nickName&quot; placeholder=&quot;请输入用户昵称&quot; maxlength=&quot;30&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;归属部门&quot; prop=&quot;deptId&quot;&gt;</span><br><span class="line">              &lt;treeselect v-model=&quot;form.deptId&quot; :options=&quot;deptOptions&quot; :show-count=&quot;true&quot; placeholder=&quot;请选择归属部门&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;手机号码&quot; prop=&quot;phonenumber&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.phonenumber&quot; placeholder=&quot;请输入手机号码&quot; maxlength=&quot;11&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;邮箱&quot; prop=&quot;email&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.email&quot; placeholder=&quot;请输入邮箱&quot; maxlength=&quot;50&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item v-if=&quot;form.userId == undefined&quot; label=&quot;用户名称&quot; prop=&quot;userName&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.userName&quot; placeholder=&quot;请输入用户名称&quot; maxlength=&quot;30&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item v-if=&quot;form.userId == undefined&quot; label=&quot;用户密码&quot; prop=&quot;password&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.password&quot; placeholder=&quot;请输入用户密码&quot; type=&quot;password&quot; maxlength=&quot;20&quot; show-password/&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;用户性别&quot;&gt;</span><br><span class="line">              &lt;el-select v-model=&quot;form.sex&quot; placeholder=&quot;请选择性别&quot;&gt;</span><br><span class="line">                &lt;el-option</span><br><span class="line">                  v-for=&quot;dict in dict.type.sys_user_sex&quot;</span><br><span class="line">                  :key=&quot;dict.value&quot;</span><br><span class="line">                  :label=&quot;dict.label&quot;</span><br><span class="line">                  :value=&quot;dict.value&quot;</span><br><span class="line">                &gt;&lt;/el-option&gt;</span><br><span class="line">              &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;状态&quot;&gt;</span><br><span class="line">              &lt;el-radio-group v-model=&quot;form.status&quot;&gt;</span><br><span class="line">                &lt;el-radio</span><br><span class="line">                  v-for=&quot;dict in dict.type.sys_normal_disable&quot;</span><br><span class="line">                  :key=&quot;dict.value&quot;</span><br><span class="line">                  :label=&quot;dict.value&quot;</span><br><span class="line">                &gt;&#123;&#123;dict.label&#125;&#125;&lt;/el-radio&gt;</span><br><span class="line">              &lt;/el-radio-group&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;岗位&quot;&gt;</span><br><span class="line">              &lt;el-select v-model=&quot;form.postIds&quot; multiple placeholder=&quot;请选择岗位&quot;&gt;</span><br><span class="line">                &lt;el-option</span><br><span class="line">                  v-for=&quot;item in postOptions&quot;</span><br><span class="line">                  :key=&quot;item.postId&quot;</span><br><span class="line">                  :label=&quot;item.postName&quot;</span><br><span class="line">                  :value=&quot;item.postId&quot;</span><br><span class="line">                  :disabled=&quot;item.status == 1&quot;</span><br><span class="line">                &gt;&lt;/el-option&gt;</span><br><span class="line">              &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;角色&quot;&gt;</span><br><span class="line">              &lt;el-select v-model=&quot;form.roleIds&quot; multiple placeholder=&quot;请选择角色&quot;&gt;</span><br><span class="line">                &lt;el-option</span><br><span class="line">                  v-for=&quot;item in roleOptions&quot;</span><br><span class="line">                  :key=&quot;item.roleId&quot;</span><br><span class="line">                  :label=&quot;item.roleName&quot;</span><br><span class="line">                  :value=&quot;item.roleId&quot;</span><br><span class="line">                  :disabled=&quot;item.status == 1&quot;</span><br><span class="line">                &gt;&lt;/el-option&gt;</span><br><span class="line">              &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;24&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;备注&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.remark&quot; type=&quot;textarea&quot; placeholder=&quot;请输入内容&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm&quot;&gt;确 定&lt;/el-button&gt; //点击确认，提交表单</span><br><span class="line">        &lt;el-button @click=&quot;cancel&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<p>在 数据库sys-user 的user-id，如果存在，是修改；如果不存在，是添加。</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 提交按钮 */</span></span><br><span class="line"><span class="attr">submitForm</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$refs</span>[<span class="string">&quot;form&quot;</span>].<span class="title function_">validate</span>(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">userId</span> != <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="title function_">updateUser</span>(<span class="variable language_">this</span>.<span class="property">form</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">msgSuccess</span>(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">getList</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">addUser</span>(<span class="variable language_">this</span>.<span class="property">form</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; <span class="comment">//调用addUser，参数是整个表单</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">msgSuccess</span>(<span class="string">&quot;新增成功&quot;</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">getList</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增用户</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">addUser</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="11-2-后端实现"><a href="#11-2-后端实现" class="headerlink" title="11-2 后端实现"></a>11-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:add&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@Log(title = &quot;用户管理&quot;, businessType = BusinessType.INSERT)</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">add</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!userService.checkUserNameUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;新增用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，登录账号已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isNotEmpty(user.getPhonenumber()) &amp;&amp; !userService.checkPhoneUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;新增用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，手机号码已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isNotEmpty(user.getEmail()) &amp;&amp; !userService.checkEmailUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;新增用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，邮箱账号已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    user.setCreateBy(getUsername()); <span class="comment">//将用户是谁添加的，赋到用户的 create-by 字段</span></span><br><span class="line">    user.setPassword(SecurityUtils.encryptPassword(user.getPassword())); <span class="comment">//将用户的密码进行加密</span></span><br><span class="line">    <span class="keyword">return</span> toAjax(userService.insertUser(user)); <span class="comment">//调用insertUser</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增保存用户信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 新增用户信息</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> userMapper.insertUser(user);</span><br><span class="line">    <span class="comment">// 新增用户岗位关联</span></span><br><span class="line">    insertUserPost(user); <span class="comment">//数据库表sys-user-post</span></span><br><span class="line">    <span class="comment">// 新增用户与角色管理</span></span><br><span class="line">    insertUserRole(user); <span class="comment">//数据库表sys-user-role</span></span><br><span class="line">    <span class="keyword">return</span> rows;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="11-3-数据库"><a href="#11-3-数据库" class="headerlink" title="11-3 数据库"></a>11-3 数据库</h2><ul>
<li>sys-user-post</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240531222541280.png"
                      alt="image-20240531222541280"
                ></p>
<ul>
<li>sys-user-role</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240531222558574.png"
                      alt="image-20240531222558574"
                ></p>
<h1 id="12-修改用户"><a href="#12-修改用户" class="headerlink" title="12- 修改用户"></a>12- 修改用户</h1><h2 id="12-1-修改前获取用户信息"><a href="#12-1-修改前获取用户信息" class="headerlink" title="12-1 修改前获取用户信息"></a>12-1 修改前获取用户信息</h2><h3 id="12-1-1-前端实现"><a href="#12-1-1-前端实现" class="headerlink" title="12-1-1 前端实现"></a>12-1-1 前端实现</h3><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template slot-scope=&quot;scope&quot; v-if=&quot;scope.row.userId !== 1&quot;&gt;</span><br><span class="line">    &lt;el-button</span><br><span class="line">        size=&quot;mini&quot;</span><br><span class="line">        type=&quot;text&quot;</span><br><span class="line">        icon=&quot;el-icon-edit&quot;</span><br><span class="line">        @click=&quot;handleUpdate(scope.row)&quot; //点击修改</span><br><span class="line">        v-hasPermi=&quot;[&#x27;system:user:edit&#x27;]&quot;</span><br><span class="line">    &gt;修改&lt;/el-button&gt;</span><br><span class="line">&lt;/template&gt;    </span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 修改按钮操作 */</span></span><br><span class="line"><span class="title function_">handleUpdate</span>(<span class="params">row</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">reset</span>(); <span class="comment">//调用reset，表单重置 </span></span><br><span class="line">  <span class="keyword">const</span> userId = row.<span class="property">userId</span> || <span class="variable language_">this</span>.<span class="property">ids</span>; <span class="comment">//获取用户Id</span></span><br><span class="line">  <span class="title function_">getUser</span>(userId).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; <span class="comment">//调用getUser，参数是userId；获取岗位和角色，同时获取用户信息 </span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">form</span> = response.<span class="property">data</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">postOptions</span> = response.<span class="property">posts</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">roleOptions</span> = response.<span class="property">roles</span>;</span><br><span class="line">    <span class="variable language_">this</span>.$set(<span class="variable language_">this</span>.<span class="property">form</span>, <span class="string">&quot;postIds&quot;</span>, response.<span class="property">postIds</span>);</span><br><span class="line">    <span class="variable language_">this</span>.$set(<span class="variable language_">this</span>.<span class="property">form</span>, <span class="string">&quot;roleIds&quot;</span>, response.<span class="property">roleIds</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">true</span>; <span class="comment">//打开用户表单</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&quot;修改用户&quot;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">password</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询用户详细</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getUser</span>(<span class="params">userId</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user/&#x27;</span> + <span class="title function_">parseStrEmpty</span>(userId),</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="12-1-2-后端实现"><a href="#12-1-2-后端实现" class="headerlink" title="12-1-2 后端实现"></a>12-1-2 后端实现</h3><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据用户编号获取详细信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:query&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(value = &#123; &quot;/&quot;, &quot;/&#123;userId&#125;&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;userId&quot;, required = false)</span> Long userId)</span></span><br><span class="line">&#123;</span><br><span class="line">    userService.checkUserDataScope(userId); <span class="comment">//调用checkUserDataScope，判断用户是否有权限，只有管理员可以</span></span><br><span class="line">    <span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">    List&lt;SysRole&gt; roles = roleService.selectRoleAll();</span><br><span class="line">    <span class="comment">//如果是管理员，获取所有角色；如果不是管理员，则排除管理员角色</span></span><br><span class="line">    ajax.put(<span class="string">&quot;roles&quot;</span>, SysUser.isAdmin(userId) ? roles : roles.stream().filter(r -&gt; !r.isAdmin()).collect(Collectors.toList()));</span><br><span class="line">    <span class="comment">//获取所有岗位</span></span><br><span class="line">    ajax.put(<span class="string">&quot;posts&quot;</span>, postService.selectPostAll());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断是否有userId，如果没有，直接返回；如果有，则获取他的用户信息、角色、岗位返回</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotNull(userId))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> userService.selectUserById(userId);</span><br><span class="line">        ajax.put(AjaxResult.DATA_TAG, sysUser);</span><br><span class="line">        <span class="comment">//将用户角色赋给 postIds</span></span><br><span class="line">        ajax.put(<span class="string">&quot;postIds&quot;</span>, postService.selectPostListByUserId(userId));</span><br><span class="line">        <span class="comment">//将用户岗位赋给roleIds</span></span><br><span class="line">       ajax.put(<span class="string">&quot;roleIds&quot;</span>,sysUser.getRoles().stream().map(SysRole::getRoleId).collect(Collectors.toList()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ajax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="12-2-修改"><a href="#12-2-修改" class="headerlink" title="12-2 修改"></a>12-2 修改</h2><h3 id="12-2-1-前端实现"><a href="#12-2-1-前端实现" class="headerlink" title="12-2-1 前端实现"></a>12-2-1 前端实现</h3><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 提交按钮 */</span></span><br><span class="line"><span class="attr">submitForm</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$refs</span>[<span class="string">&quot;form&quot;</span>].<span class="title function_">validate</span>(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">userId</span> != <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="title function_">updateUser</span>(<span class="variable language_">this</span>.<span class="property">form</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; <span class="comment">//调用updateUser，参数是整个表单</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">msgSuccess</span>(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">getList</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">addUser</span>(<span class="variable language_">this</span>.<span class="property">form</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">msgSuccess</span>(<span class="string">&quot;新增成功&quot;</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">getList</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改用户</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">updateUser</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="12-2-2-后端实现"><a href="#12-2-2-后端实现" class="headerlink" title="12-2-2 后端实现"></a>12-2-2 后端实现</h3><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:edit&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@Log(title = &quot;用户管理&quot;, businessType = BusinessType.UPDATE)</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">edit</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    userService.checkUserAllowed(user); <span class="comment">//调用checkUserAllowed，判断用户是否可以被操作</span></span><br><span class="line">    userService.checkUserDataScope(user.getUserId());</span><br><span class="line">    <span class="keyword">if</span> (!userService.checkUserNameUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;修改用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，登录账号已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isNotEmpty(user.getPhonenumber()) &amp;&amp; !userService.checkPhoneUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;修改用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，手机号码已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isNotEmpty(user.getEmail()) &amp;&amp; !userService.checkEmailUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;修改用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，邮箱账号已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    user.setUpdateBy(getUsername()); <span class="comment">//将用户是谁修改的，赋到用户的 update-by 字段</span></span><br><span class="line">    <span class="keyword">return</span> toAjax(userService.updateUser(user)); <span class="comment">//调用updateUser</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 校验用户是否允许操作</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkUserAllowed</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotNull(user.getUserId()) &amp;&amp; user.isAdmin())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;不允许操作超级管理员用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改保存用户信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getUserId();</span><br><span class="line">    <span class="comment">// 删除用户与角色关联</span></span><br><span class="line">    userRoleMapper.deleteUserRoleByUserId(userId);</span><br><span class="line">    <span class="comment">// 新增用户与角色管理</span></span><br><span class="line">    insertUserRole(user);</span><br><span class="line">    <span class="comment">// 删除用户与岗位关联</span></span><br><span class="line">    userPostMapper.deleteUserPostByUserId(userId);</span><br><span class="line">    <span class="comment">// 新增用户与岗位管理</span></span><br><span class="line">    insertUserPost(user);</span><br><span class="line">    <span class="keyword">return</span> userMapper.updateUser(user); <span class="comment">//调用updateUser，修改用户信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="13-删除用户"><a href="#13-删除用户" class="headerlink" title="13- 删除用户"></a>13- 删除用户</h1><h2 id="13-1-前端实现"><a href="#13-1-前端实现" class="headerlink" title="13-1 前端实现"></a>13-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button</span><br><span class="line">	size=&quot;mini&quot;</span><br><span class="line">    type=&quot;text&quot;</span><br><span class="line">    icon=&quot;el-icon-delete&quot;</span><br><span class="line">    @click=&quot;handleDelete(scope.row)&quot; //点击删除</span><br><span class="line">    v-hasPermi=&quot;[&#x27;system:user:remove&#x27;]&quot;</span><br><span class="line">&gt;删除&lt;/el-button&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 删除按钮操作 */</span></span><br><span class="line"><span class="title function_">handleDelete</span>(<span class="params">row</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> userIds = row.<span class="property">userId</span> || <span class="variable language_">this</span>.<span class="property">ids</span>; <span class="comment">//获取用户Id</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">confirm</span>(<span class="string">&#x27;是否确认删除用户编号为&quot;&#x27;</span> + userIds + <span class="string">&#x27;&quot;的数据项？&#x27;</span>).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">//弹窗</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">delUser</span>(userIds); <span class="comment">//调用delUser，参数是userIds</span></span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getList</span>(); <span class="comment">//调用getList，获取用户</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">msgSuccess</span>(<span class="string">&quot;删除成功&quot;</span>); </span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除用户</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">delUser</span>(<span class="params">userId</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user/&#x27;</span> + userId,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="13-2-后端实现"><a href="#13-2-后端实现" class="headerlink" title="13-2 后端实现"></a>13-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:remove&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@Log(title = &quot;用户管理&quot;, businessType = BusinessType.DELETE)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;userIds&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> Long[] userIds)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//通过比对 要删除的用户Id与当前登录用户的Id，不能删除当前用户</span></span><br><span class="line">    <span class="keyword">if</span> (ArrayUtils.contains(userIds, getUserId()))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;当前用户不能删除&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> toAjax(userService.deleteUserByIds(userIds));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量删除用户信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userIds 需要删除的用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteUserByIds</span><span class="params">(Long[] userIds)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (Long userId : userIds)</span><br><span class="line">    &#123;</span><br><span class="line">        checkUserAllowed(<span class="keyword">new</span> <span class="title class_">SysUser</span>(userId)); <span class="comment">//调用checkUserAllowed，判断用户是否可以被操作</span></span><br><span class="line">        checkUserDataScope(userId); <span class="comment">//调用checkUserDataScope，判断用户是否有数据权限</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除用户与角色关联</span></span><br><span class="line">    userRoleMapper.deleteUserRole(userIds);</span><br><span class="line">    <span class="comment">// 删除用户与岗位关联</span></span><br><span class="line">    userPostMapper.deleteUserPost(userIds);</span><br><span class="line">    <span class="comment">//调用deleteUserByIds，删除用户信息（逻辑删除），他并不是把用户信息删除，而是更改 del-flag，使从0 --&gt; 2，逻辑上删除。</span></span><br><span class="line">    <span class="keyword">return</span> userMapper.deleteUserByIds(userIds); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="14-异步任务管理器"><a href="#14-异步任务管理器" class="headerlink" title="14- 异步任务管理器"></a>14- 异步任务管理器</h1><ul>
<li>ruoyi-framework.com.ruoyi.framework.web.service.SysLoginService</li>
</ul>
<p>通过异步任务管理器记录登录日志。</p>
<p>1、AsyncManager.me()：</p>
<p>​	获取一个 AsycnManager 对象，饿汉式。</p>
<p>2、execute()：</p>
<p>​	调用execute；</p>
<p>​	执行这个任务，传入的是一个 Task(任务) 对象。</p>
<p>3、AsyncFactory.recordLogininfor(username,Constants.LOGIN_FAIL,MessageUtils.message(“user.jcaptcha.expire”))：</p>
<p>​	调用 recordLogininfor；</p>
<p>​	实现了 Runnable 接口，是一个任务，由线程 Thread 去执行。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (captcha == <span class="literal">null</span>) <span class="comment">//如果Redis答案不存在</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//异步日志</span></span><br><span class="line">    AsyncManager.me().execute(AsyncFactory.recordLogininfor(username,Constants.LOGIN_FAIL,</span><br><span class="line">     	MessageUtils.message(<span class="string">&quot;user.jcaptcha.expire&quot;</span>))); </span><br><span class="line">  	<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CaptchaExpireException</span>(); <span class="comment">//抛出过期异常</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!code.equalsIgnoreCase(captcha)) <span class="comment">//如果验证码答案和Redis答案不一致</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//异步日志</span></span><br><span class="line">    AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, 	   </span><br><span class="line">    	MessageUtils.message(<span class="string">&quot;user.jcaptcha.error&quot;</span>)));</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CaptchaException</span>(); <span class="comment">//抛出错误异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-framework.com.ruoyi.framework.manager.factory.AsyncFactory</li>
</ul>
<p>封装了登录用户的信息，执行添加操作，这里不会执行，而是将任务交给线程对象来执行。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 记录登录信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status 状态</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> message 消息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args 列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 任务task</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> TimerTask <span class="title function_">recordLogininfor</span><span class="params">(<span class="keyword">final</span> String username, <span class="keyword">final</span> String status, <span class="keyword">final</span> String message,</span></span><br><span class="line"><span class="params">            <span class="keyword">final</span> Object... args)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">UserAgent</span> <span class="variable">userAgent</span> <span class="operator">=</span> UserAgent.parseUserAgentString(ServletUtils.getRequest().getHeader(<span class="string">&quot;User-Agent&quot;</span>));</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> IpUtils.getIpAddr();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TimerTask</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> AddressUtils.getRealAddressByIP(ip);</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            s.append(LogUtils.getBlock(ip));</span><br><span class="line">            s.append(address);</span><br><span class="line">            s.append(LogUtils.getBlock(username));</span><br><span class="line">            s.append(LogUtils.getBlock(status));</span><br><span class="line">            s.append(LogUtils.getBlock(message));</span><br><span class="line">            <span class="comment">// 打印信息到日志</span></span><br><span class="line">            sys_user_logger.info(s.toString(), args);</span><br><span class="line">            <span class="comment">// 获取客户端操作系统</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">os</span> <span class="operator">=</span> userAgent.getOperatingSystem().getName();</span><br><span class="line">            <span class="comment">// 获取客户端浏览器</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">browser</span> <span class="operator">=</span> userAgent.getBrowser().getName();</span><br><span class="line">            <span class="comment">// 封装对象</span></span><br><span class="line">            <span class="type">SysLogininfor</span> <span class="variable">logininfor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SysLogininfor</span>();</span><br><span class="line">            logininfor.setUserName(username);</span><br><span class="line">            logininfor.setIpaddr(ip);</span><br><span class="line">            logininfor.setLoginLocation(address);</span><br><span class="line">            logininfor.setBrowser(browser);</span><br><span class="line">            logininfor.setOs(os);</span><br><span class="line">            logininfor.setMsg(message);</span><br><span class="line">            <span class="comment">// 日志状态</span></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.equalsAny(status, Constants.LOGIN_SUCCESS, Constants.LOGOUT, Constants.REGISTER))</span><br><span class="line">            &#123;</span><br><span class="line">                logininfor.setStatus(Constants.SUCCESS);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (Constants.LOGIN_FAIL.equals(status))</span><br><span class="line">            &#123;</span><br><span class="line">                logininfor.setStatus(Constants.FAIL);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 插入数据</span></span><br><span class="line">            SpringUtils.getBean(ISysLogininforService.class).insertLogininfor(logininfor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-framework.com.ruoyi.framework.manager.AsyncManager</li>
</ul>
<p>异步任务管理器，内部定义了一个线程池，然后根据业务创建添加日志的任务，交给线程池来处理，这样做到日志和业务的抽象，解合，日志全部统一处理。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异步任务管理器</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作延迟10毫秒</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">OPERATE_DELAY_TIME</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异步操作任务调度线程池</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ScheduledExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> SpringUtils.getBean(<span class="string">&quot;scheduledExecutorService&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单例模式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">AsyncManager</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">AsyncManager</span> <span class="variable">me</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AsyncManager</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AsyncManager <span class="title function_">me</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> me;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行任务</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task 任务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(TimerTask task)</span></span><br><span class="line">    &#123;</span><br><span class="line">        executor.schedule(task, OPERATE_DELAY_TIME, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 停止任务线程池</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Threads.shutdownAndAwaitTermination(executor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="15-代码自动生成"><a href="#15-代码自动生成" class="headerlink" title="15- 代码自动生成"></a>15- 代码自动生成</h1><h2 id="15-1-创建数据表"><a href="#15-1-创建数据表" class="headerlink" title="15-1 创建数据表"></a>15-1 创建数据表</h2><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use ruoyi_vue;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_user(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">11</span>),</span><br><span class="line">	password <span class="type">varchar</span>(<span class="number">11</span>)</span><br><span class="line">&#125;;		</span><br></pre></td></tr></table></figure></div>

<h2 id="15-2-使用工具"><a href="#15-2-使用工具" class="headerlink" title="15-2 使用工具"></a>15-2 使用工具</h2><ul>
<li>启动 若依管理系统 ，点击 系统工具，找到 代码生成。</li>
<li>点击 导入，点击 你要生成的数据库表，点击 确定。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705153600650.png"
                      alt="image-20240705153600650"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602160352961.png"
                      alt="image-20240602160352961"
                ></p>
<ul>
<li>点击 预览，可以看到生成的 java后端，sql数据库，vue前端的代码。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602160655452.png"
                      alt="image-20240602160655452"
                ></p>
<h2 id="15-3-编辑"><a href="#15-3-编辑" class="headerlink" title="15-3 编辑"></a>15-3 编辑</h2><ul>
<li>点击 编辑</li>
<li>必须添加 字段描述</li>
<li>必须添加 表描述</li>
<li>生成模版：单表、树表、主子表</li>
<li>上级菜单：生成的接口会在哪个下面</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602160928700.png"
                      alt="image-20240602160928700"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602161001621.png"
                      alt="image-20240602161001621"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602161220369.png"
                      alt="image-20240602161220369"
                ></p>
<h2 id="15-4-生成代码"><a href="#15-4-生成代码" class="headerlink" title="15-4 生成代码"></a>15-4 生成代码</h2><ul>
<li>点击 生成代码，点击 下载</li>
<li>会在桌面生成一个压缩包</li>
</ul>
<h2 id="15-5-解压"><a href="#15-5-解压" class="headerlink" title="15-5 解压"></a>15-5 解压</h2><ul>
<li>main (Java 后端代码)</li>
<li>vue (Vue 前端代码)</li>
<li>sql (菜单 SQL)</li>
</ul>
<h2 id="15-6-导入"><a href="#15-6-导入" class="headerlink" title="15-6 导入"></a>15-6 导入</h2><ul>
<li>复制代码，导入项目</li>
<li>菜单 由 菜单管理 编辑</li>
</ul>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<h1 id="二、"><a href="#二、" class="headerlink" title="二、"></a>二、</h1><h1 id="1-使用代码生成器"><a href="#1-使用代码生成器" class="headerlink" title="1- 使用代码生成器"></a>1- 使用代码生成器</h1><h2 id="1-1-准备相应的数据库表"><a href="#1-1-准备相应的数据库表" class="headerlink" title="1-1 准备相应的数据库表"></a>1-1 准备相应的数据库表</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708195813114.png"
                      alt="image-20240708195813114"
                ></p>
<h2 id="1-2-准备SQL并导入数据库中"><a href="#1-2-准备SQL并导入数据库中" class="headerlink" title="1-2 准备SQL并导入数据库中"></a>1-2 准备SQL并导入数据库中</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708195923608.png"
                      alt="image-20240708195923608"
                ></p>
<h2 id="1-3-配置代码生成信息"><a href="#1-3-配置代码生成信息" class="headerlink" title="1-3 配置代码生成信息"></a>1-3 配置代码生成信息</h2><ul>
<li>点击 系统工具，点击 代码生成，点击 导入，点击 你想要的数据库表，点击 确定。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708202813444.png"
                      alt="image-20240708202813444"
                ></p>
<ul>
<li>点击 编辑。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708202923556.png"
                      alt="image-20240708202923556"
                ></p>
<ul>
<li>基本信息</li>
<li>实体类名称：默认是根据表名称生成的，可以修改。</li>
<li>作者：默认是ruoyi，可以修改。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708203032924.png"
                      alt="image-20240708203032924"
                ></p>
<ul>
<li>字段信息</li>
<li>字段描述：决定最终在页面上展示的效果。</li>
<li>java属性：默认与字段列名一样，只不过下划线的（create_time）变成其他样式（createTime）。</li>
<li>插入、编辑、列表、查询、查询方式、必填、显示类型：根据想要的自己配置。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708203733187.png"
                      alt="image-20240708203733187"
                ></p>
<ul>
<li><p>生成信息</p>
</li>
<li><p>生成包路径、生成模块名、生成业务名：根据想要的自己修改。</p>
</li>
<li><p>上级菜单：默认生成在 系统工具 下，也可以自己修改。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708204437129.png"
                      alt="image-20240708204437129"
                ></p>
<h2 id="1-4-下载代码并导入项目"><a href="#1-4-下载代码并导入项目" class="headerlink" title="1-4 下载代码并导入项目"></a>1-4 下载代码并导入项目</h2><ul>
<li>1、点击 生成代码。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708205033594.png"
                      alt="image-20240708205033594"
                ></p>
<ul>
<li>2、解压，里面有三部分：main、vue、sql。</li>
<li>3、导入sql。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708205601791.png"
                      alt="image-20240708205601791"
                ></p>
<ul>
<li><p>4、导入vue。</p>
</li>
<li><p>分为 api 和 views 两部分。</p>
</li>
<li><p>api 导入到 src \ api 中；views 导入到 src \ views 中。</p>
</li>
<li><p>5、导入main。</p>
</li>
<li><p>分为 java 和 resources 两部分。</p>
</li>
<li><p>java 导入到 ruoyi-admin \ src \ main \ java 中。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708211525297.png"
                      alt="image-20240708211525297"
                ></p>
<ul>
<li>resources .mapper 导入到 ruoyi-admin \ src \ main \ resources 中。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708211943558.png"
                      alt="image-20240708211943558"
                ></p>
<h1 id="2-功能详解"><a href="#2-功能详解" class="headerlink" title="2- 功能详解"></a>2- 功能详解</h1><h2 id="2-1-权限控制"><a href="#2-1-权限控制" class="headerlink" title="2-1 权限控制"></a>2-1 权限控制</h2><h3 id="2-1-1-RBAC"><a href="#2-1-1-RBAC" class="headerlink" title="2-1-1 RBAC"></a>2-1-1 RBAC</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708213749693.png"
                      alt="image-20240708213749693"
                ></p>
<h3 id="2-1-2-表关系"><a href="#2-1-2-表关系" class="headerlink" title="2-1-2 表关系"></a>2-1-2 表关系</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708214021407.png"
                      alt="image-20240708214021407"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708214058966.png"
                      alt="image-20240708214058966"
                ></p>
<h3 id="2-1-3-菜单管理"><a href="#2-1-3-菜单管理" class="headerlink" title="2-1-3 菜单管理"></a>2-1-3 菜单管理</h3><ul>
<li>菜单分为：目录菜单、页面菜单、按钮菜单。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709070952141.png"
                      alt="image-20240709070952141"
                ></p>
<ul>
<li>目录菜单 匹配 主类目。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712094912300.png"
                      alt="image-20240712094912300"
                ></p>
<ul>
<li>页面菜单 匹配 目录菜单 或 主类目。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712095235714.png"
                      alt="image-20240712095235714"
                ></p>
<ul>
<li>按钮菜单 匹配  页面菜单。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-09%20071120.png"
                      alt="屏幕截图 2024-07-09 071120"
                ></p>
<h2 id="2-2-数据字典"><a href="#2-2-数据字典" class="headerlink" title="2-2 数据字典"></a>2-2 数据字典</h2><h3 id="2-2-1-概念"><a href="#2-2-1-概念" class="headerlink" title="2-2-1 概念"></a>2-2-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709073639071.png"
                      alt="image-20240709073639071"
                ></p>
<h3 id="2-2-2-表关系"><a href="#2-2-2-表关系" class="headerlink" title="2-2-2 表关系"></a>2-2-2 表关系</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709073534331.png"
                      alt="image-20240709073534331"
                ></p>
<h3 id="2-2-3-使用"><a href="#2-2-3-使用" class="headerlink" title="2-2-3 使用"></a>2-2-3 使用</h3><ul>
<li>添加 字典类型 和 字典数据</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709074207425.png"
                      alt="image-20240709074207425"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709074241216.png"
                      alt="image-20240709074241216"
                ></p>
<ul>
<li>修改代码生成信息</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709074513823.png"
                      alt="image-20240709074513823"
                ></p>
<ul>
<li><p>下载代码，导入</p>
</li>
<li><p>如果之前没有代码生成，则需要按上述 使用代码生成器 的第四步。</p>
</li>
<li><p>如果之前有代码生成，则只需要导入 vue \ views 中的 index.vue，先将对应的 vue 文件删掉，然后导入。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709082908972.png"
                      alt="image-20240709082908972"
                ></p>
<ul>
<li>修改数据库</li>
<li>如果修改后的字段有问题，则修改原数据库表中的该字段值。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709082848507.png"
                      alt="image-20240709082848507"
                ></p>
<h2 id="2-3-其他功能"><a href="#2-3-其他功能" class="headerlink" title="2-3 其他功能"></a>2-3 其他功能</h2><h3 id="2-3-1-参数设置"><a href="#2-3-1-参数设置" class="headerlink" title="2-3-1 参数设置"></a>2-3-1 参数设置</h3><ul>
<li>对系统中的参数进行动态维护。</li>
<li>通过修改参数键值，无需修改代码，直接刷新即可。动态使用。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709153631564.png"
                      alt="image-20240709153631564"
                ></p>
<h3 id="2-3-2-通知公告"><a href="#2-3-2-通知公告" class="headerlink" title="2-3-2 通知公告"></a>2-3-2 通知公告</h3><ul>
<li><p>促进组织内部信息传递。</p>
</li>
<li><p>若依提供了在本页面的通知公告的增删改查，而其他的形式需要开发者自己开发。</p>
</li>
</ul>
<h3 id="2-3-3-日志管理"><a href="#2-3-3-日志管理" class="headerlink" title="2-3-3 日志管理"></a>2-3-3 日志管理</h3><ul>
<li>轻松追踪用户行为和系统运行状况。</li>
</ul>
<h2 id="2-4-监控相关"><a href="#2-4-监控相关" class="headerlink" title="2-4 监控相关"></a>2-4 监控相关</h2><ul>
<li>若依提供了一些列强大的监控工具，能够帮助开发者和运维快速了解应用程序的性能状态。</li>
<li>包括：在线用户、数据监控（内置德鲁伊，账号：ruoyi、123456）、服务监控、缓存监控、缓存列表。</li>
</ul>
<h2 id="2-5-定时任务"><a href="#2-5-定时任务" class="headerlink" title="2-5 定时任务"></a>2-5 定时任务</h2><h3 id="2-5-1-作用"><a href="#2-5-1-作用" class="headerlink" title="2-5-1 作用"></a>2-5-1 作用</h3><ul>
<li>若依为定时任务功能提供方便友好的web界面，实现动态管理任务。</li>
</ul>
<h3 id="2-5-2-使用"><a href="#2-5-2-使用" class="headerlink" title="2-5-2 使用"></a>2-5-2 使用</h3><ul>
<li>在 ruoyi-quartz 包下的 task 包下创建任务。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710114025772.png"
                      alt="image-20240710114025772"
                ></p>
<ul>
<li>点击 系统监控，点击 定时任务，点击 新增。</li>
<li>调用方法： 模块名 .方法名。</li>
<li>执行策略：</li>
<li>有一个任务需求，每半个小时执行一次。当在8点服务器当机了，在9点15恢复了，此时的8点半、9点的任务没有执行。</li>
<li>立即执行 - 把之间的所有任务执行。</li>
<li>执行一次 - 只执行最近的一次。</li>
<li>放弃执行 - 把之间的所有任务不执行，使用最多。</li>
<li>是否并发：当是没有固定先后关系的，一般是允许并发的；如果有固定先后关系，则是禁止并发的。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710140056696.png"
                      alt="image-20240710140056696"
                ></p>
<ul>
<li>点击 cron表达式，设置时间表达式。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710140526678.png"
                      alt="image-20240710140526678"
                ></p>
<ul>
<li>点击状态，启用。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710143158539.png"
                      alt="image-20240710143158539"
                ></p>
<h2 id="2-6-表单结构"><a href="#2-6-表单结构" class="headerlink" title="2-6 表单结构"></a>2-6 表单结构</h2><h3 id="2-6-1-作用"><a href="#2-6-1-作用" class="headerlink" title="2-6-1 作用"></a>2-6-1 作用</h3><ul>
<li>表单构建工具，只需要开发者通过图形界面和拖拽等操作，可以快速构建复杂的表单。</li>
</ul>
<h3 id="2-6-2-使用"><a href="#2-6-2-使用" class="headerlink" title="2-6-2 使用"></a>2-6-2 使用</h3><ul>
<li>制作表单。</li>
<li>左侧是组件区域，先将布局型组件拖拽，再使用输入型组件或选择型组件。</li>
<li>右侧是对选中组件的设置，必须要改的是字段名、标题。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-10%20195050.png"
                      alt="屏幕截图 2024-07-10 195050"
                ></p>
<ul>
<li>导出并下载。</li>
<li>点击 导出vue文件，选择是 页面 或 弹窗，输入文件名。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710201035866.png"
                      alt="image-20240710201035866"
                ></p>
<ul>
<li>复制到前端工程。</li>
<li>找到自己想要的位置，复制过去。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710202842829.png"
                      alt="image-20240710202842829"
                ></p>
<ul>
<li><p>创建动态菜单。</p>
</li>
<li><p>点击 菜单管理，设置上级目录、菜单类型、路由地址、组件路径。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710203018232.png"
                      alt="image-20240710203018232"
                ></p>
<h2 id="2-7-代码生成"><a href="#2-7-代码生成" class="headerlink" title="2-7 代码生成"></a>2-7 代码生成</h2><h3 id="2-7-1-树表"><a href="#2-7-1-树表" class="headerlink" title="2-7-1 树表"></a>2-7-1 树表</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710204309895.png"
                      alt="image-20240710204309895"
                ></p>
<h3 id="2-7-2-主子表"><a href="#2-7-2-主子表" class="headerlink" title="2-7-2 主子表"></a>2-7-2 主子表</h3><ul>
<li>一对多。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710204501738.png"
                      alt="image-20240710204501738"
                ></p>
<h2 id="2-8-系统接口"><a href="#2-8-系统接口" class="headerlink" title="2-8 系统接口"></a>2-8 系统接口</h2><ul>
<li>Swagger，能够自动生成 API 的同步在线文档，并提供Web界面进行接口调用和测试。</li>
<li>若依的 token 值在 Admin-Token 中。</li>
<li>点击 Authorize ，输入 token 值，完成授权。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-10%20205220.png"
                      alt="屏幕截图 2024-07-10 205220"
                ></p>
<ul>
<li>找到想要的 api 接口，点击 完成接口的调用与测试。</li>
<li>注意接口中的 &#x2F;dev-api ，去掉它才能正确请求后端接口。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710205501666.png"
                      alt="image-20240710205501666"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710205745198.png"
                      alt="image-20240710205745198"
                ></p>
<h1 id="3-项目结构"><a href="#3-项目结构" class="headerlink" title="3- 项目结构"></a>3- 项目结构</h1><h2 id="3-1-后端结构"><a href="#3-1-后端结构" class="headerlink" title="3-1 后端结构"></a>3-1 后端结构</h2><h3 id="3-1-1-admin"><a href="#3-1-1-admin" class="headerlink" title="3-1-1 admin"></a>3-1-1 admin</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710211404517.png"
                      alt="image-20240710211404517"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710215422345.png"
                      alt="image-20240710215422345"
                ></p>
<h3 id="3-1-2-common"><a href="#3-1-2-common" class="headerlink" title="3-1-2 common"></a>3-1-2 common</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710211601428.png"
                      alt="image-20240710211601428"
                ></p>
<h3 id="3-1-3-framework"><a href="#3-1-3-framework" class="headerlink" title="3-1-3 framework"></a>3-1-3 framework</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710213631662.png"
                      alt="image-20240710213631662"
                ></p>
<h3 id="3-1-4-system与其他"><a href="#3-1-4-system与其他" class="headerlink" title="3-1-4 system与其他"></a>3-1-4 system与其他</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710214750713.png"
                      alt="image-20240710214750713"
                ></p>
<h3 id="3-1-5-模块依赖关系"><a href="#3-1-5-模块依赖关系" class="headerlink" title="3-1-5 模块依赖关系"></a>3-1-5 模块依赖关系</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710215944691.png"
                      alt="image-20240710215944691"
                ></p>
<h2 id="3-2-前端结构"><a href="#3-2-前端结构" class="headerlink" title="3-2 前端结构"></a>3-2 前端结构</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710220432554.png"
                      alt="image-20240710220432554"
                ></p>
<h2 id="3-3-表结构"><a href="#3-3-表结构" class="headerlink" title="3-3 表结构"></a>3-3 表结构</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710220839461.png"
                      alt="image-20240710220839461"
                ></p>
<h1 id="4-源码阅读"><a href="#4-源码阅读" class="headerlink" title="4- 源码阅读"></a>4- 源码阅读</h1><h2 id="4-1-前端代码分析"><a href="#4-1-前端代码分析" class="headerlink" title="4-1 前端代码分析"></a>4-1 前端代码分析</h2><ul>
<li>前端内容太多，只写了几个。</li>
<li>v-hasPermi &#x3D; “ [ ‘course:course:add’ ] “ ：若依自定义属性，用于权限控制。</li>
<li>@ keyup.enter &#x3D; “ handleQuery “ ：键盘回车事件，点击键盘回车，调用 handleQuery 方法。</li>
<li>@ selection-change &#x3D; “ handleSelectionChange “：监听复选框，调用 handleSelectionChange 方法。</li>
<li>&lt; el-table-column type &#x3D; “ selection “ width &#x3D; “ 55 “ align &#x3D; “ center “ &#x2F; &gt;：复选框。</li>
</ul>
<h2 id="4-2-后端代码分析"><a href="#4-2-后端代码分析" class="headerlink" title="4-2 后端代码分析"></a>4-2 后端代码分析</h2><ul>
<li><p>后端内容太多，只写了几个。</p>
</li>
<li><p>@PreAuthorize ( “@ss.hasPermi ( ‘course:course:add’ )” )：若依自定义属性，用于权限控制。</p>
</li>
<li><p>BaseController ：web层通用数据处理。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709145830321.png"
                      alt="image-20240709145830321"
                ></p>
<ul>
<li>TableDataInfo：表格分页数据对象。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709150959410.png"
                      alt="image-20240709150959410"
                ></p>
<ul>
<li>AjaxResult：操作消息提醒。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709151051003.png"
                      alt="image-20240709151051003"
                ></p>
<ul>
<li>BaseEntity ：Entity基类。</li>
<li>searchValue：全局检索。</li>
<li>params：前端多加了个参数，后端没有修改，可以用它接收。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709151232639.png"
                      alt="image-20240709151232639"
                ></p>
<h2 id="4-3-权限注解"><a href="#4-3-权限注解" class="headerlink" title="4-3 权限注解"></a>4-3 权限注解</h2><ul>
<li>注解</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709084430177.png"
                      alt="image-20240709084430177"
                ></p>
<ul>
<li>控制流程图</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709085818488.png"
                      alt="image-20240709085818488"
                ></p>
<h1 id="5-二次开发"><a href="#5-二次开发" class="headerlink" title="5- 二次开发"></a>5- 二次开发</h1><h2 id="5-1-新建业务模块"><a href="#5-1-新建业务模块" class="headerlink" title="5-1 新建业务模块"></a>5-1 新建业务模块</h2><h3 id="5-1-1-若依框架修改器"><a href="#5-1-1-若依框架修改器" class="headerlink" title="5-1-1 若依框架修改器"></a>5-1-1 若依框架修改器</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711171905312.png"
                      alt="image-20240711171905312"
                ></p>
<h3 id="5-1-2-新建业务模块"><a href="#5-1-2-新建业务模块" class="headerlink" title="5-1-2 新建业务模块"></a>5-1-2 新建业务模块</h3><ul>
<li>新建子模块并引入核心依赖。</li>
<li>点击 项目，右击鼠标，点击 新建 -&gt; 新模块。</li>
<li>核心依赖在 sky-admin 的 pom.xml 中。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711172606344.png"
                      alt="image-20240711172606344"
                ></p>
<ul>
<li>父工程版本锁定。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711173123954.png"
                      alt="image-20240711173123954"
                ></p>
<ul>
<li>sky-admin 添加依赖。</li>
<li>在 sky-admin 的 pom.xml 中添加。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711173231869.png"
                      alt="image-20240711173231869"
                ></p>
<h2 id="5-2-菜品管理（主子表）"><a href="#5-2-菜品管理（主子表）" class="headerlink" title="5-2 菜品管理（主子表）"></a>5-2 菜品管理（主子表）</h2><h3 id="5-2-1-功能"><a href="#5-2-1-功能" class="headerlink" title="5-2-1 功能"></a>5-2-1 功能</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711174406926.png"
                      alt="image-20240711174406926"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711174429699.png"
                      alt="image-20240711174429699"
                ></p>
<h3 id="5-2-2-数据库表与主子表"><a href="#5-2-2-数据库表与主子表" class="headerlink" title="5-2-2 数据库表与主子表"></a>5-2-2 数据库表与主子表</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711174728640.png"
                      alt="image-20240711174728640"
                ></p>
<h3 id="5-2-3-配置并生成代码"><a href="#5-2-3-配置并生成代码" class="headerlink" title="5-2-3 配置并生成代码"></a>5-2-3 配置并生成代码</h3><ul>
<li>1、准备SQL并导入数据库。</li>
<li>2、点击 代码生成，点击 导入，导入两张表。</li>
<li>3、因为 售卖状态 是 下拉框，所以通过 字典管理 来配置。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711190634131.png"
                      alt="image-20240711190634131"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711190658071.png"
                      alt="image-20240711190658071"
                ></p>
<ul>
<li>4、根据页面配置代码生成信息。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711191926076.png"
                      alt="image-20240711191926076"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711192535578.png"
                      alt="image-20240711192535578"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711193259481.png"
                      alt="image-20240711193259481"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711193429389.png"
                      alt="image-20240711193429389"
                ></p>
<ul>
<li><p>5、下载代码。</p>
</li>
<li><p>6、导入sql。</p>
</li>
<li><p>7、导入vue。分为 api 和 views 两部分。api 导入到 src \ api 中；views 导入到 src \ views 中。</p>
</li>
<li><p>8、导入main。分为 java 和 resources 两部分。java 导入到 ruoyi-admin \ src \ main \ java 中；resources .mapper 导入到 ruoyi-admin \ src \ main \ resources 中。</p>
</li>
<li><p>9、重启后端。</p>
</li>
</ul>
<h3 id="5-2-4-修改菜单位置"><a href="#5-2-4-修改菜单位置" class="headerlink" title="5-2-4 修改菜单位置"></a>5-2-4 修改菜单位置</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711195312961.png"
                      alt="image-20240711195312961"
                ></p>
<h3 id="5-2-5-对前端代码微调"><a href="#5-2-5-对前端代码微调" class="headerlink" title="5-2-5 对前端代码微调"></a>5-2-5 对前端代码微调</h3><ul>
<li>主键id：注销前端代码。</li>
<li>售价</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711205916107.png"
                      alt="image-20240711205916107"
                ></p>
<ul>
<li>最后操作时间</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711210245638.png"
                      alt="image-20240711210245638"
                ></p>
<ul>
<li>图片回显</li>
<li>一般数据库中保存的是图片保存在云上的 url；而使用若依后，保存在数据库的是图片保存在本地的地址，默认D:&#x2F;ruoyi&#x2F;uploadPath。</li>
<li>因为回显的图片前面有 “ http: &#x2F;&#x2F;localhost &#x2F;dev-api “，所以显示不出来。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711211258908.png"
                      alt="image-20240711211258908"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711211909838.png"
                      alt="image-20240711211909838"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711211643638.png"
                      alt="image-20240711211643638"
                ></p>
<ul>
<li>口味</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711213906667.png"
                      alt="image-20240711213906667"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711213843946.png"
                      alt="image-20240711213843946"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711212835486.png"
                      alt="image-20240711212835486"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711214148886.png"
                      alt="image-20240711214148886"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\31518\AppData\Roaming\Typora\typora-user-images\image-20240711214353527.png"
                      alt="image-20240711214353527"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711214245838.png"
                      alt="image-20240711214245838"
                ></p>
<h2 id="5-3-页面调整"><a href="#5-3-页面调整" class="headerlink" title="5-3 页面调整"></a>5-3 页面调整</h2><h3 id="5-3-1-浏览器标签页icon、标题"><a href="#5-3-1-浏览器标签页icon、标题" class="headerlink" title="5-3-1 浏览器标签页icon、标题"></a>5-3-1 浏览器标签页icon、标题</h3><ul>
<li><p>将原本的 pubilc \ favicon.ico 修改，作废。</p>
</li>
<li><p>将标签页 icon 图片，保存在 pubilc \ favicon.ico 中。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711220815190.png"
                      alt="image-20240711220815190"
                ></p>
<ul>
<li>在 index.html 中，将 “若依管理系统” 修改为自己想要的。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711221117211.png"
                      alt="image-20240711221117211"
                ></p>
<h3 id="5-3-2-系统页面中的logo、标题"><a href="#5-3-2-系统页面中的logo、标题" class="headerlink" title="5-3-2 系统页面中的logo、标题"></a>5-3-2 系统页面中的logo、标题</h3><ul>
<li>将原本的 src \ assets \ logo \ logo.png 修改，作废。</li>
<li>将系统页面 logo 图片，保存在 src \ assets \ logo \ logo.png 中。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712073118606.png"
                      alt="image-20240712073118606"
                ></p>
<ul>
<li>在 .env.development 中，将 “若依管理系统” 修改为自己想要的。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712072211214.png"
                      alt="image-20240712072211214"
                ></p>
<h3 id="5-3-3-去除头部导航"><a href="#5-3-3-去除头部导航" class="headerlink" title="5-3-3 去除头部导航"></a>5-3-3 去除头部导航</h3><ul>
<li>在 src \ layout \ components \ Navbar.vue 中，将头部的不需要组件注释掉。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712074948445.png"
                      alt="image-20240712074948445"
                ></p>
<h3 id="5-2-4-主题修改"><a href="#5-2-4-主题修改" class="headerlink" title="5-2-4 主题修改"></a>5-2-4 主题修改</h3><ul>
<li>点击 右上角图标，点击 布局设置，修改主题。</li>
<li>注意只在本地生效，其他设备登录访问看到是还是默认的。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712075551937.png"
                      alt="image-20240712075551937"
                ></p>
<h3 id="5-2-5-自定义图标"><a href="#5-2-5-自定义图标" class="headerlink" title="5-2-5 自定义图标"></a>5-2-5 自定义图标</h3><ul>
<li><p>一般的图标：点击 菜单管理，点击 修改，点击 菜单图标，进行配置。</p>
</li>
<li><p>自定义的图标：</p>
</li>
<li><p>登录 iconfont - 阿里巴巴矢量图标库。</p>
</li>
<li><p>搜索 图标，选择 颜色，使用 SVG下载。</p>
</li>
<li><p>然后保存在 src \ assets \ icons \ svg 中。</p>
</li>
<li><p>最后点击 菜单管理，点击 修改，点击 菜单图标，进行配置。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712085826645.png"
                      alt="image-20240712085826645"
                ></p>
<h3 id="5-2-6-登录页面中标题、背景图"><a href="#5-2-6-登录页面中标题、背景图" class="headerlink" title="5-2-6 登录页面中标题、背景图"></a>5-2-6 登录页面中标题、背景图</h3><ul>
<li>在 src \ views \ login.vue 中，将 “若依后台管理系统” 修改为自己想要的。</li>
<li>将原本的 src \ assets \ images \ login-background.jpg 修改，作废。</li>
<li>将想要的图片保存在 src \ assets \ images \ login-background.jpg 中。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712092132636.png"
                      alt="image-20240712092132636"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712092253598.png"
                      alt="image-20240712092253598"
                ></p>

        </div>

        
            <div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>标题:</strong> RuoYi框架</li>
        <li><strong>作者:</strong> dearlrq</li>
        <li><strong>创建于
                :</strong> 2024-05-25 21:55:34</li>
        
            <li>
                <strong>更新于
                    :</strong> 2024-07-12 16:23:51
            </li>
        
        <li>
            <strong>链接:</strong> https://redefine.ohevan.com/2024/05/25/RuoYi框架/
        </li>
        <li>
            <strong>
                版权声明:
            </strong>
            

            
                本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> 进行许可。
            
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/%E8%87%AA%E7%A0%94%E7%AC%94%E8%AE%B0/">#自研笔记</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2024/06/22/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">计算机网络</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2024/05/15/MQTT%E5%8D%8F%E8%AE%AE/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">MQTT协议</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
            <div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
                <div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        评论
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          lang: 'zh-CN',
          dark: 'body[class~="dark-mode"]',
          requiredMeta: ['nick', 'mail'],
          emoji: [],
          recaptchaV3Key: "wasd",
          
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此页目录</div>
        <div class="page-title">RuoYi框架</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81"><span class="nav-number">1.</span> <span class="nav-text">一、</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.</span> <span class="nav-text">1- 介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8"><span class="nav-number">3.</span> <span class="nav-text">2- 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D"><span class="nav-number">3.1.</span> <span class="nav-text">2-1 结构介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-%E5%90%8E%E7%AB%AF%E7%BB%93%E6%9E%84"><span class="nav-number">3.1.1.</span> <span class="nav-text">2-1-1 后端结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2-%E5%89%8D%E7%AB%AF%E7%BB%93%E6%9E%84"><span class="nav-number">3.1.2.</span> <span class="nav-text">2-1-2 前端结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E4%B8%8B%E8%BD%BD"><span class="nav-number">3.2.</span> <span class="nav-text">2-2 下载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E5%90%AF%E5%8A%A8%E5%90%8E%E7%AB%AF"><span class="nav-number">3.3.</span> <span class="nav-text">2-3 启动后端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1-%E9%85%8D%E7%BD%AEMySQL"><span class="nav-number">3.3.1.</span> <span class="nav-text">2-3-1 配置MySQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-2-%E9%85%8D%E7%BD%AERedis"><span class="nav-number">3.3.2.</span> <span class="nav-text">2-3-2 配置Redis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-%E5%90%AF%E5%8A%A8%E5%89%8D%E7%AB%AF"><span class="nav-number">3.4.</span> <span class="nav-text">2-4 启动前端</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E7%99%BB%E5%BD%95"><span class="nav-number">4.</span> <span class="nav-text">3- 登录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">4.1.</span> <span class="nav-text">3-1 验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-1-%E6%80%9D%E8%B7%AF"><span class="nav-number">4.1.1.</span> <span class="nav-text">3-1-1 思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-2-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.1.2.</span> <span class="nav-text">3-1-2 前端实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-3-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.1.3.</span> <span class="nav-text">3-1-3 后端实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E7%99%BB%E5%BD%95"><span class="nav-number">4.2.</span> <span class="nav-text">3-2 登录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1-%E5%90%8E%E7%AB%AF%E6%80%9D%E8%B7%AF"><span class="nav-number">4.2.1.</span> <span class="nav-text">3-2-1 后端思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-2-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.2.2.</span> <span class="nav-text">3-2-2 后端实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-3-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.2.3.</span> <span class="nav-text">3-2-3 前端实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2%E5%92%8C%E6%9D%83%E9%99%90"><span class="nav-number">5.</span> <span class="nav-text">4- 获取用户角色和权限</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8"><span class="nav-number">5.1.</span> <span class="nav-text">作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">5.2.</span> <span class="nav-text">4-1 前端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">5.3.</span> <span class="nav-text">4-2 后端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">5.4.</span> <span class="nav-text">4-3 数据库</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E8%8E%B7%E5%8F%96%E5%8A%A8%E6%80%81%E8%8F%9C%E5%8D%95%E8%B7%AF%E7%94%B1"><span class="nav-number">6.</span> <span class="nav-text">5- 获取动态菜单路由</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8-1"><span class="nav-number">6.1.</span> <span class="nav-text">作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.2.</span> <span class="nav-text">5-1 前端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.3.</span> <span class="nav-text">5-2 后端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">6.4.</span> <span class="nav-text">5-3 数据库</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD"><span class="nav-number">7.</span> <span class="nav-text">6- 首页数据加载</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E4%BE%A7%E8%BE%B9%E6%A0%8F%E8%8F%9C%E5%8D%95"><span class="nav-number">7.1.</span> <span class="nav-text">6-1 侧边栏菜单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-%E4%B8%BB%E9%A1%B5%E9%9D%A2"><span class="nav-number">7.2.</span> <span class="nav-text">6-2 主页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC"><span class="nav-number">7.3.</span> <span class="nav-text">6-3 页面跳转</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="nav-number">8.</span> <span class="nav-text">7- 用户管理-分页查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">8.1.</span> <span class="nav-text">7-1 前端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">8.2.</span> <span class="nav-text">7-2 后端实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E9%A1%B5"><span class="nav-number">8.2.1.</span> <span class="nav-text">分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2"><span class="nav-number">8.2.2.</span> <span class="nav-text">查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86-%E5%85%AC%E5%8F%B8%E6%A0%91%E7%8A%B6%E5%9B%BE"><span class="nav-number">9.</span> <span class="nav-text">8- 用户管理-公司树状图</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">9.1.</span> <span class="nav-text">8-1 前端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">9.2.</span> <span class="nav-text">8-2 后端实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2-1"><span class="nav-number">9.2.1.</span> <span class="nav-text">查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E9%80%A0%E6%A0%91"><span class="nav-number">9.2.2.</span> <span class="nav-text">构造树</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">9.3.</span> <span class="nav-text">8-3 数据库</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86-%E7%82%B9%E5%87%BB%E6%A0%91%E7%8A%B6%E5%9B%BE%E6%9F%A5%E8%AF%A2"><span class="nav-number">10.</span> <span class="nav-text">9- 用户管理-点击树状图查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">10.1.</span> <span class="nav-text">9-1 前端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">10.2.</span> <span class="nav-text">9-2 后端实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E9%A2%84%E5%8A%A0%E8%BD%BD%EF%BC%88%E8%A1%A8%E5%8D%95%EF%BC%89"><span class="nav-number">11.</span> <span class="nav-text">10- 添加用户数据预加载（表单）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">11.1.</span> <span class="nav-text">10-1 前端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">11.2.</span> <span class="nav-text">10-2 后端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-3-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">11.3.</span> <span class="nav-text">10-3 数据库</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="nav-number">12.</span> <span class="nav-text">11- 添加用户</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-1-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">12.1.</span> <span class="nav-text">11-1 前端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-2-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">12.2.</span> <span class="nav-text">11-2 后端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-3-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">12.3.</span> <span class="nav-text">11-3 数据库</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7"><span class="nav-number">13.</span> <span class="nav-text">12- 修改用户</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#12-1-%E4%BF%AE%E6%94%B9%E5%89%8D%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="nav-number">13.1.</span> <span class="nav-text">12-1 修改前获取用户信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#12-1-1-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">13.1.1.</span> <span class="nav-text">12-1-1 前端实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-1-2-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">13.1.2.</span> <span class="nav-text">12-1-2 后端实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-2-%E4%BF%AE%E6%94%B9"><span class="nav-number">13.2.</span> <span class="nav-text">12-2 修改</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#12-2-1-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">13.2.1.</span> <span class="nav-text">12-2-1 前端实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-2-2-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">13.2.2.</span> <span class="nav-text">12-2-2 后端实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#13-%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="nav-number">14.</span> <span class="nav-text">13- 删除用户</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#13-1-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">14.1.</span> <span class="nav-text">13-1 前端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-2-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="nav-number">14.2.</span> <span class="nav-text">13-2 后端实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#14-%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">15.</span> <span class="nav-text">14- 异步任务管理器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#15-%E4%BB%A3%E7%A0%81%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90"><span class="nav-number">16.</span> <span class="nav-text">15- 代码自动生成</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#15-1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-number">16.1.</span> <span class="nav-text">15-1 创建数据表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-2-%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="nav-number">16.2.</span> <span class="nav-text">15-2 使用工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-3-%E7%BC%96%E8%BE%91"><span class="nav-number">16.3.</span> <span class="nav-text">15-3 编辑</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-4-%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81"><span class="nav-number">16.4.</span> <span class="nav-text">15-4 生成代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-5-%E8%A7%A3%E5%8E%8B"><span class="nav-number">16.5.</span> <span class="nav-text">15-5 解压</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-6-%E5%AF%BC%E5%85%A5"><span class="nav-number">16.6.</span> <span class="nav-text">15-6 导入</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81"><span class="nav-number">17.</span> <span class="nav-text">二、</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">18.</span> <span class="nav-text">1- 使用代码生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E5%87%86%E5%A4%87%E7%9B%B8%E5%BA%94%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="nav-number">18.1.</span> <span class="nav-text">1-1 准备相应的数据库表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E5%87%86%E5%A4%87SQL%E5%B9%B6%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD"><span class="nav-number">18.2.</span> <span class="nav-text">1-2 准备SQL并导入数据库中</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E4%BF%A1%E6%81%AF"><span class="nav-number">18.3.</span> <span class="nav-text">1-3 配置代码生成信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%A0%81%E5%B9%B6%E5%AF%BC%E5%85%A5%E9%A1%B9%E7%9B%AE"><span class="nav-number">18.4.</span> <span class="nav-text">1-4 下载代码并导入项目</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E5%8A%9F%E8%83%BD%E8%AF%A6%E8%A7%A3"><span class="nav-number">19.</span> <span class="nav-text">2- 功能详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="nav-number">19.1.</span> <span class="nav-text">2-1 权限控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-RBAC"><span class="nav-number">19.1.1.</span> <span class="nav-text">2-1-1 RBAC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2-%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="nav-number">19.1.2.</span> <span class="nav-text">2-1-2 表关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-3-%E8%8F%9C%E5%8D%95%E7%AE%A1%E7%90%86"><span class="nav-number">19.1.3.</span> <span class="nav-text">2-1-3 菜单管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8"><span class="nav-number">19.2.</span> <span class="nav-text">2-2 数据字典</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-%E6%A6%82%E5%BF%B5"><span class="nav-number">19.2.1.</span> <span class="nav-text">2-2-1 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="nav-number">19.2.2.</span> <span class="nav-text">2-2-2 表关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-3-%E4%BD%BF%E7%94%A8"><span class="nav-number">19.2.3.</span> <span class="nav-text">2-2-3 使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD"><span class="nav-number">19.3.</span> <span class="nav-text">2-3 其他功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1-%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE"><span class="nav-number">19.3.1.</span> <span class="nav-text">2-3-1 参数设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-2-%E9%80%9A%E7%9F%A5%E5%85%AC%E5%91%8A"><span class="nav-number">19.3.2.</span> <span class="nav-text">2-3-2 通知公告</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-3-%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86"><span class="nav-number">19.3.3.</span> <span class="nav-text">2-3-3 日志管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-%E7%9B%91%E6%8E%A7%E7%9B%B8%E5%85%B3"><span class="nav-number">19.4.</span> <span class="nav-text">2-4 监控相关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="nav-number">19.5.</span> <span class="nav-text">2-5 定时任务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-1-%E4%BD%9C%E7%94%A8"><span class="nav-number">19.5.1.</span> <span class="nav-text">2-5-1 作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-2-%E4%BD%BF%E7%94%A8"><span class="nav-number">19.5.2.</span> <span class="nav-text">2-5-2 使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-%E8%A1%A8%E5%8D%95%E7%BB%93%E6%9E%84"><span class="nav-number">19.6.</span> <span class="nav-text">2-6 表单结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-1-%E4%BD%9C%E7%94%A8"><span class="nav-number">19.6.1.</span> <span class="nav-text">2-6-1 作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-2-%E4%BD%BF%E7%94%A8"><span class="nav-number">19.6.2.</span> <span class="nav-text">2-6-2 使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-7-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90"><span class="nav-number">19.7.</span> <span class="nav-text">2-7 代码生成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-1-%E6%A0%91%E8%A1%A8"><span class="nav-number">19.7.1.</span> <span class="nav-text">2-7-1 树表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-2-%E4%B8%BB%E5%AD%90%E8%A1%A8"><span class="nav-number">19.7.2.</span> <span class="nav-text">2-7-2 主子表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-8-%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3"><span class="nav-number">19.8.</span> <span class="nav-text">2-8 系统接口</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">20.</span> <span class="nav-text">3- 项目结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E5%90%8E%E7%AB%AF%E7%BB%93%E6%9E%84"><span class="nav-number">20.1.</span> <span class="nav-text">3-1 后端结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-1-admin"><span class="nav-number">20.1.1.</span> <span class="nav-text">3-1-1 admin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-2-common"><span class="nav-number">20.1.2.</span> <span class="nav-text">3-1-2 common</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-3-framework"><span class="nav-number">20.1.3.</span> <span class="nav-text">3-1-3 framework</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-4-system%E4%B8%8E%E5%85%B6%E4%BB%96"><span class="nav-number">20.1.4.</span> <span class="nav-text">3-1-4 system与其他</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-5-%E6%A8%A1%E5%9D%97%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB"><span class="nav-number">20.1.5.</span> <span class="nav-text">3-1-5 模块依赖关系</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E5%89%8D%E7%AB%AF%E7%BB%93%E6%9E%84"><span class="nav-number">20.2.</span> <span class="nav-text">3-2 前端结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-number">20.3.</span> <span class="nav-text">3-3 表结构</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB"><span class="nav-number">21.</span> <span class="nav-text">4- 源码阅读</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">21.1.</span> <span class="nav-text">4-1 前端代码分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">21.2.</span> <span class="nav-text">4-2 后端代码分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E6%9D%83%E9%99%90%E6%B3%A8%E8%A7%A3"><span class="nav-number">21.3.</span> <span class="nav-text">4-3 权限注解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91"><span class="nav-number">22.</span> <span class="nav-text">5- 二次开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E6%96%B0%E5%BB%BA%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%9D%97"><span class="nav-number">22.1.</span> <span class="nav-text">5-1 新建业务模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-1-%E8%8B%A5%E4%BE%9D%E6%A1%86%E6%9E%B6%E4%BF%AE%E6%94%B9%E5%99%A8"><span class="nav-number">22.1.1.</span> <span class="nav-text">5-1-1 若依框架修改器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-2-%E6%96%B0%E5%BB%BA%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%9D%97"><span class="nav-number">22.1.2.</span> <span class="nav-text">5-1-2 新建业务模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86%EF%BC%88%E4%B8%BB%E5%AD%90%E8%A1%A8%EF%BC%89"><span class="nav-number">22.2.</span> <span class="nav-text">5-2 菜品管理（主子表）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-1-%E5%8A%9F%E8%83%BD"><span class="nav-number">22.2.1.</span> <span class="nav-text">5-2-1 功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E4%B8%8E%E4%B8%BB%E5%AD%90%E8%A1%A8"><span class="nav-number">22.2.2.</span> <span class="nav-text">5-2-2 数据库表与主子表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-3-%E9%85%8D%E7%BD%AE%E5%B9%B6%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81"><span class="nav-number">22.2.3.</span> <span class="nav-text">5-2-3 配置并生成代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-4-%E4%BF%AE%E6%94%B9%E8%8F%9C%E5%8D%95%E4%BD%8D%E7%BD%AE"><span class="nav-number">22.2.4.</span> <span class="nav-text">5-2-4 修改菜单位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-5-%E5%AF%B9%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%E5%BE%AE%E8%B0%83"><span class="nav-number">22.2.5.</span> <span class="nav-text">5-2-5 对前端代码微调</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E9%A1%B5%E9%9D%A2%E8%B0%83%E6%95%B4"><span class="nav-number">22.3.</span> <span class="nav-text">5-3 页面调整</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-1-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%A0%87%E7%AD%BE%E9%A1%B5icon%E3%80%81%E6%A0%87%E9%A2%98"><span class="nav-number">22.3.1.</span> <span class="nav-text">5-3-1 浏览器标签页icon、标题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-2-%E7%B3%BB%E7%BB%9F%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9A%84logo%E3%80%81%E6%A0%87%E9%A2%98"><span class="nav-number">22.3.2.</span> <span class="nav-text">5-3-2 系统页面中的logo、标题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-3-%E5%8E%BB%E9%99%A4%E5%A4%B4%E9%83%A8%E5%AF%BC%E8%88%AA"><span class="nav-number">22.3.3.</span> <span class="nav-text">5-3-3 去除头部导航</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-4-%E4%B8%BB%E9%A2%98%E4%BF%AE%E6%94%B9"><span class="nav-number">22.3.4.</span> <span class="nav-text">5-2-4 主题修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-5-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BE%E6%A0%87"><span class="nav-number">22.3.5.</span> <span class="nav-text">5-2-5 自定义图标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-6-%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E4%B8%AD%E6%A0%87%E9%A2%98%E3%80%81%E8%83%8C%E6%99%AF%E5%9B%BE"><span class="nav-number">22.3.6.</span> <span class="nav-text">5-2-6 登录页面中标题、背景图</span></a></li></ol></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
            <div class="customize-info my-1">dearlrq</div>
        
        <div class="text-center">
            &copy;
            
              <span>2024</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">dearlrq</a>
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">访问人数</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">总访问量</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span>
            <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.6.0</a></span>
        </div>
        
        
            <div>
                博客已运行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>



    
<script src="/js/tools/localSearch.js" type="module"></script>




    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>









<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
