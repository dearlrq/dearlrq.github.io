<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Git使用</title>
    <url>/2024/07/05/Git%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1 id="1-版本控制系统概述"><a href="#1-版本控制系统概述" class="headerlink" title="1- 版本控制系统概述"></a>1- 版本控制系统概述</h1><h2 id="1-1-基本概念"><a href="#1-1-基本概念" class="headerlink" title="1-1 基本概念"></a>1-1 基本概念</h2><p>​		版本控制（Revision control）是一种在开发的过程中用于管理我们对文件、目录或工程等内容的修改历史，方便查看更改历史记<br>录，备份以便恢复以前的版本的软件工程技术。</p>
<ul>
<li>实现跨区域多人协同开发</li>
<li>追踪和记载一个或者多个文件的历史记录</li>
<li>组织和保护你的源代码和文档</li>
<li>统计工作量</li>
<li>并行开发、提高开发效率</li>
<li>跟踪记录整个软件的开发过程</li>
<li>减轻开发人员的负担，节省时间，同时降低人为错误</li>
</ul>
<p>简单说就是用于管理多人协同开发项目的技术。</p>
<p>​		没有进行版本控制或者版本控制本身缺乏正确的流程管理，在软件开发过程中将会引入很多问题，如软件代码的一致性、软件内容的冗余、软件过程的事物性、软件开发过程中的并发性、软件源代码的安全性，以及软件的整合等问题。</p>
<p>​		有了版本控制系统以后，就可以方便记录每次修改的版本了，类似于以下效果：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705195350325.png"
                      alt="image-20240705195350325"
                ></p>
<p>​		主流的版本控制器有如下这些：</p>
<ul>
<li><strong>Git</strong></li>
<li><strong>SVN</strong>（Subversion）</li>
<li><strong>CVS</strong>（Concurrent Versions System）</li>
<li><strong>VSS</strong>（Micorosoft Visual SourceSafe）</li>
<li><strong>TFS</strong> （Team Foundation Server）</li>
<li><strong>Visual Studio Online</strong></li>
</ul>
<p>版本控制产品非常的多，现在影响力最大且使用最广泛的是 Git与SVN。</p>
<h2 id="1-2-版本控制分类"><a href="#1-2-版本控制分类" class="headerlink" title="1-2 版本控制分类"></a>1-2 版本控制分类</h2><h3 id="1-2-1-集中式"><a href="#1-2-1-集中式" class="headerlink" title="1-2-1 集中式"></a>1-2-1 集中式</h3><p>集中式版本控制系统，版本库是集中存放在中央服务器的，团队成员需要先从中央服务器取得最新的版本，再将变动推送给中央服务器。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705200131154.png"
                      alt="image-20240705200131154"
                ></p>
<p>集中式版本控制系统主要问题在于中央服务器的故障。如果服务器宕机，那么谁都无法提交更新，也就无法协同工作，代表产品：SVN、<br>CVS、VSS。</p>
<h3 id="1-2-2-分布式"><a href="#1-2-2-分布式" class="headerlink" title="1-2-2 分布式"></a>1-2-2 分布式</h3><p>分布式版本控制系统没有 ”中央服务器“，每个人的电脑上都是一个完整的版本库，这样任何一处协同工作用的文件发生故障，事后都可以<br>用其他客户端的本地仓库进行恢复，分布式的版本控制系统出现之后，解决了集中式版本控制系统的缺陷：</p>
<ul>
<li>服务器断网的情况下也可以进行开发（因为版本控制是在本地进行的）</li>
<li>每个客户端保存的也都是整个完整的项目（包含历史记录，更加安全）</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705200545377.png"
                      alt="image-20240705200545377"
                ></p>
<h3 id="1-2-3-Git与SVN最主要区别"><a href="#1-2-3-Git与SVN最主要区别" class="headerlink" title="1-2-3 Git与SVN最主要区别"></a>1-2-3 Git与SVN最主要区别</h3><p>SVN是集中式版本控制系统，版本库是集中在中央服务器中，Git是分布式版本控制系统，没有中央服务器，每个人的电脑就是一个完整的<br>版本库。</p>
<p>Git是目前世界上最先进的分布式版本控制系统，Git是免费、开源的。</p>
<h2 id="1-3-远程仓库"><a href="#1-3-远程仓库" class="headerlink" title="1-3 远程仓库"></a>1-3 远程仓库</h2><p>Git是分布式版本控制系统，同一个Git仓库，可以分布到不同的机器上，但开发参与者必须在同一个网络中，且必须有一个项目的原始版本，通常的办法是让一台电脑充当服务器的角色，每天24小时开机，其他每个人都从这个 “服务器” 仓库克隆一份到自己的电脑上，并且名自把各自的提交推送到服务器仓库里，也从服务器仓库中拉取别人的提交。完全可以自己搭建一台运行Git服务器但现在更适合的做法是使用免费的托管平台。</p>
<p>同时相较于传统的代码都是管理到本机或者内网。一旦本机或者内网机器出问题，代码可能会丢失，使用远端代码仓库将永远存在一个备份。同时也免去了搭建本地代码版本控制服务的繁琐。云计算时代Git以其强大的分支和克隆功能，更加方便了开发者远程协作。</p>
<p>代码托管中心是基于网络服务器的远程代码仓库，一般我们简单称为远程库。</p>
<p>企业内部可以使用GitLab搭建远程仓库，也可以使用公网上开放的远程仓库，如：GitHub，Gitee（码云），阿里云效中的CodeUp。</p>
<h2 id="1-4-工作机制"><a href="#1-4-工作机制" class="headerlink" title="1-4 工作机制"></a>1-4 工作机制</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705201619865.png"
                      alt="image-20240705201619865"
                ></p>
<h2 id="1-5-团队协作建议"><a href="#1-5-团队协作建议" class="headerlink" title="1-5 团队协作建议"></a>1-5 团队协作建议</h2><p>1.组长在本地设计项目结构，并推送到远程仓库。</p>
<p>2.组员将远程仓库克隆到本地。</p>
<p>3.组员在本地创建分支进行协作开发，分支可以以组员名称命名。</p>
<p>4.组员将自己的分支推送到远程仓库。</p>
<p>5.当代码确认没有问题后，告诉组长，组长进行分支合并。</p>
<h1 id="2-基础使用"><a href="#2-基础使用" class="headerlink" title="2- 基础使用"></a>2- 基础使用</h1><h2 id="2-1-基本配置"><a href="#2-1-基本配置" class="headerlink" title="2-1 基本配置"></a>2-1 基本配置</h2><p>-&#x2F;.gitconfig文件保存了本用户的所有仓库的配置，可以通过命令：git config -global来设置。</p>
<p>Git仓库在进行commit时，必须进行签名。</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global user.name &#x27;username&#x27;</span><br><span class="line">git config --global user.email &#x27;emai1@163.com&#x27;</span><br></pre></td></tr></table></figure></div>

<p>签名用于区分不同操作者身份，在提交信息中可以查看用户的签名，以此确认本次提交是谁做的。Git 首次安装必须设置一下用户签名<br>否则无法提交代码。</p>
<p>注意，此处设置的用户签名和远端代码托管中心的账号没有任何关系!</p>
<h2 id="2-2-常用操作"><a href="#2-2-常用操作" class="headerlink" title="2-2 常用操作"></a>2-2 常用操作</h2><h3 id="2-2-1-初始化本地仓库"><a href="#2-2-1-初始化本地仓库" class="headerlink" title="2-2-1 初始化本地仓库"></a>2-2-1 初始化本地仓库</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git init</span></span><br><span class="line">Initialized empty Git repository in C:/xx/.git/</span><br></pre></td></tr></table></figure></div>

<p>会在当前目录中自动创建 .git目录，此目录用于Git跟踪管理版本库。</p>
<h3 id="2-2-2-查看本地库状态"><a href="#2-2-2-查看本地库状态" class="headerlink" title="2-2-2 查看本地库状态"></a>2-2-2 查看本地库状态</h3><p>无文件时：</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git status</span></span><br><span class="line">On branch master</span><br><span class="line">No commits yet</span><br><span class="line">nothing to commit (create/copy files and use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure></div>

<p>新增文件后：</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">touch</span> hello.txt <span class="comment"># 生成hello.txt文件</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git status</span></span><br><span class="line">On branch master</span><br><span class="line">No commits yet</span><br><span class="line">Untracked files:</span><br><span class="line">	(use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">		hello.txt</span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-3-添加文件至暂存区"><a href="#2-2-3-添加文件至暂存区" class="headerlink" title="2-2-3 添加文件至暂存区"></a>2-2-3 添加文件至暂存区</h3><p>命令</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">git add 文件名</span><br></pre></td></tr></table></figure></div>

<p>添加 hello.txt 至暂存区</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add hello.txt</span></span><br></pre></td></tr></table></figure></div>

<p>查看状态</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git status</span></span><br><span class="line">On branch master</span><br><span class="line">No commits yet</span><br><span class="line">Changes to be committed:</span><br><span class="line">	(use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class="line">		new file:      hello.txt</span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-4-提交至本地库"><a href="#2-2-4-提交至本地库" class="headerlink" title="2-2-4 提交至本地库"></a>2-2-4 提交至本地库</h3><p>命令</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">git commit -m &quot;日志信息&quot;</span><br></pre></td></tr></table></figure></div>

<p>提交 hello.txt 到本地库</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit -m <span class="string">&quot;测试&quot;</span></span></span><br><span class="line">[master (root-commit) 5e97c57] 测试</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 hello.txt</span><br></pre></td></tr></table></figure></div>

<p>查看状态</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git status</span></span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-5-提交修改"><a href="#2-2-5-提交修改" class="headerlink" title="2-2-5 提交修改"></a>2-2-5 提交修改</h3><p>修改 hello.txt 后，再次查看状态</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git status</span></span><br><span class="line">On branch master</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">	(use &quot;git add &lt;file&gt;...&quot; to update what wi7l be committed)</span><br><span class="line">	(use &quot;git restore &lt;file&gt;...to discard changes in working directory)</span><br><span class="line">		modified:  hello.txt</span><br><span class="line">		</span><br><span class="line">no changes added to commit(use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br></pre></td></tr></table></figure></div>

<p>重新添加至暂存区</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add hello.txt</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git status</span></span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">	(use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">		modified:   hello.txt</span><br></pre></td></tr></table></figure></div>

<p>再次提交</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit -m <span class="string">&quot;修改了hello.txt&quot;</span></span></span><br><span class="line">[master 575cf6c] 修改了he11o.txt</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-6-撤销修改"><a href="#2-2-6-撤销修改" class="headerlink" title="2-2-6 撤销修改"></a>2-2-6 撤销修改</h3><p>命令</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout -- fi1e</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以丢弃工作区的修改</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git checkout -- hello.txt</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>当文件自修改后还没有被放到暂存区（add）时，撤销修改就回到和版本库一模一样的状态（最后一次提交的状态）</li>
<li>当文件已经添加到暂存区后，又作了修改，撤销修改就回到添加到暂存区后的状态</li>
</ul>
<h3 id="2-2-7-版本穿梭"><a href="#2-2-7-版本穿梭" class="headerlink" title="2-2-7 版本穿梭"></a>2-2-7 版本穿梭</h3><p>命令</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">git reset --hard 版本号</span><br></pre></td></tr></table></figure></div>

<p>可以通过 git reflog 查看版本信息</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reflog</span></span><br><span class="line">575cf6c(HEAD -&gt; master) HEAD@&#123;0&#125;: commit: 修改了hello.txt</span><br><span class="line">5e97c57 HEAD@&#123;1&#125;: commit (initia1): 测试</span><br></pre></td></tr></table></figure></div>

<p>切换到 5e97c57 版本</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git reset --hard 5e97c57</span></span><br><span class="line">HEAD is now at 5e97c57 测试</span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-8-克隆远程仓库"><a href="#2-2-8-克隆远程仓库" class="headerlink" title="2-2-8 克隆远程仓库"></a>2-2-8 克隆远程仓库</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git <span class="built_in">clone</span> + SSH链接</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">例如</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git <span class="built_in">clone</span> git@gitee.com:rqdd/Mobilework.git</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">克隆的时候可以指定分支</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git <span class="built_in">clone</span> -b &lt;指定分支名&gt; &lt;远程仓库地址&gt;</span> </span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-9-拉取远程仓库"><a href="#2-2-9-拉取远程仓库" class="headerlink" title="2-2-9 拉取远程仓库"></a>2-2-9 拉取远程仓库</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git pull origin &lt;远程分支名&gt;:&lt;本地分支名&gt;</span></span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-10-推送远程仓库"><a href="#2-2-10-推送远程仓库" class="headerlink" title="2-2-10 推送远程仓库"></a>2-2-10 推送远程仓库</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git push origin &lt;本地分支名&gt;:&lt;远程分支名&gt;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="2-3-分支操作"><a href="#2-3-分支操作" class="headerlink" title="2-3 分支操作"></a>2-3 分支操作</h2><h3 id="2-3-1-基本概念"><a href="#2-3-1-基本概念" class="headerlink" title="2-3-1 基本概念"></a>2-3-1 基本概念</h3><p>假设你准备开发一个新功能，但是需要两周才能完成，第一周你写了50%的代码，如果立刻提交，由于代码还没写完，不完整的代码库会导致别人不能干活了。如果等代码全部写完再一次提交，又存在丢失每天进度的巨大风险。</p>
<p>这时可以创建一个属于你自己的分支，别人看不到，还继续在原来的分支上正常工作，而你在自己的分支上干活，想提交就提交，直到开发完毕后，再一次性合并到原来的分支上，这样，既安全，又不影响别人工作。</p>
<p>在版本控制过程中，同时推进多个任务，为每个任务，我们就可以创建每个任务的单独分支。使用分支意味着程序员可以把自己的工作从开发主线上分离开来，开发自己分支的时候，不会影响主线分支的运行。</p>
<p>每次提交时，Git都把它们串成一条时间线，这条时间线就是一个分支。截止到目前，只有一条时间线，在Git里，这个分支叫主分支，即master分支。同时会有一个HEAD指针指向当前分支，而master指向最新的提交。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705213054229.png"
                      alt="image-20240705213054229"
                ></p>
<p>每次提交，master分支都会向前移动一步，这样，随着你不断提交，master 分支的线也越来越长。</p>
<p>当我们创建新的分支，例如dev时，Git新建了一个指针叫dev，指向master相同的提交，再把HEAD指向dev，就表示当前分支在dev上：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705213304208.png"
                      alt="image-20240705213304208"
                ></p>
<p>从现在开始，对工作区的修改和提交就是针对dev分支了，比如新提交一次后，dev指针往前移动一步，而master 指针不变：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705213726071.png"
                      alt="image-20240705213726071"
                ></p>
<p>假如我们在 dev上的工作完成了，就可以把dev合并到master上。Git怎么合并呢？最简单的方法，就是直接把master指向dev的当前提交，就完成了合并：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705213916587.png"
                      alt="image-20240705213916587"
                ></p>
<p>合并完分支后，甚至可以删除dev分支。删除dev分支就是把dev指针给删掉，删掉后，我们就剩下了一条master分支:</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705214038216.png"
                      alt="image-20240705214038216"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705214318310.png"
                      alt="image-20240705214318310"
                ></p>
<h3 id="2-3-2-查看分支"><a href="#2-3-2-查看分支" class="headerlink" title="2-3-2 查看分支"></a>2-3-2 查看分支</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git branch -v</span></span><br><span class="line">* master 5e97c57 测试</span><br></pre></td></tr></table></figure></div>

<h3 id="2-3-3-创建分支"><a href="#2-3-3-创建分支" class="headerlink" title="2-3-3 创建分支"></a>2-3-3 创建分支</h3><p>*表示目前所在的分支</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git branch dev</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git branch -v</span></span><br><span class="line">  dev    5e97c57 测试</span><br><span class="line">* master 5e97c57 测试</span><br></pre></td></tr></table></figure></div>

<h3 id="2-3-4-切换分支"><a href="#2-3-4-切换分支" class="headerlink" title="2-3-4 切换分支"></a>2-3-4 切换分支</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git checkout dev</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git branch -v</span></span><br><span class="line">* dev    5e97c57 测试</span><br><span class="line">  master 5e97c57 测试</span><br></pre></td></tr></table></figure></div>

<h3 id="2-3-5-合并分支"><a href="#2-3-5-合并分支" class="headerlink" title="2-3-5 合并分支"></a>2-3-5 合并分支</h3><p>在dev分支上修改hello.txt文件，添加内容</p>
<p>添加至暂存区，并提交至本地版本库</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add hello.txt</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit -m <span class="string">&quot;dev commit&quot;</span></span></span><br></pre></td></tr></table></figure></div>

<p>切换至master分支，在master分支上合并dev分支</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git checkout master</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> hello.txt <span class="comment"># 没有dev分支的内容</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行合井</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git merge dev</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件内容</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> hello.txt <span class="comment"># 此时可以看到dev分支修改的内容</span></span></span><br></pre></td></tr></table></figure></div>

<p>如果在dev分支上修改时，master分支也修改（两个分支修改的不是同一个文件）。当分支合并时，切换到master分支，合并dev分支。</p>
<h3 id="2-3-6-删除分支"><a href="#2-3-6-删除分支" class="headerlink" title="2-3-6 删除分支"></a>2-3-6 删除分支</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git branch -d dev</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除dev分支</span></span><br></pre></td></tr></table></figure></div>

<h3 id="2-3-7-合并冲突并解决"><a href="#2-3-7-合并冲突并解决" class="headerlink" title="2-3-7 合并冲突并解决"></a>2-3-7 合并冲突并解决</h3><ul>
<li>冲突</li>
</ul>
<p>合并分支时，两个分支在同一个文件的同一个位置有两套完全不同的修改。Git 无法替我们决定使用哪一个。必须人为决定新代码内容。</p>
<p>在master分支上修改hello.txt文件并提交至版本库</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">dev add content</span><br><span class="line">master 添加内容</span><br></pre></td></tr></table></figure></div>

<p>在dev分支上修改hello.txt文件并提交至版本库</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">dev add content dev添加内容</span><br></pre></td></tr></table></figure></div>

<p>切换回master分支，将dev分支内容合并至master分支，发现合并失败，此时需要手动解决冲突</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git merge dev</span></span><br><span class="line">Auto-merging hello.txt</span><br><span class="line">CONFLICT(content): Merge conflict in hello.txt</span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result.</span><br></pre></td></tr></table></figure></div>

<p>此时hello.txt文件代码格式</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">当前分支的代码</span><br><span class="line">=======</span><br><span class="line">合并过来的代码</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; dev</span><br></pre></td></tr></table></figure></div>

<ul>
<li>解决</li>
</ul>
<p>编辑有冲突的文件，删除特殊符号，决定要使用的内容，决定保留当前分支的内容。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">dev add content</span><br><span class="line">master 添加内容</span><br></pre></td></tr></table></figure></div>

<p>添加并提交修改后的文件，注意此步骤非常重要，需要将修改后的内容进行提交！</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add hello.txt</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit -m <span class="string">&quot;冲突解决&quot;</span></span></span><br></pre></td></tr></table></figure></div>

<h2 id="2-4-分支管理策略"><a href="#2-4-分支管理策略" class="headerlink" title="2-4 分支管理策略"></a>2-4 分支管理策略</h2><h3 id="2-4-1-禁用-Fast-forward"><a href="#2-4-1-禁用-Fast-forward" class="headerlink" title="2-4-1 禁用 Fast forward"></a>2-4-1 禁用 Fast forward</h3><p>通常，合并分支时，如果可能，Git会用Fast forward模式（既直接移动指针），但这种模式下，删除分支后，会丢掉分支信息。</p>
<p>注意：如果分叉后，master和dev均产生了新的提交，则无法适用于Fast forward模式，此时分为两种情况：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240706212139437.png"
                      alt="image-20240706212139437"
                ></p>
<p>如果要强制禁用Fast forward模式，Git则会在merge时自动生成一个新的commit，这样，从分支历史上就可以看出分支信息。</p>
<p>下面我们实战一下：–no-ff 方式的 git merge：</p>
<p>首先，仍然创建并切换dev分支：</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git branch dev</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git checkout dev</span></span><br></pre></td></tr></table></figure></div>

<p>修改文件，并提交一个新的commit：</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add merge.txt</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit -m <span class="string">&quot;add merge&quot;</span></span></span><br></pre></td></tr></table></figure></div>

<p>现在，我们切换回master：</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git checkout master</span></span><br></pre></td></tr></table></figure></div>

<p>准备合并dev分支，请注意–no-ff参数，表示禁用Fast forward：</p>
<p>因为本次合并要创建一个新的commit，所以加上-m参数，把commit描述写进去。</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git merge --no-ff -m <span class="string">&quot;merge with no-ff&quot;</span> dev</span></span><br></pre></td></tr></table></figure></div>

<h3 id="2-4-2-分支策略"><a href="#2-4-2-分支策略" class="headerlink" title="2-4-2 分支策略"></a>2-4-2 分支策略</h3><p>在实际开发中，我们应该按照几个基本原则进行分支管理:</p>
<p>首先，master分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面干活；</p>
<p>那在哪干活呢？干活都在dev分支上，也就是说，dev分支是不稳定的，到某个时候，比如1.0版本发布时，再把dev分支合并到master上，在master分支发布1.0版本；</p>
<p>你和你的小伙伴们每个人都在dev分支上干活，每个人都有自己的分支，时不时地往 dev分支上合并就可以了。</p>
<p>所以，团队合作的分支看起来就像这样：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240706214724254.png"
                      alt="image-20240706214724254"
                ></p>
<h1 id="3-idea的Git操作"><a href="#3-idea的Git操作" class="headerlink" title="3- idea的Git操作"></a>3- idea的Git操作</h1><h2 id="3-1-初始化仓库"><a href="#3-1-初始化仓库" class="headerlink" title="3-1 初始化仓库"></a>3-1 初始化仓库</h2><ul>
<li>相当于 git init</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240706215451156.png"
                      alt="image-20240706215451156"
                ></p>
<ul>
<li>此时左下角是Git（可以看到所有操作状态），右下角显示是master分支。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240706215700028.png"
                      alt="image-20240706215700028"
                ></p>
<h2 id="3-2-添加到暂存区"><a href="#3-2-添加到暂存区" class="headerlink" title="3-2 添加到暂存区"></a>3-2 添加到暂存区</h2><ul>
<li>相当于 git add 文件名，一次全部添加。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240706220203973.png"
                      alt="image-20240706220203973"
                ></p>
<h2 id="3-3-提交到本地库"><a href="#3-3-提交到本地库" class="headerlink" title="3-3 提交到本地库"></a>3-3 提交到本地库</h2><ul>
<li>相当于 git commit -m “日志信息”，一次全部提交。</li>
<li>三处是提交，一处是日志信息。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-07%20120835.png"
                      alt="屏幕截图 2024-07-07 120835"
                ></p>
<h2 id="3-4-提交修改"><a href="#3-4-提交修改" class="headerlink" title="3-4 提交修改"></a>3-4 提交修改</h2><ul>
<li>和上面两个步骤一样。</li>
</ul>
<h2 id="3-5-推送到远端仓库"><a href="#3-5-推送到远端仓库" class="headerlink" title="3-5 推送到远端仓库"></a>3-5 推送到远端仓库</h2><ul>
<li>远端创建仓库，得到远端的URL（http）。</li>
<li>将远端的URL添加到管理远程的URL里面。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240706221905074.png"
                      alt="image-20240706221905074"
                ></p>
<ul>
<li>有三处推送</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-07%20121342.png"
                      alt="屏幕截图 2024-07-07 121342"
                ></p>
<h2 id="3-6-当远端修改后的本地更新"><a href="#3-6-当远端修改后的本地更新" class="headerlink" title="3-6 当远端修改后的本地更新"></a>3-6 当远端修改后的本地更新</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240707122436361.png"
                      alt="image-20240707122436361"
                ></p>
<h2 id="3-7-新建分支"><a href="#3-7-新建分支" class="headerlink" title="3-7 新建分支"></a>3-7 新建分支</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240707122847774.png"
                      alt="image-20240707122847774"
                ></p>
<h2 id="3-8-切换分支"><a href="#3-8-切换分支" class="headerlink" title="3-8 切换分支"></a>3-8 切换分支</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240707123218612.png"
                      alt="image-20240707123218612"
                ></p>
<h2 id="3-9-将分支推送到远端"><a href="#3-9-将分支推送到远端" class="headerlink" title="3-9 将分支推送到远端"></a>3-9 将分支推送到远端</h2><ul>
<li>切换到想要的分支</li>
<li>然后和上面的推送到远端仓库操作一样</li>
<li>推送后的远端仓库</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240707123918738.png"
                      alt="image-20240707123918738"
                ></p>
<h2 id="3-10-合并不同的分支"><a href="#3-10-合并不同的分支" class="headerlink" title="3-10 合并不同的分支"></a>3-10 合并不同的分支</h2><ul>
<li>先点击Git，点击合并</li>
<li>这可以在不同的分支，合并不同的分支</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240707125343485.png"
                      alt="image-20240707125343485"
                ></p>
<h2 id="3-11-删除分支"><a href="#3-11-删除分支" class="headerlink" title="3-11 删除分支"></a>3-11 删除分支</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240707161737053.png"
                      alt="image-20240707161737053"
                ></p>
<h1 id="4-vscode的Git操作"><a href="#4-vscode的Git操作" class="headerlink" title="4- vscode的Git操作"></a>4- vscode的Git操作</h1><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240707161459302.png"
                      alt="image-20240707161459302"
                ></p>
]]></content>
      <categories>
        <category>其他</category>
        <category>Git使用</category>
      </categories>
      <tags>
        <tag>自研笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>MQTT协议</title>
    <url>/2024/05/15/MQTT%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<h1 id="—–Python—–"><a href="#—–Python—–" class="headerlink" title="—–Python—–"></a>—–Python—–</h1><h1 id="1-三种身份"><a href="#1-三种身份" class="headerlink" title="1- 三种身份"></a>1- 三种身份</h1><ul>
<li><p>发布者（Publisher）</p>
</li>
<li><p>服务器（Broker）</p>
</li>
<li><p>订阅者（Subscriber）</p>
</li>
<li><p>他们通过主题进行链接，只要主题相同，就能传输信息。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240515183615998.png"
                      alt="image-20240515183615998"
                ></p>
</li>
</ul>
<h1 id="2-消息结构"><a href="#2-消息结构" class="headerlink" title="2- 消息结构"></a>2- 消息结构</h1><ul>
<li><p>主题（Topic）：字符串</p>
</li>
<li><p>负载（Payload）：字符串</p>
</li>
</ul>
<h1 id="3-搭建mqtt-broker-中心服务器"><a href="#3-搭建mqtt-broker-中心服务器" class="headerlink" title="3- 搭建mqtt-broker (中心服务器)"></a>3- 搭建mqtt-broker (中心服务器)</h1><h2 id="3-1-准备"><a href="#3-1-准备" class="headerlink" title="3-1 准备"></a>3-1 准备</h2><ul>
<li>登陆一台作为服务器的 Ubuntu 主机 (本地主机或云服务器) 。</li>
</ul>
<h2 id="3-2-下载-EMQX-安装包-命令"><a href="#3-2-下载-EMQX-安装包-命令" class="headerlink" title="3-2 下载 EMQX 安装包 (命令)"></a>3-2 下载 EMQX 安装包 (命令)</h2><ul>
<li>wget <a class="link"   href="https://www.emqx.com/zh/downloads/broker/5.0.11/emqx-5.0.11-ubuntu18.04-amd64.deb" >https://www.emqx.com/zh/downloads/broker/5.0.11/emqx-5.0.11-ubuntu18.04-amd64.deb <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<h2 id="3-3-安装-命令"><a href="#3-3-安装-命令" class="headerlink" title="3-3 安装 (命令)"></a>3-3 安装 (命令)</h2><ul>
<li>sudo apt install .&#x2F;emqx-5.0.11-ubuntu18.04-amd64.deb</li>
</ul>
<h2 id="3-4-运行-命令"><a href="#3-4-运行-命令" class="headerlink" title="3-4 运行 (命令)"></a>3-4 运行 (命令)</h2><ul>
<li>sudo systemctl start emqx</li>
</ul>
<h2 id="3-5-非必选-命令"><a href="#3-5-非必选-命令" class="headerlink" title="3-5 非必选 (命令)"></a>3-5 非必选 (命令)</h2><ul>
<li>sudo emqx ctl admins add [ 用户名 ] [ 用户密码 ]</li>
</ul>
<h2 id="3-6-控制台"><a href="#3-6-控制台" class="headerlink" title="3-6 控制台"></a>3-6 控制台</h2><ul>
<li>http:&#x2F;&#x2F;[ broker 的 ip ]:18083&#x2F;</li>
</ul>
<h1 id="4-mqtt接口的python实现-消息的发送端和接收端"><a href="#4-mqtt接口的python实现-消息的发送端和接收端" class="headerlink" title="4- mqtt接口的python实现 (消息的发送端和接收端)"></a>4- mqtt接口的python实现 (消息的发送端和接收端)</h1><h2 id="4-1-安装python依赖库"><a href="#4-1-安装python依赖库" class="headerlink" title="4-1 安装python依赖库"></a>4-1 安装python依赖库</h2><ul>
<li>pip install paho-mqtt</li>
</ul>
<h2 id="4-2-连接到broker"><a href="#4-2-连接到broker" class="headerlink" title="4-2 连接到broker"></a>4-2 连接到broker</h2><ul>
<li><p>1、from paho.mqtt import client as paho_mqtt_cient</p>
</li>
<li><p>2、建立Client对象</p>
<ul>
<li><p>_client &#x3D; paho_mqtt _client.Client (client _id)</p>
</li>
<li><p>client_id是它的名字</p>
</li>
</ul>
</li>
<li><p>3、链接服务器IP和端口号</p>
<ul>
<li>_client.connect (broker-ip, broker-port)</li>
<li>broker-ip：服务器IP</li>
<li>broker-port：服务器端口号，一般是1883</li>
</ul>
</li>
<li><p>4、判断是否连接成功</p>
<ul>
<li><p>先写一个回调函数</p>
<ul>
<li>def on_connect (client, userdata, flags, rc):</li>
<li>if rc &#x3D;&#x3D; 0: </li>
<li>连接上了</li>
<li>else:</li>
<li>没连接上</li>
</ul>
</li>
<li><p>然后绑定到Client</p>
<ul>
<li>_client.on_connect &#x3D; on_connect</li>
</ul>
</li>
</ul>
</li>
<li><p>5、开启线程</p>
<ul>
<li>self._client.loop_start ( )</li>
</ul>
</li>
</ul>
<h2 id="4-3-消息发送端"><a href="#4-3-消息发送端" class="headerlink" title="4-3 消息发送端"></a>4-3 消息发送端</h2><ul>
<li>result &#x3D; client.publish (topic, msg, qos, retain)<ul>
<li>topic：消息名、主题</li>
<li>msg：消息内容、负载</li>
<li>retain：状态机消息</li>
<li>返回消息状态</li>
</ul>
</li>
</ul>
<h2 id="4-4-消息接收端"><a href="#4-4-消息接收端" class="headerlink" title="4-4 消息接收端"></a>4-4 消息接收端</h2><ul>
<li>1、写一个回调函数<ul>
<li>def default_on_message (self, client, userdata, msg):</li>
<li>……</li>
<li>默认回调函数</li>
<li>print (msg.payload.decode (‘utf-8’))</li>
</ul>
</li>
<li>2、把回调函数绑定到_client.on_message<ul>
<li>self.client.on_message &#x3D; self.default_on_message</li>
</ul>
</li>
<li>3、关联到发送端消息名<ul>
<li>self.client.subscribe (topic)</li>
<li>绑定关联完成后，接收到同名消息，就会激活回调函数</li>
</ul>
</li>
<li>4、在回调函数中处理接收消息</li>
</ul>
<h2 id="4-5-关闭链接"><a href="#4-5-关闭链接" class="headerlink" title="4-5 关闭链接"></a>4-5 关闭链接</h2><ul>
<li>_client.loop_stop ( ）</li>
<li>_client.disconnect ( )</li>
</ul>
<h1 id="5-python代码"><a href="#5-python代码" class="headerlink" title="5- python代码"></a>5- python代码</h1><h2 id="5-1-发送端"><a href="#5-1-发送端" class="headerlink" title="5-1 发送端"></a>5-1 发送端</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> paho.mqtt.client <span class="keyword">as</span> mqtt</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># 连接成功回调</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mqtt_Publisher</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        mqtt消息通讯接口</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,central_ip=<span class="string">&#x27;192.168.0.205&#x27;</span>,port=<span class="number">1883</span>,node_name=<span class="string">&#x27;bci_&#x27;</span>,anonymous=<span class="literal">True</span>,timeout=<span class="number">60</span></span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        :param central_ip: Broker的地址</span></span><br><span class="line"><span class="string">        :param port:  端口号</span></span><br><span class="line"><span class="string">        :param timeout:  连接延时</span></span><br><span class="line"><span class="string">        :param node_name: 节点名称</span></span><br><span class="line"><span class="string">        :param anonymous: 是否同时允许多个节点</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        self.broker_ip=central_ip</span><br><span class="line">        self.broker_port=port</span><br><span class="line">        self.timeout=timeout</span><br><span class="line">        self.connected=<span class="literal">False</span></span><br><span class="line">        self.node_name=node_name</span><br><span class="line">        <span class="keyword">if</span> anonymous:</span><br><span class="line">            self.node_name=self.node_name+<span class="built_in">str</span>(random.randint(<span class="number">100000</span>,<span class="number">999999</span>))</span><br><span class="line">        self.Start()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        开启publisher</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        self.client = mqtt.Client(self.node_name)     <span class="comment">#创建客户端</span></span><br><span class="line">        self.client.on_connect = self.on_connect  <span class="comment"># 指定回调函数</span></span><br><span class="line">        self.client.connect(self.broker_ip, self.broker_port, self.timeout)     <span class="comment">#开始连接</span></span><br><span class="line">        self.client.loop_start()    <span class="comment">#开启一个独立的循环通讯线程</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Publish</span>(<span class="params">self,topic,payload,qos=<span class="number">0</span>,retain=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            发送一个mqtt消息</span></span><br><span class="line"><span class="string">            :param topic: 消息名称，string类型</span></span><br><span class="line"><span class="string">            :param payload: 消息内容，string类型</span></span><br><span class="line"><span class="string">            :param qos: 消息等级</span></span><br><span class="line"><span class="string">            :retain: 状态机消息</span></span><br><span class="line"><span class="string">            :return:</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> self.connected:</span><br><span class="line">            <span class="keyword">return</span> self.client.publish(topic,payload=payload,qos=qos,retain=retain)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&quot;mqtt server not connected! you may use .Start() function to connect to server firstly.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                回调函数</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>   </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_connect</span>(<span class="params">self,client, userdata, flags, rc</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            连接到broker的回调函数</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> rc==<span class="number">0</span>:</span><br><span class="line">            self.connected=<span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&quot;Failed to connect mqtt server.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p=Mqtt_Publisher()</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> p.connected:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p.Publish(<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;this is a test message&#x27;</span>)</span><br><span class="line">        p.Publish(<span class="string">&#x27;test_2&#x27;</span>,<span class="string">&#x27;this is test 2&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div>

<h2 id="5-2-接收端"><a href="#5-2-接收端" class="headerlink" title="5-2 接收端"></a>5-2 接收端</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> paho.mqtt.client <span class="keyword">as</span> mqtt</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># 连接成功回调</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mqtt_Subscriber</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        mqtt消息通讯接口</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,central_ip=<span class="string">&#x27;192.168.0.205&#x27;</span>,port=<span class="number">1883</span>,</span></span><br><span class="line"><span class="params">                 topic_name=<span class="string">&#x27;test_2&#x27;</span>,callback_func=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">                 node_name=<span class="string">&#x27;bci_&#x27;</span>,anonymous=<span class="literal">True</span>,timeout=<span class="number">60</span></span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            :param central_ip: Broker的地址</span></span><br><span class="line"><span class="string">            :param port:  端口号</span></span><br><span class="line"><span class="string">            :param topic_name: 接收的消息名称</span></span><br><span class="line"><span class="string">            :param callback_func: 指定回调函数</span></span><br><span class="line"><span class="string">            :param timeout:  连接延时</span></span><br><span class="line"><span class="string">            :param node_name: 节点名称</span></span><br><span class="line"><span class="string">            :param anonymous: 是否同时允许多个节点</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        self.topic=topic_name</span><br><span class="line">        self.callback=callback_func</span><br><span class="line">        self.broker_ip=central_ip</span><br><span class="line">        self.broker_port=port</span><br><span class="line">        self.timeout=timeout</span><br><span class="line">        self.connected=<span class="literal">False</span></span><br><span class="line">        self.node_name=node_name</span><br><span class="line">        <span class="keyword">if</span> anonymous:</span><br><span class="line">            self.node_name=self.node_name+<span class="built_in">str</span>(random.randint(<span class="number">100000</span>,<span class="number">999999</span>))</span><br><span class="line">        self.Start()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        开启publisher</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        self.client = mqtt.Client(self.node_name)     <span class="comment">#创建客户端</span></span><br><span class="line">        self.client.on_connect = self.on_connect  <span class="comment"># 指定回调函数</span></span><br><span class="line">        self.client.on_message=self.default_on_message</span><br><span class="line">        self.client.connect(self.broker_ip, self.broker_port, self.timeout)     <span class="comment">#开始连接</span></span><br><span class="line">        self.client.subscribe(self.topic)</span><br><span class="line">        self.client.loop_start()    <span class="comment">#开启一个独立的循环通讯线程。</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                回调函数</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">default_on_message</span>(<span class="params">self,client, userdata, msg</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            默认回调函数</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(msg.payload.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_connect</span>(<span class="params">self,client, userdata, flags, rc</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            连接到broker的回调函数</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> rc==<span class="number">0</span>:</span><br><span class="line">            self.connected=<span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&quot;Failed to connect mqtt server.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p=Mqtt_Subscriber()</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> p.connected:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div>

<h1 id="—–Java—–"><a href="#—–Java—–" class="headerlink" title="—–Java—–"></a>—–Java—–</h1><h1 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1- 准备工作"></a>1- 准备工作</h1><ul>
<li><a class="link"   href="https://blog.csdn.net/weixin_44462773/article/details/135056325" >windows10-EMQX与MQTTX的安装及配置使用教程-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<h1 id="2-EMQX常用命令"><a href="#2-EMQX常用命令" class="headerlink" title="2- EMQX常用命令"></a>2- EMQX常用命令</h1><ul>
<li><p>.\emqx.cmd start ：启动服务和 Erlang 节点</p>
</li>
<li><p>.\emqx.cmd stop ：停止服务和 Erlang 节点</p>
</li>
<li><p>.\emqx.cmd restart ：运行停止命令和启动命令</p>
</li>
<li><p>.\emqx.cmd ping ： 检查节点是否正在运行</p>
</li>
<li><p>.\emqx.cmd ctl ：运行管理命令</p>
</li>
<li><p>.\emqx.cmd console ：在Windows shell 中启动 Erlang 版本</p>
</li>
<li><p>.\emqx.cmd attach ：连接到正在运行的节点并打开交互式控制台</p>
</li>
<li><p>.\emqx.cmd remote_console ：与附加相同</p>
</li>
<li><p>.\emqx.cmd list ： 显示已安装的 Erlang 服务的列表</p>
</li>
<li><p>.\emqx.cmd usage ：显示可用命令</p>
</li>
</ul>
<h1 id="3-实际应用"><a href="#3-实际应用" class="headerlink" title="3- 实际应用"></a>3- 实际应用</h1><h2 id="3-1-应用场景"><a href="#3-1-应用场景" class="headerlink" title="3-1 应用场景"></a>3-1 应用场景</h2><p>硬件采集的数据传入EMQX平台(采用MQTT协议)，java通过代码连接MQTT服务器，进行采集数据接收、解析、业务处理、存储入库、数据展示。</p>
<p>MQTT 是基于 <strong>发布(Publish)&#x2F;订阅(Subscribe)</strong> 模式来进行通信及数据交换的。</p>
<h2 id="3-2-pom文件中直接引入mqtt依赖"><a href="#3-2-pom文件中直接引入mqtt依赖" class="headerlink" title="3-2 pom文件中直接引入mqtt依赖"></a>3-2 pom文件中直接引入mqtt依赖</h2><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.integration<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-integration-mqtt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="3-2-编写MQTT工具类"><a href="#3-2-编写MQTT工具类" class="headerlink" title="3-2 编写MQTT工具类"></a>3-2 编写MQTT工具类</h2><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.siborui.dc.mqtt;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.*;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MQTT工具类操作</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Qu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> v1.1.0 2020-01-10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MQTTConnect</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">HOST</span> <span class="operator">=</span> <span class="string">&quot;tcp://127.0.0.1:1883&quot;</span>; <span class="comment">//mqtt服务器的地址和端口号</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">clientId</span> <span class="operator">=</span> <span class="string">&quot;DC&quot;</span> + (<span class="type">int</span>) (Math.random() * <span class="number">100000000</span>);</span><br><span class="line">    <span class="keyword">private</span> MqttClient mqttClient;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户端connect连接mqtt服务器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userName     用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> passWord     密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mqttCallback 回调函数</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMqttClient</span><span class="params">(String userName, String passWord, MqttCallback mqttCallback)</span> <span class="keyword">throws</span> MqttException &#123;</span><br><span class="line">        <span class="type">MqttConnectOptions</span> <span class="variable">options</span> <span class="operator">=</span> mqttConnectOptions(userName, passWord);</span><br><span class="line">        <span class="keyword">if</span> (mqttCallback == <span class="literal">null</span>) &#123;</span><br><span class="line">            mqttClient.setCallback(<span class="keyword">new</span> <span class="title class_">Callback</span>());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mqttClient.setCallback(mqttCallback);</span><br><span class="line">        &#125;</span><br><span class="line">        mqttClient.connect(options);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * MQTT连接参数设置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> MqttConnectOptions <span class="title function_">mqttConnectOptions</span><span class="params">(String userName, String passWord)</span> <span class="keyword">throws</span> MqttException &#123;</span><br><span class="line">        mqttClient = <span class="keyword">new</span> <span class="title class_">MqttClient</span>(HOST, clientId, <span class="keyword">new</span> <span class="title class_">MemoryPersistence</span>());</span><br><span class="line">        <span class="type">MqttConnectOptions</span> <span class="variable">options</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MqttConnectOptions</span>();</span><br><span class="line">        options.setUserName(userName);</span><br><span class="line">        options.setPassword(passWord.toCharArray());</span><br><span class="line">        options.setConnectionTimeout(<span class="number">10</span>);<span class="comment">///默认：30</span></span><br><span class="line">        options.setAutomaticReconnect(<span class="literal">true</span>);<span class="comment">//默认：false</span></span><br><span class="line">        options.setCleanSession(<span class="literal">false</span>);<span class="comment">//默认：true</span></span><br><span class="line">        <span class="comment">//options.setKeepAliveInterval(20);//默认：60</span></span><br><span class="line">        <span class="keyword">return</span> options;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭MQTT连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> MqttException &#123;</span><br><span class="line">        mqttClient.disconnect();</span><br><span class="line">        mqttClient.close();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向某个主题发布消息 默认qos：1</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> topic:发布的主题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg：发布的消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pub</span><span class="params">(String topic, String msg)</span> <span class="keyword">throws</span> MqttException &#123;</span><br><span class="line">        <span class="type">MqttMessage</span> <span class="variable">mqttMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MqttMessage</span>();</span><br><span class="line">        <span class="comment">//mqttMessage.setQos(2);</span></span><br><span class="line">        mqttMessage.setPayload(msg.getBytes());</span><br><span class="line">        <span class="type">MqttTopic</span> <span class="variable">mqttTopic</span> <span class="operator">=</span> mqttClient.getTopic(topic);</span><br><span class="line">        <span class="type">MqttDeliveryToken</span> <span class="variable">token</span> <span class="operator">=</span> mqttTopic.publish(mqttMessage);</span><br><span class="line">        token.waitForCompletion();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向某个主题发布消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> topic: 发布的主题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg:   发布的消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> qos:   消息质量    Qos：0、1、2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pub</span><span class="params">(String topic, String msg, <span class="type">int</span> qos)</span> <span class="keyword">throws</span> MqttException &#123;</span><br><span class="line">        <span class="type">MqttMessage</span> <span class="variable">mqttMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MqttMessage</span>();</span><br><span class="line">        mqttMessage.setQos(qos);</span><br><span class="line">        mqttMessage.setPayload(msg.getBytes());</span><br><span class="line">        <span class="type">MqttTopic</span> <span class="variable">mqttTopic</span> <span class="operator">=</span> mqttClient.getTopic(topic);</span><br><span class="line">        <span class="type">MqttDeliveryToken</span> <span class="variable">token</span> <span class="operator">=</span> mqttTopic.publish(mqttMessage);</span><br><span class="line">        token.waitForCompletion();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订阅某一个主题 ，此方法默认的的Qos等级为：1</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> topic 主题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sub</span><span class="params">(String topic)</span> <span class="keyword">throws</span> MqttException &#123;</span><br><span class="line">        mqttClient.subscribe(topic);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订阅某一个主题，可携带Qos</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> topic 所要订阅的主题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> qos   消息质量：0、1、2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sub</span><span class="params">(String topic, <span class="type">int</span> qos)</span> <span class="keyword">throws</span> MqttException &#123;</span><br><span class="line">        mqttClient.subscribe(topic, qos);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * main函数自己测试用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MqttException &#123;</span><br><span class="line">        <span class="type">MQTTConnect</span> <span class="variable">mqttConnect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MQTTConnect</span>();</span><br><span class="line">        mqttConnect.setMqttClient(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;public&quot;</span>, <span class="keyword">new</span> <span class="title class_">Callback</span>());</span><br><span class="line">        mqttConnect.sub(<span class="string">&quot;com/iot/init&quot;</span>);</span><br><span class="line">        mqttConnect.pub(<span class="string">&quot;com/iot/init&quot;</span>, <span class="string">&quot;Mr.Qu&quot;</span> + (<span class="type">int</span>) (Math.random() * <span class="number">100000000</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="3-3-编写MQTT的回调函数"><a href="#3-3-编写MQTT的回调函数" class="headerlink" title="3-3 编写MQTT的回调函数"></a>3-3 编写MQTT的回调函数</h2><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.siborui.dc.mqtt;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttCallback;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttMessage;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 常规MQTT回调函数</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Qu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/1/9 16:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Callback</span> <span class="keyword">implements</span> <span class="title class_">MqttCallback</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * MQTT 断开连接会执行此方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connectionLost</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;断开了MQTT连接 ：&#123;&#125;&quot;</span>, throwable.getMessage());</span><br><span class="line">        log.error(throwable.getMessage(), throwable);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * publish发布成功后会执行到这里</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deliveryComplete</span><span class="params">(IMqttDeliveryToken iMqttDeliveryToken)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;发布消息成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * subscribe订阅后得到的消息会执行到这里</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">messageArrived</span><span class="params">(String topic, MqttMessage message)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//  TODO    此处可以将订阅得到的消息进行业务处理、数据存储</span></span><br><span class="line">        log.info(<span class="string">&quot;收到来自 &quot;</span> + topic + <span class="string">&quot; 的消息：&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>(message.getPayload()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="3-4-监听MQTT主题Topic，编写MQTT监听器"><a href="#3-4-监听MQTT主题Topic，编写MQTT监听器" class="headerlink" title="3-4 监听MQTT主题Topic，编写MQTT监听器"></a>3-4 监听MQTT主题Topic，编写MQTT监听器</h2><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.siborui.dc.mqtt;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.ContextRefreshedEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.siborui.dc.mqtt.Callback;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 项目启动 监听主题</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mr.Qu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/1/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MQTTListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;ContextRefreshedEvent&gt; &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MQTTConnect server;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MQTTListener</span><span class="params">(MQTTConnect server)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.server = server;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ContextRefreshedEvent contextRefreshedEvent)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            server.setMqttClient(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;public&quot;</span>, <span class="keyword">new</span> <span class="title class_">Callback</span>());</span><br><span class="line">            server.sub(<span class="string">&quot;com/iot/init&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MqttException e) &#123;</span><br><span class="line">            log.error(e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>其他</category>
        <category>MQTT协议</category>
      </categories>
      <tags>
        <tag>自研笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaWeb（含SSM框架）</title>
    <url>/2024/02/27/JavaWeb%EF%BC%88%E5%90%ABSSM%E6%A1%86%E6%9E%B6%EF%BC%89/</url>
    <content><![CDATA[<h1 id="一、WEB"><a href="#一、WEB" class="headerlink" title="一、WEB"></a>一、WEB</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1- 介绍"></a>1- 介绍</h2><p>全球广域网，也称为万维网 ( www world Wide Web )，能够通过浏览器访问的网站。如：京东、淘宝。</p>
<h2 id="2-工作流程"><a href="#2-工作流程" class="headerlink" title="2- 工作流程"></a>2- 工作流程</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240228115425165.png"
                      alt="image-20240228115425165"
                ></li>
</ul>
<h1 id="二、前端"><a href="#二、前端" class="headerlink" title="二、前端"></a>二、前端</h1><h2 id="1-参考手册"><a href="#1-参考手册" class="headerlink" title="1 参考手册"></a>1 参考手册</h2><ul>
<li><a class="link"   href="http://w3school.com.cn/" >w3school.com.cn&#x2F; <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<h2 id="2-HTML"><a href="#2-HTML" class="headerlink" title="2 HTML"></a>2 HTML</h2><h3 id="2-1-介绍"><a href="#2-1-介绍" class="headerlink" title="2-1 介绍"></a>2-1 介绍</h3><p>HTML ( Hyper Text Markup Language )：超文本标记语言。</p>
<ul>
<li><p>超文本：超越了文本的限制，比普通文本更强大。除了文字信息，还可以定义图片、音频、视频等内容。</p>
</li>
<li><p>标记语言：由标签构成的语言</p>
<p>HTML标签都是预定义好的。例如：使用&lt; a &gt;展示超链接，使用&lt; img &gt;展示图片，&lt; video &gt;展示视频。</p>
<p>HTML代码直接在浏览器中运行，HTML标签由浏览器解析。</p>
</li>
</ul>
<h3 id="2-2-标题标签"><a href="#2-2-标题标签" class="headerlink" title="2-2 标题标签"></a>2-2 标题标签</h3><p><strong>&lt; h1 &gt;-&lt; h6 &gt;</strong></p>
<p>h1最大，h6最小</p>
<h3 id="2-3-图片标签"><a href="#2-3-图片标签" class="headerlink" title="2-3 图片标签"></a>2-3 图片标签</h3><p><strong>&lt; img src&#x3D;”” &gt;</strong></p>
<p>src：指定图像的url(绝对路径 &#x2F;相对路径)。</p>
<ul>
<li><p>绝对路径：绝对磁盘路径、绝对网络路径。</p>
</li>
<li><p>相对路径：.&#x2F;：当前目录，可省略；..&#x2F;：上一级目录。</p>
</li>
</ul>
<p>width：图像的宽度(像素 &#x2F;相对于父元素的百分比)。</p>
<p>height：图像的高度(像素 &#x2F;相对于父元素的百分比)。</p>
<h3 id="2-4-超链接标签"><a href="#2-4-超链接标签" class="headerlink" title="2-4 超链接标签"></a>2-4 超链接标签</h3><p><strong>&lt; a href&#x3D;”” target&#x3D;”” &gt;</strong></p>
<p>href：指定资源访问的url。</p>
<p>target：指定在何处打开资源链接。</p>
<ul>
<li>_self：默认值，在当前页面打开。</li>
<li>_blank：在空白页面打开。</li>
</ul>
<h3 id="2-5-视频标签"><a href="#2-5-视频标签" class="headerlink" title="2-5 视频标签"></a>2-5 视频标签</h3><p><strong>&lt; video src&#x3D;”” controls &gt;</strong></p>
<p>src：规定视频的url。</p>
<p>controls：显示播放控件。</p>
<p>width：播放器的宽度。</p>
<p>height：播放器的高度。</p>
<h3 id="2-6-音频标签"><a href="#2-6-音频标签" class="headerlink" title="2-6 音频标签"></a>2-6 音频标签</h3><p><strong>&lt; audio src&#x3D;”” controls &gt;</strong></p>
<p>src：规定音频的url。</p>
<p>controls：显示播放控件。</p>
<h3 id="2-7-表格标签"><a href="#2-7-表格标签" class="headerlink" title="2-7 表格标签"></a>2-7 表格标签</h3><p>&lt; th &gt; ：表示表头单元格，具有加粗居中效果</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240228170546475.png"
                      alt="image-20240228170546475"
                ></p>
<h3 id="2-8-表单标签"><a href="#2-8-表单标签" class="headerlink" title="2-8 表单标签"></a>2-8 表单标签</h3><p><strong>&lt; form action&#x3D;”” method&#x3D;”” &gt;</strong></p>
<p>action：表单提交的url，往何处提交数据 。 如果不指定，默认提交到当前页面。</p>
<p>method: 表单的提交方式。</p>
<ul>
<li>get：在url后面拼接表单数据，url长度有限制，是默认值。</li>
<li>post：在消息体(请求体) 中传递的，参数大小无限制的。</li>
</ul>
<p><strong>表单项标签</strong></p>
<p>&lt; input &gt;：表单项，通过type属性控制输入形式</p>
<p>&lt; select &gt;：定义下拉列表</p>
<p>&lt; option &gt; ：定义列表项</p>
<p>&lt; textarea &gt;：定义文本域</p>
<p>表单项必须有name属性才可以提交。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240228170609448.png"
                      alt="image-20240228170609448"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240228170617774.png"
                      alt="image-20240228170617774"
                ></p>
<h3 id="2-9-其他标签"><a href="#2-9-其他标签" class="headerlink" title="2-9 其他标签"></a>2-9 其他标签</h3><p>&lt; hr &gt;：水平分割线</p>
<p>&lt; br &gt;：换行</p>
<p>&lt; p &gt;：段落</p>
<p>&lt; b &gt; &#x2F;&lt; strong &gt;：文本加粗</p>
<p>&lt; span &gt;：一个在开发网页时大量会用到的没有语义的布局标签；一行可以显示多个(组合行内元素)，宽度和高度默认由内容撑开；不可以设置宽高 (width、height)</p>
<p>&lt; div &gt;：一行只显示一个(独占一行)；宽度默认是父元素的宽度，高度默认由内容撑开；可以设置宽高 (width、height)</p>
<h2 id="3-CSS"><a href="#3-CSS" class="headerlink" title="3- CSS"></a>3- CSS</h2><h3 id="3-1-介绍"><a href="#3-1-介绍" class="headerlink" title="3-1 介绍"></a>3-1 介绍</h3><p>CSS ( Cascading Style Sheet )：层叠样式表，用于控制页面的样式 ( 表现 )。</p>
<h3 id="3-2-引入"><a href="#3-2-引入" class="headerlink" title="3-2 引入"></a>3-2 引入</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/a408199c-4141-4844-8f67-e68fa3dfcac6-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="3-3-选择器"><a href="#3-3-选择器" class="headerlink" title="3-3 选择器"></a>3-3 选择器</h3><p>优先级：id &gt; 类 &gt; 元素</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/633d1731-b21d-499c-ab9b-fc974b8180ff-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="3-4-盒子模型"><a href="#3-4-盒子模型" class="headerlink" title="3-4 盒子模型"></a>3-4 盒子模型</h3><h4 id="3-4-1-介绍"><a href="#3-4-1-介绍" class="headerlink" title="3-4-1 介绍"></a>3-4-1 介绍</h4><p>页面中所有的元素(标签)，都可以看做是一个盒子，由盒子将页面中的元素包含在一个矩形区域内，通过盒子的视角更方便的进行页面布局。</p>
<h4 id="3-4-2-组成"><a href="#3-4-2-组成" class="headerlink" title="3-4-2 组成"></a>3-4-2 组成</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/e0e9d03d-25f9-45d7-9d6c-80e0b51de009-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="3-4-3-属性"><a href="#3-4-3-属性" class="headerlink" title="3-4-3 属性"></a>3-4-3 属性</h4><p>width：设置宽度</p>
<p>height：设置高度</p>
<p>padding、margin：上、右、下、左</p>
<p>border：宽度、线条类型、颜色</p>
<p>background：背景</p>
<h3 id="3-5-属性"><a href="#3-5-属性" class="headerlink" title="3-5 属性"></a>3-5 属性</h3><p>颜色：color</p>
<table>
<thead>
<tr>
<th>表示方式</th>
<th>表示含义</th>
<th>取值</th>
</tr>
</thead>
<tbody><tr>
<td>关键字</td>
<td>预定义的颜色名</td>
<td>red、green、blue</td>
</tr>
<tr>
<td>rgb表示法</td>
<td>红绿蓝三原色，每项取值范围：0-255</td>
<td>rgb(0,0,0)、rgb(255,255,255)、rgb(255,0,0)</td>
</tr>
<tr>
<td>十六进制表示法</td>
<td>#开头，将数字转换成十六进制表示</td>
<td>#ff0000、#cccccc，简写：#ccc</td>
</tr>
</tbody></table>
<p>字体大小：font-size</p>
<p>规定添加到文本的修饰：text-decoration，其中none表示定义标准的文本</p>
<p>设置行高：line-height</p>
<p>定义第一个行内容的缩进：text-indent</p>
<p>规定元素中的文本的水平对齐方式：text-align</p>
<h2 id="4-JavaScript"><a href="#4-JavaScript" class="headerlink" title="4- JavaScript"></a>4- JavaScript</h2><h3 id="4-1-介绍"><a href="#4-1-介绍" class="headerlink" title="4-1 介绍"></a>4-1 介绍</h3><p>JavaScript ( 简称：JS )是一门跨平台、面向对象的脚本语言。是用来控制网页行为的，它能使网页可交互。</p>
<p>JavaScript 和 Java 是完全不同的语言，不论是概念还是设计。但是基础语法类似。</p>
<h3 id="4-2-引入"><a href="#4-2-引入" class="headerlink" title="4-2 引入"></a>4-2 引入</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/675a0f0f-716a-4e94-9132-f8ac779098ac-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/2582d6db-e4af-427d-9c09-17022702f111-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
<h3 id="4-3-语法"><a href="#4-3-语法" class="headerlink" title="4-3 语法"></a>4-3 语法</h3><h4 id="4-3-1-基础"><a href="#4-3-1-基础" class="headerlink" title="4-3-1 基础"></a>4-3-1 基础</h4><p>区分大小写：与Java 一样，变量名、函数名以及其他一切东西都是区分大小写的。</p>
<p>注释：单行注释：&#x2F;&#x2F; 注释内容；多行注释：&#x2F;* 注释内容 *&#x2F;</p>
<p>每行结尾的分号可有可无。</p>
<p>大括号表示代码块。</p>
<h4 id="4-3-2-输出语句"><a href="#4-3-2-输出语句" class="headerlink" title="4-3-2 输出语句"></a>4-3-2 输出语句</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/2891e753-e511-4814-aef4-52e24395ee90-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="4-3-3-变量"><a href="#4-3-3-变量" class="headerlink" title="4-3-3 变量"></a>4-3-3 变量</h4><p>命名规则：</p>
<ul>
<li><p>组成字符可以是任何字母、数字、下划线 (_) 或美元符号 ($) 。</p>
</li>
<li><p>数字不能开头。</p>
</li>
<li><p>建议使用驼峰命名。</p>
</li>
</ul>
<p>定义：</p>
<ul>
<li><p>用var关键字 ( variable 的缩写 ) 来声明。</p>
</li>
<li><p>同一变量可以存放不同类型的值。</p>
</li>
</ul>
<p>特点：</p>
<ul>
<li><p>作用域比较大，全局变量。</p>
</li>
<li><p>可以重复定义的，但后面的覆盖前面的</p>
</li>
</ul>
<p>注意：</p>
<ul>
<li><p>ECMAScript6 新增了 let 关键字来定义变量。它的用法类似于 var，但是所声明的变量，只在 let 关键字所在的代码块内有效，且不允许重复声明。</p>
</li>
<li><p>ECMAScript6 新增了 const 关键字，用来声明一个只读的常量。一旦声明，常量的值就不能改变。</p>
</li>
</ul>
<h4 id="4-3-4-数据类型"><a href="#4-3-4-数据类型" class="headerlink" title="4-3-4 数据类型"></a>4-3-4 数据类型</h4><p>引用类型</p>
<p>原始类型：</p>
<ul>
<li>number：数字 ( 整数、小数、NaN ( Not a Number ) )</li>
<li>string：字符串，单双引皆可</li>
<li>boolean：布尔</li>
<li>null：对象为空</li>
<li>undefined：当声明的变量未初始化时，该变量的默认值是undefined</li>
</ul>
<p>使用 typeof 运算符可以获取数据类型。</p>
<h4 id="4-3-5-类型转换"><a href="#4-3-5-类型转换" class="headerlink" title="4-3-5 类型转换"></a>4-3-5 类型转换</h4><p>字符串类型转为数字：</p>
<ul>
<li>将字符串字面值转为数字。 如果字面值不是数字，则转为NaN。</li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="built_in">parseInt</span>(<span class="string">&quot;12&quot;</span>)); <span class="comment">//12</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="built_in">parseInt</span>(<span class="string">&quot;12A45&quot;</span>)); <span class="comment">//12</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="built_in">parseInt</span>(<span class="string">&quot;A45&quot;</span>)); <span class="comment">//NaN ( not a number )</span></span><br></pre></td></tr></table></figure></div>



<p>其他类型转为boolean：</p>
<ul>
<li>Number：0和NaN为false，其他均转为true。</li>
<li>String：空字符串为false，其他均转为true。</li>
<li>Null和 undefined：均转为false。</li>
</ul>
<h4 id="4-3-6-运算符"><a href="#4-3-6-运算符" class="headerlink" title="4-3-6 运算符"></a>4-3-6 运算符</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/47ac47da-f475-419f-93eb-1bba0a1af413-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>&#x3D;&#x3D;与&#x3D;&#x3D;&#x3D;的区别：</p>
<ul>
<li>&#x3D;&#x3D; 会进行类型转换，&#x3D;&#x3D;&#x3D; 不会进行类型转换。</li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">var</span> _age = <span class="string">&quot;20&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> $age = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(age == _age); <span class="comment">//true</span></span><br><span class="line"><span class="title function_">alert</span>(age === _age); <span class="comment">//flase</span></span><br><span class="line"><span class="title function_">alert</span>(age === $age); <span class="comment">//true</span></span><br></pre></td></tr></table></figure></div>

<h4 id="4-3-7-流程控制语句"><a href="#4-3-7-流程控制语句" class="headerlink" title="4-3-7 流程控制语句"></a>4-3-7 流程控制语句</h4><p>if…else if …else…</p>
<p>switch</p>
<p>for</p>
<p>while</p>
<p>do…while</p>
<h3 id="4-4-函数（即方法）"><a href="#4-4-函数（即方法）" class="headerlink" title="4-4 函数（即方法）"></a>4-4 函数（即方法）</h3><h4 id="4-4-1-介绍"><a href="#4-4-1-介绍" class="headerlink" title="4-4-1 介绍"></a>4-4-1 介绍</h4><p>函数(方法)是被设计为执行特定任务的代码块。</p>
<h4 id="4-4-2-定义"><a href="#4-4-2-定义" class="headerlink" title="4-4-2 定义"></a>4-4-2 定义</h4><p>avaScript 函数通过 function 关键字进行定义。</p>
<p>语法：</p>
<ul>
<li>1、function 函数名 （形参1，形参2……）{ 函数体 }</li>
<li>2、var 函数名 &#x3D; function(形参1,形参2…..) { 函数体 }</li>
</ul>
<p>注意：</p>
<ul>
<li><p>形式参数不需要类型。因为JavaScript是弱类型语言。</p>
</li>
<li><p>返回值也不需要定义类型，可以在函数内部直接使用return返回即可。</p>
</li>
</ul>
<h4 id="4-4-3-调用"><a href="#4-4-3-调用" class="headerlink" title="4-4-3 调用"></a>4-4-3 调用</h4><p>函数名 (实际参数列表)</p>
<h3 id="4-5-对象"><a href="#4-5-对象" class="headerlink" title="4-5 对象"></a>4-5 对象</h3><h4 id="4-5-1-Array（数组）"><a href="#4-5-1-Array（数组）" class="headerlink" title="4-5-1 Array（数组）"></a>4-5-1 Array（数组）</h4><p>定义：</p>
<ul>
<li><p>var 变量名 &#x3D; new Array ( 元素列表 )；</p>
</li>
<li><p>var 变量名 &#x3D; [ 元素列表 ]；</p>
</li>
<li><p>变量名 [ 索引 ] &#x3D; 值；</p>
</li>
</ul>
<p>属性：</p>
<ul>
<li>length：设置或返回数组中元素的数量。</li>
</ul>
<p>特点：</p>
<ul>
<li>长度可变、类型可变。</li>
</ul>
<p>方法：</p>
<ul>
<li>forEach ( )<ul>
<li>遍历数组中的每个有值的元素，并调用一次传入的函数。</li>
</ul>
</li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//arr是数组</span></span><br><span class="line">arr.<span class="title function_">forEash</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ES6 箭头函数:(...) =&gt; &#123;...&#125; -- 简化函数定义</span></span><br><span class="line">arr.<span class="title function_">forEash</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>push ( )</p>
<ul>
<li>将新元素添加到数组的末尾，并返回新的数组。</li>
</ul>
</li>
<li><p>splice ( )</p>
<ul>
<li>从数组中删除元素。第一个参数是从什么位置开始删，第二个参数是删几个。</li>
</ul>
</li>
</ul>
<h4 id="4-5-2-String（字符串）"><a href="#4-5-2-String（字符串）" class="headerlink" title="4-5-2 String（字符串）"></a>4-5-2 String（字符串）</h4><p>定义：</p>
<ul>
<li>var 变量名 &#x3D; new String ( “……” ) ;</li>
<li>var 变量名 &#x3D; “……”；</li>
</ul>
<p>属性：</p>
<ul>
<li>length：字符串的长度。</li>
</ul>
<p>方法：</p>
<ul>
<li><p>charAt ( )</p>
<ul>
<li>返回在指定位置的字符。</li>
</ul>
</li>
<li><p>indexOf ( )</p>
<ul>
<li>检索字符串位置。</li>
</ul>
</li>
<li><p>trim ( )</p>
<ul>
<li>去除字符串两边的空格。</li>
</ul>
</li>
<li><p>substring ( )</p>
<ul>
<li>提取字符串中两个指定的索引号之间的字符。左闭右开。</li>
</ul>
</li>
</ul>
<h4 id="4-5-3-JSON"><a href="#4-5-3-JSON" class="headerlink" title="4-5-3 JSON"></a>4-5-3 JSON</h4><p>自定义对象:</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/6b283f80-7343-45d7-a66c-c088a526c04f-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>介绍:</p>
<ul>
<li>JavaScript Object Notation，JavaScript对象标记法。JSON是通过JavaScript对象标记法书写的文本。由于其语法简单，层次结构鲜明，现多用于作为数据载体，在网络中进行数据传输。</li>
</ul>
<p>定义：</p>
<ul>
<li>var 变量名 &#x3D; { “key1” : value1，”key2” : value2 …..}；</li>
<li>value的数据类型：<ul>
<li>数字 ( 整数或浮点数 )</li>
<li>字符串 ( 在双引号中 )</li>
<li>逻辑值 ( true 或 false )</li>
<li>数组 ( 在方括号中 )</li>
<li>对象 ( 在花括号中 )</li>
<li>null</li>
</ul>
</li>
</ul>
<p>转换：</p>
<ul>
<li>JSON字符串转为JS对象：</li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> jsObject = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(jsonStr);</span><br></pre></td></tr></table></figure></div>

<ul>
<li>JS对象转为JSON字符串：</li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonStr = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(jsObject);</span><br></pre></td></tr></table></figure></div>

<h4 id="4-5-4-BOM"><a href="#4-5-4-BOM" class="headerlink" title="4-5-4 BOM"></a>4-5-4 BOM</h4><p>介绍：</p>
<ul>
<li>Browser Obiect Model 浏览器对象模型，允许JavaScript 与浏览器对话，Javacript 将浏览器的各个组成部分封装为对象。</li>
</ul>
<p>组成：</p>
<ul>
<li>Window：浏览器窗口对象</li>
<li>Navigator：浏览器对象</li>
<li>Screen：屏幕对象</li>
<li>History：历史记录对象</li>
<li>Location：地址栏对象</li>
</ul>
<p>Window：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/8a5db09e-cb86-4001-bb0a-1b0f863edf58-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定时器-setInterval -- 周期性的执行某一个函数</span></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	i++;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;定时器执行了&quot;</span>+ i +<span class="string">&quot;次&quot;</span>);</span><br><span class="line">&#125;,<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定时器-setTimeout -- 延迟指定时间执行一次</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="title function_">alert</span>(<span class="string">&quot;JS&quot;</span>);</span><br><span class="line">&#125;,<span class="number">3000</span>);</span><br></pre></td></tr></table></figure></div>

<p>Location：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/17a8a14b-2c53-4ea7-a988-75efd626ee30-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line">location.<span class="property">href</span>; <span class="comment">//返回本地地址。</span></span><br><span class="line">location.<span class="property">href</span> = <span class="string">&quot;https://www.itcast.cn&quot;</span>; <span class="comment">//自动跳转到该地址。</span></span><br></pre></td></tr></table></figure></div>

<h4 id="4-5-5-DOM"><a href="#4-5-5-DOM" class="headerlink" title="4-5-5 DOM"></a>4-5-5 DOM</h4><p>介绍：</p>
<ul>
<li>Document object Model，文档对象模型。</li>
</ul>
<p>组成：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/77403e16-9cff-461a-9bdd-0e3c092a527c-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>JavaScript 通过DOM，能够对HTML进行操作：</p>
<ul>
<li>改变HTML元素的内容。</li>
<li>改变HTML元素的样式(CSS)。</li>
<li>对HTML DOM 事件作出反应。</li>
<li>添加和删除HTML元素。</li>
</ul>
<p>方法：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/9cde866d-df6b-4c9b-bff2-78ed287881da-25143160.jpg"
                      alt="img"
                ><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/b2f93c99-f5ae-42ae-a0ee-a927e2a59407-25143160.jpg"
                      alt="img"
                ></li>
</ul>
</li>
</ul>
<h4 id="4-5-6-事件监听"><a href="#4-5-6-事件监听" class="headerlink" title="4-5-6 事件监听"></a>4-5-6 事件监听</h4><p>事件：</p>
<ul>
<li>HTML事件是发生在HTML元素上的“事情”。比如：按钮被点击、鼠标移动到元素上、按下键盘按键。</li>
</ul>
<p>事件监听：</p>
<ul>
<li>JavaScript可以在事件被侦测到时执行代码。</li>
</ul>
<p>事件绑定：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/584141c9-8ba6-4f8f-94fa-4a47eee9f9f4-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>常见事件：</p>
<ul>
<li><table>
<thead>
<tr>
<th>事件名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>onclick</td>
<td>鼠标单击事件</td>
</tr>
<tr>
<td>onblur</td>
<td>元素失去焦点</td>
</tr>
<tr>
<td>onfocus</td>
<td>元素获得焦点</td>
</tr>
<tr>
<td>onload</td>
<td>某个页面或图像被完成加载</td>
</tr>
<tr>
<td>onsubmit</td>
<td>当表单提交时触发该事件</td>
</tr>
<tr>
<td>onkeydown</td>
<td>某个键盘的键被按下</td>
</tr>
<tr>
<td>onmouseover</td>
<td>鼠标被移到某元素之上</td>
</tr>
<tr>
<td>onmouseout</td>
<td>鼠标从某元素移开</td>
</tr>
</tbody></table>
</li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//输入框聚焦后，展示小写; 输入框离焦后，展示大写; -- onfocus，onblur</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">lower</span>(<span class="params"></span>)&#123; <span class="comment">//小写</span></span><br><span class="line">	<span class="comment">//获取输入框元素对象</span></span><br><span class="line">	<span class="keyword">var</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">	<span class="comment">//将值转为小写</span></span><br><span class="line">	input.<span class="property">value</span> = input.<span class="property">value</span>.<span class="title function_">toLowerCase</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">upper</span>(<span class="params"></span>)&#123; <span class="comment">//大写</span></span><br><span class="line">	<span class="comment">//获取输入框元素对象</span></span><br><span class="line">	<span class="keyword">var</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">	<span class="comment">//将值转为小写</span></span><br><span class="line">	input.<span class="property">value</span> = input.<span class="property">value</span>.<span class="title function_">toUpperCase</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="5-VUE"><a href="#5-VUE" class="headerlink" title="5- VUE"></a>5- VUE</h2><h3 id="5-1-介绍"><a href="#5-1-介绍" class="headerlink" title="5-1 介绍"></a>5-1 介绍</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/23f9b571-0ed1-4fcc-a20e-390275a36021-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="5-2-快速入门"><a href="#5-2-快速入门" class="headerlink" title="5-2 快速入门"></a>5-2 快速入门</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/49554752-9b28-47bf-9126-650c12ca840a-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="5-3-指令"><a href="#5-3-指令" class="headerlink" title="5-3 指令"></a>5-3 指令</h3><p>介绍：</p>
<ul>
<li>HTML 标签上带有 V-前缀 的特殊属性，不同指令具有不同含义。例如：v-if，v-for…</li>
</ul>
<p>常用指令：</p>
<ul>
<li><table>
<thead>
<tr>
<th>指令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>v-bind</td>
<td>为HTML标签绑定属性值，如设置 href，css样式等</td>
</tr>
<tr>
<td>v-model</td>
<td>在表单元素上创建双向数据绑定</td>
</tr>
<tr>
<td>v-on</td>
<td>为HTML标签绑定事件</td>
</tr>
<tr>
<td>v-if</td>
<td>条件性的渲染某元素，判定为true时渲染，否则不渲染</td>
</tr>
<tr>
<td>v-else-if</td>
<td>条件性的渲染某元素，判定为true时渲染，否则不渲染</td>
</tr>
<tr>
<td>v-else</td>
<td>条件性的渲染某元素，判定为true时渲染，否则不渲染</td>
</tr>
<tr>
<td>v-show</td>
<td>根据条件展示某元素，区别在于切换的是display属性的值</td>
</tr>
<tr>
<td>v-for</td>
<td>列表渲染，遍历容器的元素或者对象的属性</td>
</tr>
</tbody></table>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/7fce8c79-9f78-4632-b7ca-9903f30593af-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/346bd930-c4b0-480a-bd26-5087756b0639-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/34e3adee-0ed8-4de1-96ad-07dcd93a436e-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/d48312ed-475d-4b9e-b4d6-e966f25768e0-25143160.jpg"
                      alt="img"
                ></li>
</ul>
</li>
</ul>
<h3 id="5-4-生命周期"><a href="#5-4-生命周期" class="headerlink" title="5-4 生命周期"></a>5-4 生命周期</h3><p>介绍：</p>
<ul>
<li>指一个对象从创建到销毁的整个过程。</li>
</ul>
<p>生命周期的八个阶段：</p>
<ul>
<li><p>每触发一个生命周期事件，会自动执行一个生命周期方法 ( 钩子 )。</p>
</li>
<li><table>
<thead>
<tr>
<th>状态</th>
<th>阶段周期</th>
</tr>
</thead>
<tbody><tr>
<td>beforeCreate</td>
<td>创建前</td>
</tr>
<tr>
<td>created</td>
<td>创建后</td>
</tr>
<tr>
<td>beforeMount</td>
<td>挂载前</td>
</tr>
<tr>
<td>mounted</td>
<td>挂载完成</td>
</tr>
<tr>
<td>beforeUpdate</td>
<td>更新前</td>
</tr>
<tr>
<td>updated</td>
<td>更新后</td>
</tr>
<tr>
<td>beforeDestroy</td>
<td>销毁前</td>
</tr>
<tr>
<td>destroyed</td>
<td>销毁后</td>
</tr>
</tbody></table>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/5904f391-b232-4840-a5a8-f16fba37ff46-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
<p>mounted：</p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line">//mounted：挂载完成，Vue初始化成功，HTML页面渲染成功。(发送请求到服务端，加载数据)</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Vue挂载完毕,发送请求获取数据&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">	&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>	</span><br></pre></td></tr></table></figure></div>

<h2 id="6-AJAX"><a href="#6-AJAX" class="headerlink" title="6- AJAX"></a>6- AJAX</h2><h3 id="6-1-介绍"><a href="#6-1-介绍" class="headerlink" title="6-1 介绍"></a>6-1 介绍</h3><p>Asynchronous JavaScript And XML，异步的 JavaScript 和 XML 。</p>
<h3 id="6-2-作用"><a href="#6-2-作用" class="headerlink" title="6-2 作用"></a>6-2 作用</h3><p>数据交换：通过Ajax可以给服务器发送请求，并获取服务器响应的数据。</p>
<p>异步交互：可以在不重新加载整个页面的情况下，与服务器交换数据并更新部分网页的技术。如：搜索联想、用户名是否可用的校验等。</p>
<h3 id="6-3-同步与异步"><a href="#6-3-同步与异步" class="headerlink" title="6-3 同步与异步"></a>6-3 同步与异步</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/b68f86d7-8b35-4640-be06-92da8350689e-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="6-4-XMLHttpRequest-对象属性"><a href="#6-4-XMLHttpRequest-对象属性" class="headerlink" title="6-4 XMLHttpRequest 对象属性"></a>6-4 XMLHttpRequest 对象属性</h3><table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>onreadystatechange</td>
<td>定义当 readyState 属性发生变化时被调用的函数。</td>
</tr>
<tr>
<td>readyState</td>
<td>保存 XMLHttpRequest 的状态。0：请求未初始化；1：服务器连接已建立；2：请求已收到；                   3：正在处理请求；4：请求已完成且响应已就绪。</td>
</tr>
<tr>
<td>responseTest</td>
<td>以字符串返回响应数据。</td>
</tr>
<tr>
<td>responseXML</td>
<td>以 XML 数据返回响应数据。</td>
</tr>
<tr>
<td>status</td>
<td>返回请求的状态号。200：”OK” ；403：”Forbidden” ；404：”Not Found” 。</td>
</tr>
<tr>
<td>statusText</td>
<td>返回状态文本 ( 比如 “OK” 或 “Not Found” )</td>
</tr>
</tbody></table>
<h3 id="6-5-原生Ajax"><a href="#6-5-原生Ajax" class="headerlink" title="6-5 原生Ajax"></a>6-5 原生Ajax</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/3d20750f-26d6-4927-acee-2ee6317810fb-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="6-6-Axios"><a href="#6-6-Axios" class="headerlink" title="6-6 Axios"></a>6-6 Axios</h3><p>请求方式别名：</p>
<ul>
<li>axios . get (url [ , config])</li>
<li>axios . delete (url [ , config])</li>
<li>axios . post (url [ , data[config]])</li>
<li>axios . put (url [ , data[config]])</li>
</ul>
<p>实例：</p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;#app&quot;</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>图像<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>职位<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>入职日期<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>最后操作时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(emp,index) in emps&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;index + 1&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;emp.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;emp.image&quot;</span> <span class="attr">width</span>=<span class="string">&quot;70px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;50px&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;emp.gender == 1&quot;</span>&gt;</span>男<span class="tag">&lt;/<span class="name">sapn</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;emp.gender == 2&quot;</span>&gt;</span>女<span class="tag">&lt;/<span class="name">sapn</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;emp.job&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;emp.entrydate&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;emp.updatetime&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">			<span class="attr">emps</span>:[]</span></span><br><span class="line"><span class="language-javascript">		&#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        	<span class="comment">//发送异步请求,加载数据</span></span></span><br><span class="line"><span class="language-javascript">        	axois.<span class="title function_">get</span>(<span class="string">&quot;http://......&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        		<span class="variable language_">this</span>.<span class="property">emps</span> = result.<span class="property">data</span>.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">        	&#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">	&#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//数据</span><br><span class="line">&#123;</span><br><span class="line">	&quot;code&quot;: 1,</span><br><span class="line">	&quot;message&quot;: &quot;success&quot;,</span><br><span class="line">	&quot;data&quot;: [</span><br><span class="line">		&#123;</span><br><span class="line">			&quot;id&quot;: 1,</span><br><span class="line">			&quot;name&quot;: &quot;李四&quot;,</span><br><span class="line">			&quot;image&quot;: &quot;http://......&quot;,</span><br><span class="line">			&quot;gender&quot;: 1,</span><br><span class="line">			&quot;job&quot;: &quot;班主任&quot;,</span><br><span class="line">			&quot;entrydate&quot;: &quot;2023-01-01&quot;,</span><br><span class="line">			&quot;updatetime&quot;: &quot;2023-01-01 12:00:00&quot;	</span><br><span class="line">        &#125;,</span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="7-前端工程化"><a href="#7-前端工程化" class="headerlink" title="7- 前端工程化"></a>7- 前端工程化</h2><h3 id="7-1-接口文档"><a href="#7-1-接口文档" class="headerlink" title="7-1 接口文档"></a>7-1 接口文档</h3><p>产品经理通过页面原型和需求文档分析得到接口文档。</p>
<h3 id="7-2-Vue项目创建"><a href="#7-2-Vue项目创建" class="headerlink" title="7-2 Vue项目创建"></a>7-2 Vue项目创建</h3><h4 id="7-2-1-命令创建"><a href="#7-2-1-命令创建" class="headerlink" title="7-2-1 命令创建"></a>7-2-1 命令创建</h4><p>命令：vue create 项目名</p>
<h4 id="7-2-2-图形化创建"><a href="#7-2-2-图形化创建" class="headerlink" title="7-2-2 图形化创建"></a>7-2-2 图形化创建</h4><p>命令：vue ui</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240604112907161.png"
                      alt="image-20240604112907161"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240604112953395.png"
                      alt="image-20240604112953395"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240604113029049.png"
                      alt="image-20240604113029049"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240604113115268.png"
                      alt="image-20240604113115268"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240604113159083.png"
                      alt="image-20240604113159083"
                ></p>
<h3 id="7-3-Vue项目"><a href="#7-3-Vue项目" class="headerlink" title="7-3 Vue项目"></a>7-3 Vue项目</h3><p>目录结构：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/ed4f161e-c20a-47c4-91ee-b2ab50bcffc4-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>配置端口：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/9fd1553a-9a5d-4d0e-8802-91bfe9483783-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>启动：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/67a0876d-b993-4aa3-9533-2face7ed39a0-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>开发流程：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/238d7865-1deb-48db-89b7-1242d49cf6ae-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/bb0cce68-d233-4e45-953f-48f62fc35f90-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="8-Element"><a href="#8-Element" class="headerlink" title="8- Element"></a>8- Element</h2><h3 id="8-1-官网"><a href="#8-1-官网" class="headerlink" title="8-1 官网"></a>8-1 官网</h3><p><a class="link"   href="https://element.eleme.cn/#/zh-CN" >Element - 网站快速成型工具 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="8-2-使用"><a href="#8-2-使用" class="headerlink" title="8-2 使用"></a>8-2 使用</h3><p>安装：</p>
<ul>
<li>npm i element-ui -S</li>
</ul>
<p>导包：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240301175049772.png"
                      alt="image-20240301175049772"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240301175137931.png"
                      alt="image-20240301175137931"
                ></li>
</ul>
<p>使用组件：</p>
<ul>
<li>官网搜索，然后复制并改动。</li>
</ul>
<h2 id="9-Vue路由"><a href="#9-Vue路由" class="headerlink" title="9- Vue路由"></a>9- Vue路由</h2><h3 id="9-1-介绍"><a href="#9-1-介绍" class="headerlink" title="9-1 介绍"></a>9-1 介绍</h3><p>URL 中的 hash(#号) 与组件之间的对应关系。</p>
<h3 id="9-2-Vue-Router"><a href="#9-2-Vue-Router" class="headerlink" title="9-2 Vue Router"></a>9-2 Vue Router</h3><p>介绍：</p>
<ul>
<li>Vue Router 是 Vue 的官方路由。</li>
</ul>
<p>组成：</p>
<ul>
<li>VueRouter：路由器类，根据路由请求在路由视图中动态渲染选中的组件。</li>
<li>&lt; router-link &gt;：请求链接组件，浏览器会解析成&lt; a &gt;。</li>
<li>&lt; router-view &gt;：动态视图组件，用来渲染展示与路由路径对应的组件。</li>
</ul>
<p>作用：</p>
<ul>
<li>路由链接组件 router-link —&gt; 路由请求 —&gt; 路由器 VueRouter (路由表) —&gt; 更新 —&gt; 路由展示组件 router-view 。</li>
</ul>
<h3 id="9-3-使用"><a href="#9-3-使用" class="headerlink" title="9-3 使用"></a>9-3 使用</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240302195904255.png"
                      alt="image-20240302195904255"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240302200239694.png"
                      alt="image-20240302200239694"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240302200654028.png"
                      alt="image-20240302200654028"
                ></p>
</li>
</ul>
<h2 id="10-打包部署"><a href="#10-打包部署" class="headerlink" title="10- 打包部署"></a>10- 打包部署</h2><h3 id="10-1-打包"><a href="#10-1-打包" class="headerlink" title="10-1 打包"></a>10-1 打包</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/8e7d3169-ac00-4b10-bf52-34216d50111f-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="10-2-部署（Nginx）"><a href="#10-2-部署（Nginx）" class="headerlink" title="10-2 部署（Nginx）"></a>10-2 部署（Nginx）</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/f4ff2e85-bc8c-43e6-91d6-73d6c45f5927-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>Nginx默认占用80端口号，如果80端口号被占用，可以在nginx.conf中修改端口号。</p>
<p>查看80端口谁占用：netstat -ano|findStr 80 。</p>
<h1 id="三、后端"><a href="#三、后端" class="headerlink" title="三、后端"></a>三、后端</h1><h2 id="1-概览"><a href="#1-概览" class="headerlink" title="1- 概览"></a>1- 概览</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240302201812625.png"
                      alt="image-20240302201812625"
                ></li>
</ul>
<h2 id="2-Maven"><a href="#2-Maven" class="headerlink" title="2- Maven"></a>2- Maven</h2><h3 id="2-1-介绍-1"><a href="#2-1-介绍-1" class="headerlink" title="2-1 介绍"></a>2-1 介绍</h3><p>Maven 是 apache（ 世界上最大、最受欢迎、非盈利性、开源软件基金会） 旗下的一个开源项目，是一款用于管理和构建java项目的工具。它基于项目对象模型(POM)的概念，通过一小段描述信息来管理项目的构建。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/502264aa-0a13-4a25-91a2-93c4cf3ef874-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="2-2-作用"><a href="#2-2-作用" class="headerlink" title="2-2 作用"></a>2-2 作用</h3><p>方便快捷的管理项目依赖的资源 ( jar包 )，避免版本冲突问题。</p>
<ul>
<li>在 pom.xml 中。</li>
</ul>
<p>标准跨平台 (Linux、Windows、Macos)的自动化项目构建方式。</p>
<ul>
<li>右侧Maven命令，然后再target包下实现。</li>
</ul>
<p>提供标准、统一的项目结构。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/60de190d-c354-4567-ab0a-61e7ee3ee4c7-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="2-3-Maven坐标"><a href="#2-3-Maven坐标" class="headerlink" title="2-3 Maven坐标"></a>2-3 Maven坐标</h3><p>介绍：</p>
<ul>
<li>使用坐标来定义项目或引入项目中需要的依赖。</li>
<li>Maven 的坐标是资源的唯一标识，通过该坐标可以唯一定位资源位置。</li>
</ul>
<p>组成：</p>
<ul>
<li><p>groupld：定义当前Maven项目隶属组织名称 (通常是域名反写，例如：com.itheima)。</p>
</li>
<li><p>artifactld：定义当前Maven项目名称 (通常是模块名称，例如：order-service、goods-service)。</p>
</li>
<li><p>version：定义当前项目版本号。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupld</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupld</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactld</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<h3 id="2-4-IDEA-导入-Maven-项目"><a href="#2-4-IDEA-导入-Maven-项目" class="headerlink" title="2-4 IDEA 导入 Maven 项目"></a>2-4 IDEA 导入 Maven 项目</h3><p>方法1：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/12712607-75d4-4c9b-ba6b-f615566a922d-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>方法2：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/3d8978d7-f382-4659-af0b-ad3d543e893e-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="2-5-依赖管理"><a href="#2-5-依赖管理" class="headerlink" title="2-5 依赖管理"></a>2-5 依赖管理</h3><h4 id="2-5-1-依赖配置"><a href="#2-5-1-依赖配置" class="headerlink" title="2-5-1 依赖配置"></a>2-5-1 依赖配置</h4><p>依赖：</p>
<ul>
<li>指当前项目运行所需要的jar包，一个项目中可以引入多个依赖。</li>
</ul>
<p>配置：</p>
<ul>
<li><p>如果引入的依赖，在本地仓库不存在，将会连接远程仓库&#x2F;中央仓库，然后下载依赖。</p>
</li>
<li><p>如果不知道依赖的坐标信息，可以到 <a class="link"   href="https://mvnrepository.com/" >https://mvnrepository.com/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 搜索。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/b868d8ae-7c7a-431f-a685-e3886732ed38-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
<h4 id="2-5-2-依赖传递"><a href="#2-5-2-依赖传递" class="headerlink" title="2-5-2 依赖传递"></a>2-5-2 依赖传递</h4><p>直接依赖：</p>
<ul>
<li>在当前项目中通过依赖配置建立的依赖关系。</li>
</ul>
<p>间接依赖：</p>
<ul>
<li>被依赖的资源如果依赖其他资源，当前项目间接依赖其他资源。</li>
</ul>
<p>排除依赖：</p>
<ul>
<li>排除依赖指主动断开依赖的资源，被排除的资源无需指定版本。</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupld</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupld</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactld</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactid</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>将传递依赖图表化：</p>
<ul>
<li>在pom.xml右击</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/5a8117bb-10c6-496a-bf8f-f902af30e3b7-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="2-5-3-依赖范围"><a href="#2-5-3-依赖范围" class="headerlink" title="2-5-3 依赖范围"></a>2-5-3 依赖范围</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/c28442eb-fc1f-430d-a9e9-d14cb41fe036-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="2-6-生命周期"><a href="#2-6-生命周期" class="headerlink" title="2-6 生命周期"></a>2-6 生命周期</h3><p>介绍：</p>
<ul>
<li>Maven的生命周期就是为了对所有的maven项目构建过程进行抽象和统一。</li>
</ul>
<p>3套相互独立的生命周期：</p>
<ul>
<li>clean：清理工作。</li>
<li>default：核心工作，如：编译、测试、打包、安装、部署等。</li>
<li>site：生成报告、发布站点等。</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/707d7b00-abfa-4766-b7dc-5c381d8af21c-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/e34e8ced-316d-4faf-90dd-b15d1f117797-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>执行指定生命周期的两种方式：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/5815c5d7-804f-4195-96fb-977ba127a80e-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="3-Maven高级"><a href="#3-Maven高级" class="headerlink" title="3- Maven高级"></a>3- Maven高级</h2><h3 id="3-1-分模块设计与开发"><a href="#3-1-分模块设计与开发" class="headerlink" title="3-1 分模块设计与开发"></a>3-1 分模块设计与开发</h3><p>介绍：</p>
<ul>
<li>将项目按照功能拆分成若干个子模块。</li>
<li>方便项目的管理维护、扩展，也方便模块间的相互调用，资源共享。</li>
<li>分模块设计需要先针对模块功能进行设计，再进行编码。不会先将工程开发完毕，然后进行拆分。</li>
</ul>
<p>实例：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/b8be78b8-a461-4423-830c-000234825c07-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/aac32427-91b3-49ae-94d1-acdd3d48e958-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/059ee1ab-720b-48ff-9936-721317f4c56d-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="3-2-继承与聚合"><a href="#3-2-继承与聚合" class="headerlink" title="3-2 继承与聚合"></a>3-2 继承与聚合</h3><h4 id="3-2-3-继承"><a href="#3-2-3-继承" class="headerlink" title="3-2-3 继承"></a>3-2-3 继承</h4><p>介绍：</p>
<ul>
<li>继承描述的是两个工程间的关系，与java中的继承相似，子工程可以继承父工程中的配置信息，常见于依赖关系的继承。</li>
<li>简化依赖配置、统一管理依赖。</li>
</ul>
<p>实现 (pom.xml)：</p>
<ul>
<li>&lt; parent &gt; …… &lt; &#x2F;parent &gt;</li>
</ul>
<p>&lt; dependencyManagement &gt;与&lt; dependencies &gt;的区别：</p>
<ul>
<li>&lt; dependencies &gt;是直接依赖，在父工程配置了依赖，子工程会直接继承下来。</li>
<li>&lt; dependencyManagement &gt;是统一管理依赖版本，不会直接依赖，还需要在子工程中引入所需依赖 (无需指定版本)。</li>
</ul>
<h4 id="3-2-4-继承实现"><a href="#3-2-4-继承实现" class="headerlink" title="3-2-4 继承实现"></a>3-2-4 继承实现</h4><p>注意：</p>
<ul>
<li>在子工程中，配置了继承关系之后，坐标中的 &lt; groupId &gt; 是可以省略的，因为会自动继承父工程的。</li>
<li>&lt; relativePath &gt; 指定父工程的 pom.xml 文件的相对位置 (如果不指定，将从本地仓库 &#x2F; 远程仓库查找该工程)。</li>
<li>若父子工程都配置了同一个依赖的不同版本，以子工程的为准。</li>
</ul>
<p>实现：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/9752e41b-e0d6-4b7e-a2d2-dd747b1e81c0-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/13b99c46-b96c-4719-bba5-e6262e2cce71-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/691d2268-1a15-46e8-9a82-5c1451838efc-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="3-2-5-版本锁定"><a href="#3-2-5-版本锁定" class="headerlink" title="3-2-5 版本锁定"></a>3-2-5 版本锁定</h4><p>介绍：</p>
<ul>
<li>在maven中，可以在父工程的 pom文件中通过&lt; dependencyManagement &gt;来统一管理依赖版本。</li>
<li>子工程引入依赖时，无需指定&lt; version &gt;版本号，父工程统一管理。变更依赖版本，只需在父工程中统一变更。</li>
</ul>
<p>实现：</p>
<ul>
<li>方法1：<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/c541f307-b3f4-4f89-991c-e44048298b25-25143160.jpg"
                      alt="img"
                ></li>
</ul>
</li>
<li>方法2：<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/dfea8567-9505-4125-98d2-14184c914f8a-25143160.jpg"
                      alt="img"
                ></li>
</ul>
</li>
</ul>
<h4 id="3-2-6-聚合实现"><a href="#3-2-6-聚合实现" class="headerlink" title="3-2-6 聚合实现"></a>3-2-6 聚合实现</h4><p>介绍：</p>
<ul>
<li>聚合：将多个模块组织成一个整体，同时进行项目的构建。</li>
<li>聚合工程：一个不具有业务功能的“空”工程 (有且仅有一个 pom.xml 文件)。</li>
<li>一般来说，父工程也是聚合工程。</li>
<li>聚合工程中所包含的模块，在构建时，会自动根据模块间的依赖关系设置构建顺序，与聚合工程中模块的配置书写位置无关。</li>
</ul>
<p>实现：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/f4d84dfd-7148-4233-b136-4e5d83ff6577-25143160.jpg"
                      alt="img"
                ></li>
<li>然后再聚合工程中执行打包操作。</li>
</ul>
<h4 id="3-2-7-继承与聚合的差异"><a href="#3-2-7-继承与聚合的差异" class="headerlink" title="3-2-7 继承与聚合的差异"></a>3-2-7 继承与聚合的差异</h4><p>作用：</p>
<ul>
<li>继承用于简化依赖配置、统一管理依赖。</li>
<li>聚合用于快速构建项目。</li>
</ul>
<p>相同点：</p>
<ul>
<li>聚合与继承的 pom.xml 文件打包方式均为pom，可以将两种关系制作到同一个pom文件中。</li>
<li>聚合与继承均属于设计型模块，并无实际的模块内容。</li>
</ul>
<p>不同点：</p>
<ul>
<li><p>继承是在子模块中配置关系，父模块无法感知哪些子模块继承了自己。</p>
</li>
<li><p>聚合是在聚合工程中配置关系，聚合可以感知到参与聚合的模块有哪些。</p>
</li>
</ul>
<h3 id="3-3-私服"><a href="#3-3-私服" class="headerlink" title="3-3 私服"></a>3-3 私服</h3><h4 id="3-3-1-介绍"><a href="#3-3-1-介绍" class="headerlink" title="3-3-1 介绍"></a>3-3-1 介绍</h4><p>私服是一种特殊的远程仓库，它是架设在局域网内的仓库服务，用来代理位于外部的中央仓库，用于解决团队内部的资源共享与资源同步问题。</p>
<p>私服在企业项目开发中，一个项目&#x2F;公司，只需要一台即可 (无需我们自己搭建，会使用即可)。</p>
<p>依赖查找顺序：</p>
<ul>
<li>本地仓库、私服、中央仓库 (从前到后)。</li>
</ul>
<p>项目版本：</p>
<ul>
<li>RELEASE(发行版本):功能趋于稳定、当前更新停止，可以用于发行的版本，存储在私服中的RELEASE仓库中。</li>
<li>SNAPSHOT(快照版本):功能不稳定、尚处于开发中的版本，即快照版本，存储在私服的SNAPSHOT仓库中。</li>
</ul>
<h4 id="3-3-2-操作流程"><a href="#3-3-2-操作流程" class="headerlink" title="3-3-2 操作流程"></a>3-3-2 操作流程</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/f39c4c4d-9871-43ad-a71b-05fe8904b3c7-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="3-3-3-上传"><a href="#3-3-3-上传" class="headerlink" title="3-3-3 上传"></a>3-3-3 上传</h4><p>第一步的&lt; id &gt;要和第二步的&lt; id &gt;对应。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/24fcca49-47a9-4390-88de-42618628f830-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/1670214e-81b4-403d-8c8b-e11a5074882f-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/aa31e951-c8a1-497a-a51e-ca4a1c4bec6f-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/b773e8d3-c3c4-4dc0-a544-32e98b942879-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/5275ed71-8dbf-452c-b922-09134cae8258-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="3-3-4-下载"><a href="#3-3-4-下载" class="headerlink" title="3-3-4 下载"></a>3-3-4 下载</h4><p>在 pom.xml 文件中</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/baca0177-644d-44de-a1d8-37b1b059e021-25143160.jpg"
                      alt="img"
                ></p>
<h2 id="4-SpringBoot-Web入门"><a href="#4-SpringBoot-Web入门" class="headerlink" title="4- SpringBoot Web入门"></a>4- SpringBoot Web入门</h2><h3 id="4-1-快速入门"><a href="#4-1-快速入门" class="headerlink" title="4-1 快速入门"></a>4-1 快速入门</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/17afca6d-5110-47fc-8133-106a36acb7ad-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/33efaa01-1a4d-4bba-b64f-c0aa1a1ca52c-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/a872536a-77b2-4790-b60e-bfcab3b3ca95-25143160.jpg"
                      alt="img"
                ></li>
<li></li>
</ul>
<h3 id="4-2-Http协议"><a href="#4-2-Http协议" class="headerlink" title="4-2 Http协议"></a>4-2 Http协议</h3><h4 id="4-2-1-介绍"><a href="#4-2-1-介绍" class="headerlink" title="4-2-1 介绍"></a>4-2-1 介绍</h4><p>概念：</p>
<ul>
<li>HyperText Transfer Protocol，超文本传输协议，规定了浏览器和服务器之间数据传输的规则。</li>
</ul>
<p>特点：</p>
<ul>
<li>基于TCP协议：面向连接，安全。</li>
<li>基于请求-响应模型的：一次请求对应一次响应。</li>
<li>HTTP协议是无状态的协议：对于事务处理没有记忆能力。每次请求-响应都是独立的。<ul>
<li>缺点：多次请求间不能共享数据。</li>
<li>优点：速度快。</li>
</ul>
</li>
</ul>
<h4 id="4-2-2-请求协议"><a href="#4-2-2-请求协议" class="headerlink" title="4-2-2 请求协议"></a>4-2-2 请求协议</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/05482e19-dcf7-41c6-b950-1429662f8cc2-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>请求头：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/41616e37-7792-476b-8a3b-563f14e89862-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="4-2-3-响应协议"><a href="#4-2-3-响应协议" class="headerlink" title="4-2-3 响应协议"></a>4-2-3 响应协议</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/1cab31d2-95b8-4986-9152-abdd3ecf8df4-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>状态码：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/defb7db1-398b-445c-abc5-508897fb5364-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/d471a499-446e-4358-820d-62c7426922a8-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>响应头：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/2913802f-2faa-4fcb-b171-489dfd67349d-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="4-2-4-Web-服务器"><a href="#4-2-4-Web-服务器" class="headerlink" title="4-2-4 Web 服务器"></a>4-2-4 Web 服务器</h4><p>介绍：</p>
<ul>
<li>Web服务器是一个软件程序，对HTTP协议的操作进行封装，使得程序员不必直接对协议进行操作，让Web开发更加便捷，主要功能是“提供网上信息浏览服务”。</li>
</ul>
<p>Tomcat：</p>
<ul>
<li>一个轻量级的web服务器，支持servlet、jsp等少量javaEE规范，也被称为web容器、servlet容器。</li>
<li>基于Springboot开发的web应用程序，内置了tomcat服务器，当启动类运行时，会自动启动内嵌的tomcat服务器。默认端口8080。</li>
<li>起步依赖：spring-boot-starter-web；spring-boot-starter-test。</li>
</ul>
<h2 id="5-请求响应"><a href="#5-请求响应" class="headerlink" title="5- 请求响应"></a>5- 请求响应</h2><h3 id="5-1-概览"><a href="#5-1-概览" class="headerlink" title="5-1 概览"></a>5-1 概览</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/9c9b7907-8f98-4d02-bd27-428ac896cae8-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="5-2-请求"><a href="#5-2-请求" class="headerlink" title="5-2 请求"></a>5-2 请求</h3><h4 id="5-2-1-简单参数"><a href="#5-2-1-简单参数" class="headerlink" title="5-2-1 简单参数"></a>5-2-1 简单参数</h4><p>get样式 (SpringBoot方式)：</p>
<ul>
<li>基本：<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/9431bbe1-79f4-4bf1-9e7a-fb340dbe4ebd-25143160.jpg"
                      alt="img"
                ></li>
</ul>
</li>
<li>@ RequestParam注解 &#x2F; 映射<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/3de87bcd-ec96-4985-a635-7c4cbc1324a0-25143160.jpg"
                      alt="img"
                ></li>
</ul>
</li>
</ul>
<p>post样式：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/8441816a-af26-46a9-878d-e708346510aa-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="5-2-2-实体参数"><a href="#5-2-2-实体参数" class="headerlink" title="5-2-2 实体参数"></a>5-2-2 实体参数</h4><p>简单：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/715af525-45a1-4b05-a937-309b81d20d09-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>复杂：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/75a9310f-f5b0-4593-8365-caafc84f38d4-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="5-2-3-数组参数"><a href="#5-2-3-数组参数" class="headerlink" title="5-2-3 数组参数"></a>5-2-3 数组参数</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/a387e584-0c12-431c-b78c-3113dd483c47-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="5-2-4-集合参数"><a href="#5-2-4-集合参数" class="headerlink" title="5-2-4 集合参数"></a>5-2-4 集合参数</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/5bf27d72-3b8d-444c-853d-58559f05975c-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="5-2-5-日期参数"><a href="#5-2-5-日期参数" class="headerlink" title="5-2-5 日期参数"></a>5-2-5 日期参数</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/c28937ee-e3a0-43fc-bb96-3f64d76ab2c8-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="5-2-6-json参数"><a href="#5-2-6-json参数" class="headerlink" title="5-2-6 json参数"></a>5-2-6 json参数</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/6a8bafef-4342-4a1e-8d2c-690c186e032c-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="5-2-7-路径参数"><a href="#5-2-7-路径参数" class="headerlink" title="5-2-7 路径参数"></a>5-2-7 路径参数</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/e49f8bd9-8def-4b1b-9593-f212676b68c8-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="5-3-响应"><a href="#5-3-响应" class="headerlink" title="5-3 响应"></a>5-3 响应</h3><h4 id="5-3-1-ResponseBody"><a href="#5-3-1-ResponseBody" class="headerlink" title="5-3-1 @ ResponseBody"></a>5-3-1 @ ResponseBody</h4><p>类型：方法注解、类注解。</p>
<p>位置：Controller方法上&#x2F;类上。</p>
<p>作用：将方法返回值直接响应，如果返回值类型是 实体对象&#x2F;集合，将会转换为JSON格式响应。</p>
<p>说明：@ RestController &#x3D; @ Controller + @ ResponseBody</p>
<h4 id="5-3-2-统一响应结果"><a href="#5-3-2-统一响应结果" class="headerlink" title="5-3-2 统一响应结果"></a>5-3-2 统一响应结果</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建pojo.Result</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer code;<span class="comment">//响应码，200 代表成功; 0 代表失败</span></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//响应信息，描述字符串</span></span><br><span class="line">    <span class="keyword">private</span> Object data; <span class="comment">//返回的数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">()</span>&#123;<span class="comment">//增删改 成功响应</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">200</span>,<span class="string">&quot;success&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">(Object data)</span>&#123;<span class="comment">//查询 成功响应</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">200</span>,<span class="string">&quot;success&quot;</span>,data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">(String msg)</span>&#123;<span class="comment">//失败响应</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">200</span>,msg,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Controller应用</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/listAddr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">listAddr</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Address&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="type">Address</span> <span class="variable">addr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>();</span><br><span class="line">    addr.setProvince(<span class="string">&quot;广东&quot;</span>);</span><br><span class="line">    addr.setcity(<span class="string">&quot;深圳&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">Address</span> <span class="variable">addr2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>();</span><br><span class="line">    addr2.setProvince(<span class="string">&quot;陝西”);</span></span><br><span class="line"><span class="string">    addr2.setcity(&quot;</span>西安”)</span><br><span class="line">                      </span><br><span class="line">    list.add(addr);</span><br><span class="line">    list.add(addr2);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="5-4-分层解耦"><a href="#5-4-分层解耦" class="headerlink" title="5-4 分层解耦"></a>5-4 分层解耦</h3><h4 id="5-4-1-三层架构"><a href="#5-4-1-三层架构" class="headerlink" title="5-4-1 三层架构"></a>5-4-1 三层架构</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/f759338d-a379-4e43-ada4-d4d09f3fa282-25143160.jpg"
                      alt="img"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/901156b2-f7f9-47e3-9f53-a730814a17aa-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="5-4-2-介绍"><a href="#5-4-2-介绍" class="headerlink" title="5-4-2 介绍"></a>5-4-2 介绍</h4><p>内聚：软件中各个功能模块内部的功能联系。</p>
<p>耦合：衡量软件中各个层&#x2F;模块之间的依赖、关联的程度。</p>
<p>软件设计原则：高内聚、低耦合。</p>
<p>控制反转：lnversion Of Control，简称IOC。对象的创建控制权由程序自身转移到外部(容器)，这种思想称为控制反转。</p>
<p>依赖注入：Dependency lnjection，简称DI。容器为应用程序提供运行时，所依赖的资源，称之为依赖注入。</p>
<p>Bean对象：IOC容器中创建、管理的对象，称之为bean。</p>
<h4 id="5-4-3-IOC-DI-入门"><a href="#5-4-3-IOC-DI-入门" class="headerlink" title="5-4-3 IOC &amp; DI 入门"></a>5-4-3 IOC &amp; DI 入门</h4><p>@ Component：将当前类交给IOC容器管理，成为IOC容器中的bean。</p>
<p>@ Autowired：运行时，IOC容器会提俱该类型的bean对象，并赋值给该变量 - 依赖注入。</p>
<p>如果想用不同的bean，只需要保留你需要的类的@ Component。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/7701847f-c8cb-4dcd-a3ec-f7c7781f7653-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="5-4-4-IOC"><a href="#5-4-4-IOC" class="headerlink" title="5-4-4 IOC"></a>5-4-4 IOC</h4><p>Bean的声明：</p>
<ul>
<li><table>
<thead>
<tr>
<th>注解</th>
<th>声明</th>
<th>位置</th>
</tr>
</thead>
<tbody><tr>
<td>@ Component</td>
<td>声明bean的基础注解</td>
<td>不属于以下三类时，用此注解</td>
</tr>
<tr>
<td>@ Controller</td>
<td>@ Component的衍生注解</td>
<td>标注在控制器类上</td>
</tr>
<tr>
<td>@ Service</td>
<td>@ Component的衍生注解</td>
<td>标注在业务类上</td>
</tr>
<tr>
<td>@ Repository</td>
<td>@ Component的衍生注解</td>
<td>标注在数据访问类上 (由于与mybatis整合，用的少)</td>
</tr>
</tbody></table>
</li>
<li><p>声明bean的时候，可以通过value属性指定bean的名字，如果没有指定，默认为类名首字母小写。</p>
</li>
<li><p>使用以上四个注解都可以声明bean，但是在spring boot集成web开发中，声明控制器bean只能用@ Controller。</p>
</li>
</ul>
<p>Bean组件扫描：</p>
<ul>
<li>前面声明bean的四大注解，要想生效，还需要被组件扫描注解@ ComponentScan 扫描。</li>
<li>@ ComponentScan 注解虽然没有显式配置，但是实际上已经包含在了启动类声明注解 @ SpringBootApplication 中，默认扫描的范围是启动类所在包及其子包。</li>
</ul>
<h4 id="5-4-5-DI"><a href="#5-4-5-DI" class="headerlink" title="5-4-5 DI"></a>5-4-5 DI</h4><p>Bean注入：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/2ef3236c-8172-4622-b370-acef5b5c3565-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="6-Mybatis"><a href="#6-Mybatis" class="headerlink" title="6- Mybatis"></a>6- Mybatis</h2><h3 id="6-1-入门"><a href="#6-1-入门" class="headerlink" title="6-1 入门"></a>6-1 入门</h3><h4 id="6-1-1-快速入门"><a href="#6-1-1-快速入门" class="headerlink" title="6-1-1 快速入门"></a>6-1-1 快速入门</h4><p>添加配制</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/154b72b8-53f1-43a9-a8cb-dfc4ab32f8c3-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>左侧结构（SpringBoot、Maven）</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/ef6669ff-be91-4924-9c00-4e96d7f4431a-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>数据库</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/52baab48-68af-4a26-9c3c-43eed34436b1-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>配置SQL提示</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/37753771-2a63-4f0d-b083-e21b3f045a59-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//application.properties</span></span><br><span class="line"></span><br><span class="line">spring.datasource.driver-class-name = com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.datasource.url = jdbc:mysql:<span class="comment">//localhost:3306/test</span></span><br><span class="line">spring.datasource.username = root</span><br><span class="line">spring.datasource.password = <span class="number">690609</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Userss 变量、构造器、getset方法、toString方法</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Userss</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String username;<span class="comment">//用户名</span></span><br><span class="line">    <span class="keyword">private</span> String password;<span class="comment">//用户密码    </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//UserssMapper</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span> <span class="comment">//在运行时，会自动生成该接口的实现类对象(代理对象)，并且将该对象交给IOC容器管理</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserssMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Select(&quot;select * from test.userss&quot;)</span> <span class="comment">//查询全部用户信息</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Userss&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//SpringBootMyBatisApplicationTests</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span> <span class="comment">//springboot整合单元测试的注解</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringBootMyBatisApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserssMapper userssMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testListUserss</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Userss&gt; usersslist = userssMapper.list();</span><br><span class="line">        usersslist.stream().forEach(userss -&gt; &#123;</span><br><span class="line">            System.out.println(userss);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="6-1-2-lombok工具包"><a href="#6-1-2-lombok工具包" class="headerlink" title="6-1-2 lombok工具包"></a>6-1-2 lombok工具包</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/db7e5834-d9c0-4b0f-a32d-811d5f1eba93-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="6-1-3-日志输出"><a href="#6-1-3-日志输出" class="headerlink" title="6-1-3 日志输出"></a>6-1-3 日志输出</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//application.properties</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//指定mybatis输出日志的位置，输出控制台</span></span><br><span class="line">mybatis.configuration.log-impl = org.apache.ibatis.logging.stdout.StdOutImpl</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Controller应用</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@Slf4j</span><span class="comment">//日志记录框架注解</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XinxiController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line">    <span class="keyword">private</span> XinxiService xinxiService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//private static Logger log = LoggerFactory.getLogger(XinxiController.class);//日志记录框架</span></span><br><span class="line">    <span class="comment">//@RequestMapping(value = &quot;/studentx&quot;,method = RequestMethod.POST)//指定请求方式为 POST</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">//添加信息</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/studentx&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">insert</span><span class="params">(<span class="meta">@RequestBody</span> Xinxi xinxi)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;添加学生信息&quot;</span>,xinxi);<span class="comment">//日志</span></span><br><span class="line">        <span class="comment">//调用service添加信息</span></span><br><span class="line">        xinxiService.insert(xinxi);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="6-1-4-JDBC"><a href="#6-1-4-JDBC" class="headerlink" title="6-1-4 JDBC"></a>6-1-4 JDBC</h4><p>sun公司提供的一套操作关系型数据库的API(规范)。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/7a178f3f-7fa0-4439-bef8-bff5c08faca8-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="6-1-5-数据库连接池"><a href="#6-1-5-数据库连接池" class="headerlink" title="6-1-5 数据库连接池"></a>6-1-5 数据库连接池</h4><p>介绍：数据库连接池是个容器，负责分配、管理数据库连接 (Connection)。</p>
<p>优势：资源重用、提升系统响应速度、避免数据库连接遗漏。</p>
<p>标准接口：DataSource；</p>
<p>获取连接：Connection getConnection( ) throws SQLException；</p>
<p>产品：Druid (德鲁伊，阿里)、Hikari (SpringBoot默认)。</p>
<h4 id="6-1-6-预编译"><a href="#6-1-6-预编译" class="headerlink" title="6-1-6 预编译"></a>6-1-6 预编译</h4><p>性能更高（SQL语句只需要编译一次，再调用直接在缓存里）。</p>
<p>更安全（防止SQL注入）。</p>
<p>SQL注入：通过操作输入的数据来修改事先定义好的SQL语句，以达到执行代码对服务器进行攻击的方法。如：password &#x3D; ‘’or ‘1’&#x3D; ‘1’ ;</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/31de6117-f65b-4b85-925b-90c068fa9734-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="6-1-7-参数占位符"><a href="#6-1-7-参数占位符" class="headerlink" title="6-1-7 参数占位符"></a>6-1-7 参数占位符</h4><table>
<thead>
<tr>
<th>#{……}</th>
<th>${……}</th>
</tr>
</thead>
<tbody><tr>
<td>执行SQL时，会将#{…}替换为?，生成预编译SQL，会自动设置参数值。</td>
<td>拼接SQL。直接将参数拼接在SQL语句中，存在SQL注入问题。</td>
</tr>
<tr>
<td>使用时机：参数传递，都使用#{…}</td>
<td>使用时机：如果对表名、列表进行动态设置时使用。</td>
</tr>
</tbody></table>
<h4 id="6-1-8-数据封装"><a href="#6-1-8-数据封装" class="headerlink" title="6-1-8 数据封装"></a>6-1-8 数据封装</h4><p>实体类属性名和数据库表查询返回的字段名一致，mybatis会自动封装。如果实体类属性名和数据库表查询返回的字段名不一致，不能自动封装。</p>
<p>解决方案：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//application.properties</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//开启mybatis的驼峰命名自动映射开关</span></span><br><span class="line">mybatis.configuration.map-underscore-to-camel-<span class="keyword">case</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//方案一：给字段起别名，让别名与实体类属性一致</span></span><br><span class="line">	<span class="meta">@Select(&quot;select id, username, password, name, gender, image, job, entrydate, &quot; + </span></span><br><span class="line"><span class="meta">		&quot;dept_id deptId, create_time createTime, update_time updateTime from emp where id = #&#123;id)</span><span class="string">&quot;)</span></span><br><span class="line"><span class="string">	public Emp getById(Integer id);</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">//方案二:通过@Results，@Result注解手动映射封装</span></span><br><span class="line"><span class="string">    @Results(&#123;</span></span><br><span class="line"><span class="string">        @Result(column =&quot;</span>dept_id<span class="string">&quot;, property = &quot;</span>deptId<span class="string">&quot;),</span></span><br><span class="line"><span class="string">        @Result(column=&quot;</span>create_time<span class="string">&quot;, property = &quot;</span>createTime<span class="string">&quot;)</span></span><br><span class="line"><span class="string">        @Result(column =&quot;</span>update_time<span class="string">&quot;, property = &quot;</span>updateTime<span class="string">&quot;)</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">    @Select(&quot;</span>select * from emp <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;<span class="string">&quot;)</span></span><br><span class="line"><span class="string">    public Emp getById(Integer id);</span></span><br></pre></td></tr></table></figure></div>

<h3 id="6-2-基础操作"><a href="#6-2-基础操作" class="headerlink" title="6-2 基础操作"></a>6-2 基础操作</h3><p>如果mapper接口方法形参只有一个普通类型的参数，# {…}里面的属性名可以随便写，如: # {id}、# {value}。</p>
<p>添加</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"> 	<span class="meta">@Insert(&quot;insert into student.xinxi(stuname, id, gender, job, phone) values (#&#123;stuname&#125;,#&#123;id&#125;,#&#123;gender&#125;,#		&#123;job&#125;,#&#123;phone&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Xinxi xinxi)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//主键返回</span></span><br><span class="line">	<span class="meta">@Options(keyProperty=&quot;id&quot;,useGeneratedKeys = true)</span> 会自动将生成的主键值，赋值给emp对象的id属性</span><br></pre></td></tr></table></figure></div>

<p>删除</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Delete(&quot;delete from student.xinxi where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">deleteByid</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure></div>

<p>修改</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Update(&quot;update student.xinxi set stuname = #&#123;stuname&#125;,gender = #&#123;gender&#125;,job = #&#123;job&#125;,phone = #&#123;phone&#125; 		where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Xinxi xinxi)</span>;</span><br></pre></td></tr></table></figure></div>

<p>查询</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据ID查询</span></span><br><span class="line">	<span class="meta">@Select(&quot;select * from student.xinxi where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">	Xinxi <span class="title function_">select</span><span class="params">(string id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//条件查询(姓名模糊查询)</span></span><br><span class="line">	<span class="meta">@Select(&quot;select * from student.xinxi where stuname like concat(&#x27;%&#x27;, #&#123;stuname&#125;, &#x27;%&#x27;) and gender = #				&#123;gender&#125; and id = #&#123;id&#125;&quot;)</span></span><br><span class="line">	List&lt;Xinxi&gt; <span class="title function_">selectpro</span><span class="params">(String stuname, String gender, String id)</span>;</span><br></pre></td></tr></table></figure></div>

<h3 id="6-3-XML映射文件"><a href="#6-3-XML映射文件" class="headerlink" title="6-3 XML映射文件"></a>6-3 XML映射文件</h3><p>使用Mybatis的注解，主要是来完成一些简单的增删改查功能。如果需要实现复杂的SQL功能，建议使用XML来配置映射语句。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/27c9ba2e-f793-4c0d-bb82-f39803c4bc51-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="6-4-动态SQL"><a href="#6-4-动态SQL" class="headerlink" title="6-4 动态SQL"></a>6-4 动态SQL</h3><p>介绍：随着用户的输入或外部条件的变化而变化的 SQL 语句，我们称为 动态SQL。</p>
<h4 id="6-4-1-sql-与-include"><a href="#6-4-1-sql-与-include" class="headerlink" title="6-4-1 &lt; sql &gt;与&lt; include &gt;"></a>6-4-1 &lt; sql &gt;与&lt; include &gt;</h4><p>&lt; sql &gt;：定义可重用的SQL片段。</p>
<p>&lt; include &gt;：通过属性refid，指定包含的SQL片段。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/8fa1aaae-9a3e-4b47-8fba-a5542b952981-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="6-4-2-if-与-where-与-set"><a href="#6-4-2-if-与-where-与-set" class="headerlink" title="6-4-2 &lt; if 与&lt; where &gt;与&lt; set &gt;"></a>6-4-2 &lt; if 与&lt; where &gt;与&lt; set &gt;</h4><p>&lt; if &gt;：用于判断条件是否成立。使用test属性进行条件判断，如果条件为true，则拼接SQL。</p>
<p>&lt; where &gt;：where 元素只会在子元素有内容的情况下才插入where子句。而且会自动去除子句的开头的AND 或OR。</p>
<p>&lt; set &gt;：动态地在行首插入 SET 关键字，并会删掉额外的逗号。 (用在update语句中)。</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lrq.mapper.XinxiMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;commonSelect&quot;</span>&gt;</span></span><br><span class="line">        select stuname, id, gender, job, phone</span><br><span class="line">        from student.xinxi</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update student.xinxi</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;stuname != null&quot;</span>&gt;</span></span><br><span class="line">                stuname = #&#123;stuname&#125;,</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span></span><br><span class="line">                gender  = #&#123;gender&#125;,</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;job != null&quot;</span>&gt;</span></span><br><span class="line">                job = #&#123;job&#125;,</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null&quot;</span>&gt;</span></span><br><span class="line">                phone = #&#123;phone&#125;</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- resultType: 单条记录所封装的类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listpro&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lrq.pojo.Xinxi&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;commonSelect&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;stuname != null and stuname != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                stuname like concat(&#x27;%&#x27;, #&#123;stuname&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null and gender != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                AND gender = #&#123;gender&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null and id != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                AND id = #&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<h4 id="6-4-3-foreach"><a href="#6-4-3-foreach" class="headerlink" title="6-4-3 &lt; foreach &gt;"></a>6-4-3 &lt; foreach &gt;</h4><p>collection: 遍历的集合。</p>
<p>item: 遍历出来的元素。</p>
<p>separator: 分隔符。</p>
<p>open: 遍历开始前拼接的SQL片段。</p>
<p>close: 遍历结束后拼接的SQL片段。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//批量删除</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testdeletepro</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;string&gt; ids = Arrays.asList(<span class="string">&quot;20221303033&quot;</span>,<span class="string">&quot;20221304044&quot;</span>);</span><br><span class="line">    xinxiMapper.deletepro(ids);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Mapper</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deletepro</span><span class="params">(List&lt;String&gt; ids)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//Mapper.xml</span></span><br><span class="line">&lt;delete id=<span class="string">&quot;deletepro&quot;</span>&gt;</span><br><span class="line">    delete</span><br><span class="line">    from student.xinxi</span><br><span class="line">    where id in</span><br><span class="line">    &lt;foreach collection=<span class="string">&quot;ids&quot;</span> item=<span class="string">&quot;id&quot;</span> separator=<span class="string">&quot;,&quot;</span> open=<span class="string">&quot;(&quot;</span> close=<span class="string">&quot;)&quot;</span>&gt;</span><br><span class="line">    #&#123;id&#125;</span><br><span class="line">	&lt;/foreach&gt;</span><br><span class="line">&lt;/delete&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="7-Mybatis-Plus"><a href="#7-Mybatis-Plus" class="headerlink" title="7- Mybatis-Plus"></a>7- Mybatis-Plus</h2><h3 id="7-1-快速入门"><a href="#7-1-快速入门" class="headerlink" title="7-1 快速入门"></a>7-1 快速入门</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240310190417556.png"
                      alt="image-20240310190417556"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240310190504183.png"
                      alt="image-20240310190504183"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240310190557178.png"
                      alt="image-20240310190557178"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240310190625160.png"
                      alt="image-20240310190625160"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240310190655453.png"
                      alt="image-20240310190655453"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240310190726664.png"
                      alt="image-20240310190726664"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240310191000560.png"
                      alt="image-20240310191000560"
                ></p>
</li>
</ul>
<h3 id="7-2-介绍"><a href="#7-2-介绍" class="headerlink" title="7-2 介绍"></a>7-2 介绍</h3><p>MyBatisPlus (简称MP) 是基于MyBatis框架基础上开发的增强型工具，旨在简化开发、提高效率。</p>
<p>官网：<a class="link"   href="https://mybatis.plus/%E3%80%81https://mp.baomidou.com/" >https://mybatis.plus/、https://mp.baomidou.com/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>特性：</p>
<ul>
<li>无侵入：只做增强不做改变，不会对现有工程产生影响</li>
<li>强大的 CRUD 操作：内置通用 Mapper，少量配置即可实现单表CRUD 操作</li>
<li>支持 Lambda：编写查询条件无需担心字段写错</li>
<li>支持主键自动生成</li>
<li>内置分页插件</li>
<li>……</li>
</ul>
<h3 id="7-3-日志"><a href="#7-3-日志" class="headerlink" title="7-3 日志"></a>7-3 日志</h3><div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">	<span class="attr">configuration:</span></span><br><span class="line">		<span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.stdoutImp1</span></span><br></pre></td></tr></table></figure></div>

<h3 id="7-4-CRUD功能"><a href="#7-4-CRUD功能" class="headerlink" title="7-4 CRUD功能"></a>7-4 CRUD功能</h3><table>
<thead>
<tr>
<th>功能</th>
<th>自定义接口</th>
<th>MP接口</th>
</tr>
</thead>
<tbody><tr>
<td>新增</td>
<td>boolean save (T t)</td>
<td>int insert (T t)</td>
</tr>
<tr>
<td>删除</td>
<td>boolean delete (int id)</td>
<td>int deleteById (Serializable id)</td>
</tr>
<tr>
<td>修改</td>
<td>boolean update (T t)</td>
<td>int updateById (T t)</td>
</tr>
<tr>
<td>根据id查询</td>
<td>T getById (int id)</td>
<td>T selectById (Serializable id)</td>
</tr>
<tr>
<td>查询全部</td>
<td>List&lt; T &gt; getAll ( )</td>
<td>List&lt; T &gt; selectList ( )</td>
</tr>
<tr>
<td>分页查询</td>
<td>PageInfo&lt; T &gt; getAll (int page, int size)</td>
<td>IPage&lt; T &gt; selectPage (IPage&lt; T &gt; page)</td>
</tr>
<tr>
<td>按条件查询</td>
<td>List&lt; T &gt; getAll (Condition condition)</td>
<td>IPage&lt; T &gt; selectPage (Wrapper&lt; T &gt; queryWrapper)</td>
</tr>
</tbody></table>
<h3 id="7-5-分页功能"><a href="#7-5-分页功能" class="headerlink" title="7-5 分页功能"></a>7-5 分页功能</h3><p>1、设置分页拦截器作为Spring管理的bean</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MpCongfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">pageInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.定义mp拦截器</span></span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">//2.添加具体的拦截器</span></span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>2、执行分页查询</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetByPage</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">IPage</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(<span class="number">2</span>,<span class="number">3</span>); <span class="comment">//当前页码，每页数据总量</span></span><br><span class="line">    userDao.selectPage(page, <span class="literal">null</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;当前页码:&quot;</span>+page.getCurrent());</span><br><span class="line">    System.out.println(<span class="string">&quot;每页数据总量:&quot;</span>+page.getsize());</span><br><span class="line">    System.out.println(<span class="string">&quot;总页数:&quot;</span>+page.getPages());</span><br><span class="line">    System.out.println(<span class="string">&quot;数据总量:&quot;</span>+page.getTotal());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前页数据:&quot;</span>+page.getRecords());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="7-6-条件查询功能"><a href="#7-6-条件查询功能" class="headerlink" title="7-6 条件查询功能"></a>7-6 条件查询功能</h3><h4 id="7-6-1-条件查询的三种格式"><a href="#7-6-1-条件查询的三种格式" class="headerlink" title="7-6-1 条件查询的三种格式"></a>7-6-1 条件查询的三种格式</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"><span class="comment">//方式一:常规格式</span></span><br><span class="line"><span class="type">QueryWrapper</span> <span class="variable">qw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>();</span><br><span class="line">qw.lt(<span class="string">&quot;age&quot;</span>,<span class="number">10</span>); <span class="comment">//age小于10的</span></span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(qw);</span><br><span class="line">System.out.println(userList)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//方式二:lambda格式按条件查询</span></span><br><span class="line">QueryWrapper&lt;User&gt; qw = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">qw.lambda().lt(User::getAge,<span class="number">10</span>); <span class="comment">//age小于10的</span></span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(qw);</span><br><span class="line">System.out.println(userList);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//方式三:lambda格式按条件查询</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">lqw.lt(User::getAge,<span class="number">10</span>); <span class="comment">//age小于10的</span></span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList);</span><br><span class="line"></span><br><span class="line"><span class="comment">//多条件(链式编程)</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line"></span><br><span class="line">lqw.lt(User::getAge,<span class="number">30</span>).ge(User::getAge,<span class="number">10</span>); <span class="comment">//10到30岁之间</span></span><br><span class="line">lqw.lt(User::getAge,<span class="number">10</span>).or().ge(User::getAge,<span class="number">30</span>); <span class="comment">//小于10岁或者大于30岁</span></span><br><span class="line"></span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></table></figure></div>

<h4 id="7-6-2-条件查询null判定"><a href="#7-6-2-条件查询null判定" class="headerlink" title="7-6-2 条件查询null判定"></a>7-6-2 条件查询null判定</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建UserQuery</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserQuery</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模拟页面传递过来的查询数据</span></span><br><span class="line"><span class="type">UserQuery</span> <span class="variable">userQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserQuery</span>();</span><br><span class="line">userQuery.getAge(<span class="number">10</span>);</span><br><span class="line">userQuery.getAge2(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//条件查询null判定</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line"><span class="comment">//先判定第一个参数是否为true，如果为true连接当前条件</span></span><br><span class="line">lqw.ge(<span class="literal">null</span> != userQuery.getAge() ,User::getAge, userQuery.getAge())</span><br><span class="line">   .lt(<span class="literal">null</span> != userQuery.getAge2() ,User::getAge, userQuery.getAge2());   </span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></table></figure></div>

<h4 id="7-6-3-查询投影"><a href="#7-6-3-查询投影" class="headerlink" title="7-6-3 查询投影"></a>7-6-3 查询投影</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询结果包含模型类中部分属性</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">lqw.select(User::getId, User::getName, User::getAge);</span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//查询结果包含模型类中未定义的属性</span></span><br><span class="line">QueryWrapper&lt;User&gt; qw = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">qw.select(<span class="string">&quot;count(*) as nums, gender&quot;</span>); <span class="comment">//查询数据数 并取别名，显示分组名</span></span><br><span class="line">qw.groupBy(<span class="string">&quot;gender&quot;</span>); <span class="comment">//分组</span></span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; maps = userDao.selectMaps(qw);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></table></figure></div>

<h4 id="7-6-4-查询条件"><a href="#7-6-4-查询条件" class="headerlink" title="7-6-4 查询条件"></a>7-6-4 查询条件</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//登录操作 等同于&quot;=&quot;</span></span><br><span class="line">lqw.eq(User::getName,<span class="string">&quot;root&quot;</span>).eq(User::getPassword,<span class="string">&quot;root&quot;</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">loginUser</span> <span class="operator">=</span> userDao.selectOne(lqw); <span class="comment">//只查询一个</span></span><br><span class="line">System.out.println(loginUser);</span><br><span class="line"></span><br><span class="line"><span class="comment">//范围查询 lt、le、gt、ge、eq、between</span></span><br><span class="line">lqw.between(User::getAge,<span class="number">10</span>,<span class="number">30</span>); <span class="comment">//age在10到30之间 前小后大</span></span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList);</span><br><span class="line"></span><br><span class="line"><span class="comment">//模糊匹配 like</span></span><br><span class="line">lqw.like(User::getName,<span class="string">&quot;r&quot;</span>); <span class="comment">//%r%</span></span><br><span class="line">lqw.likeRight(User::getName,<span class="string">&quot;r&quot;</span>); <span class="comment">//r%</span></span><br><span class="line">lqw.likeLeft(User::getName,<span class="string">&quot;r&quot;</span>); <span class="comment">//%r</span></span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></table></figure></div>

<p>更多查询条件设置参看：<a class="link"   href="https://mybatis.plus/guide/wrapper.html#abstractwrapper" >https://mybatis.plus/guide/wrapper.html#abstractwrapper <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="7-7-字段映射与表名映射"><a href="#7-7-字段映射与表名映射" class="headerlink" title="7-7 字段映射与表名映射"></a>7-7 字段映射与表名映射</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\31518\AppData\Roaming\Typora\typora-user-images\image-20240312212827779.png"
                      alt="image-20240312212827779"
                ></li>
</ul>
<h4 id="7-7-1-TableField"><a href="#7-7-1-TableField" class="headerlink" title="7-7-1 @ TableField"></a>7-7-1 @ TableField</h4><p>问题一：表字段与编码属性设计不同步</p>
<p>​		value (默认)：设置数据库表字段名称。</p>
<p>问题二：编码中添加了数据库中未定义的属性</p>
<p>​		exist：设置属性在数据库表字段中是否存在，默认为true。此属性无法与value合并使用。</p>
<p>问题三：采用默认查询开放了更多的字段查看权限</p>
<p>​		select：设置属性是否参与查询，此属性与select ( )映射配置不冲突。</p>
<h4 id="7-7-2-TableName"><a href="#7-7-2-TableName" class="headerlink" title="7-7-2 @ TableName"></a>7-7-2 @ TableName</h4><p>问题四：表名与编码开发设计不同步</p>
<p>​		value：设置数据库表名称</p>
<p>全局配置：</p>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">	<span class="attr">global-config:</span></span><br><span class="line">		<span class="attr">db-config:</span></span><br><span class="line">			<span class="attr">table-prefix:</span> <span class="string">tbl_</span></span><br></pre></td></tr></table></figure></div>

<h3 id="7-8-ID生成策略"><a href="#7-8-ID生成策略" class="headerlink" title="7-8 ID生成策略"></a>7-8 ID生成策略</h3><p> <strong>@ TableId</strong></p>
<p>属性：</p>
<ul>
<li>value：设置数据库主键名称</li>
<li>type：设置主键属性的生成策略，值参照IdType枚举值</li>
</ul>
<table>
<thead>
<tr>
<th>代码</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>AUTO</td>
<td>使用数据库id自增策略，控制id生成</td>
</tr>
<tr>
<td>NONE</td>
<td>不设置id生成策略</td>
</tr>
<tr>
<td>INPUT</td>
<td>用户手工输入id</td>
</tr>
<tr>
<td>ASSIGN_ID</td>
<td>雪花算法生成id (可兼容数值型与字符串型)</td>
</tr>
<tr>
<td>ASSIGN_UUID</td>
<td>以UUID生成算法作为id生成策略</td>
</tr>
</tbody></table>
<p>雪花算法：</p>
<p>0 | 00100110111011010101100001101010011000110 | 10000 | 10001 | 000000000010 </p>
<p>占位符：0； 					时间戳（41）；								机器码（5+5）； 序列号（12）</p>
<p>实例：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>全局配置：</p>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">	<span class="attr">global-config:</span></span><br><span class="line">		<span class="attr">db-config:</span></span><br><span class="line">			<span class="attr">id_type:</span> <span class="string">auto</span></span><br></pre></td></tr></table></figure></div>

<h3 id="7-9-多数据操作"><a href="#7-9-多数据操作" class="headerlink" title="7-9 多数据操作"></a>7-9 多数据操作</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//删除</span></span><br><span class="line">List&lt;Long&gt; list = Arrays.asList(<span class="keyword">new</span> <span class="title class_">Long</span>[]&#123;<span class="number">2</span>,<span class="number">3</span>&#125;);</span><br><span class="line">userDao.deleteBatchIds(list);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//查询</span></span><br><span class="line">List&lt;Long&gt; list = Arrays.asList(<span class="keyword">new</span> <span class="title class_">Long</span>[]&#123;<span class="number">2</span>,<span class="number">3</span>&#125;);</span><br><span class="line">userDao.selectBatchIds(list);</span><br></pre></td></tr></table></figure></div>

<h3 id="7-10-逻辑删除"><a href="#7-10-逻辑删除" class="headerlink" title="7-10 逻辑删除"></a>7-10 逻辑删除</h3><p>介绍：为数据设置是否可用状态字段，删除时设置状态字段为不可用状态，数据保留在数据库中。</p>
<p>使用：</p>
<p>在数据库中添加字段 deleted</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//逻辑删除字段，标记当前记录是否被删除</span></span><br><span class="line">	<span class="meta">@TableLogic(value = &quot;0&quot;, delval = &quot;1&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer deleted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">userDao.deleteById(<span class="number">1L</span>); <span class="comment">//实际变成update</span></span><br><span class="line">userDao.selectList(<span class="literal">null</span>); <span class="comment">//实际变成where deleted = 0</span></span><br></pre></td></tr></table></figure></div>

<p>全局配置：</p>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">	<span class="attr">global-config:</span></span><br><span class="line">		<span class="attr">db-config:</span></span><br><span class="line">			<span class="attr">logic-delete-field:</span> <span class="string">deleted</span> <span class="string">//逻辑删除字段</span></span><br><span class="line">			<span class="attr">logic-not-delete-value:</span> <span class="number">0</span> <span class="string">//没删除</span></span><br><span class="line">			<span class="attr">logic-delete-value:</span> <span class="number">1</span> <span class="string">//删除</span></span><br></pre></td></tr></table></figure></div>

<h3 id="7-11-乐观锁"><a href="#7-11-乐观锁" class="headerlink" title="7-11 乐观锁"></a>7-11 乐观锁</h3><p>解决：业务并发现象带来的问题–秒杀</p>
<p>使用：</p>
<p>在数据库中添加字段 version</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Version</span></span><br><span class="line">	<span class="keyword">private</span> Integer version;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//配置乐观锁拦截器实现锁机制对应的动态SOL语句拼装</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MpCongfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mpInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.定义mp拦截器</span></span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mpinterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">//2.添加具体的拦截器</span></span><br><span class="line">        mpinterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">OptimisticLockerInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用乐观锁机制在修改前必须先获取到对应数据的verion方可正常进行</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="comment">//先查询数据，获取到version数据</span></span><br><span class="line">	User user=userDao.selectById(<span class="number">1L</span>);</span><br><span class="line">	<span class="comment">//执行数据修改操作</span></span><br><span class="line">	user.setName(<span class="string">&quot;Tom and Jerry&quot;</span>);</span><br><span class="line">	userDao.updateById(user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行修改前先执行查询语句</span></span><br><span class="line">SELECT id, name, age, tel, deleted, version FRoM tbl_user <span class="type">WHERE</span> <span class="variable">id</span> <span class="operator">=</span> ?</span><br><span class="line">    </span><br><span class="line"><span class="comment">//执行修改时使用version字段作为乐观锁检查依据</span></span><br><span class="line">UPDATE tbl_user <span class="type">SET</span> <span class="variable">name</span> <span class="operator">=</span> ?, age = ?, tel = ?, version = ? <span class="type">WHERE</span> <span class="variable">id</span> <span class="operator">=</span> ? <span class="type">AND</span> <span class="variable">version</span> <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure></div>

<h3 id="7-12-代码生成器"><a href="#7-12-代码生成器" class="headerlink" title="7-12 代码生成器"></a>7-12 代码生成器</h3><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line">//引入依赖在pom.xml</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--velocity模板引擎--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建执行类 com.lrq.CodeGenerator</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">         <span class="comment">//1.获取代码生成器的对象</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">autoGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//设置数据库相关配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        </span><br><span class="line">        dataSource.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">&quot;root&quot;</span>); </span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;690609&quot;</span>); </span><br><span class="line">            </span><br><span class="line">        autoGenerator.setDataSource(dataSource);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//设置全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">globalconfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//设置代码输出位置，默认生成文件夹src/main/java/baomidou</span></span><br><span class="line">        globalconfig.setOutputDir(System.getProperty(<span class="string">&quot;user.dir&quot;</span>).<span class="string">&quot;/项目名/src/main/java&quot;</span>); </span><br><span class="line">        globalconfig.setOpen(<span class="literal">false</span>); <span class="comment">//设置生成完毕后是否打开生成代码所在的目录</span></span><br><span class="line">        globalconfig.setAuthor(<span class="string">&quot;lrq&quot;</span>); <span class="comment">//设置作者    </span></span><br><span class="line">        globalconfig.setFileOverride(<span class="literal">true</span>); <span class="comment">//设置是否覆盖原始生成的文件</span></span><br><span class="line">        globalconfig.setMapperName(<span class="string">&quot;%sDao&quot;</span>); <span class="comment">//设置数据层接口名，%s为占位符，指代模块名称，默认是&quot;%Mapper&quot;</span></span><br><span class="line">        globalconfig.setIdType(IdTyPe.ASSIGN_ID); <span class="comment">//设置Id生成策略    </span></span><br><span class="line">        </span><br><span class="line">        autoGenerator.setGlobalConfig(globalConfig);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//设置包名相关配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">packageInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//设置生成的包名，与代码所在位置不冲突，二者叠加组成完整路径，生成文件夹src/main/java/com.lrq</span></span><br><span class="line">        packageInfo.setParent(<span class="string">&quot;com.lrq&quot;</span>);</span><br><span class="line">        packageInfo.setEntity(<span class="string">&quot;domain&quot;</span>); <span class="comment">//设置实体类包名，默认是entity</span></span><br><span class="line">        packageInfo.setMapper(<span class="string">&quot;dao&quot;</span>); <span class="comment">//设置数据层包名，默认是mapper</span></span><br><span class="line">        </span><br><span class="line">        autoGenerator.setPackageInfo(packageInfo);</span><br><span class="line">            </span><br><span class="line">        <span class="comment">//策略设置 </span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategyConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        </span><br><span class="line">        strategyConfig.setInclude(<span class="string">&quot;tbl_user&quot;</span>,<span class="string">&quot;tbl_house&quot;</span>); <span class="comment">//设置当前参与生成的表名，参数为可变参数</span></span><br><span class="line">        <span class="comment">//设置数据库表的前缀名称，模块名 = 数据库表名 - 前缀名，例如：User = tbl_user - tbl_  </span></span><br><span class="line">        strategyConfig.setTablePrefix(<span class="string">&quot;tbl_&quot;</span>);</span><br><span class="line">        strategyConfig.setRestControllerStyle(<span class="literal">true</span>); <span class="comment">//设置是否启用Rest风格</span></span><br><span class="line">        strategyConfig.setVersionFieldName(<span class="string">&quot;version&quot;</span>); <span class="comment">//设置乐观锁字段名</span></span><br><span class="line">        strategyConfig.setLogicDeleteFieldName(<span class="string">&quot;deleted&quot;</span>); <span class="comment">//设置逻辑删除字段名    </span></span><br><span class="line">        strategyConfig.setEntityLombokModel(<span class="literal">true</span>); <span class="comment">//设置是否启用lombok</span></span><br><span class="line">        </span><br><span class="line">        autoGenerator.setStrategy(strategyConfig);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2.执行生成操作    </span></span><br><span class="line">        autoGenerator.execute();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="8-开发流程"><a href="#8-开发流程" class="headerlink" title="8- 开发流程"></a>8- 开发流程</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/00cc078c-248c-4202-81b7-6df0b22c773d-25143160.jpg"
                      alt="img"
                ></p>
<h2 id="9-开发规范"><a href="#9-开发规范" class="headerlink" title="9- 开发规范"></a>9- 开发规范</h2><h3 id="9-1-Restful"><a href="#9-1-Restful" class="headerlink" title="9-1 Restful"></a>9-1 Restful</h3><p>REST (REpresentational State Transfer)，表述性状态转换，它是一种软件架构风格。</p>
<p>REST是风格，是约定方式，约定不是规定，可以打破。</p>
<p>描述模块的功能通常使用复数，也就是加s的格式来描述，表示此类资源，而非单个资源。如：uers、emps、books…</p>
<table>
<thead>
<tr>
<th>URL定位资源HTTP动词描述操作</th>
<th>REST风格</th>
<th>注解</th>
</tr>
</thead>
<tbody><tr>
<td><a class="link"   href="http://localhost:8080/users/1" >http://localhost:8080/users/1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td>GET：查询id为1的用户</td>
<td>@GetMapping</td>
</tr>
<tr>
<td><a class="link"   href="http://localhost:8080/users" >http://localhost:8080/users <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td>POST：新增用户</td>
<td>@PostMapping</td>
</tr>
<tr>
<td><a class="link"   href="http://localhost:8080/users" >http://localhost:8080/users <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td>PUT：修改用户</td>
<td>@PutMapping</td>
</tr>
<tr>
<td><a class="link"   href="http://localhost:8080/users/1" >http://localhost:8080/users/1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
<td>DELETE：删除id为1的用户</td>
<td>@DeleteMapping(</td>
</tr>
</tbody></table>
<h3 id="9-2-统一响应结果"><a href="#9-2-统一响应结果" class="headerlink" title="9-2 统一响应结果"></a>9-2 统一响应结果</h3><p>请求响应 –&gt; 响应 –&gt; 统一响应结果</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建pojo.Result</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer code;<span class="comment">//响应码，200 代表成功; 0 代表失败</span></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//响应信息，描述字符串</span></span><br><span class="line">    <span class="keyword">private</span> Object data; <span class="comment">//返回的数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">()</span>&#123;<span class="comment">//增删改 成功响应</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">200</span>,<span class="string">&quot;success&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">(Object data)</span>&#123;<span class="comment">//查询 成功响应</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">200</span>,<span class="string">&quot;success&quot;</span>,data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">(String msg)</span>&#123;<span class="comment">//失败响应</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">200</span>,msg,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="9-3-日志输出"><a href="#9-3-日志输出" class="headerlink" title="9-3 日志输出"></a>9-3 日志输出</h3><p>Mybatis –&gt; 入门 –&gt; 日志输出</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Controller应用</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@Slf4j</span><span class="comment">//日志记录框架注解</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XinxiController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line">    <span class="keyword">private</span> XinxiService xinxiService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//private static Logger log = LoggerFactory.getLogger(XinxiController.class);//日志记录框架</span></span><br><span class="line">    <span class="comment">//@RequestMapping(value = &quot;/studentx&quot;,method = RequestMethod.POST)//指定请求方式为 POST</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">//添加信息</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/studentx&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">insert</span><span class="params">(<span class="meta">@RequestBody</span> Xinxi xinxi)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;添加学生信息&quot;</span>,xinxi);<span class="comment">//日志</span></span><br><span class="line">        <span class="comment">//调用service添加信息</span></span><br><span class="line">        xinxiService.insert(xinxi);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="9-4-RequestMapping"><a href="#9-4-RequestMapping" class="headerlink" title="9-4 @ RequestMapping"></a>9-4 @ RequestMapping</h3><p>请求路径url有相同处，可以简写。</p>
<p>一个完整的请求路径，应该是类上的 @RequestMapping 的value属性+方法上的 @RequestMapping 的value属性。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/a7bb151b-1fad-4f0d-a436-2a7c3e10795a-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="10-分页查询"><a href="#10-分页查询" class="headerlink" title="10- 分页查询"></a>10- 分页查询</h2><h3 id="10-1-基础"><a href="#10-1-基础" class="headerlink" title="10-1 基础"></a>10-1 基础</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 参数1:起始索引 = (页码-1)*每页展示记录数</span></span><br><span class="line"><span class="comment">// 参数2:查询返回记录数 = 每页展示记录数</span></span><br><span class="line">select * from emp limit <span class="number">0</span>,<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取总记录数</span></span><br><span class="line">select <span class="title function_">count</span><span class="params">(*)</span> from emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置请求参数默认值</span></span><br><span class="line"><span class="meta">@RequestParam</span> (defaultValue = <span class="string">&quot;1&quot;</span>) </span><br></pre></td></tr></table></figure></div>

<h3 id="10-2-原始方式"><a href="#10-2-原始方式" class="headerlink" title="10-2 原始方式"></a>10-2 原始方式</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建pojo.PageBean</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long total;<span class="comment">//总记录数</span></span><br><span class="line">    <span class="keyword">private</span> List rows;<span class="comment">//数据列表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Controller应用、分页查询</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line"><span class="keyword">private</span> XinxiService xinxiService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/studentfs&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">page</span><span class="params">(<span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> Integer page,</span></span><br><span class="line"><span class="params">                   <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> Integer pageSize)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;分页查询，参数: &#123;&#125;,&#123;&#125;&quot;</span>,page,pageSize);</span><br><span class="line">    <span class="comment">//调用service分页查询</span></span><br><span class="line">    <span class="type">PageBean</span> <span class="variable">pageBean</span> <span class="operator">=</span> xinxiService.page(page,pageSize);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageBean);s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Service impl应用、分页查询</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line"><span class="keyword">private</span> XinxiMapper xinxiMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageBean <span class="title function_">page</span><span class="params">(Integer page, Integer pageSize)</span> &#123;</span><br><span class="line">	<span class="comment">//1. 获取总记录数</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> xinxiMapper.count();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2. 获取分页查询结果列表</span></span><br><span class="line">	<span class="type">Integer</span> <span class="variable">start</span> <span class="operator">=</span> (page - <span class="number">1</span>) * pageSize;</span><br><span class="line">    List&lt;Xinxi&gt; xinxiList = xinxiMapper.page(start,pageSize);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//3，封装PageBean对象</span></span><br><span class="line">    <span class="type">PageBean</span> <span class="variable">pageBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageBean</span>(count,xinxiList);</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">return</span> pageBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Mapper应用、分页查询</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//查询总记录</span></span><br><span class="line"><span class="meta">@Select(&quot;select count(*) from student.xinxi&quot;)</span></span><br><span class="line">Long <span class="title function_">count</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//分页 与 每页多少数据</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from student.xinxi limit #&#123;start&#125;,#&#123;pageSize&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Xinxi&gt; <span class="title function_">page</span><span class="params">(Integer start, Integer pageSize)</span>;</span><br></pre></td></tr></table></figure></div>

<h3 id="10-3-pagehelper插件"><a href="#10-3-pagehelper插件" class="headerlink" title="10-3 pagehelper插件"></a>10-3 pagehelper插件</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/3f7729d5-f9ca-41aa-adb3-84f0057503fa-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="10-4-分页条件查询"><a href="#10-4-分页条件查询" class="headerlink" title="10-4 分页条件查询"></a>10-4 分页条件查询</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//EmpController</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/emps&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">page</span><span class="params">(<span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> Integer page,</span></span><br><span class="line"><span class="params">                   <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                   String name,Short gender,</span></span><br><span class="line"><span class="params">                   <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin</span></span><br><span class="line"><span class="params">				   <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span> &#123;</span><br><span class="line">	log.info(<span class="string">&quot;分页查询，参数: &#123;&#125;,&#123;&#125;,&#123;&#125;,&#123;&#125;,&#123;&#125;,&#123;&#125;&quot;</span>,page, pageSize, name, gender, begin, end);</span><br><span class="line">    <span class="comment">//调用service分页查询</span></span><br><span class="line">    <span class="type">PageBean</span> <span class="variable">pageBean</span> <span class="operator">=</span> empService.page(page, pageSize, name, ender, begin, end);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageBean);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//EmpService impl</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageBean <span class="title function_">page</span><span class="params">(Integer page,Integer pageSize,String name,Short gender,LocalDate begin,LocalDate end)</span> &#123;</span><br><span class="line">	<span class="comment">//1.设置分页参数</span></span><br><span class="line">	PageHelper.startPage(page,pageSize);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//2、执行查询</span></span><br><span class="line">	List&lt;Emp&gt; empList = empMapper.list(name, gender, begin, end);</span><br><span class="line">	Page&lt;Emp&gt; p = (Page&lt;Emp&gt;)empList;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//3.封装PageBean对象</span></span><br><span class="line">	<span class="type">PageBean</span> <span class="variable">pageBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageBean</span>(p.getTotal(),p.getResult());</span><br><span class="line">	<span class="keyword">return</span> pageBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//EmpMapper</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">list</span><span class="params">(String name, Short gender, LocalDate begin, LocalDate end)</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line">//EmpMapper.xml</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span> = <span class="string">&quot;com.itheima.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Emp&quot;</span>&gt;</span></span><br><span class="line">		select * </span><br><span class="line">		from emp</span><br><span class="line">		<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">text</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">				name like concat(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">text</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span></span><br><span class="line">				and gender = #&#123;gender&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">text</span>=<span class="string">&quot;begin != null and end != null&quot;</span>&gt;</span></span><br><span class="line">            	and entrydate between #&#123;begin&#125; and #&#123;end&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by update_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span>    </span><br></pre></td></tr></table></figure></div>

<h2 id="11-批量删除"><a href="#11-批量删除" class="headerlink" title="11- 批量删除"></a>11- 批量删除</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/8d4c2382-49d4-4cbc-b6d7-1388cf917ace-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="12-修改前查询回显"><a href="#12-修改前查询回显" class="headerlink" title="12- 修改前查询回显"></a>12- 修改前查询回显</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/d2d6d6c9-47d1-481e-aacd-15554b059f98-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="13-文件上传"><a href="#13-文件上传" class="headerlink" title="13- 文件上传"></a>13- 文件上传</h2><h3 id="13-1-介绍"><a href="#13-1-介绍" class="headerlink" title="13-1 介绍"></a>13-1 介绍</h3><p>是指将本地图片、视频、音频等文件上传到服务器，供其他用户浏览或下载的过程。</p>
<h3 id="13-2-本地存储"><a href="#13-2-本地存储" class="headerlink" title="13-2 本地存储"></a>13-2 本地存储</h3><p>文件名必须是唯一的，不然后面的文件会覆盖前面的文件。</p>
<p>在SpringBoot中，文件上传，默认单个文件允许最大大小为 1M。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>String   <strong>getOriginalFilename</strong> ( ) ;</td>
<td>获取原始文件名</td>
</tr>
<tr>
<td>void   <strong>transferTo</strong> (File dest) ;</td>
<td>将接收的文件转存到磁盘文件中</td>
</tr>
<tr>
<td>long   <strong>getSize</strong> ( ) ;</td>
<td>获取文件的大小，单位：字节</td>
</tr>
<tr>
<td>byte[ ]   <strong>getBytes</strong> ( ) ;</td>
<td>获取文件内容的字节数组</td>
</tr>
<tr>
<td>InputStream   <strong>getInputStream</strong> ( ) ;</td>
<td>获取接收到的文件内容的输入流</td>
</tr>
</tbody></table>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//实例</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">upload</span><span class="params">(String username, Integer age, MultipartFile image)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	log.info(<span class="string">&quot;文件上传:&#123;&#125;,&#123;&#125;,&#123;&#125;&quot;</span>,username, age, image);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//获取原始文件名-1.jPg123.0.0.jPg</span></span><br><span class="line">	<span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> image.getOriginalFilename();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//构造唯一的文件名(不能重复) - uuid(通用唯一识别码) de49685b-61c0-4b11-80fa-c71e95924018</span></span><br><span class="line">	<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">	<span class="type">String</span> <span class="variable">extname</span> <span class="operator">=</span> originalFilename.substring(index);</span><br><span class="line">	<span class="type">String</span> <span class="variable">newFileName</span> <span class="operator">=</span> UUID.randomUUID().tostring() + extname;</span><br><span class="line">	log.info(<span class="string">&quot;新的文件名:&#123;&#125;&quot;</span>,newFileName);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//将文件存储在服务器的磁盘目录中 E:\images</span></span><br><span class="line">	image.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\images\\&quot;</span> + newFileName));</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> Result.success();</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>上传大文件，进行如下配置</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//application.properties</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置单个文件最大上传大小</span></span><br><span class="line">spring.servlet.multipart.max-file-size = 10MB</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置单个请求最大上传大小(一次请求可以上传多个文件)</span></span><br><span class="line">spring.servlet.multipart.max-request-size = 100MB</span><br></pre></td></tr></table></figure></div>

<h3 id="13-3-阿里云OSS"><a href="#13-3-阿里云OSS" class="headerlink" title="13-3 阿里云OSS"></a>13-3 阿里云OSS</h3><h4 id="13-3-1-准备工作"><a href="#13-3-1-准备工作" class="headerlink" title="13-3-1 准备工作"></a>13-3-1 准备工作</h4><p>注册阿里云(实名认证) –&gt; 开通对象存储服务(oss) –&gt; 创建bucket –&gt; 获取AccessKey (秘钥) 。</p>
<ul>
<li>Bucket：存储空间是用户用于存储对象 (Object，就是文件)的容器，所有的对象都必须隶属于某个存储空间。</li>
<li>创建bucket：必须动 名称、地域、读写权限</li>
</ul>
<h4 id="13-3-2-参照官方SDK编写入门程序"><a href="#13-3-2-参照官方SDK编写入门程序" class="headerlink" title="13-3-2 参照官方SDK编写入门程序"></a>13-3-2 参照官方SDK编写入门程序</h4><p>只需要用的时候复制并修改官方案例。</p>
<ul>
<li>SDK：Sofware Development Kit 的缩写，软件开发工具包，包括辅助软件开发的依赖 (iar包)、代码示例等，都可以叫做SDK。</li>
</ul>
<h4 id="13-3-3-案例集成OSS"><a href="#13-3-3-案例集成OSS" class="headerlink" title="13-3-3 案例集成OSS"></a>13-3-3 案例集成OSS</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下创建阿里云OSS工具类（utils.AliossUtils）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliossUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> <span class="string">&quot;https://oss-cn-hangzhou.aliyuncs.com&quot;</span>; <span class="comment">//地址</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> <span class="string">&quot;LTAI4GCHlvX6DKqJWxd6nEuw&quot;</span>; <span class="comment">//秘钥</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> <span class="string">&quot;yBshYweHOpqDuhCArrVHwIiBKpyqSL&quot;</span>; <span class="comment">//秘钥</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> <span class="string">&quot;web-tlias&quot;</span>; <span class="comment">//Bucke名称</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="comment">// 获取上传的文件的输入流</span></span><br><span class="line">		<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> file.getInputStream();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 避免文件覆盖</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString() +</span><br><span class="line">        	originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        	</span><br><span class="line">        <span class="comment">//上传文件到 OSS</span></span><br><span class="line">		<span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line">		ossClient.putObject(bucketName, fileName, inputStream);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//文件访问路径</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> endpoint.split(<span class="string">&quot;//&quot;</span>)[<span class="number">0</span>] + <span class="string">&quot;//&quot;</span> + bucketName + <span class="string">&quot;.&quot;</span> + endpoint.split(<span class="string">&quot;//&quot;</span>)[<span class="number">1</span>] + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//关闭ossClient</span></span><br><span class="line">		ossClient.shutdown();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//把上传到oss的路径返回</span></span><br><span class="line">		<span class="keyword">return</span> url;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下创建控制层（UploadController）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AliOSSUtils aliOSSUtils;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload”)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">upload</span><span class="params">(MultipartFile image)</span> <span class="keyword">throws</span> lOException &#123;</span><br><span class="line">    	String url= aliOSSUtils.upload(image);<span class="comment">//调用阿里云OSS工具类，将上传上来的文件存入阿里云</span></span><br><span class="line">    	<span class="keyword">return</span> Result.success(url);<span class="comment">//将图片上传完成后的url返回，用于浏览器回显展示</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="14-配置文件"><a href="#14-配置文件" class="headerlink" title="14- 配置文件"></a>14- 配置文件</h2><h3 id="14-1-OSS配置"><a href="#14-1-OSS配置" class="headerlink" title="14-1 OSS配置"></a>14-1 OSS配置</h3><p>@ Value ：通常用于外部配置的属性注入，具体用法为：@Value(“${配置文件中的key}”)</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-03-07%20220644.jpeg"
                      alt="img"
                ></li>
</ul>
<h3 id="14-2-yml配置"><a href="#14-2-yml配置" class="headerlink" title="14-2 yml配置"></a>14-2 yml配置</h3><p>语法：</p>
<ul>
<li>大小写敏感</li>
<li>数值前边必须有空格，作为分隔符</li>
<li>使用缩进表示层级关系，缩进时，不允许使用Tab键，只能用空格(idea中会自动将Tab转换为空格)</li>
<li>缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</li>
<li>#表示注释，从这个字符一直到行尾，都会被解析器忽略</li>
</ul>
<p>对比：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//XML</span></span><br><span class="line">&lt;server&gt;</span><br><span class="line">    &lt;port&gt;<span class="number">8080</span>&lt;/port&gt;</span><br><span class="line">    &lt;address&gt;<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>&lt;/address&gt;</span><br><span class="line">&lt;/server&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//properties</span></span><br><span class="line">server.port=<span class="number">8080</span></span><br><span class="line">server.address=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//yml/yaml</span></span><br><span class="line">server:</span><br><span class="line">	port:<span class="number">8080</span></span><br><span class="line">	address:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure></div>

<p>数据格式：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 对象/Map集合:</span></span><br><span class="line">user:</span><br><span class="line">	name:zhangsan</span><br><span class="line">	age:<span class="number">18</span></span><br><span class="line">	password:<span class="number">123456</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">// 数组/List/Set集合:</span></span><br><span class="line">hobby:</span><br><span class="line">	-java</span><br><span class="line">	-game</span><br><span class="line">	-sport</span><br></pre></td></tr></table></figure></div>

<h3 id="14-3-ConfigurationProperties"><a href="#14-3-ConfigurationProperties" class="headerlink" title="14-3 @ ConfigurationProperties"></a>14-3 @ ConfigurationProperties</h3><p>引入 与 案例：</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line">//pom.xml</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">//yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">aliyun:</span></span><br><span class="line">	<span class="attr">oss:</span></span><br><span class="line">		<span class="attr">endpoint:</span> <span class="string">https://oss-cn-hangzhou.aliyuncs.com</span></span><br><span class="line">		<span class="attr">accessKeyId:</span> <span class="string">LTAI4GCHlvX6DKqJWxd6nEuw</span></span><br><span class="line">		<span class="attr">accessKeySecret:</span> <span class="string">yBshYweHOpqDuhCArrVHwIiBKpyqSL</span></span><br><span class="line">		<span class="attr">bucketName:</span> <span class="string">web-tlias</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下创建阿里云OSS工具类（utils.AliOSSProperties）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;aliyun.oss&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOSSProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String endpoint; <span class="comment">//地址</span></span><br><span class="line">	<span class="keyword">private</span> String accessKeyId; <span class="comment">//秘钥</span></span><br><span class="line">	<span class="keyword">private</span> String accessKeySecret; <span class="comment">//秘钥</span></span><br><span class="line">	<span class="keyword">private</span> String bucketName; <span class="comment">//Bucke名称</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下创建阿里云OSS工具类（utils.AliossUtils）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliossUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> AliOSSProperties aliOSSProperties;	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	</span><br><span class="line">		<span class="comment">//获取阿里云OSS参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> aliOSSProperties.getEndpoint; <span class="comment">//地址</span></span><br><span class="line">       	<span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> aliOSSProperties.getAccessKeyId; <span class="comment">//秘钥</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> aliOSSProperties.getAccessKeySecret; <span class="comment">//秘钥</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> aliOSSProperties.getBucketName; <span class="comment">//Bucke名称</span></span><br><span class="line">		<span class="comment">// 获取上传的文件的输入流</span></span><br><span class="line">		<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> file.getInputStream();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 避免文件覆盖</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString() +</span><br><span class="line">        	originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        	</span><br><span class="line">        <span class="comment">//上传文件到 OSS</span></span><br><span class="line">		<span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line">		ossClient.putObject(bucketName, fileName, inputStream);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//文件访问路径</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> endpoint.split(<span class="string">&quot;//&quot;</span>)[<span class="number">0</span>] + <span class="string">&quot;//&quot;</span> + bucketName + <span class="string">&quot;.&quot;</span> + endpoint.split(<span class="string">&quot;//&quot;</span>)[<span class="number">1</span>] + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//关闭ossClient</span></span><br><span class="line">		ossClient.shutdown();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//把上传到oss的路径返回</span></span><br><span class="line">		<span class="keyword">return</span> url;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>与@ Value差别：</p>
<p>相同点：</p>
<ul>
<li>都是用来注入外部配置的属性的。</li>
</ul>
<p>不同点：</p>
<ul>
<li>@ Value注解只能一个一个的进行外部属性的注入。</li>
<li>@ ConfigurationProperties可以批量的将外部的属性配置注入到bean对象的属性中。</li>
</ul>
<h2 id="15-登录校验"><a href="#15-登录校验" class="headerlink" title="15- 登录校验"></a>15- 登录校验</h2><h3 id="15-1-会话技术"><a href="#15-1-会话技术" class="headerlink" title="15-1 会话技术"></a>15-1 会话技术</h3><h4 id="15-1-1-介绍"><a href="#15-1-1-介绍" class="headerlink" title="15-1-1 介绍"></a>15-1-1 介绍</h4><p>会话：用户打开浏览器，访问web服务器的资源，会话建立，直到有一方断开连接，会话结束。在一次会话中可以包含多次请求和响应。</p>
<p>会话跟踪：一种维护浏览器状态的方法，服务器需要识别多次请求是否来自于同一浏览器，以便在同一次会话的多次请求间共享数据。</p>
<p>跨域：跨域区分三个维度，即协议、IP&#x2F;域名、端口，只要三个有一个不一样，就是跨域。</p>
<h4 id="15-1-2-会话跟踪方案"><a href="#15-1-2-会话跟踪方案" class="headerlink" title="15-1-2 会话跟踪方案"></a>15-1-2 会话跟踪方案</h4><p>客户端会话跟踪技术：Cookie</p>
<p>存在客户端</p>
<ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/97c53656-7555-4f69-aef3-07e37980f1d0-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/ff9957b4-e5f1-417e-adc2-adc06f524a36-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
<p>服务端会话跟踪技术：Session</p>
<p>存在服务端</p>
<ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/16b49e84-8227-4bfc-babd-4cc158ad49a4-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/4b2d2275-e563-429f-98c6-e919324937e1-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
<p>JWT令牌技术</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/e3f5aa25-d98d-4b5b-8dba-983afed1a1e5-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="15-2-JWT令牌"><a href="#15-2-JWT令牌" class="headerlink" title="15-2 JWT令牌"></a>15-2 JWT令牌</h3><h4 id="15-2-1-介绍"><a href="#15-2-1-介绍" class="headerlink" title="15-2-1 介绍"></a>15-2-1 介绍</h4><p>header、payload用的是 Base64编码，Signature不是。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/2242d46a-7383-4cbf-8d97-debb4c3c9b16-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>JWT校验时使用的签名秘钥，必须和生成IWT令牌时使用的秘钥是配套的。</p>
<p>如果JWT令牌解析校验时报错，则说明JWT令牌被篡改 或 失效了，令牌非法。</p>
<h4 id="15-2-2-应用场景：登录认证"><a href="#15-2-2-应用场景：登录认证" class="headerlink" title="15-2-2 应用场景：登录认证"></a>15-2-2 应用场景：登录认证</h4><p>1、登录成功后，生成令牌</p>
<p>2、将令牌存储到客户端（不一定存在Cookie中）</p>
<p>3、后续每个请求，都要携带JWT令牌，系统在每次请求处理之前，先校验令牌，通过后，再处理</p>
<h4 id="15-2-3-快速入门"><a href="#15-2-3-快速入门" class="headerlink" title="15-2-3 快速入门"></a>15-2-3 快速入门</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//pom.xml</span></span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupld&gt;io.jsonwebtoken&lt;/groupld&gt;</span><br><span class="line">    &lt;artifactld&gt;jjwt&lt;/artifactld&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">0.9</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//生成JWT</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGenJwt</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    claims.put(<span class="string">&quot;id&quot;</span>,<span class="number">1</span>);</span><br><span class="line">    claims.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;lrq&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">            .signWith(SignatureAlgorithm.HS256,<span class="string">&quot;lrq&quot;</span>)<span class="comment">//签名算法</span></span><br><span class="line">            .setClaims(claims)<span class="comment">//自定义内容(载荷)</span></span><br><span class="line">            .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + <span class="number">3600</span> * <span class="number">1000</span>))<span class="comment">//设置有效期为1小时</span></span><br><span class="line">            .compact();</span><br><span class="line"></span><br><span class="line">    System.out.println(jwt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//解析JWT</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testParseJwt</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> Jwts.parser()</span><br><span class="line">            .setSigningKey(<span class="string">&quot;lrq&quot;</span>)</span><br><span class="line">            .parseClaimsJws(jwt)</span><br><span class="line">            .getBody();</span><br><span class="line">            </span><br><span class="line">    System.out.println(claims);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="15-2-4-使用"><a href="#15-2-4-使用" class="headerlink" title="15-2-4 使用"></a>15-2-4 使用</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下创建JWT工具类(utils.JWTUtils)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">signKey</span> <span class="operator">=</span> <span class="string">&quot;lrq&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Long</span> <span class="variable">expire</span> <span class="operator">=</span><span class="number">43200000L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//生成Jwt</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateJwt</span><span class="params">(Map&lt;String,Object&gt; claims)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">                .addClaims(claims)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS256,signKey)</span><br><span class="line">                .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + expire))</span><br><span class="line">                .compact();</span><br><span class="line">        <span class="keyword">return</span> jwt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析Jwt</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title function_">parseJwt</span><span class="params">(String jwt)</span> &#123;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> Jwts.parser()</span><br><span class="line">                .setSigningKey(signKey)</span><br><span class="line">                .parseClaimsJws(jwt)</span><br><span class="line">                .getBody();</span><br><span class="line">        <span class="keyword">return</span> claims;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下创建控制层(LoginController)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginService loginService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户登录</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Login login)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;用户登录：&#123;&#125;&quot;</span>,login);</span><br><span class="line">        </span><br><span class="line">        <span class="type">Login</span> <span class="variable">log</span> <span class="operator">=</span> loginService.login(login);</span><br><span class="line">        <span class="keyword">if</span>(log != <span class="literal">null</span>)&#123; <span class="comment">//用户名密码正确</span></span><br><span class="line">            Map&lt;String,Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            claims.put(<span class="string">&quot;username&quot;</span>,log.getUsername());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//生成JWT令牌</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> JwtUtils.generateJwt(claims);</span><br><span class="line">            <span class="keyword">return</span> Result.success(jwt);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;用户名或用户密码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="15-3-过滤器Filter"><a href="#15-3-过滤器Filter" class="headerlink" title="15-3 过滤器Filter"></a>15-3 过滤器Filter</h3><h4 id="15-3-1-介绍"><a href="#15-3-1-介绍" class="headerlink" title="15-3-1 介绍"></a>15-3-1 介绍</h4><p>Filter 过滤器，是JavaWeb 三大组件(Servlet、Filter、Listener)之一。</p>
<p>过滤器可以把对资源的请求拦截下来，从而实现一些特殊的功能。</p>
<p>过滤器一般完成一些通用的操作，比如：登录校验、统一编码处理、敏感字符处理等。</p>
<h4 id="15-3-2-快速入门"><a href="#15-3-2-快速入门" class="headerlink" title="15-3-2 快速入门"></a>15-3-2 快速入门</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/f11fd6f1-007b-43fe-bd01-589fbb01e05e-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="15-3-3-执行流程"><a href="#15-3-3-执行流程" class="headerlink" title="15-3-3 执行流程"></a>15-3-3 执行流程</h4><p>请求 –&gt; 放行前逻辑 –&gt; 放行 –&gt; 获取web资源 –&gt; 放行后逻辑</p>
<p>放行后访问对应资源，资源访问完成后，还会回到Filter中。</p>
<p>如果回到Filter中，是执行放行后的逻辑。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/4c69af2c-8925-4f4a-9b3e-46a96d8f5e7a-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="15-3-4-拦截路径"><a href="#15-3-4-拦截路径" class="headerlink" title="15-3-4 拦截路径"></a>15-3-4 拦截路径</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/7ad02009-9324-49cf-b434-3072f7c3af49-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="15-3-5-过滤器链"><a href="#15-3-5-过滤器链" class="headerlink" title="15-3-5 过滤器链"></a>15-3-5 过滤器链</h4><p>一个web应用中，可以配置多个过滤器，这多个过滤器就形成了一个过滤器链。</p>
<p>注解配置的Filter，优先级是按照过滤器类名 (字符串) 的自然排序。</p>
<h4 id="15-3-6-登录校验Filter"><a href="#15-3-6-登录校验Filter" class="headerlink" title="15-3-6 登录校验Filter"></a>15-3-6 登录校验Filter</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/837b124c-7f82-4d8b-a89b-10ca82a87347-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="15-3-7-使用"><a href="#15-3-7-使用" class="headerlink" title="15-3-7 使用"></a>15-3-7 使用</h4><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line">//pom.xml</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.76<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下创建过滤器(filter.LoginCheckFilter)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> ...&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="type">HttpServletRequest</span> <span class="variable">reg</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">		<span class="type">HttpServletResponse</span> <span class="variable">resp</span> <span class="operator">=</span> (HttpServetResponse) response;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//流程步骤</span></span><br><span class="line">		<span class="comment">//1.获取请求url</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> req.getRequestURL().toString();</span><br><span class="line">		log.info(<span class="string">&quot;请求的url:&#123;&#125;&quot;</span>,url);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2.判断请求ur1中是否包含1ogin，如果包含，说明是登录操作，放行</span></span><br><span class="line">		<span class="keyword">if</span>(url.contains(<span class="string">&quot;login&quot;</span>))&#123;</span><br><span class="line">			log.info(<span class="string">&quot;登录操作，放行...&quot;</span>);</span><br><span class="line">			chain.doFilter(request,response);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3.获取请求头中的令牌(token)</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> req.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//4.判断令牌是否存在、如果不存在、返回错误结果(未登录)</span></span><br><span class="line">		<span class="keyword">if</span>(!StringUtils.hasLength(jwt))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;请求头token为空,返回未登录的信息&quot;</span>);</span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">            <span class="comment">//手动转换 对象--json ----&gt; 阿里巴巴 fastJSON</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">            resp.getWriter().write(notLogin);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         <span class="comment">//5.解析token，如果解析失败，返回错误结果(未登录)</span></span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">         	JwtUtils.parseJWT(jwt);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (Exception e) &#123; <span class="comment">//jwt解折失败</span></span><br><span class="line">         	e.printStackTrace();</span><br><span class="line">         	log.info(<span class="string">&quot;解析令牌失败，返回未登录错误信息&quot;</span>);</span><br><span class="line">         	<span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">         	<span class="comment">//手动转换 对象--json ----&gt; 阿里巴巴 fastJSON</span></span><br><span class="line">         	<span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">         	resp.getwriter().write(notLogin);</span><br><span class="line">         	<span class="keyword">return</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//6.放行。</span></span><br><span class="line">		log.info(<span class="string">&quot;令牌合法，放行&quot;</span>);</span><br><span class="line">		chain.doFilter(request,response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="15-4-拦截器Interceptor"><a href="#15-4-拦截器Interceptor" class="headerlink" title="15-4 拦截器Interceptor"></a>15-4 拦截器Interceptor</h3><h4 id="15-4-1-介绍"><a href="#15-4-1-介绍" class="headerlink" title="15-4-1 介绍"></a>15-4-1 介绍</h4><p>是一种动态拦截方法调用的机制，类似于过滤器。Spring框架中提供的，用来动态拦截控制器方法的执行。</p>
<p>作用是拦截请求，在指定的方法调用前后，根据业务需要执行预先设定的代码。</p>
<h4 id="15-4-2-快速入门"><a href="#15-4-2-快速入门" class="headerlink" title="15-4-2 快速入门"></a>15-4-2 快速入门</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/c174b4f1-66ec-47ce-893d-ab0a0bb1d7df-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="15-4-3-执行流程"><a href="#15-4-3-执行流程" class="headerlink" title="15-4-3 执行流程"></a>15-4-3 执行流程</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/6b6ca0d3-2479-46d2-ad3e-1bf4ddf604af-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="15-4-4-拦截路径"><a href="#15-4-4-拦截路径" class="headerlink" title="15-4-4 拦截路径"></a>15-4-4 拦截路径</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/e20dd429-edd4-4b7c-bb1a-7b60fe33f968-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="15-4-5-登录校验Interceptor"><a href="#15-4-5-登录校验Interceptor" class="headerlink" title="15-4-5 登录校验Interceptor"></a>15-4-5 登录校验Interceptor</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/37844238-5a37-4169-a9dc-8bf20c4ada65-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h4 id="15-4-6-使用"><a href="#15-4-6-使用" class="headerlink" title="15-4-6 使用"></a>15-4-6 使用</h4><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下创建拦截器(config.WebConfig)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginCheckinterceptor loginCheckinterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(loginCheckinterceptor).addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下创建拦截器(interceptor.LoginCheckinterceptor)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckinterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span><span class="comment">//目标资源方法运行前运行，返回 true:放行，返回false:不放行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.获取请求 url</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> request.getRequestURL().toString();</span><br><span class="line">        log.info(<span class="string">&quot;请求的url&quot;</span>,url);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.判断请求 url 中是否包含 login，如果包含，说明是登录操作，放行</span></span><br><span class="line">        <span class="keyword">if</span>(url.contains(<span class="string">&quot;login&quot;</span>))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;登录操作，放行...&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.获取请求头中的令牌(token)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.判断令牌是否存在，如果不存在，返回错误结果(未登录)</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasLength(jwt))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;请求头token为空,返回未登录的信息&quot;</span>);</span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">            <span class="comment">//手动转换对象--json-&gt;阿里巴巴fastJSON</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">            response.getWriter().write(notLogin);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.解析token，如果解析失败，返回错误结果(未登录)</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JwtUtils.parseJwt(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception e)&#123;<span class="comment">//jwt解折失败</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            log.info(<span class="string">&quot;解析令牌失败，返回未登录错误信息&quot;</span>);</span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">            <span class="comment">//手动转换对象--json -----&gt;阿里巴巴fastJSON</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">            response.getWriter().write(notLogin);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.放行</span></span><br><span class="line">        log.info(<span class="string">&quot;令牌合法，放行&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="15-5-Filter-与-Interceptor-区别"><a href="#15-5-Filter-与-Interceptor-区别" class="headerlink" title="15-5 Filter 与 Interceptor 区别"></a>15-5 Filter 与 Interceptor 区别</h3><p>接口规范不同：过滤器需要实现Filter接口，而拦截器需要实现HandlerInterceptor接口。</p>
<p>拦截范围不同：过滤器Filter会拦截所有的资源，而拦截器Interceptor只会拦截Spring环境中的资源。</p>
<h2 id="16-异常处理"><a href="#16-异常处理" class="headerlink" title="16- 异常处理"></a>16- 异常处理</h2><h3 id="16-1-全局异常处理器"><a href="#16-1-全局异常处理器" class="headerlink" title="16-1 全局异常处理器"></a>16-1 全局异常处理器</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下创建全局异常处理器(exception.GlobalExceptionHandler)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//全局异常处理</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span><span class="comment">//捕获所有异常</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">ex</span><span class="params">(Exception ex)</span>&#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;对不起,操作失败,请联系管理员&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="17-事务管理"><a href="#17-事务管理" class="headerlink" title="17- 事务管理"></a>17- 事务管理</h2><h3 id="17-1-介绍"><a href="#17-1-介绍" class="headerlink" title="17-1 介绍"></a>17-1 介绍</h3><p>事务 是一组操作的集合，它是一个不可分割的工作单位，这些操作 要么同时成功，要么同时失败。</p>
<h3 id="17-2-操作"><a href="#17-2-操作" class="headerlink" title="17-2 操作"></a>17-2 操作</h3><p>开启事务(一组操作开始前，开启事务) : start transaction &#x2F; begin ;</p>
<p>提交事务(这组操作全部成功后，提交事务) : commit ;</p>
<p>回滚事务(中间任何一个操作出现异常，回滚事务) : rollback ;</p>
<h3 id="17-3-开启事务管理日志"><a href="#17-3-开启事务管理日志" class="headerlink" title="17-3 开启事务管理日志"></a>17-3 开启事务管理日志</h3><div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">	<span class="attr">level:</span></span><br><span class="line">		<span class="string">org.springframework.jdbc.support,jdbcTransactionManager:debug</span></span><br></pre></td></tr></table></figure></div>

<h3 id="17-4-Transactional"><a href="#17-4-Transactional" class="headerlink" title="17-4 @ Transactional"></a>17-4 @ Transactional</h3><p>位置：业务(service)层的方法上、类上、接口上。</p>
<p>作用：将当前方法交给spring进行事务管理，方法执行前，开启事务; 成功执行完毕，提交事务; 出现异常，回滚事务。</p>
<h3 id="17-5-rollbackFor属性"><a href="#17-5-rollbackFor属性" class="headerlink" title="17-5 rollbackFor属性"></a>17-5 rollbackFor属性</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/77f4b662-6bc2-48d5-b2df-0987bacac987-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="17-6-propagation属性"><a href="#17-6-propagation属性" class="headerlink" title="17-6 propagation属性"></a>17-6 propagation属性</h3><p>REQUIRED：大部分情况下都是用该传播行为即可。</p>
<p>REOUIRES_NEW：当我们不希望事务之间相互影响时，可以使用该传播行为。比如：下订单前需要记录日志，不论订单保存成功与<br>否，都需要保证日志记录能够记录成功。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/41d20ee0-7fe4-45b6-8d78-ae3bcb108af1-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="18-AOP"><a href="#18-AOP" class="headerlink" title="18- AOP"></a>18- AOP</h2><h3 id="18-1-介绍"><a href="#18-1-介绍" class="headerlink" title="18-1 介绍"></a>18-1 介绍</h3><p>Aspect Oriented Programming ( 面向切面编程、面向方面编程 ) 其实就是面向特定方法编程。</p>
<p>动态代理是面向切面编程最主流的实现。而SpringAOP是Spring框架的高级技术，旨在管理bean对象的过程中，主要通过底层的动态代理机制，对特定的方法进行编程。</p>
<h3 id="18-2-快速入门"><a href="#18-2-快速入门" class="headerlink" title="18-2 快速入门"></a>18-2 快速入门</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/a8e479c5-7b93-41f6-bffe-65a72147e5df-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="18-3-核心概念"><a href="#18-3-核心概念" class="headerlink" title="18-3 核心概念"></a>18-3 核心概念</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/a08e9362-76cc-4a5e-8d09-6c592934cf4d-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="18-4-执行流程"><a href="#18-4-执行流程" class="headerlink" title="18-4 执行流程"></a>18-4 执行流程</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/0d436b6b-ccfa-4cd9-9213-a3a3d11227c7-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="18-5-Pointcut"><a href="#18-5-Pointcut" class="headerlink" title="18-5 @ Pointcut"></a>18-5 @ Pointcut</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/ad1b5667-35d8-4448-9fb1-87baee1ef9f9-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="18-6-通知类型"><a href="#18-6-通知类型" class="headerlink" title="18-6 通知类型"></a>18-6 通知类型</h3><p>@ Around：环绕通知，此注解标注的通知方法在目标方法前、后都被执行。</p>
<p>@ Before：前置通知，此注解标注的通知方法在目标方法前被执行。</p>
<p>@ After：后置通知，此注解标注的通知方法在目标方法后被执行，无论是否有异常都会执行。</p>
<p>@ AfterReturning：返回后通知，此注解标注的通知方法在目标方法后被执行，有异常不会执行。</p>
<p>@ AfterThrowing：异常后通知，此注解标注的通知方法发生异常后执行。</p>
<ul>
<li><p>@ Around环绕通知需要自己调用 ProceedingJoinPoint.proceed ( ) 来让原始方法执行，其他通知不需要考虑目标方法执行。</p>
</li>
<li><p>@ Around环绕通知方法的返回值，必须指定为0bject，来接收原始方法的返回值。</p>
</li>
</ul>
<h3 id="18-7-通知顺序"><a href="#18-7-通知顺序" class="headerlink" title="18-7 通知顺序"></a>18-7 通知顺序</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/0b4e648a-6e1b-4288-b39c-45fc6f71c202-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="18-8-切入点表达式"><a href="#18-8-切入点表达式" class="headerlink" title="18-8 切入点表达式"></a>18-8 切入点表达式</h3><p>介绍：描述切入点方法的一种表达式。</p>
<p>作用：主要用来决定项目中的哪些方法需要加入通知。</p>
<p>常见形式：</p>
<ul>
<li>execution (……)：根据方法的签名来匹配。</li>
<li>@ annotation (……)：根据注解匹配。</li>
</ul>
<h3 id="18-9-切入点表达式-execution"><a href="#18-9-切入点表达式-execution" class="headerlink" title="18-9 切入点表达式-execution"></a>18-9 切入点表达式-execution</h3><p>语法：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/16e2c4d8-a11d-42db-8448-f7386e5b55ac-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>使用：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/e7527c65-156b-4dd4-849c-49c0438925de-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="18-10-切入点表达式-annotation"><a href="#18-10-切入点表达式-annotation" class="headerlink" title="18-10 切入点表达式-@ annotation"></a>18-10 切入点表达式-@ annotation</h3><p>语法：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下创建(aop.MyLog)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy .RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType .METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyLog&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在main.java.com.lrq下的Serviceimpl使用</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XinxiServiceimpl</span> <span class="keyword">implements</span> <span class="title class_">XinxiService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span><span class="comment">//注入</span></span><br><span class="line">    <span class="keyword">private</span> XinxiMapper xinxiMapper;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@MyLog</span></span><br><span class="line">    <span class="meta">@Override</span><span class="comment">//添加信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Xinxi xinxi)</span> &#123;</span><br><span class="line">        xinxiMapper.insert(xinxi);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@MyLog</span></span><br><span class="line">    <span class="meta">@Override</span><span class="comment">//显示全部信息</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Xinxi&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> xinxiMapper.list();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>使用：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/d186cba8-aad2-41ad-bda3-2c108355ca5e-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="18-11-连接点"><a href="#18-11-连接点" class="headerlink" title="18-11 连接点"></a>18-11 连接点</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/f0f67219-cf6b-4bb9-90df-80170591e8c6-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/46dd89c7-d565-4ad6-bb9e-c30e2929b057-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
<h2 id="19-配置"><a href="#19-配置" class="headerlink" title="19- 配置"></a>19- 配置</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/504ca202-32e5-4a91-afeb-d049d211e54f-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/4c42eab8-71a9-402d-bbfa-d8653da55b54-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/99260fd9-71bd-4acb-adfe-8e2d331bfa8a-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
<h2 id="20-Bean管理"><a href="#20-Bean管理" class="headerlink" title="20- Bean管理"></a>20- Bean管理</h2><h3 id="20-1-bean的获取"><a href="#20-1-bean的获取" class="headerlink" title="20-1 bean的获取"></a>20-1 bean的获取</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/71b7a89b-cbea-494b-a644-2bef5e091f13-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="20-2-bean的作用域"><a href="#20-2-bean的作用域" class="headerlink" title="20-2 bean的作用域"></a>20-2 bean的作用域</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/31765a9f-eb09-47e5-b9e6-97ea7c19c444-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/f177cc0e-7322-410e-b421-67b39498d848-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
<h3 id="20-3-第三方bean"><a href="#20-3-第三方bean" class="headerlink" title="20-3 第三方bean"></a>20-3 第三方bean</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/62f714d4-aea6-47d4-bf07-8947fa351f5a-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="21-SpringBoot原理"><a href="#21-SpringBoot原理" class="headerlink" title="21- SpringBoot原理"></a>21- SpringBoot原理</h2><h3 id="21-1-起步依赖"><a href="#21-1-起步依赖" class="headerlink" title="21-1 起步依赖"></a>21-1 起步依赖</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/9dd9ac26-c393-4b80-9f37-da04b0eac02e-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="21-2-自动配置"><a href="#21-2-自动配置" class="headerlink" title="21-2 自动配置"></a>21-2 自动配置</h3><h4 id="21-2-1-介绍"><a href="#21-2-1-介绍" class="headerlink" title="21-2-1 介绍"></a>21-2-1 介绍</h4><p>SpringBoot的自动配置就是当spring容器启动后，一些配置类、bean对象就自动存入到了IOC容器中，不需要我们手动去声明，从而简化了开发，省去了繁琐的配置操作。</p>
<h4 id="21-2-2-原理"><a href="#21-2-2-原理" class="headerlink" title="21-2-2 原理"></a>21-2-2 原理</h4><p>启动类：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/ba053a17-eccd-4c67-9be2-534e92b4e7f9-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>启动类：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/2d32d3f9-1ee2-41b2-889d-0b28d1f18302-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>源码跟踪：</p>
<ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/ff098535-37bc-4dd2-829f-f9b4690d386b-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/feb7c20d-0e97-49c7-9e02-f7e71ff63a97-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
<p>@ conditional：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/81e5d8cd-5ea3-4dfb-a65c-6b2f1c0ee6ef-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="21-3-自定义starter"><a href="#21-3-自定义starter" class="headerlink" title="21-3 自定义starter"></a>21-3 自定义starter</h3><p>在实际开发中，经常会定义一些公共组件，提供给各个项目团队使用。而在SpringBoot的项目中，一般会将这些公共组件封装为SpringBoot 的 starter。</p>
<p>SpringBoot官方的starter以spring-boot开头，其它技术提供的starter以功能开头。</p>
]]></content>
      <categories>
        <category>Web</category>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>自研笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>Python</title>
    <url>/2024/04/07/Python/</url>
    <content><![CDATA[<h1 id="1-基础"><a href="#1-基础" class="headerlink" title="1- 基础"></a>1- 基础</h1><h2 id="1-1-注释"><a href="#1-1-注释" class="headerlink" title="1-1 注释"></a>1-1 注释</h2><p>单行注释：</p>
<ul>
<li># 注释内容</li>
</ul>
<p>多行注释：</p>
<ul>
<li>“” “注释内容” “”</li>
</ul>
<h2 id="1-2-变量"><a href="#1-2-变量" class="headerlink" title="1-2 变量"></a>1-2 变量</h2><p>组成：</p>
<ul>
<li>标识（id）类型（type）值（print）</li>
</ul>
<p>注意：</p>
<ul>
<li>当多次赋值之后，变量名会指向新的空间。</li>
<li>变量没有类型，但变量存储的数据有类型。</li>
<li>函数内定义的局部变量声明为全局变量，前面加global。</li>
</ul>
<h2 id="1-3-输入输出函数"><a href="#1-3-输入输出函数" class="headerlink" title="1-3 输入输出函数"></a>1-3 输入输出函数</h2><p>input ( )：</p>
<ul>
<li>输入函数，在下框输入。</li>
<li>默认接收的数据都是字符串类型。</li>
</ul>
<p>print ( )：</p>
<ul>
<li><p>输出的内容可以是数字、字符串（要括起来）、含有运算符的表达式 （不括起来，输出表达式的值；反之，原样输出）。</p>
</li>
<li><p>输出的形式可以是换行、不换行（后面加上end&#x3D;’ ‘）。</p>
</li>
</ul>
<h2 id="1-4-标识符"><a href="#1-4-标识符" class="headerlink" title="1-4 标识符"></a>1-4 标识符</h2><p>变量、函数、方法、类、其他对象起的名字。</p>
<p>由字母、数字、下划线组成，数字不能开头。</p>
<p>严格区分大小写。</p>
<p>不能是关键字。</p>
<h2 id="1-5-转义字符"><a href="#1-5-转义字符" class="headerlink" title="1-5 转义字符"></a>1-5 转义字符</h2><p>换行：\n 。</p>
<p>回车：\r（用后面的内容覆盖前面的）。</p>
<p>制表符：\t（四个字符为一个单元，用空格补全单元空格）。</p>
<p>退格：\b（把紧邻的前一个字符退没）。</p>
<p>不希望转义字符起作用，可以在字符串前加 r或R。</p>
<h2 id="1-6-运算符"><a href="#1-6-运算符" class="headerlink" title="1-6 运算符"></a>1-6 运算符</h2><h3 id="1-6-1-优先级（由高到底）"><a href="#1-6-1-优先级（由高到底）" class="headerlink" title="1-6-1 优先级（由高到底）"></a>1-6-1 优先级（由高到底）</h3><p>( * * ) - ( *、&#x2F;、&#x2F;&#x2F;、% ) - ( +、- ) - ( &lt;&lt;、&gt;&gt; ) - ( &amp; ) - ( I ) - ( &gt;、&lt;、&gt;&#x3D;、&lt;&#x3D;、&#x3D;&#x3D;、!&#x3D; ) - ( and ) - ( or ) - ( &#x3D; )</p>
<h3 id="1-6-2-算数运算符"><a href="#1-6-2-算数运算符" class="headerlink" title="1-6-2 算数运算符"></a>1-6-2 算数运算符</h3><p>+（加）、-（减）、*（乘）、&#x2F;（除）、&#x2F;&#x2F;（整除）、%（取余）、**（指数）。</p>
<h3 id="1-6-3-赋值运算符"><a href="#1-6-3-赋值运算符" class="headerlink" title="1-6-3 赋值运算符"></a>1-6-3 赋值运算符</h3><p>把 &#x3D; 右边的值赋给左边的变量。</p>
<p>支持复合赋值运算符+&#x3D;、-&#x3D;、*&#x3D;、&#x2F;&#x3D;、&#x2F;&#x2F;&#x3D;、%&#x3D;、**&#x3D; 。</p>
<p>支持链式赋值，a&#x3D;b&#x3D;c&#x3D;20 。</p>
<p>支持系列解包赋值，a,b,c&#x3D;20,30,40，变量的个数和值的个数要对应。</p>
<h3 id="1-6-4-比较运算符"><a href="#1-6-4-比较运算符" class="headerlink" title="1-6-4 比较运算符"></a>1-6-4 比较运算符</h3><p>&gt;、&lt;、&gt;&#x3D;、&lt;&#x3D;、!&#x3D;、&#x3D;&#x3D; 。</p>
<p>&#x3D;&#x3D; 是对象value的比较，is、is not 是对象id的比较。</p>
<p>结果是bool类型。</p>
<h3 id="1-6-5-布尔运算符"><a href="#1-6-5-布尔运算符" class="headerlink" title="1-6-5 布尔运算符"></a>1-6-5 布尔运算符</h3><p>and：全真为真，一假为假；or：全假为假，一真为真。</p>
<p>not：取反，真变假，假变真。</p>
<p>in、not  in：在不在其中。</p>
<h3 id="1-6-6-位运算符"><a href="#1-6-6-位运算符" class="headerlink" title="1-6-6 位运算符"></a>1-6-6 位运算符</h3><p>先转换为二进制。</p>
<p>&amp;（位与）：对应数位都为1，结果数位为1。</p>
<p>I（位或）：对应数位都为0，结果数位为0。</p>
<p>&lt;&lt;（左移）：高位溢出舍弃，低位补0。</p>
<p>&gt;&gt;（右移）：低位溢出舍弃，高位补0。</p>
<h2 id="1-7-数据类型"><a href="#1-7-数据类型" class="headerlink" title="1-7 数据类型"></a>1-7 数据类型</h2><h3 id="1-7-1-类型转换"><a href="#1-7-1-类型转换" class="headerlink" title="1-7-1 类型转换"></a>1-7-1 类型转换</h3><p>int 转 float 时末尾加 .0。</p>
<p>float 转 int 时只截取整数部分。</p>
<p>str 转 int、float ，字符串必须是数字串，否则不允许转换。</p>
<h3 id="1-7-2-整数类型（int）"><a href="#1-7-2-整数类型（int）" class="headerlink" title="1-7-2 整数类型（int）"></a>1-7-2 整数类型（int）</h3><p>可以表示正数、负数、零。</p>
<p>二进制：以0b开头，内置函数bin ( ) 。</p>
<p>八进制：以0o开头，内置函数oct ( ) 。</p>
<p>十进制：以0x开头,内置函数hex ( ) 。</p>
<h3 id="1-7-3-浮点数类型（float）"><a href="#1-7-3-浮点数类型（float）" class="headerlink" title="1-7-3 浮点数类型（float）"></a>1-7-3 浮点数类型（float）</h3><p>由整数部分和小数部分组成。</p>
<p>浮点数储存不精确时，导入模块decimal。</p>
<ul>
<li>form  decimal  import  Decimal    </li>
<li>print(Decimal(‘ ‘)+Decimal(‘ ‘))</li>
</ul>
<h3 id="1-7-4-布尔类型（bool）"><a href="#1-7-4-布尔类型（bool）" class="headerlink" title="1-7-4 布尔类型（bool）"></a>1-7-4 布尔类型（bool）</h3><p>真 - True - 1；假 - False - 0 。</p>
<h3 id="1-7-5-字符串类型（str）"><a href="#1-7-5-字符串类型（str）" class="headerlink" title="1-7-5 字符串类型（str）"></a>1-7-5 字符串类型（str）</h3><p>定义：</p>
<ul>
<li>单引号或双引号定义在一行，而三引号定义可以换行。</li>
<li>引号的嵌套：<ul>
<li>可以用 \ 进行转义。</li>
<li>单引号内可以写双引号，双引号内可以写单引号。</li>
</ul>
</li>
</ul>
<p>拼接：</p>
<ul>
<li>使用 + 连接字符串变量或字符串字面量</li>
</ul>
<p>格式化：</p>
<ul>
<li>“%占位符” % 变量</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#如下代码，完成字符串、整数、浮点数，三种不同类型变量的占位</span></span><br><span class="line"></span><br><span class="line">name = <span class="string">&quot;传智播客”</span></span><br><span class="line"><span class="string">set_up_year = 2006</span></span><br><span class="line"><span class="string">stock_price = 19.99</span></span><br><span class="line"><span class="string">message = &quot;</span>我是:%s，我成立于:%d，我今天的股价是:%<span class="string">f&quot; % (name，set_up_year，stock_price)</span></span><br><span class="line"><span class="string">print(message)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#我是:传智播客，我成立于:2006，我今天的股价是:19.990000</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>数字精度控制</li>
</ul>
<p>我们可以使用辅助符号 “m.n” 来控制数据的宽度和精度</p>
<p>m，控制宽度，要求是数字（很少使用），设置的宽度小于数字自身，不生效。</p>
<p>.n，控制小数点精度，要求是数字，会进行小数的四舍五入。</p>
<ul>
<li>f”内容{变量}” 的格式来快速格式化</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">name = <span class="string">&quot;传智播客”</span></span><br><span class="line"><span class="string">set_up_year = 2006</span></span><br><span class="line"><span class="string">stock_price = 19.99</span></span><br><span class="line"><span class="string">print(f&quot;</span>我是:&#123;name&#125;，我成立于:&#123;set_up_year&#125;，我今天的股票价格是:&#123;stock_price&#125;<span class="string">&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#我是:传智播客，我成立于:2006，我今天的股价是:19.99(不做精度控制，原样输出)</span></span><br></pre></td></tr></table></figure></div>

<h1 id="2-顺序结构"><a href="#2-顺序结构" class="headerlink" title="2- 顺序结构"></a>2- 顺序结构</h1><p>程序从上到下执行，中间没有判断和跳转，直到结束。</p>
<h1 id="3-选择结构"><a href="#3-选择结构" class="headerlink" title="3- 选择结构"></a>3- 选择结构</h1><p>语法：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240407163757455.png"
                      alt="image-20240407163757455"
                ></p>
<p>实例：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入你的身高(cm):&quot;</span>)) &lt; <span class="number">120</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;身高小于120cm，可以免费。&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入你的VIP等级(1-5):&quot;</span>)) &gt;<span class="number">3</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;vip级别大于3，可以免费。&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请告诉我今天几号:&quot;</span>)) == <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;今天是1号免费日，可以免费。&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;不好意思，条件都不满足。&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#请输入你的身高(cm):130</span></span><br><span class="line"><span class="comment">#请输入你的VIP等级(1-5):5</span></span><br><span class="line"><span class="comment">#vip级别大于3，可以免费。</span></span><br></pre></td></tr></table></figure></div>

<h1 id="4-循环结构"><a href="#4-循环结构" class="headerlink" title="4- 循环结构"></a>4- 循环结构</h1><p>语法：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240407164255420.png"
                      alt="image-20240407164255420"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240407164359042.png"
                      alt="image-20240407164359042"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240407164407701.png"
                      alt="image-20240407164407701"
                ></p>
<p>实例（九九乘法表）：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#通过外层循环控制行数</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">	<span class="comment">#通过内层循环控制每一行的数据</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,i + <span class="number">1</span>):</span><br><span class="line">        <span class="comment">#在内层循环中输出每一行的内容</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;j&#125;</span> * <span class="subst">&#123;i&#125;</span> = <span class="subst">&#123;j * i&#125;</span>\t&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># 外层循环可以通过print输出一个回车符</span></span><br><span class="line"><span class="built_in">print</span>()</span><br></pre></td></tr></table></figure></div>

<h1 id="5-数据容器"><a href="#5-数据容器" class="headerlink" title="5- 数据容器"></a>5- 数据容器</h1><h2 id="5-1-内容"><a href="#5-1-内容" class="headerlink" title="5-1 内容"></a>5-1 内容</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240407170317626.png"
                      alt="image-20240407170317626"
                ></p>
<h2 id="5-2-方法"><a href="#5-2-方法" class="headerlink" title="5-2 方法"></a>5-2 方法</h2><p>max（容器）：统计容器的最大元素。</p>
<p>min（容器）：统计容器的最小元素。</p>
<p>len（容器）：统计容器的元素数量。</p>
<p>list（容器）：将给定容器转换为列表。</p>
<p>tuple（容器）：将给定容器转换为元组。</p>
<p>str（容器）：将给定容器转换为字符串。</p>
<p>set（容器）：将给定容器转换为集合。</p>
<p>sorted（容器, [reverse&#x3D;True]）：如果没有[reverse&#x3D;True]，正序排序；若有则反序排序。</p>
<h1 id="6-序列切片"><a href="#6-序列切片" class="headerlink" title="6- 序列切片"></a>6- 序列切片</h1><h2 id="6-1-内容"><a href="#6-1-内容" class="headerlink" title="6-1 内容"></a>6-1 内容</h2><p>介绍：</p>
<ul>
<li><p>序列支持切片，即：列表、元组、字符串，均支持进行切片操作。</p>
</li>
<li><p>切片：从一个序列中，取出一个子序列。</p>
</li>
</ul>
<p>语法：</p>
<ul>
<li>序列 [ 起始下标 : 结束下标 : 步长 ]。</li>
<li>表示从序列中，从指定位置开始，依次取出元素，到指定位置结束，得到一个新序列：<ul>
<li>起始下标表示从何处开始，可以留空，留空视作从头开始。</li>
<li>结束下标（不含）表示何处结束，可以留空，留空视作截取到结尾。</li>
<li>步长表示，依次取元素的间隔：<ul>
<li>步长1表示，一个个取元素。</li>
<li>步长2表示，每次跳过1个元素取。</li>
<li>步长N表示，每次跳过N-1个元素取。</li>
<li>步长为负数表示，反向取（注意，起始下标和结束下标也要反向标记）。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="6-2-实例"><a href="#6-2-实例" class="headerlink" title="6-2 实例"></a>6-2 实例</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#对tuple进行切片，从头开始，到最后结束，步长1</span></span><br><span class="line">my_tuple = (<span class="number">0</span>，<span class="number">1</span>，<span class="number">2</span>，<span class="number">3</span>，<span class="number">4</span>，<span class="number">5</span>，<span class="number">6</span>)</span><br><span class="line">result1 = my_tuple[:] <span class="comment">#起始和结束不写表示从头到尾，步长为1可以省略</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;结果1:<span class="subst">&#123;result1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment">#(0,1,2,3,4,5,6)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对str进行切片，从头开始，到最后结束，步长-1</span></span><br><span class="line">my_str = <span class="string">&quot;01234567&quot;</span></span><br><span class="line">result2 = my_str[::-<span class="number">1</span>] <span class="comment">#等同于将序列反转了</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;结果2:<span class="subst">&#123;result2&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment">#76543210</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对列表进行切片，从3开始、到1结束，步长-1</span></span><br><span class="line">my_list = [<span class="number">0</span>，<span class="number">1</span>，<span class="number">2</span>，<span class="number">3</span>，<span class="number">4</span>，<span class="number">5</span>，<span class="number">6</span>]</span><br><span class="line">result3 = my_list[<span class="number">3</span>:<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;结果3:<span class="subst">&#123;result3&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment">#[3,2]</span></span><br><span class="line"></span><br><span class="line">my_str = <span class="string">&quot;万过薪月，员序程马黑来，nohtyP学&quot;</span></span><br><span class="line"><span class="comment"># 倒序字符申，切片取出</span></span><br><span class="line">result1 = my_str[::-<span class="number">1</span>][<span class="number">9</span>:<span class="number">14</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;方式1结果:<span class="subst">&#123;result1&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切片取出，然后倒序</span></span><br><span class="line">result2 = my_str[<span class="number">5</span>:<span class="number">10</span>][::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;方式2结果:<span class="subst">&#123;result2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># split分隔&quot;，&quot; replace替换&quot;来”为空，倒序字符串</span></span><br><span class="line">result3 = my_str.split(<span class="string">&quot;，&quot;</span>)[<span class="number">1</span>].replace(<span class="string">&quot;来&quot;</span>，<span class="string">&quot;&quot;</span>)[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;方式3结果:<span class="subst">&#123;result3&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#都得到：黑马程序员</span></span><br></pre></td></tr></table></figure></div>

<h1 id="7-列表（list）"><a href="#7-列表（list）" class="headerlink" title="7- 列表（list）"></a>7- 列表（list）</h1><h2 id="7-1-创建"><a href="#7-1-创建" class="headerlink" title="7-1 创建"></a>7-1 创建</h2><p>语法：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">（1）</span><br><span class="line">[ 元素1, 元素2, ...... ] </span><br><span class="line">（2）</span><br><span class="line">list ([ 元素1, 元素2, ...... ]) </span><br></pre></td></tr></table></figure></div>

<p>元素间用英文逗号隔开。</p>
<p>元素的数据类型没有限制，也可以是列表。</p>
<h2 id="7-2-查"><a href="#7-2-查" class="headerlink" title="7-2 查"></a>7-2 查</h2><p>列表 .index ( 元素 )</p>
<ul>
<li>查找某元素下标。</li>
<li>如果有n个相同元素，只返回第一个元素的下标。如果元素不存在，会抛出 ValueError。</li>
</ul>
<p>列表 [ 下标 ] [ 下标 ]</p>
<ul>
<li>查找某元素。</li>
<li>下标索引：正向从0到n-1，逆向从-n到-1。索引不存在抛出 IndexError。</li>
</ul>
<h2 id="7-3-改"><a href="#7-3-改" class="headerlink" title="7-3 改"></a>7-3 改</h2><p>列表 [ 下标 ] &#x3D; 值</p>
<ul>
<li>将指定位置元素的值修改。</li>
</ul>
<h2 id="7-4-增"><a href="#7-4-增" class="headerlink" title="7-4 增"></a>7-4 增</h2><p>列表 .insert ( 下标, 元素 )</p>
<ul>
<li>在指定位置插入一个元素。</li>
</ul>
<p>列表 .append ( 元素 )</p>
<ul>
<li>在尾部追加一个元素。</li>
</ul>
<p>列表 .extend ( 其他数据容器 )</p>
<ul>
<li>将其他数据容器的内容取出，依次追加到尾部。</li>
</ul>
<h2 id="7-5-删"><a href="#7-5-删" class="headerlink" title="7-5 删"></a>7-5 删</h2><p>del 列表 [ 下标 ]</p>
<ul>
<li>将指定位置的元素删除。</li>
</ul>
<p>列表 .pop ( 下标 )</p>
<ul>
<li>删除指定位置元素，还可将删除元素作为返回值得到。若不指定，则删除最后一个元素。索引不存在抛出 IndexError。</li>
</ul>
<p>列表 .remove ( 元素 )</p>
<ul>
<li>一次删除一个指定元素，重复元素只删除第一个。元素不存在抛出ValueError。</li>
</ul>
<p>列表 .clear ( )</p>
<ul>
<li>清空列表内容。</li>
</ul>
<h2 id="7-6-其他方法"><a href="#7-6-其他方法" class="headerlink" title="7-6 其他方法"></a>7-6 其他方法</h2><p>列表 .count ( 元素 )</p>
<ul>
<li>统计某元素在列表内的数量。</li>
</ul>
<p>列表 .sort ( )</p>
<ul>
<li>列表内元素默认从小到大排序。</li>
<li>可以指定reverse&#x3D;True进行降序排序。</li>
</ul>
<p>sorted ( 列表 )</p>
<ul>
<li>默认从小到大排序。</li>
<li>可指定reverse&#x3D;True进行降序排序。原列表不发生变化。</li>
</ul>
<h2 id="7-7-遍历"><a href="#7-7-遍历" class="headerlink" title="7-7 遍历"></a>7-7 遍历</h2><p>语法：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">（1）</span><br><span class="line">for 临时变量 in 数据容器:</span><br><span class="line">	对临时变量进行处理</span><br><span class="line"></span><br><span class="line">（2）</span><br><span class="line">index = 0</span><br><span class="line">while index &lt; len(列表):</span><br><span class="line">	元素 = 列表[index]</span><br><span class="line">	对元素进行处理</span><br><span class="line">	index += 1</span><br></pre></td></tr></table></figure></div>

<h1 id="8-元组（tuple）"><a href="#8-元组（tuple）" class="headerlink" title="8- 元组（tuple）"></a>8- 元组（tuple）</h1><h2 id="8-1-创建"><a href="#8-1-创建" class="headerlink" title="8-1 创建"></a>8-1 创建</h2><p>语法：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">（1）</span><br><span class="line">( 元素1, 元素2, ...... )</span><br><span class="line">（2）</span><br><span class="line">tuple (( 元素1, 元素2, ...... ))</span><br></pre></td></tr></table></figure></div>

<p>元组只有一个元素，要在其后面加上逗号。</p>
<p>元素的数据类型没有限制，可以是元组。</p>
<h2 id="8-2-特性"><a href="#8-2-特性" class="headerlink" title="8-2 特性"></a>8-2 特性</h2><p>不可修改。</p>
<p>但可以修改元组中 list ( ) 内部的内容。</p>
<h2 id="8-3-方法"><a href="#8-3-方法" class="headerlink" title="8-3 方法"></a>8-3 方法</h2><p>元组 [ 下标 ] [ 下标 ]</p>
<ul>
<li>查找某元素。</li>
</ul>
<p>元组 .index ( 元素 )</p>
<ul>
<li>查找某元素的下标。</li>
</ul>
<p>元组 .count ( 元素 )</p>
<ul>
<li>统计某元素在元组中的数量。</li>
</ul>
<h2 id="8-4-遍历"><a href="#8-4-遍历" class="headerlink" title="8-4 遍历"></a>8-4 遍历</h2><p>语法：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">（1）</span><br><span class="line">for 临时变量 in 数据容器:</span><br><span class="line">	对临时变量进行处理</span><br><span class="line"></span><br><span class="line">（2）</span><br><span class="line">index = 0</span><br><span class="line">while index &lt; len(列表):</span><br><span class="line">	元素 = 列表[index]</span><br><span class="line">	对元素进行处理</span><br><span class="line">	index += 1</span><br></pre></td></tr></table></figure></div>

<h1 id="9-字符串（str）"><a href="#9-字符串（str）" class="headerlink" title="9- 字符串（str）"></a>9- 字符串（str）</h1><h2 id="9-1-特性"><a href="#9-1-特性" class="headerlink" title="9-1 特性"></a>9-1 特性</h2><p>不可修改。</p>
<h2 id="9-2-查"><a href="#9-2-查" class="headerlink" title="9-2 查"></a>9-2 查</h2><p>字符串 [ 下标 ] [ 下标 ]</p>
<ul>
<li>查找某元素。</li>
</ul>
<p>字符串 .index ( 子串 )</p>
<ul>
<li>查找子串第一次出现位置，无则抛出ValueError。</li>
</ul>
<p>字符串 .rindex ( 子串 )</p>
<ul>
<li>查找子串最后一次出现位置，无则抛出ValueError。</li>
</ul>
<p>字符串 .find ( 子串 )</p>
<ul>
<li>查找子串第一次出现位置，无则返回-1。</li>
</ul>
<p>字符串 .rfind ( 子串 )</p>
<ul>
<li>查找子串最后一次出现位置，无则返回-1。</li>
</ul>
<h2 id="9-3-改"><a href="#9-3-改" class="headerlink" title="9-3 改"></a>9-3 改</h2><p>字符串 .replace ( 字符串1, 字符串2, 数字 )</p>
<ul>
<li>数字是字符串2替换字符串1的个数，若没有则全部替换。</li>
<li>不是修改字符串本身，而是得到新字符串。</li>
</ul>
<h2 id="9-4-分割"><a href="#9-4-分割" class="headerlink" title="9-4 分割"></a>9-4 分割</h2><p>字符串 .split ( sep&#x3D;’分隔符字符串’, maxsplit&#x3D;数字 )</p>
<ul>
<li>按照指定的分隔符字符串将字符串划分为多个字符串，并存入列表对象中。</li>
<li>数字是最大劈分次数，没有则全部劈分。</li>
<li>字符串本身不变，而是得到了一个列表对象。</li>
</ul>
<h2 id="9-5-规整"><a href="#9-5-规整" class="headerlink" title="9-5 规整"></a>9-5 规整</h2><p>字符串. strip ( )</p>
<ul>
<li>去前后空格</li>
</ul>
<p>字符串 .strip ( 字符串 )</p>
<ul>
<li>去前后指定字符串</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">my_str = <span class="string">&quot; itheima and itcast &quot;</span></span><br><span class="line"><span class="built_in">print</span>(my_str.strip())</span><br><span class="line"><span class="comment">#结果:&quot;itheima and itcast&quot;</span></span><br><span class="line"></span><br><span class="line">my_str = <span class="string">&quot;12itheima and itcast21&quot;</span></span><br><span class="line"><span class="built_in">print</span>(my_str.strip(<span class="string">&quot;12&quot;</span>))</span><br><span class="line"><span class="comment">#结果:&quot;itheima and itcast&quot;</span></span><br><span class="line"><span class="comment">#注意，传入的是&quot;12&quot;,其实就是:&quot;1&quot;和&quot;2&quot;都会移除，是按照单个字符。</span></span><br></pre></td></tr></table></figure></div>

<h2 id="9-6-比较"><a href="#9-6-比较" class="headerlink" title="9-6 比较"></a>9-6 比较</h2><p>字符串是按位比较，只要有一位大，整体都大。</p>
<h2 id="9-7-其他方法"><a href="#9-7-其他方法" class="headerlink" title="9-7 其他方法"></a>9-7 其他方法</h2><p>字符串 .count ( 子串 )</p>
<ul>
<li>子串在字符串的个数。</li>
</ul>
<h2 id="9-8-遍历"><a href="#9-8-遍历" class="headerlink" title="9-8 遍历"></a>9-8 遍历</h2><p>语法：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">（1）</span><br><span class="line">for 临时变量 in 数据容器:</span><br><span class="line">	对临时变量进行处理</span><br><span class="line"></span><br><span class="line">（2）</span><br><span class="line">index = 0</span><br><span class="line">while index &lt; len(列表):</span><br><span class="line">	元素 = 列表[index]</span><br><span class="line">	对元素进行处理</span><br><span class="line">	index += 1</span><br></pre></td></tr></table></figure></div>

<h1 id="10-集合（set）"><a href="#10-集合（set）" class="headerlink" title="10- 集合（set）"></a>10- 集合（set）</h1><h2 id="10-1-创建"><a href="#10-1-创建" class="headerlink" title="10-1 创建"></a>10-1 创建</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">（1）</span><br><span class="line">&#123;元素1, 元素2, ......&#125;</span><br><span class="line">（2）</span><br><span class="line">set (&#123; 元素1, 元素2, ...... &#125;)</span><br></pre></td></tr></table></figure></div>

<p>集合中的元素不允许重复。</p>
<p>集合是无序的。</p>
<h2 id="10-2-增"><a href="#10-2-增" class="headerlink" title="10-2 增"></a>10-2 增</h2><p>集合 .add ( 元素 )</p>
<ul>
<li>一次添加一个元素。</li>
</ul>
<p>集合 .update ( 集合 )</p>
<ul>
<li>一次至少添加一个元素。</li>
</ul>
<h2 id="10-3-删"><a href="#10-3-删" class="headerlink" title="10-3 删"></a>10-3 删</h2><p>集合 .remove ( 元素 )</p>
<ul>
<li>一次删除一个元素，无则抛出KeyError。</li>
</ul>
<p>集合 .discard ( 元素 )</p>
<ul>
<li>一次删除一个元素，无不抛出异常。</li>
</ul>
<p>集合 .pop ( )</p>
<ul>
<li>从集合中随机取出一个元素。</li>
</ul>
<p>集合 .clear ( )</p>
<ul>
<li>清空集合。</li>
</ul>
<h2 id="10-4-关系"><a href="#10-4-关系" class="headerlink" title="10-4 关系"></a>10-4 关系</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">s1=&#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>,<span class="number">60</span>&#125;</span><br><span class="line">s2=&#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>&#125;</span><br><span class="line">s3=&#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">90</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#一个集合是否是另一个集合的子集</span></span><br><span class="line"><span class="built_in">print</span>(s2.issubset(s1))<span class="comment">#True</span></span><br><span class="line"><span class="built_in">print</span>(s3.issubset(s1))<span class="comment">#False</span></span><br><span class="line"><span class="comment">#一个集合是否是另一个集合的超集</span></span><br><span class="line"><span class="built_in">print</span>(s1.issuperset(s2))<span class="comment">#True</span></span><br><span class="line"><span class="built_in">print</span>(s1.issuperset(s3))<span class="comment">#False</span></span><br><span class="line"><span class="comment">#两个集合是否含有交集</span></span><br><span class="line"><span class="built_in">print</span>(s2.isdisjoint(s3))<span class="comment">#False</span></span><br></pre></td></tr></table></figure></div>

<h2 id="10-5-数学操作"><a href="#10-5-数学操作" class="headerlink" title="10-5 数学操作"></a>10-5 数学操作</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#交并集</span></span><br><span class="line">s1=&#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>&#125;</span><br><span class="line">s2=&#123;<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>,<span class="number">60</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sl.intersection(s2))</span><br><span class="line"><span class="built_in">print</span>(s1 &amp; s2)</span><br><span class="line"><span class="comment">#intersection()与&amp;等价，交集操作</span></span><br><span class="line"><span class="comment">#交：&#123;40,20,30&#125; </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s1.union(s2))</span><br><span class="line"><span class="built_in">print</span>(s1 | s2)</span><br><span class="line"><span class="comment">#union()与|等价，并集操作</span></span><br><span class="line"><span class="comment">#并：&#123;10,20,30,40,50,60&#125;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#取出2个集合的差集</span></span><br><span class="line"><span class="comment">#语法:集合1.difference(集合2)</span></span><br><span class="line"><span class="comment">#功能:取出集合1和集合2的差集(集合1有而集合2没有的)</span></span><br><span class="line"><span class="comment">#结果:得到一个新集合，集合1和集合2不变</span></span><br><span class="line"></span><br><span class="line">set1=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">set2=&#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>&#125;</span><br><span class="line">set3 = setl.difference(set2) </span><br><span class="line"><span class="built_in">print</span>(set3) <span class="comment">#结果:&#123;2，3&#125;</span></span><br><span class="line"><span class="built_in">print</span>(set1) <span class="comment">#结果:&#123;1，2，3&#125;不变</span></span><br><span class="line"><span class="built_in">print</span>(set2) <span class="comment">#结果:&#123;1，5，6&#125;不变</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#消除2个集合的差集</span></span><br><span class="line"><span class="comment">#语法:集合1.difference_update(集合2)</span></span><br><span class="line"><span class="comment">#功能:对比集合1和集合2，在集合1内，删除和集合2相同的元素</span></span><br><span class="line"><span class="comment">#结果:集合1被修改，集合2不变</span></span><br><span class="line"></span><br><span class="line">set1=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">set2=&#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>&#125;</span><br><span class="line">set1.difference_update(set2)</span><br><span class="line"><span class="built_in">print</span>(set1) <span class="comment">#结果:&#123;2，3&#125;</span></span><br><span class="line"><span class="built_in">print</span>(set2) <span class="comment">#结果:&#123;1，5，6&#125;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#对称差集</span></span><br><span class="line"></span><br><span class="line">s1=&#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>&#125;</span><br><span class="line">s2=&#123;<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>,<span class="number">60</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(sl.symmetric_difference(s2))</span><br><span class="line"><span class="built_in">print</span>(s1 ^ s2) <span class="comment">#&#123;50,10,60&#125;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="10-6-其他方法"><a href="#10-6-其他方法" class="headerlink" title="10-6 其他方法"></a>10-6 其他方法</h2><p>元素  in&#x2F;not  in  集合</p>
<ul>
<li>判断元素在不在集合中。</li>
</ul>
<h2 id="10-7-遍历"><a href="#10-7-遍历" class="headerlink" title="10-7 遍历"></a>10-7 遍历</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#集合不支持下标索引，不能用while循环</span></span><br><span class="line"><span class="comment">#可以用for循环</span></span><br><span class="line"></span><br><span class="line">set1=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> set1:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;集合的元素有:<span class="subst">&#123;element&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<h1 id="11-字典（dict）"><a href="#11-字典（dict）" class="headerlink" title="11- 字典（dict）"></a>11- 字典（dict）</h1><h2 id="11-1-创建"><a href="#11-1-创建" class="headerlink" title="11-1 创建"></a>11-1 创建</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">（1）</span><br><span class="line">&#123; key1:value1, key2:value2, ...... &#125;</span><br><span class="line">（2）</span><br><span class="line">dict (&#123; key1:value1, key2:value2, ...... &#125;)</span><br></pre></td></tr></table></figure></div>

<p>字典中的 key 不可重复，若重复后面的将覆盖前面的。</p>
<p>字典是无序的。</p>
<p>字典的 value 可以是任意数据类型，而 key 只能为不可变数据类型。</p>
<h2 id="11-2-查"><a href="#11-2-查" class="headerlink" title="11-2 查"></a>11-2 查</h2><p>字典 [ key ]</p>
<ul>
<li>通过 key 值获得对应的 value 。</li>
</ul>
<p>字典 .keys ( )</p>
<ul>
<li>得到字典中的全部 key 。</li>
</ul>
<p>字典 .values ( )</p>
<ul>
<li>得到字典中的全部 value 。</li>
</ul>
<h2 id="11-3-增-改"><a href="#11-3-增-改" class="headerlink" title="11-3 增&#x2F;改"></a>11-3 增&#x2F;改</h2><p>字典 [ key ] &#x3D; value</p>
<ul>
<li>若 key 不存在，则新增。</li>
<li>若 key 存在，则修改。</li>
</ul>
<h2 id="11-4-删"><a href="#11-4-删" class="headerlink" title="11-4 删"></a>11-4 删</h2><p>字典 .pop ( key )</p>
<ul>
<li>获得指定 key 的 value，同时字典被修改，指定 key 的数据被删除。</li>
</ul>
<p>字典 .clear ( )</p>
<ul>
<li>清空字典。</li>
</ul>
<h2 id="11-5-其他方法"><a href="#11-5-其他方法" class="headerlink" title="11-5 其他方法"></a>11-5 其他方法</h2><p>key  in&#x2F;not  in  字典</p>
<ul>
<li>判断 key 在不在字典中。</li>
</ul>
<h2 id="11-6-遍历"><a href="#11-6-遍历" class="headerlink" title="11-6 遍历"></a>11-6 遍历</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#方式1:通过获取到全部的key来完成遍历</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> keys:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;字典的key是:<span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;字典的value是:<span class="subst">&#123;my_dict[key]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#方式2:直接对字典进行for循环，每一次循环都是直接得到key</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> my_dict:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;2字典的key是:<span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;2字典的value是:<span class="subst">&#123;my_dict[key]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<h1 id="12-函数"><a href="#12-函数" class="headerlink" title="12- 函数"></a>12- 函数</h1><h2 id="12-1-创建与调用"><a href="#12-1-创建与调用" class="headerlink" title="12-1 创建与调用"></a>12-1 创建与调用</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240408204943428.png"
                      alt="image-20240408204943428"
                ></p>
<h2 id="12-2-多返回值（结果是元组）"><a href="#12-2-多返回值（结果是元组）" class="headerlink" title="12-2 多返回值（结果是元组）"></a>12-2 多返回值（结果是元组）</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_return</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>，<span class="number">2</span></span><br><span class="line"></span><br><span class="line">x,y = test_return()</span><br><span class="line"><span class="built_in">print</span>(x) <span class="comment">#结果1</span></span><br><span class="line"><span class="built_in">print</span>(y) <span class="comment">#结果2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#按照返回值的顺序，写对应顺序的多个变量接收即可</span></span><br><span class="line"><span class="comment">#变量之间用逗号隔开</span></span><br><span class="line"><span class="comment">#支持不同类型的数据return</span></span><br></pre></td></tr></table></figure></div>

<h2 id="12-3-参数"><a href="#12-3-参数" class="headerlink" title="12-3 参数"></a>12-3 参数</h2><h3 id="12-3-1-位置参数"><a href="#12-3-1-位置参数" class="headerlink" title="12-3-1 位置参数"></a>12-3-1 位置参数</h3><p>位置参数：</p>
<ul>
<li>调用函数时根据函数定义的参数位置来传递参数。</li>
</ul>
<p>注意：</p>
<ul>
<li>传递的参数和定义的参数的顺序及个数必须一致。</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">user_info</span>(<span class="params">name,age,gender</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;您的名字是<span class="subst">&#123;name&#125;</span>，年龄是<span class="subst">&#123;age&#125;</span>，性别是<span class="subst">&#123;gender&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">user_info(<span class="string">&#x27;TOM&#x27;</span>,<span class="number">20</span>,<span class="string">&#x27;男&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="12-3-2-关键字参数"><a href="#12-3-2-关键字参数" class="headerlink" title="12-3-2 关键字参数"></a>12-3-2 关键字参数</h3><p>关键字参数：</p>
<ul>
<li>函数调用时通过 “键&#x3D;值” 形式传递参数。</li>
</ul>
<p>作用：</p>
<ul>
<li>可以让函数更加清晰、容易使用，同时也清除了参数的顺序需求。</li>
</ul>
<p>注意：</p>
<ul>
<li>函数调用时，如果有位置参数时，位置参数必须在关键字参数的前面，但关键字参数之间不存在先后顺序。</li>
<li>def fun ( a , b , * , c , d ):   从 * 之后的参数，在函数调用时，只能采用关键字。</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">user_info</span>(<span class="params">name,age,gender</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;您的名字是:<span class="subst">&#123;name&#125;</span>，年龄是:<span class="subst">&#123;age&#125;</span>，性别是:<span class="subst">&#123;gender&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#关键字传参</span></span><br><span class="line">user_info(name=<span class="string">&quot;小明&quot;</span>,age=<span class="number">20</span>,gender=<span class="string">&quot;男&quot;</span>) </span><br><span class="line"><span class="comment">#可以不按照固定顺序</span></span><br><span class="line">user_info(age=<span class="number">20</span>,gender=<span class="string">&quot;男&quot;</span>,name=<span class="string">&quot;小明&quot;</span>) </span><br><span class="line"><span class="comment">#可以和位置参数混用，位置参数必须在前，且匹配参数序</span></span><br><span class="line">user_info(<span class="string">&quot;小明&quot;</span>,age=<span class="number">20</span>,gender=<span class="string">&quot;男&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="12-3-3-缺省参数"><a href="#12-3-3-缺省参数" class="headerlink" title="12-3-3 缺省参数"></a>12-3-3 缺省参数</h3><p>缺省参数：</p>
<ul>
<li>缺省参数也叫默认参数，用于定义函数，为参数提供默认值，调用函数时可不传该默认参数的值。</li>
<li>( 注意：所有位置参数必须出现在默认参数前，包括函数定义和调用 )。</li>
</ul>
<p>作用：</p>
<ul>
<li>当调用函数时没有传递参数，就会使用默认是用缺省参数对应的值。</li>
</ul>
<p>注意：</p>
<ul>
<li>函数调用时，如果为缺省参数传值则修改默认参数值，否则使用这个默认值。</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">user_info</span>(<span class="params">name,age,gender=<span class="string">&#x27;男&#x27;</span></span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&#x27;您的名字是<span class="subst">&#123;name&#125;</span>，年龄是<span class="subst">&#123;age&#125;</span>，性别是<span class="subst">&#123;gender&#125;</span>&#x27;</span>)</span><br><span class="line">	</span><br><span class="line">user_info(<span class="string">&#x27;TOM&#x27;</span>,<span class="number">20</span>)</span><br><span class="line">user_info(<span class="string">&#x27;Rose&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;女&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="12-3-4-不定长参数"><a href="#12-3-4-不定长参数" class="headerlink" title="12-3-4 不定长参数"></a>12-3-4 不定长参数</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240408211529142.png"
                      alt="image-20240408211529142"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240408211536261.png"
                      alt="image-20240408211536261"
                ></p>
<p>注意：</p>
<ul>
<li><p>在一个函数的定义过程中，既有个数可变的位置参数，也有个数可变的关键字形参。要求，个数可变的位置参数放在个数可变的关键字形参之前。</p>
</li>
<li><p>def fun ( *args1 , **args2 ): </p>
</li>
<li><p>def fun ( a , b , * , c , d , **args2 ):</p>
</li>
<li><p>def fun ( a , b , *args1 , **args2 ):</p>
</li>
</ul>
<h2 id="12-4-lambda匿名函数"><a href="#12-4-lambda匿名函数" class="headerlink" title="12-4 lambda匿名函数"></a>12-4 lambda匿名函数</h2><h3 id="12-4-1-定义"><a href="#12-4-1-定义" class="headerlink" title="12-4-1 定义"></a>12-4-1 定义</h3><p>def关键字，可以定义带有名称的函数。</p>
<p>lambda关键字，可以定义匿名函数 ( 无名称 )。</p>
<p>有名称的函数，可以基于名称重复使用。</p>
<p>无名称的匿名函数，只可临时使用一次。</p>
<h3 id="12-4-2-语法"><a href="#12-4-2-语法" class="headerlink" title="12-4-2 语法"></a>12-4-2 语法</h3><p>lambda 传入参数：函数体(一行代码)</p>
<ul>
<li>lambda 是关键字，表示定义匿名函数。</li>
<li>传入参数表示匿名函数的形式参数，如：x , y表示接收2个形式参数。</li>
<li>函数体，就是函数的执行逻辑，要注意：只能写一行，无法写多行代码。</li>
</ul>
<h3 id="12-4-3-实例"><a href="#12-4-3-实例" class="headerlink" title="12-4-3 实例"></a>12-4-3 实例</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#通过def关键字，定义一个函数，并传入</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_func</span>(<span class="params">compute</span>):</span><br><span class="line">    result=compute(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(resut)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="keyword">return</span> x+y</span><br><span class="line"> </span><br><span class="line">test_func(compute) <span class="comment">#结果:3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#也可以通过lambda关键字，传入一个一次性使用的lambda匿名函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_func</span>(<span class="params">compute</span>):</span><br><span class="line">    result=compute(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(resut)</span><br><span class="line"></span><br><span class="line">test_func(<span class="keyword">lambda</span> x,y: x+y) <span class="comment">#结果:3   </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用def和使用lambda，定义的函数功能完全一致，只是lambda关键字定义的函数是匿名的，无法二次使用。</span></span><br></pre></td></tr></table></figure></div>

<h2 id="12-5-递归函数"><a href="#12-5-递归函数" class="headerlink" title="12-5 递归函数"></a>12-5 递归函数</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fib</span>(<span class="params">n</span>):</span><br><span class="line">	<span class="keyword">if</span> n==<span class="number">1</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> n==<span class="number">2</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> fib(n-<span class="number">1</span>)+fib(n-<span class="number">2</span>)</span><br><span class="line"><span class="comment">#输出数列前6位</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">1</span> <span class="number">7</span>):</span><br><span class="line">    <span class="built_in">print</span>(fib(i)) <span class="comment">#斐波那契数列：1 1 2 3 5 8</span></span><br></pre></td></tr></table></figure></div>

<h1 id="13-文件操作"><a href="#13-文件操作" class="headerlink" title="13- 文件操作"></a>13- 文件操作</h1><h2 id="13-1-常用的三种基础访问模式"><a href="#13-1-常用的三种基础访问模式" class="headerlink" title="13-1 常用的三种基础访问模式"></a>13-1 常用的三种基础访问模式</h2><table>
<thead>
<tr>
<th>模式</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。</td>
</tr>
<tr>
<td>w</td>
<td>打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，原有内容会被删除。如果该文件不存在，创建新文件。</td>
</tr>
<tr>
<td>a</td>
<td>打开一个文件用于追加。如果该文件已存在，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</td>
</tr>
</tbody></table>
<h2 id="13-2-打开"><a href="#13-2-打开" class="headerlink" title="13-2 打开"></a>13-2 打开</h2><p>语法：</p>
<ul>
<li>open ( name, mode, encoding )</li>
<li>name：是要打开的目标文件名的字符串 ( 可以包含文件所在的具体路径 )。</li>
<li>mode：设置打开文件的模式 ( 访问模式 )：只读、写入、追加等。</li>
<li>encoding：编码格式 ( 推荐使用UTF-8 )</li>
</ul>
<p>注意：</p>
<ul>
<li>此时的 f 是 open 函数的文件对象，对象是Python中一种特殊的数据类型，拥有属性和方法，可以使用 “对象.属性” 或 “对象.方法” 对其进行访问。</li>
</ul>
<p>实例：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;python.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&quot;UTF-8&quot;</span>)</span><br><span class="line"><span class="comment">#encoding的顺序不是第三位，所以不能用位置参数，用关键字参数直接指定</span></span><br></pre></td></tr></table></figure></div>

<h2 id="13-3-读取"><a href="#13-3-读取" class="headerlink" title="13-3 读取"></a>13-3 读取</h2><table>
<thead>
<tr>
<th>方法</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>文件对象 .read ( num )</td>
<td>读取指定长度字节，不指定num读取文件全部。</td>
</tr>
<tr>
<td>文件对象 .readline ( )</td>
<td>读取一行。</td>
</tr>
<tr>
<td>文件对象 .readlines ( )</td>
<td>读取全部行，得到列表。</td>
</tr>
</tbody></table>
<h2 id="13-4-关闭"><a href="#13-4-关闭" class="headerlink" title="13-4 关闭"></a>13-4 关闭</h2><p>close：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;python.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">f.close()</span><br><span class="line"><span class="comment">#最后通过close，关闭文件对象，也就是关闭对文件的占用。</span></span><br><span class="line"><span class="comment">#如果不调用close，同时程序没有停止运行，那么这个文件将一直被Python程序占用。</span></span><br></pre></td></tr></table></figure></div>

<p>with open：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;python.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.readlines()</span><br><span class="line"><span class="comment">#通过在with open的语句块中对文件进行操作。</span></span><br><span class="line"><span class="comment">#可以在操作完成后自动关闭close文件，避免遗忘掉close方法。</span></span><br></pre></td></tr></table></figure></div>

<h2 id="13-5-遍历"><a href="#13-5-遍历" class="headerlink" title="13-5 遍历"></a>13-5 遍历</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&quot;python.txt&quot;</span>, <span class="string">&quot;r&quot;</span>):</span><br><span class="line">	<span class="built_in">print</span>(line)</span><br><span class="line"><span class="comment">#for循环读取文件行</span></span><br><span class="line"><span class="comment">#每一个line临时变量，就记录了文件的一行数据</span></span><br></pre></td></tr></table></figure></div>

<h2 id="13-6-写出"><a href="#13-6-写出" class="headerlink" title="13-6 写出"></a>13-6 写出</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.打开文件</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;python.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="comment">#2.文件写入</span></span><br><span class="line">f.write(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line"><span class="comment">#3.内容刷新</span></span><br><span class="line">f.flush()</span><br></pre></td></tr></table></figure></div>

<p>注意：</p>
<ul>
<li>直接调用write，内容并未真正写入文件，而是会积在程序的内存中，称之为缓冲区。</li>
<li>当调用flush的时候，内容会真正写入文件。</li>
<li>这样做是避免频繁的操作硬盘，导致效率下降 ( 攒一堆，一次性写磁盘 )。</li>
<li>w模式，文件不存在，会创建新文件。</li>
<li>w模式，文件存在，会清空原有内容。</li>
</ul>
<h2 id="13-7-追加写出"><a href="#13-7-追加写出" class="headerlink" title="13-7 追加写出"></a>13-7 追加写出</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.打开文件，通过a模式打开即可</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;python.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="comment">#2.文件写入</span></span><br><span class="line">f.write(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line"><span class="comment">#3.内容刷新</span></span><br><span class="line">f.flush()</span><br></pre></td></tr></table></figure></div>

<p>注意：</p>
<ul>
<li>a模式，文件不存在会创建文件。</li>
<li>a模式，文件存在会在最后，追加写入文件。</li>
</ul>
<h1 id="14-异常"><a href="#14-异常" class="headerlink" title="14- 异常"></a>14- 异常</h1><h2 id="14-1-异常捕获"><a href="#14-1-异常捕获" class="headerlink" title="14-1 异常捕获"></a>14-1 异常捕获</h2><h3 id="14-1-1-常规异常"><a href="#14-1-1-常规异常" class="headerlink" title="14-1-1 常规异常"></a>14-1-1 常规异常</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">try:</span><br><span class="line">	可能发生错误的代码</span><br><span class="line">except:</span><br><span class="line">	如果出现异常执行的代码</span><br></pre></td></tr></table></figure></div>

<h3 id="14-1-2-指定异常"><a href="#14-1-2-指定异常" class="headerlink" title="14-1-2 指定异常"></a>14-1-2 指定异常</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">try:</span><br><span class="line">	可能发生错误的代码</span><br><span class="line">except 可能发生错误代码的异常类型 as e:</span><br><span class="line">	如果出现异常执行的代码</span><br></pre></td></tr></table></figure></div>

<p>注意：</p>
<ul>
<li>e是接收异常信息的临时变量。</li>
<li>如果尝试执行的代码的异常类型和要捕获的异常类型不一致，则无法捕获异常。</li>
<li>一般try下方只放一行尝试执行的代码。</li>
</ul>
<h3 id="14-1-3-多个异常"><a href="#14-1-3-多个异常" class="headerlink" title="14-1-3 多个异常"></a>14-1-3 多个异常</h3><p>当捕获多个异常时，可以把要捕获的异常类型的名字，放到except 后，并使用元组的方式进行书写。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="number">1</span>/<span class="number">0</span>)</span><br><span class="line"><span class="keyword">except</span>(NameError, ZeroDivisionError):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ZeroDivision错误...&#x27;</span>) <span class="comment">#结果：ZeroDivision错误...</span></span><br></pre></td></tr></table></figure></div>

<h3 id="14-1-4-全部异常"><a href="#14-1-4-全部异常" class="headerlink" title="14-1-4 全部异常"></a>14-1-4 全部异常</h3><p>Exception是最顶级的异常。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	f = <span class="built_in">open</span>(<span class="string">&quot;D:/123.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;出现异常了&quot;</span>) <span class="comment">#结果：出现异常了</span></span><br></pre></td></tr></table></figure></div>

<h3 id="14-1-5-else"><a href="#14-1-5-else" class="headerlink" title="14-1-5  else"></a>14-1-5  else</h3><p>else表示的是如果没有异常要执行的代码。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;我是else，是没有异常的时候执行的代码&#x27;</span>) </span><br><span class="line"><span class="comment">#结果：1  我是else，是没有异常的时候执行的代码</span></span><br></pre></td></tr></table></figure></div>

<h3 id="14-1-6-finally"><a href="#14-1-6-finally" class="headerlink" title="14-1-6 finally"></a>14-1-6 finally</h3><p>finally表示的是无论是否异常都要执行的代码，例如关闭文件。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    f= <span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;没有异常，真开心&quot;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure></div>

<h2 id="14-2-异常的传递性"><a href="#14-2-异常的传递性" class="headerlink" title="14-2 异常的传递性"></a>14-2 异常的传递性</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/51d6bbbb-63dd-40d6-b7f0-37c09b24555f-25143160.jpg"
                      alt="img"
                ></p>
<h2 id="14-3-traceback模块"><a href="#14-3-traceback模块" class="headerlink" title="14-3 traceback模块"></a>14-3 traceback模块</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/df434f28-095a-4235-9618-9526478d9719-25143160.jpg"
                      alt="img"
                ></p>
<h1 id="15-模块"><a href="#15-模块" class="headerlink" title="15- 模块"></a>15- 模块</h1><h2 id="15-1-介绍"><a href="#15-1-介绍" class="headerlink" title="15-1 介绍"></a>15-1 介绍</h2><p>内涵：</p>
<ul>
<li>模块就是一个Python代码文件，内含类、函数、变量等，我们可以导入进行使用。</li>
</ul>
<p>导入：</p>
<ul>
<li>[ from 模块名 ] import [ 模块|类|变量|函数 |* ] [ as 别名 ]</li>
</ul>
<p>注意：</p>
<ul>
<li><p>from可以省略，直接import即可。</p>
</li>
<li><p>as别名可以省略。</p>
</li>
<li><p>通过 “.” 来确定层级关系。</p>
</li>
<li><p>模块的导入一般写在代码文件的开头位置。</p>
</li>
</ul>
<h2 id="15-2-导入"><a href="#15-2-导入" class="headerlink" title="15-2 导入"></a>15-2 导入</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> 模块名</span><br><span class="line"><span class="keyword">import</span> 模块名<span class="number">1</span>,模块名<span class="number">2</span></span><br><span class="line"></span><br><span class="line">模块名.功能名()</span><br><span class="line"></span><br><span class="line"><span class="comment">#案例:导入time模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#导入时间模块</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line"><span class="comment">#让程序睡眠1秒(阻塞)</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;结束&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> 模块名 <span class="keyword">import</span> 功能名</span><br><span class="line"></span><br><span class="line">功能名()</span><br><span class="line"></span><br><span class="line"><span class="comment">#案例:导入time模块中的sleep方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#导入时间模块中的sleep方法</span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line"><span class="comment">#让程序睡眠1秒(阻塞)</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;结束&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> 模块名 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">功能名()</span><br><span class="line"></span><br><span class="line"><span class="comment">#案例:导入time模块中所有的方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#导入时间模块中所有的方法</span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line"><span class="comment">#让程序睡眠1秒(阻塞)</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;结束”)</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#模块定义别名</span></span><br><span class="line"><span class="keyword">import</span> 模块名 <span class="keyword">as</span> 别名</span><br><span class="line"><span class="comment">#功能定义别名</span></span><br><span class="line"><span class="keyword">from</span> 模块名 <span class="keyword">import</span> 功能 <span class="keyword">as</span> 别名</span><br><span class="line"></span><br><span class="line"><span class="comment">#模块别名</span></span><br><span class="line"><span class="keyword">import</span> time <span class="keyword">as</span> tt</span><br><span class="line">tt.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#功能别名</span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep <span class="keyword">as</span> sl</span><br><span class="line">sl(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<h2 id="15-3-自定义模块"><a href="#15-3-自定义模块" class="headerlink" title="15-3 自定义模块"></a>15-3 自定义模块</h2><h3 id="15-3-1-介绍"><a href="#15-3-1-介绍" class="headerlink" title="15-3-1 介绍"></a>15-3-1 介绍</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/9ff46312-5af3-4435-8c6a-e66252aba50b-25143160.jpg"
                      alt="img"
                ></p>
<h3 id="15-3-2-main"><a href="#15-3-2-main" class="headerlink" title="15-3-2 _ main _"></a>15-3-2 _ main _</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/09f2494e-f47d-4e04-bbbf-fe2563414d10-25143160.jpg"
                      alt="img"
                ></p>
<h3 id="15-3-3-all"><a href="#15-3-3-all" class="headerlink" title="15-3-3 _ all _"></a>15-3-3 _ all _</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/1064a774-1417-4cfe-9286-176cb6852627-25143160.jpg"
                      alt="img"
                ></p>
<h3 id="13-3-4-注意"><a href="#13-3-4-注意" class="headerlink" title="13-3-4 注意"></a>13-3-4 注意</h3><p>当导入多个模块且模块内有同名功能时，当调用这个同名功能的时候，调用到的是后面导入的模块的功能。</p>
<h1 id="16-包"><a href="#16-包" class="headerlink" title="16- 包"></a>16- 包</h1><h2 id="16-1-创建"><a href="#16-1-创建" class="headerlink" title="16-1 创建"></a>16-1 创建</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/d5b9f4ad-3b44-45ea-b347-8da9d6d64581-25143160.jpg"
                      alt="img"
                ></p>
<h2 id="16-2-导入"><a href="#16-2-导入" class="headerlink" title="16-2 导入"></a>16-2 导入</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/c67c25c2-5d66-4ddc-a23e-9fe393c30502-25143160.jpg"
                      alt="img"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/fb85c068-4693-45f5-b6da-8533b3df1f53-25143160.jpg"
                      alt="img"
                ></p>
<h1 id="17-类与对象"><a href="#17-类与对象" class="headerlink" title="17- 类与对象"></a>17- 类与对象</h1><h2 id="17-1-类创建"><a href="#17-1-类创建" class="headerlink" title="17-1 类创建"></a>17-1 类创建</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建类的语法:</span></span><br><span class="line">	<span class="comment">#class是关键字，表示要定义类了</span></span><br><span class="line">	<span class="comment">#类的属性，即定义在类中的变量(成员变量)</span></span><br><span class="line">	<span class="comment">#类的行为，即定义在类中的函数(成员方法)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">类名称</span>:</span><br><span class="line">	类的属性</span><br><span class="line">	类的行为</span><br><span class="line">	</span><br><span class="line"><span class="comment">#创建类对象的语法:</span></span><br><span class="line">对象 = 类名称()</span><br></pre></td></tr></table></figure></div>

<h2 id="17-2-方法"><a href="#17-2-方法" class="headerlink" title="17-2 方法"></a>17-2 方法</h2><h3 id="17-2-1-创建"><a href="#17-2-1-创建" class="headerlink" title="17-2-1 创建"></a>17-2-1 创建</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#self关键字是成员方法定义的时候，必须填写的。</span></span><br><span class="line">	<span class="comment">#它用来表示类对象自身的意思</span></span><br><span class="line">    <span class="comment">#当我们使用类对象调用方法的是，self会自动被python传入</span></span><br><span class="line">    <span class="comment">#在方法内部，想要访问类的成员变量，必须使用self</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">方法名</span>(<span class="params">self, 形参<span class="number">1</span>, ......, 形参N</span>):</span><br><span class="line">	方法体</span><br></pre></td></tr></table></figure></div>

<h3 id="17-2-2-魔术方法"><a href="#17-2-2-魔术方法" class="headerlink" title="17-2-2 魔术方法"></a>17-2-2 魔术方法</h3><p>构造方法：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/54488178-8ce3-453a-a8e6-09a20a1f5f14-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>_ str _字符串方法：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/fc451bb8-9103-435f-980e-a28836c09b9c-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>_ lt _小于符号比较方法：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/8b9a6fc8-b822-44ad-a5f9-e784488871fd-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>_ le _小于等于比较符号方法：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/23579518-a249-4e5e-8e69-566c4681ace9-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<p>_ eq _比较运算符实现方法：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/89156723-b451-4e06-b97e-f41458a92cc1-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="17-3-封装（私有成员）"><a href="#17-3-封装（私有成员）" class="headerlink" title="17-3 封装（私有成员）"></a>17-3 封装（私有成员）</h2><h3 id="17-3-1-创建"><a href="#17-3-1-创建" class="headerlink" title="17-3-1 创建"></a>17-3-1 创建</h3><p>类中提供了私有成员的形式来支持：</p>
<ul>
<li>私有成员变量</li>
<li>私有成员方法</li>
</ul>
<p>定义私有成员的方式非常简单，只需要：</p>
<ul>
<li>私有成员变量：变量名以__开头 ( 2个下划线 )</li>
<li>私有成员方法：方法名以__开头 ( 2个下划线 )</li>
<li>即可完成私有成员的设置</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">phone</span>:</span><br><span class="line">	IMEI = <span class="literal">None</span> <span class="comment">#序列号</span></span><br><span class="line">	producer = <span class="literal">None</span> <span class="comment">#厂商</span></span><br><span class="line"></span><br><span class="line">    __current_voltage = <span class="literal">None</span> <span class="comment">#当前电压，私有成员变量</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">ca11_by_5g</span>(<span class="params">se1f</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;5g通话已开启&quot;</span>)</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__keep_single_core</span>(<span class="params">self</span>): <span class="comment">#私有成员方法</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;让CPU以单核模式运行以节省电量&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="17-3-2-注意"><a href="#17-3-2-注意" class="headerlink" title="17-3-2 注意"></a>17-3-2 注意</h3><p>私有变量无法赋值，也无法获取值。</p>
<p>私有成员无法被类对象使用，但可以被其他的成员使用。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#设计一个类，用来描述手机</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone</span>:</span><br><span class="line">	<span class="comment">#提供私有成员变量:__is_5g_enable</span></span><br><span class="line">    __is_5g_enable = <span class="literal">True</span> <span class="comment"># 5g状态</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">#提供私有成员方法:__check_5g()</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">_check_5g</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.__is_5g_enable:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;5g开启&quot;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;5g关闭，使用4g网络&quot;</span>)</span><br><span class="line">            </span><br><span class="line">	<span class="comment">#提供公开成员方法:call_by_5g()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">call_by_5g</span>(<span class="params">self</span>):</span><br><span class="line">		self.__check_5g()</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;正在通话中&quot;</span>)</span><br><span class="line">        </span><br><span class="line">phone = Phone()</span><br><span class="line">phone.call_by_5g() <span class="comment">#结果：5g开启    正在通话中</span></span><br></pre></td></tr></table></figure></div>

<h2 id="17-4-继承"><a href="#17-4-继承" class="headerlink" title="17-4 继承"></a>17-4 继承</h2><h3 id="17-4-1-单继承"><a href="#17-4-1-单继承" class="headerlink" title="17-4-1 单继承"></a>17-4-1 单继承</h3><p>语法：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">类名</span>(<span class="title class_ inherited__">父类名</span>):</span><br><span class="line">	类内容体</span><br></pre></td></tr></table></figure></div>

<p>实例：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#父类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone</span>:</span><br><span class="line">	IMEI = <span class="literal">None</span> <span class="comment">#序列号</span></span><br><span class="line">	producer = <span class="literal">None</span> <span class="comment">#厂商</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">ca11_by_4g</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;4g通话&quot;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#子类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">phone2022</span>(<span class="title class_ inherited__">Phone</span>):</span><br><span class="line">	face_id = <span class="literal">True</span> <span class="comment">#面部识别</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">ca11_by_5g</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;2022最新5g通话&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="17-4-2-多继承"><a href="#17-4-2-多继承" class="headerlink" title="17-4-2 多继承"></a>17-4-2 多继承</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/b44a3911-d61f-4ad0-88b3-f60a80049aad-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/2deca8ef-175c-4f2d-a349-fad7275fae3f-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
<h3 id="17-4-3-pass关键字"><a href="#17-4-3-pass关键字" class="headerlink" title="17-4-3 pass关键字"></a>17-4-3 pass关键字</h3><p>是占位语句，用来保证函数（方法）或定义的完整性，表示无内容、空的意思。</p>
<h3 id="17-4-4-复写"><a href="#17-4-4-复写" class="headerlink" title="17-4-4 复写"></a>17-4-4 复写</h3><p>子类继承父类的成员属性和成员方法后，如果对其“不满意”，那么可以进行复写即：</p>
<ul>
<li>在子类中重新定义同名的属性或方法即可。</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">phone</span>:</span><br><span class="line">	IMEI = <span class="literal">None</span> <span class="comment">#序列号</span></span><br><span class="line">	producer = <span class="string">&quot;ITCAST&quot;</span> <span class="comment">#厂商</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">cal1_by_5g</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;父类的5g通话&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPhone</span>(<span class="title class_ inherited__">Phone</span>):</span><br><span class="line">    proucer = <span class="string">&quot;ITHEIMA&quot;</span> <span class="comment">#复写父类属性</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">ca11_by_5g</span>(<span class="params">self</span>): <span class="comment">#复写父类方法</span></span><br><span class="line">    	<span class="built_in">print</span>(<span class="string">&quot;子类的5g通话&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="17-4-5-调用父类成员（在子类内部）"><a href="#17-4-5-调用父类成员（在子类内部）" class="headerlink" title="17-4-5 调用父类成员（在子类内部）"></a>17-4-5 调用父类成员（在子类内部）</h3><p>一旦复写父类成员，那么类对象调用成员的时候，就会调用复写后的新成员。</p>
<p>如果需要使用被复写的父类的成员，需要特殊的调用方式：</p>
<ul>
<li><p>方式1:</p>
<ul>
<li><p>调用父类成员</p>
<ul>
<li><p>使用成员变量：父类名 .成员变量</p>
</li>
<li><p>使用成员方法：父类名 .成员方法 ( self )</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>方式2:</p>
<ul>
<li>使用 super( ) 调用父类成员<ul>
<li>使用成员变量：super( ) .成员变量</li>
<li>使用成员方法：super( ) .成员方法( )</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">phone</span>:</span><br><span class="line">    IMEI = <span class="literal">None</span> <span class="comment">#序列号</span></span><br><span class="line">	producer = <span class="string">&quot;ITCAST&quot;</span> <span class="comment">#厂商</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">ca11_by_5g</span>(<span class="params">se1f</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;父类的5g通话&quot;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">myphone</span>(<span class="title class_ inherited__">phone</span>):</span><br><span class="line">    proucer = <span class="string">&quot;ITHEIMA&quot;</span> <span class="comment">#厂商</span></span><br><span class="line">    </span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">ca11_by_5g</span>(<span class="params">se1f</span>):</span><br><span class="line">		<span class="comment">#方式1调用父类成员</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;父类的品牌是:<span class="subst">&#123;Phone.producer&#125;</span>&quot;</span>)</span><br><span class="line">        Phone.ca11_by_5g(se1f)</span><br><span class="line">        </span><br><span class="line">		<span class="comment">#方式2调用父类成员</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;父类的品牌足:<span class="subst">&#123;<span class="built_in">super</span>().producer&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">super</span>().ca11_by_5g()</span><br><span class="line">        </span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;子类的5g通话&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<h2 id="17-5-多态"><a href="#17-5-多态" class="headerlink" title="17-5 多态"></a>17-5 多态</h2><h3 id="17-5-1-介绍"><a href="#17-5-1-介绍" class="headerlink" title="17-5-1 介绍"></a>17-5-1 介绍</h3><p>什么是多态：</p>
<ul>
<li>多态指的是，同一个行为，使用不同的对象获得不同的状态。如，定义函数（方法），通过类型注解声明需要父类对象，实际传入子类对象进行工作，从而获得不同的工作状态。</li>
</ul>
<p>什么是抽象类（接口）：</p>
<ul>
<li>包含抽象方法的类，称之为抽象类。</li>
<li>抽象方法是指：没有具体实现的方法（pass）称之为抽象方法。</li>
</ul>
<p>抽象类的作用：</p>
<ul>
<li>多用于做顶层设计（设计标准），以便子类做具体实现。也是对子类的一种软性约束，要求子类必须复写（实现）父类的一些方法并配合多态使用，获得不同的工作状态。</li>
</ul>
<h3 id="17-5-2-实例"><a href="#17-5-2-实例" class="headerlink" title="17-5-2 实例"></a>17-5-2 实例</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AC</span>:</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">cool_wind</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="string">&quot;&quot;&quot;制冷&quot;&quot;&quot;</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">hot_wind</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;制热&quot;&quot;&quot;</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">swing_l_r</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;左右摆风&quot;&quot;&quot;</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Midea_AC</span>(<span class="title class_ inherited__">AC</span>):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">cool_wind</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;美的空调核心制冷科技&quot;</span>)</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">hot_wind</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;美的空调电热丝加热&quot;</span>)</span><br><span class="line">	</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;美的空调无风感左右摆风&quot;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GREE_AC</span>(<span class="title class_ inherited__">AC</span>):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">cool_wind</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;格力空调变频省电制冷&quot;</span>)</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">hot_wind</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;格力空调电热丝加热&quot;</span>)</span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">swing_l_r</span>(<span class="params">self</span>):   </span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;格力空调静音左右摆风&quot;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#配合多态，完成</span></span><br><span class="line"><span class="comment">#抽象的父类设计(设计标准)</span></span><br><span class="line"><span class="comment">#具体的子类实现(实现标准)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_cool</span>(<span class="params">ac: Ac</span>):</span><br><span class="line">    ac.cool_wind()</span><br><span class="line">    </span><br><span class="line">midea_ac = Midea_AC()</span><br><span class="line">gree_ac = GREE_AC()</span><br><span class="line"></span><br><span class="line">make_cool(midea_ac) <span class="comment"># 输出:美的空调制冷</span></span><br><span class="line">make_cool(gree_ac) <span class="comment"># 输出:格力空调制冷</span></span><br></pre></td></tr></table></figure></div>

<h2 id="17-6-类型注解"><a href="#17-6-类型注解" class="headerlink" title="17-6 类型注解"></a>17-6 类型注解</h2><h3 id="17-6-1-介绍"><a href="#17-6-1-介绍" class="headerlink" title="17-6-1 介绍"></a>17-6-1 介绍</h3><p>类型注解只是提示性的，并非决定性的。</p>
<h3 id="17-6-2-变量"><a href="#17-6-2-变量" class="headerlink" title="17-6-2 变量"></a>17-6-2 变量</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法：变量:类型</span></span><br><span class="line">my_1ist: <span class="built_in">list</span>[<span class="built_in">int</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">my_tuple: <span class="built_in">tuple</span>[<span class="built_in">str</span>,<span class="built_in">int</span>,<span class="built_in">bool</span>] = (<span class="string">&quot;itheima&quot;</span>, <span class="number">666</span>, <span class="literal">True</span>)</span><br><span class="line">my_set: <span class="built_in">set</span>[<span class="built_in">int</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">my_dict: <span class="built_in">dict</span>[<span class="built_in">str</span>,<span class="built_in">int</span>] = &#123;<span class="string">&quot;itheima&quot;</span>:<span class="number">666</span>&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">#注意:</span></span><br><span class="line"><span class="comment">#元组类型设置类型详细注解，需要将每一个元素都标记出来</span></span><br><span class="line"><span class="comment">#字典类型设置类型详细注解，需要2个类型，第一个是key，第二个是value</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法：# type:类型（在注释中进行类型注解）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">student</span>:</span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line">var_1 = random.randint(<span class="number">1</span>,<span class="number">10</span>) <span class="comment"># type: <span class="built_in">int</span></span></span><br><span class="line">var_2 = json.loads(data) <span class="comment"># type: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span>]</span></span><br><span class="line">var_3 = func() <span class="comment"># type: student</span></span><br></pre></td></tr></table></figure></div>

<h3 id="17-6-3-函数和方法"><a href="#17-6-3-函数和方法" class="headerlink" title="17-6-3 函数和方法"></a>17-6-3 函数和方法</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#函数和方法的形参类型注解语法:</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">函数方法名</span>(<span class="params">形参名:类型, 形参名:类型, ......</span>):</span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">x:<span class="built_in">int</span>, y:<span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">return</span> x+y</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">data:<span class="built_in">list</span></span>):</span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">add() <span class="comment">#提示参数的类型</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">同时，函数(方法)的返回值也是可以添加类型注解的。</span><br><span class="line">语法如下:</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">函数方法名</span>(<span class="params">形参:类型, 形参:类型, ......</span>) -&gt; 返回值类型:</span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div>

<h3 id="17-6-4-Union类型"><a href="#17-6-4-Union类型" class="headerlink" title="17-6-4 Union类型"></a>17-6-4 Union类型</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Union联合类型注解，在变量注解、函数(方法)形参和返回值注解中，均可使用。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line">my_list: <span class="built_in">list</span>[<span class="type">Union</span>(<span class="built_in">int</span>, <span class="built_in">str</span>)] = [<span class="number">1</span>, <span class="number">2</span>, <span class="string">&quot;itcast&quot;</span>, <span class="string">&quot;itheima&quot;</span>]</span><br><span class="line">my_dict: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">int</span>]] = &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;周杰轮&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">31</span>&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">data: <span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>] -&gt; <span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>]:</span></span><br><span class="line"><span class="params">	<span class="keyword">pass</span>   </span></span><br></pre></td></tr></table></figure></div>

<h1 id="18-SQL"><a href="#18-SQL" class="headerlink" title="18- SQL"></a>18- SQL</h1><h2 id="18-1-介绍"><a href="#18-1-介绍" class="headerlink" title="18-1 介绍"></a>18-1 介绍</h2><p>数据库：</p>
<ul>
<li>按照 库 -&gt; 表 -&gt; 数据 三个层级组织数据。</li>
</ul>
<p>SQL的语法特征：</p>
<ul>
<li>SQL语言，大小写不敏感。</li>
<li>SQL可以单行或多行书写，最后以 ; 号结束。</li>
<li>SQL支持注释：<ul>
<li>单行注释：–注释内容（–后面一定要有一个空格）</li>
<li>单行注释：#注释内容（#后面可以不加空格，推荐加上）</li>
<li>多行注释：&#x2F;* 注释内容 *&#x2F;</li>
</ul>
</li>
</ul>
<h2 id="18-2-DDL"><a href="#18-2-DDL" class="headerlink" title="18-2 DDL"></a>18-2 DDL</h2><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--查看数据库</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"></span><br><span class="line"><span class="comment">--使用数据库</span></span><br><span class="line">USE 数据库名称;</span><br><span class="line"></span><br><span class="line"><span class="comment">--创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名称 [CHARSET UTF8];</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除数据库</span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE 数据库名称;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看当前使用的数据库</span></span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看有哪些表</span></span><br><span class="line"><span class="keyword">SHOW</span> TABLES; <span class="comment">--注意:需要先选择教据库哦</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名称(</span><br><span class="line">	列名称 列类型,</span><br><span class="line">	列名称 列类型,</span><br><span class="line">    ......</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> 表名称;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> 表名称;</span><br><span class="line"></span><br><span class="line"><span class="comment">--列类型有</span></span><br><span class="line"><span class="type">int</span> <span class="comment">--整数</span></span><br><span class="line"><span class="type">float</span> <span class="comment">--浮点数</span></span><br><span class="line"><span class="type">varchar</span>(长度) <span class="comment">--文本，长度为数字，做最大长度限制</span></span><br><span class="line"><span class="type">date</span> <span class="comment">--日期类型</span></span><br><span class="line"><span class="type">timestamp</span> <span class="comment">--时间藏类型</span></span><br></pre></td></tr></table></figure></div>

<h2 id="18-3-DML"><a href="#18-3-DML" class="headerlink" title="18-3 DML"></a>18-3 DML</h2><p>注意：</p>
<ul>
<li>字符串的值，出现在SQL语句中，必须要用单引号包围起来。</li>
</ul>
<h3 id="18-3-1-数据插入"><a href="#18-3-1-数据插入" class="headerlink" title="18-3-1 数据插入"></a>18-3-1 数据插入</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--基础语法:</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表[(列<span class="number">1</span>, 列<span class="number">2</span>, ......, 列N)] <span class="keyword">VALUES</span> (值<span class="number">1</span>, 值<span class="number">2</span>, ......, 值N)[, (值<span class="number">1</span>, 值<span class="number">2</span>, ......, 值N), ......, (值<span class="number">1</span>,值<span class="number">2</span>, ......, 值N)]</span><br><span class="line"></span><br><span class="line"><span class="comment">--实例:</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student(</span><br><span class="line">	id <span class="type">INT</span>,</span><br><span class="line">	name VARCHART(<span class="number">20</span>),</span><br><span class="line">	age <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#仅插入id列数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student(id) <span class="keyword">VALUES</span> (<span class="number">10001</span>),(<span class="number">10002</span>),(<span class="number">10003</span>)</span><br><span class="line">#插入全部列数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student(id,name,age) <span class="keyword">VALUES</span> (<span class="number">10001</span>,<span class="string">&#x27;周杰轮&#x27;</span>,<span class="number">31</span>),(<span class="number">10002</span>,<span class="string">&#x27;王力鸿&#x27;</span>,<span class="number">33</span>),(<span class="number">10003</span>,<span class="string">&#x27;林俊节&#x27;</span>,<span class="number">26</span>)</span><br><span class="line">#插入全部列数据，快捷写法</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span> (<span class="number">10001</span>,<span class="string">&#x27;周杰轮&#x27;</span>,<span class="number">31</span>),(<span class="number">10002</span>,<span class="string">&#x27;王力鸿&#x27;</span>,<span class="number">33</span>)，(<span class="number">10003</span>,<span class="string">&#x27;林俊节&#x27;</span>,<span class="number">26</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="18-3-2-数据删除"><a href="#18-3-2-数据删除" class="headerlink" title="18-3-2 数据删除"></a>18-3-2 数据删除</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--基础语法:</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名称 [<span class="keyword">WHERE</span> 条件判断]</span><br><span class="line"></span><br><span class="line">#条件判断:</span><br><span class="line">列 操作符 值</span><br><span class="line">操作符:<span class="operator">=</span> <span class="operator">&lt;</span> <span class="operator">&gt;</span> <span class="operator">&lt;=</span> <span class="operator">&gt;=</span> <span class="operator">!=</span> 等等</span><br><span class="line"></span><br><span class="line"><span class="comment">--实例:</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> student;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student(</span><br><span class="line">	id <span class="type">INT</span>,</span><br><span class="line">	name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">	age <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span> (<span class="number">10001</span>,<span class="string">&#x27;周杰轮&#x27;</span>,<span class="number">31</span>),(<span class="number">10002</span>,<span class="string">&#x27;王力鸿&#x27;</span>,<span class="number">33</span>),(<span class="number">10003</span>,<span class="string">&#x27;林俊节&#x27;</span>,<span class="number">35</span>),(<span class="number">10004</span>,<span class="string">&#x27;张学油&#x27;</span>,<span class="number">36</span>),(<span class="number">10005</span>,<span class="string">&#x27;刘德滑&#x27;</span>,<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">#删除name为林俊节的数据</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;林俊节&#x27;</span>; #注意，不要忘记<span class="string">&#x27;&#x27;</span></span><br><span class="line">#删除age <span class="operator">&gt;</span> <span class="number">33</span> 的数据</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">33</span>;</span><br><span class="line">#删除全部数据</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure></div>

<h3 id="18-3-3-数据更新"><a href="#18-3-3-数据更新" class="headerlink" title="18-3-3 数据更新"></a>18-3-3 数据更新</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--基础语法:</span></span><br><span class="line"><span class="keyword">UPDATE</span> 表名 <span class="keyword">SET</span> 列<span class="operator">=</span>值 [<span class="keyword">WHERE</span> 条件判断];</span><br><span class="line"></span><br><span class="line">#条件判断:</span><br><span class="line">列 操作符 值</span><br><span class="line">操作符:<span class="operator">=</span> <span class="operator">&lt;</span> <span class="operator">&gt;</span> <span class="operator">&lt;=</span> <span class="operator">&gt;=</span> <span class="operator">!=</span> 等等</span><br><span class="line"></span><br><span class="line"><span class="comment">--实例:</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> student;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student(</span><br><span class="line">	id <span class="type">INT</span>,</span><br><span class="line">	name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">	age <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="number">10001</span>,<span class="string">&#x27;周杰轮&#x27;</span>,<span class="number">31</span>),(<span class="number">10002</span>,<span class="string">&#x27;王力鸿&#x27;</span>,<span class="number">33</span>),(<span class="number">10003</span>,<span class="string">&#x27;林俊节&#x27;</span>,<span class="number">35</span>),(<span class="number">10004</span>,<span class="string">&#x27;张学油&#x27;</span>,<span class="number">36</span>),(<span class="number">10005</span>,<span class="string">&#x27;刘德滑&#x27;</span>,<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">#修改id为<span class="number">10001</span>的name为陈一讯</span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;陈一讯&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10001</span>;</span><br><span class="line">#修改全部数据的age为<span class="number">11</span></span><br><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">SET</span> age <span class="operator">=</span> <span class="number">11</span>;</span><br></pre></td></tr></table></figure></div>

<h2 id="18-4-DQL"><a href="#18-4-DQL" class="headerlink" title="18-4 DQL"></a>18-4 DQL</h2><h3 id="18-4-1-查询"><a href="#18-4-1-查询" class="headerlink" title="18-4-1 查询"></a>18-4-1 查询</h3><h4 id="18-4-1-1-基础查询"><a href="#18-4-1-1-基础查询" class="headerlink" title="18-4-1-1 基础查询"></a>18-4-1-1 基础查询</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--基础语法:</span></span><br><span class="line"><span class="keyword">SELECT</span> 字段列表<span class="operator">|</span><span class="operator">*</span> <span class="keyword">FROM</span> 表</span><br><span class="line"></span><br><span class="line"><span class="comment">--实例:</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> student;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student(</span><br><span class="line">	id <span class="type">INT</span>,</span><br><span class="line">	name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">	age <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span> (<span class="number">10001</span>,<span class="string">&#x27;周杰轮&#x27;</span>,<span class="number">31</span>),(<span class="number">10002</span>,<span class="string">&#x27;王力鸿&#x27;</span>,<span class="number">33</span>),(<span class="number">10003</span>,<span class="string">&#x27;林俊节&#x27;</span>,<span class="number">35</span>),(<span class="number">10004</span>,<span class="string">&#x27;张学油&#x27;</span>,<span class="number">36</span>),(<span class="number">10005</span>,<span class="string">&#x27;刘德滑&#x27;</span>,<span class="number">30</span>);</span><br><span class="line">                                                                                       </span><br><span class="line">#查询id和name两个列</span><br><span class="line"><span class="keyword">SELEcT</span> id,name <span class="keyword">FROM</span> student;</span><br><span class="line">#查询全部列</span><br><span class="line"><span class="keyword">SELEcT</span> id,name,age <span class="keyword">FROM</span> student;</span><br><span class="line">#查询全部列，快捷写法</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure></div>

<h4 id="18-4-1-2-过滤查询"><a href="#18-4-1-2-过滤查询" class="headerlink" title="18-4-1-2 过滤查询"></a>18-4-1-2 过滤查询</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--基础语法:</span></span><br><span class="line"><span class="keyword">SELECT</span> 字段列表<span class="operator">|</span><span class="operator">*</span> <span class="keyword">FROM</span> 表 <span class="keyword">WHERE</span> 条件判断</span><br><span class="line"></span><br><span class="line">#条件判断:</span><br><span class="line">列 操作符 值</span><br><span class="line">操作符:<span class="operator">=</span> <span class="operator">&lt;</span> <span class="operator">&gt;</span> <span class="operator">&lt;=</span> <span class="operator">&gt;=</span> <span class="operator">!=</span> 等等</span><br><span class="line"></span><br><span class="line"><span class="comment">--实例:</span></span><br><span class="line">#查询id和name两个列，年龄小于<span class="number">33</span>岁</span><br><span class="line"><span class="keyword">SELECT</span> id,name <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&lt;</span> <span class="number">33</span>;</span><br><span class="line">#查询全部列，id等于<span class="number">10003</span></span><br><span class="line"><span class="keyword">SELECT</span> id,name,age <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">10003</span>;</span><br></pre></td></tr></table></figure></div>

<h3 id="18-4-2-分组聚合"><a href="#18-4-2-分组聚合" class="headerlink" title="18-4-2 分组聚合"></a>18-4-2 分组聚合</h3><h4 id="18-4-2-1-语法"><a href="#18-4-2-1-语法" class="headerlink" title="18-4-2-1 语法"></a>18-4-2-1 语法</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段<span class="operator">|</span>聚合函数 <span class="keyword">FROM</span> 表 [<span class="keyword">WHERE</span> 条件] <span class="keyword">GROUP</span> <span class="keyword">BY</span> 列</span><br><span class="line"></span><br><span class="line"><span class="comment">--聚合函数有:</span></span><br><span class="line"><span class="built_in">SUM</span>(列) 求和</span><br><span class="line"><span class="built_in">AVG</span>(列) 求平均值</span><br><span class="line"><span class="built_in">MIN</span>(列) 求最小值</span><br><span class="line"><span class="built_in">MAX</span>(列) 求最大值</span><br><span class="line"><span class="built_in">COUNT</span>(列<span class="operator">|</span><span class="operator">*</span>) 求数量</span><br></pre></td></tr></table></figure></div>

<h4 id="18-4-2-2-注意"><a href="#18-4-2-2-注意" class="headerlink" title="18-4-2-2 注意"></a>18-4-2-2 注意</h4><p>GROUP BY 中出现了哪个列，哪个列才能出现在 SELECT 中的非聚合中。</p>
<h3 id="18-4-3-排序"><a href="#18-4-3-排序" class="headerlink" title="18-4-3 排序"></a>18-4-3 排序</h3><h4 id="18-4-3-1-基础语法"><a href="#18-4-3-1-基础语法" class="headerlink" title="18-4-3-1 基础语法"></a>18-4-3-1 基础语法</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line">可以对查询的结果，使用 <span class="keyword">ORDER</span> <span class="keyword">BY</span> 关键字，指定某个列进行排序，语法:</span><br><span class="line"><span class="keyword">SELECT</span> 列<span class="operator">|</span>聚合函数<span class="operator">|</span><span class="operator">*</span> <span class="keyword">FROM</span> 表</span><br><span class="line"><span class="keyword">WHERE</span> ...</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ...</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> ... [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>]</span><br><span class="line"></span><br><span class="line">演示:</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTs</span> student;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student(</span><br><span class="line">	id <span class="type">INT</span>,</span><br><span class="line">	name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">	age <span class="type">INT</span>,</span><br><span class="line">	gender <span class="type">VARCHAR</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span> (<span class="number">10001</span>,<span class="string">&#x27;周杰轮&#x27;</span>,<span class="number">31</span>,<span class="string">&#x27;男&#x27;</span>),(<span class="number">10002</span>,<span class="string">&#x27;王力鸿&#x27;</span>,<span class="number">33</span>,<span class="string">&#x27;男&#x27;</span>),(<span class="number">10003</span>,<span class="string">&#x27;蔡依琳&#x27;</span>,<span class="number">35</span>,<span class="string">&#x27;女&#x27;</span>),</span><br><span class="line">(<span class="number">10004</span>,<span class="string">&#x27;林志灵&#x27;</span>,<span class="number">36</span>,<span class="string">&#x27;女&#x27;</span>),(<span class="number">10005</span>,<span class="string">&#x27;刘德滑&#x27;</span>,<span class="number">30</span>,<span class="string">&#x27;男&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#按年龄隆序排序结果</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">DESC</span>;</span><br><span class="line">#按ID升序排序结果</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">31</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br></pre></td></tr></table></figure></div>

<h4 id="18-4-3-2-排序和分页限制语法"><a href="#18-4-3-2-排序和分页限制语法" class="headerlink" title="18-4-3-2 排序和分页限制语法"></a>18-4-3-2 排序和分页限制语法</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列<span class="operator">|</span>聚合函数<span class="operator">|</span><span class="operator">*</span> <span class="keyword">FROM</span> 表</span><br><span class="line"><span class="keyword">WHERE</span> ...</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ...</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> ... [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>]</span><br><span class="line">LIMIT n[, m] #如果只有n，则是截取n个数据；如果有n和m，则是跳过n个数据，截取m个数据。</span><br></pre></td></tr></table></figure></div>

<p>注意：</p>
<ul>
<li>WHERE、GROUP BY、ORDER BY、LIMIT均可按需求省略。</li>
<li>SELECT和 FROM 是必写的。</li>
<li>执行顺序：<ul>
<li>FROM -&gt; WHERE -&gt; GROUP BY和聚合函数 -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT。</li>
</ul>
</li>
</ul>
<h2 id="18-5-python操作"><a href="#18-5-python操作" class="headerlink" title="18-5 python操作"></a>18-5 python操作</h2><h3 id="18-5-1-创建到数据库的链接"><a href="#18-5-1-创建到数据库的链接" class="headerlink" title="18-5-1 创建到数据库的链接"></a>18-5-1 创建到数据库的链接</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pymysql <span class="keyword">import</span> Connection</span><br><span class="line"><span class="comment">#获取到MySQL数据库的链接对象</span></span><br><span class="line">conn = Connection(</span><br><span class="line">	host=<span class="string">&#x27;localhost&#x27;</span>, <span class="comment">#主机名(或IP地址)</span></span><br><span class="line">    port=<span class="number">3306</span>, <span class="comment">#端口，默认3306</span></span><br><span class="line">    user=<span class="string">&#x27;root&#x27;</span>, <span class="comment">#账户名</span></span><br><span class="line">	password=<span class="string">&#x27;123456&#x27;</span> <span class="comment">#密码</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印MySQL数据库软件信息</span></span><br><span class="line"><span class="built_in">print</span>(conn.get_server_info())</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭到数据库的链接</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure></div>

<h3 id="18-5-2-执行非查询性质的SQL语句"><a href="#18-5-2-执行非查询性质的SQL语句" class="headerlink" title="18-5-2 执行非查询性质的SQL语句"></a>18-5-2 执行非查询性质的SQL语句</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pymysql <span class="keyword">import</span> Connection</span><br><span class="line"><span class="comment">#获取到MySQL数据库的链接对象</span></span><br><span class="line">conn = Connection(</span><br><span class="line">	host=<span class="string">&#x27;1oca1host&#x27;</span>, <span class="comment">#主机名(或IP地址)</span></span><br><span class="line">    port=<span class="number">3306</span>, <span class="comment">#端口，默认3306</span></span><br><span class="line">    user=<span class="string">&#x27;root&#x27;</span>, <span class="comment">#账户名</span></span><br><span class="line">    password=<span class="string">&#x27;123456&#x27;</span> <span class="comment">#密码</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取游标对象</span></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line">conn.select_db(<span class="string">&quot;test&quot;</span>) <span class="comment">#先选择数据库</span></span><br><span class="line"><span class="comment">#使用游标对象，执行sql语句</span></span><br><span class="line">cursor.execute(<span class="string">&quot;CREATE TABLE test_pymysql(id INT, info VARCHAR(255))&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭到数据库的链接</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure></div>

<h3 id="18-5-3-执行查询性质的SQL语句"><a href="#18-5-3-执行查询性质的SQL语句" class="headerlink" title="18-5-3 执行查询性质的SQL语句"></a>18-5-3 执行查询性质的SQL语句</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pymysql <span class="keyword">import</span> Connection</span><br><span class="line"><span class="comment">#获取到MySQL数据库的链接对象</span></span><br><span class="line">conn = Connection(</span><br><span class="line">	host=<span class="string">&#x27;1oca1host&#x27;</span>, <span class="comment">#主机名(或IP地址)</span></span><br><span class="line">    port=<span class="number">3306</span>, <span class="comment">#端口，默认3306</span></span><br><span class="line">    user=<span class="string">&#x27;root&#x27;</span>, <span class="comment">#账户名</span></span><br><span class="line">    password=<span class="string">&#x27;123456&#x27;</span> <span class="comment">#密码</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取游标对象</span></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line">conn.select_db(<span class="string">&quot;test&quot;</span>) <span class="comment">#先选择数据库</span></span><br><span class="line"><span class="comment">#使用游标对象，执行sql语句</span></span><br><span class="line">cursor.execute(<span class="string">&quot;SELECT * FROM student&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取查询结果</span></span><br><span class="line">results: <span class="built_in">tuple</span> = cursor.fetchall()</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">	<span class="built_in">print</span>(r)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#关闭到数据库的链接</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure></div>

<p>注意：</p>
<p>通过连接对象调用cursor ( ) 方法，得到游标对象</p>
<ul>
<li>游标对象 .execute ( ) 执行SQL语句</li>
<li>游标对象 .fetchall ( ) 得到全部的查询结果封装入元组内</li>
</ul>
<h3 id="18-5-4-提交"><a href="#18-5-4-提交" class="headerlink" title="18-5-4 提交"></a>18-5-4 提交</h3><h4 id="18-5-4-1-commit-提交"><a href="#18-5-4-1-commit-提交" class="headerlink" title="18-5-4-1 commit 提交"></a>18-5-4-1 commit 提交</h4><p>pymysql 库在执行对数据库有修改操作的行为时，是需要通过链接对象的 commit 成员方法来进行确认的。</p>
<p>只有确认的修改，才能生效。</p>
<h4 id="18-5-4-2-自动提交"><a href="#18-5-4-2-自动提交" class="headerlink" title="18-5-4-2 自动提交"></a>18-5-4-2 自动提交</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"># 构建到MySQL数据库的链接</span><br><span class="line">conn <span class="operator">=</span> Connection(</span><br><span class="line">	host<span class="operator">=</span>&quot;localhost&quot;, #主机名(IP)</span><br><span class="line">    port<span class="operator">=</span><span class="number">3306</span>, #端口</span><br><span class="line">	<span class="keyword">user</span><span class="operator">=</span>&quot;root&quot;, #账户</span><br><span class="line">	password<span class="operator">=</span>&quot;123456&quot;, #密码</span><br><span class="line">	autocommit<span class="operator">=</span><span class="literal">True</span> #设置自动提交</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<h1 id="19-PySpork"><a href="#19-PySpork" class="headerlink" title="19- PySpork"></a>19- PySpork</h1><h2 id="19-1-数据输入"><a href="#19-1-数据输入" class="headerlink" title="19-1 数据输入"></a>19-1 数据输入</h2><h3 id="19-1-1-Python对象"><a href="#19-1-1-Python对象" class="headerlink" title="19-1-1 Python对象"></a>19-1-1 Python对象</h3><p>PySpark 支持通过 SparkContext 对象的 parallelize 成员方法，将 list、tuple、set、dict、str 转换为 PySpark 的 RDD 对象。</p>
<p>注意：</p>
<ul>
<li>字符串会被拆分出一个个的字符，存入 RDD 对象</li>
<li>字典仅有 key 会被存入 RDD 对象</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setMaster(<span class="string">&quot;local[*]&quot;</span>).\setAppName(<span class="string">&quot;test_spark_app&quot;</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line">rdd = sc.parallelize(数据容器对象)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出RDD的内容</span></span><br><span class="line"><span class="built_in">print</span>(rdd.collect())</span><br></pre></td></tr></table></figure></div>

<h3 id="19-1-2-文件"><a href="#19-1-2-文件" class="headerlink" title="19-1-2 文件"></a>19-1-2 文件</h3><p>PySpark 也支持通过 SparkContext 入口对象，来读取文件，来构建出 RDD 对象。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"></span><br><span class="line">conf = Sparkconf().setMaster(<span class="string">&quot;local[*]&quot;</span>).\setAppName(<span class="string">&quot;test_spark_app&quot;</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line">rdd =sc.textFie(文件路径)</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印RDD内容</span></span><br><span class="line"><span class="built_in">print</span>(rdd.collect())</span><br></pre></td></tr></table></figure></div>

<h2 id="19-2-数据计算"><a href="#19-2-数据计算" class="headerlink" title="19-2 数据计算"></a>19-2 数据计算</h2><h3 id="19-2-1-map"><a href="#19-2-1-map" class="headerlink" title="19-2-1 map"></a>19-2-1 map</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/288b0277-fe93-43f3-b3f9-de038815ad23-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#准备一个RDD</span></span><br><span class="line">rdd = sc.parallelize([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过map方法将全部数据都乘以10</span></span><br><span class="line"><span class="comment">#def func(data):</span></span><br><span class="line"><span class="comment">#	return data *10</span></span><br><span class="line"></span><br><span class="line">rdd2 = rdd.<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x*<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(rdd2.collect())</span><br><span class="line"><span class="comment">#(T)-&gt;U</span></span><br><span class="line"><span class="comment">#(T)-&gt;T</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#链式调用</span></span><br><span class="line">rdd3 = rdd2.<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x+<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#组合简写</span></span><br><span class="line">rdd4 = rdd.<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x*<span class="number">10</span>).<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x+<span class="number">5</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="19-2-2-flatMap"><a href="#19-2-2-flatMap" class="headerlink" title="19-2-2 flatMap"></a>19-2-2 flatMap</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/5bcab126-91e3-43f1-99e3-36a4d258271b-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="19-2-3-reduceByKey"><a href="#19-2-3-reduceByKey" class="headerlink" title="19-2-3 reduceByKey"></a>19-2-3 reduceByKey</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/bbeb7e1c-29c3-4ebb-ba65-0259bb71bb9e-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="19-2-4-filter"><a href="#19-2-4-filter" class="headerlink" title="19-2-4 filter"></a>19-2-4 filter</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/ef7ef679-7060-4818-b230-1c5132ab3ee0-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="19-2-5-distinct"><a href="#19-2-5-distinct" class="headerlink" title="19-2-5 distinct"></a>19-2-5 distinct</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/523a1565-c8b4-423d-9efa-770d4b78a43a-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="19-2-6-sortBy"><a href="#19-2-6-sortBy" class="headerlink" title="19-2-6 sortBy"></a>19-2-6 sortBy</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/61b7395d-aa7c-46c5-b20c-4a8b97db298b-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="19-3-数据输出"><a href="#19-3-数据输出" class="headerlink" title="19-3 数据输出"></a>19-3 数据输出</h2><h3 id="19-3-1-输出为Python对象"><a href="#19-3-1-输出为Python对象" class="headerlink" title="19-3-1 输出为Python对象"></a>19-3-1 输出为Python对象</h3><h4 id="19-3-1-1-collect算子"><a href="#19-3-1-1-collect算子" class="headerlink" title="19-3-1-1 collect算子"></a>19-3-1-1 collect算子</h4><p>功能：将 RDD 各个分区内的数据，统一收集到 Driver 中，形成一个 List 对象</p>
<p>用法：rdd.collect ( )</p>
<p>返回值：是一个list</p>
<h4 id="19-3-1-2-take算子"><a href="#19-3-1-2-take算子" class="headerlink" title="19-3-1-2 take算子"></a>19-3-1-2 take算子</h4><p>功能：取 RDD 的前 N 个元素，组合成 list 返回</p>
<p>用法：sc.parallelize ( [ 3,2,1,4,5,6 ] ).take ( 5 )</p>
<p>结果：[3，2，1，4，5]</p>
<h4 id="19-3-1-3-count算子"><a href="#19-3-1-3-count算子" class="headerlink" title="19-3-1-3 count算子"></a>19-3-1-3 count算子</h4><p>功能：计算 RDD 有多少条数据，返回值是一个数字</p>
<p>用法：sc.parallelize ( [ 3,2,1,4,5,6 ] ).count ( )</p>
<p>结果：6</p>
<h4 id="19-3-1-4-reduce算子"><a href="#19-3-1-4-reduce算子" class="headerlink" title="19-3-1-4 reduce算子"></a>19-3-1-4 reduce算子</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/d88002f0-f0da-4264-b12e-b4a70410f47b-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="19-3-2-输出到文件"><a href="#19-3-2-输出到文件" class="headerlink" title="19-3-2 输出到文件"></a>19-3-2 输出到文件</h3><h4 id="19-3-2-1-修改RDD分区为1个"><a href="#19-3-2-1-修改RDD分区为1个" class="headerlink" title="19-3-2-1 修改RDD分区为1个"></a>19-3-2-1 修改RDD分区为1个</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240511143925820.png"
                      alt="image-20240511143925820"
                ></li>
</ul>
<h4 id="19-3-2-2-RDD输出到文件的方法"><a href="#19-3-2-2-RDD输出到文件的方法" class="headerlink" title="19-3-2-2 RDD输出到文件的方法"></a>19-3-2-2 RDD输出到文件的方法</h4><p>rdd.saveAsTextFile ( 路径 )</p>
<p>输出的结果是一个文件夹</p>
<p>有几个分区就输出多少个结果文件</p>
<h4 id="19-3-2-3-如何修改RDD分区"><a href="#19-3-2-3-如何修改RDD分区" class="headerlink" title="19-3-2-3 如何修改RDD分区"></a>19-3-2-3 如何修改RDD分区</h4><p>SparkConf 对象设置 conf.set (“spark.default.parallelism”，”1”）</p>
<p>创建RDD的时候，sc.parallelize 方法传入 numSlices 参数为 1</p>
<h1 id="20-高阶"><a href="#20-高阶" class="headerlink" title="20- 高阶"></a>20- 高阶</h1><h2 id="20-1-闭包"><a href="#20-1-闭包" class="headerlink" title="20-1 闭包"></a>20-1 闭包</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/14b83c50-eb31-40a3-9b49-0a6d863ce03b-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/79c10b87-2deb-47a0-90c8-28cd416e8538-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p>结果：20    30</p>
</li>
</ul>
<h2 id="20-2-装饰器"><a href="#20-2-装饰器" class="headerlink" title="20-2 装饰器"></a>20-2 装饰器</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/534555cc-6480-448d-abee-0cb76e51534f-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="20-3-设计模式"><a href="#20-3-设计模式" class="headerlink" title="20-3 设计模式"></a>20-3 设计模式</h2><h3 id="20-3-1-单例模式"><a href="#20-3-1-单例模式" class="headerlink" title="20-3-1 单例模式"></a>20-3-1 单例模式</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/3667556c-61b1-436c-8d35-f3f461d025b5-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h3 id="20-3-2-工厂模式"><a href="#20-3-2-工厂模式" class="headerlink" title="20-3-2 工厂模式"></a>20-3-2 工厂模式</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/c3010b9b-448a-456c-b72b-15af70826d21-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="20-4-多线程"><a href="#20-4-多线程" class="headerlink" title="20-4 多线程"></a>20-4 多线程</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/3772c3ed-e033-4ea8-82f7-dd89e203173a-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/09feff2d-7948-4f2d-8932-e6eb617a2719-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
<h2 id="20-5-socket服务端"><a href="#20-5-socket服务端" class="headerlink" title="20-5 socket服务端"></a>20-5 socket服务端</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/f209c4d3-aa19-4b1a-b049-aaa761135f80-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="20-6-socket客户端"><a href="#20-6-socket客户端" class="headerlink" title="20-6 socket客户端"></a>20-6 socket客户端</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/0db0a86c-6fea-45f5-9b0d-6b7ae62a9c5c-25143160.jpg"
                      alt="img"
                ></li>
</ul>
<h2 id="20-7-正则表达式"><a href="#20-7-正则表达式" class="headerlink" title="20-7 正则表达式"></a>20-7 正则表达式</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/23a283e3-33f4-409c-ae9d-1d140f855ff3-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/eb0f609b-8665-4b92-8b16-f259cd6d7182-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/c26ae980-1420-43c5-91a5-c6a4b2e449dc-25143160.jpg"
                      alt="img"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/d127a325-e85f-4d91-a2bc-c2ec62094f16-25143160.jpg"
                      alt="img"
                ></p>
</li>
</ul>
]]></content>
      <categories>
        <category>后端</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>课程笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>RuoYi框架</title>
    <url>/2024/05/25/RuoYi%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<h1 id="一、"><a href="#一、" class="headerlink" title="一、"></a>一、</h1><h1 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1- 介绍"></a>1- 介绍</h1><p>1、开源项目</p>
<p>2、学习目标：</p>
<ul>
<li>使用，减少自己的工作量</li>
<li>学习优秀开源项目底层的编程思想，设计思路，提高自己的编程能力</li>
</ul>
<p>3、官网：</p>
<ul>
<li><a class="link"   href="https://doc.ruoyi.vip/ruoyi-vue/" >介绍 | RuoYi <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<p>4、基础：</p>
<ul>
<li>Spring Boot + Vue</li>
</ul>
<p>5、环境：</p>
<ul>
<li>JDK 1.8</li>
<li>MySQL</li>
<li>Redis</li>
<li>Maven</li>
<li>Vue</li>
</ul>
<p>6、使用步骤</p>
<ul>
<li>下载并运行</li>
<li>看懂业务流程</li>
<li>进行二次开发</li>
</ul>
<h1 id="2-使用"><a href="#2-使用" class="headerlink" title="2- 使用"></a>2- 使用</h1><h2 id="2-1-结构介绍"><a href="#2-1-结构介绍" class="headerlink" title="2-1 结构介绍"></a>2-1 结构介绍</h2><h3 id="2-1-1-后端结构"><a href="#2-1-1-后端结构" class="headerlink" title="2-1-1 后端结构"></a>2-1-1 后端结构</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528142439009.png"
                      alt="image-20240528142439009"
                ></p>
<h3 id="2-1-2-前端结构"><a href="#2-1-2-前端结构" class="headerlink" title="2-1-2 前端结构"></a>2-1-2 前端结构</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528142544193.png"
                      alt="image-20240528142544193"
                ></p>
<h2 id="2-2-下载"><a href="#2-2-下载" class="headerlink" title="2-2 下载"></a>2-2 下载</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://gitee.com/y_project/RuoYi-Vue.git</span><br></pre></td></tr></table></figure></div>

<h2 id="2-3-启动后端"><a href="#2-3-启动后端" class="headerlink" title="2-3 启动后端"></a>2-3 启动后端</h2><h3 id="2-3-1-配置MySQL"><a href="#2-3-1-配置MySQL" class="headerlink" title="2-3-1 配置MySQL"></a>2-3-1 配置MySQL</h3><ul>
<li>1、执行 sql 文件夹下的 sql脚本</li>
<li>2、修改数据库连接（application-druid.yml）</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240525222739816.png"
                      alt="image-20240525222739816"
                ></li>
</ul>
<h3 id="2-3-2-配置Redis"><a href="#2-3-2-配置Redis" class="headerlink" title="2-3-2 配置Redis"></a>2-3-2 配置Redis</h3><ul>
<li><p>修改Redis连接（application.yml）</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240525222917137.png"
                      alt="image-20240525222917137"
                ></p>
</li>
</ul>
<h2 id="2-4-启动前端"><a href="#2-4-启动前端" class="headerlink" title="2-4 启动前端"></a>2-4 启动前端</h2><p>安装依赖：</p>
<ul>
<li>npm install</li>
</ul>
<p>启动服务：</p>
<ul>
<li>npm run dev</li>
</ul>
<p>浏览器访问：</p>
<ul>
<li><a class="link"   href="http://localhost/" >http://localhost:80 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<h1 id="3-登录"><a href="#3-登录" class="headerlink" title="3- 登录"></a>3- 登录</h1><h2 id="3-1-验证码"><a href="#3-1-验证码" class="headerlink" title="3-1 验证码"></a>3-1 验证码</h2><h3 id="3-1-1-思路"><a href="#3-1-1-思路" class="headerlink" title="3-1-1 思路"></a>3-1-1 思路</h3><p>后端生成一个表达式，1+1&#x3D;2</p>
<p>1+1&#x3D;?@2</p>
<p>1+1&#x3D;? 转成图片，传到前端进行展示</p>
<p>2 存入 Redis</p>
<p>前端提交登录表单，把表单的 2 和 Redis 的 2 比较</p>
<h3 id="3-1-2-前端实现"><a href="#3-1-2-前端实现" class="headerlink" title="3-1-2 前端实现"></a>3-1-2 前端实现</h3><ul>
<li>login.vue</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526090733159.png"
                      alt="image-20240526090733159"
                ></p>
<ul>
<li>ruoyi-ui.src.api.login.js</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526090814027.png"
                      alt="image-20240526090814027"
                ></p>
<ul>
<li>ruoyi-ui.src.utils.request.js</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526090932731.png"
                      alt="image-20240526090932731"
                ></p>
<ul>
<li>.env.development</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526091141931.png"
                      alt="image-20240526091141931"
                ></p>
<ul>
<li>http: &#x2F;&#x2F;localhost&#x2F;dev-api&#x2F;captchalmage</li>
</ul>
<p>是前端请求，但Vue是从后端获取图片，为什么：</p>
<p>反向代理，url请求前端，进行代理，映射到后端，解决跨越问题。</p>
<ul>
<li>vue.config.js</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240526092508638.png"
                      alt="image-20240526092508638"
                ></p>
<p>pathRewrite：路径重写，将 &#x2F;dev-api 替换为 ‘ ‘。</p>
<p>然后再映射到 http: &#x2F;&#x2F;localhost:8080 。</p>
<h3 id="3-1-3-后端实现"><a href="#3-1-3-后端实现" class="headerlink" title="3-1-3 后端实现"></a>3-1-3 后端实现</h3><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.common.CaptchaController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证码操作处理</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CaptchaController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Resource(name = &quot;captchaProducer&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Producer captchaProducer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;captchaProducerMath&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Producer captchaProducerMath;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ISysConfigService configService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成验证码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/captchaImage&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">getCode</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">captchaEnabled</span> <span class="operator">=</span> configService.selectCaptchaEnabled(); <span class="comment">//检验是否开启验证码</span></span><br><span class="line">        ajax.put(<span class="string">&quot;captchaEnabled&quot;</span>, captchaEnabled);</span><br><span class="line">        <span class="keyword">if</span> (!captchaEnabled)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> ajax;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存验证码信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> IdUtils.simpleUUID(); <span class="comment">//获取uuid</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">verifyKey</span> <span class="operator">=</span> CacheConstants.CAPTCHA_CODE_KEY + uuid; <span class="comment">//将uuid与前缀拼接，变成key值</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">capStr</span> <span class="operator">=</span> <span class="literal">null</span>, code = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">captchaType</span> <span class="operator">=</span> RuoYiConfig.getCaptchaType();</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;math&quot;</span>.equals(captchaType))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">capText</span> <span class="operator">=</span> captchaProducerMath.createText(); <span class="comment">//获取验证码</span></span><br><span class="line">            capStr = capText.substring(<span class="number">0</span>, capText.lastIndexOf(<span class="string">&quot;@&quot;</span>)); <span class="comment">//@分割，@前的表达式 </span></span><br><span class="line">            code = capText.substring(capText.lastIndexOf(<span class="string">&quot;@&quot;</span>) + <span class="number">1</span>); <span class="comment">//@后的答案</span></span><br><span class="line">            image = captchaProducerMath.createImage(capStr); <span class="comment">//生成图片</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;char&quot;</span>.equals(captchaType))</span><br><span class="line">        &#123;</span><br><span class="line">            capStr = code = captchaProducer.createText();</span><br><span class="line">            image = captchaProducer.createImage(capStr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将key值，答案，有效期，分钟一起存入Redis</span></span><br><span class="line">        redisCache.setCacheObject(verifyKey, code, Constants.CAPTCHA_EXPIRATION, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">// 转换流信息写出</span></span><br><span class="line">        <span class="type">FastByteArrayOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastByteArrayOutputStream</span>();</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            ImageIO.write(image, <span class="string">&quot;jpg&quot;</span>, os);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> AjaxResult.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ajax.put(<span class="string">&quot;uuid&quot;</span>, uuid);</span><br><span class="line">        ajax.put(<span class="string">&quot;img&quot;</span>, Base64.encode(os.toByteArray()));</span><br><span class="line">        <span class="keyword">return</span> ajax; <span class="comment">//将uuid和验证码图片返回前端</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="3-2-登录"><a href="#3-2-登录" class="headerlink" title="3-2 登录"></a>3-2 登录</h2><h3 id="3-2-1-后端思路"><a href="#3-2-1-后端思路" class="headerlink" title="3-2-1 后端思路"></a>3-2-1 后端思路</h3><ul>
<li>1、校验验证码</li>
<li>2、校验用户名和密码</li>
<li>3、生成 Token</li>
<li>使用异步任务管理器，结合线程池，实现了异步的操作日志记录，和业务逻辑实现异步解耦合。</li>
</ul>
<h3 id="3-2-2-后端实现"><a href="#3-2-2-后端实现" class="headerlink" title="3-2-2 后端实现"></a>3-2-2 后端实现</h3><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysLoginController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SysLoginService loginService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录方法</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> loginBody 登录信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginBody loginBody)</span> <span class="comment">//前端提交的登录表单内容</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">    <span class="comment">// 生成令牌</span></span><br><span class="line">    <span class="comment">//得到用户名、密码、验证码答案、uuid</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> loginService.login(loginBody.getUsername(), loginBody.getPassword(), 				                    loginBody.getCode(),loginBody.getUuid()); <span class="comment">//调用login</span></span><br><span class="line">    ajax.put(Constants.TOKEN, token);</span><br><span class="line">    <span class="keyword">return</span> ajax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-framework.com.ruoyi.framework.web.service.SysLoginService</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录校验方法</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysLoginService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenService tokenService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ISysUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ISysConfigService configService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录验证</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uuid 唯一标识</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(String username, String password, String code, String uuid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 验证码校验</span></span><br><span class="line">        validateCaptcha(username, code, uuid);</span><br><span class="line">        <span class="comment">// 登录前置校验</span></span><br><span class="line">        loginPreCheck(username, password);</span><br><span class="line">        <span class="comment">// 用户验证</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span>                             <span class="title class_">UsernamePasswordAuthenticationToken</span>(username, password);</span><br><span class="line">            AuthenticationContextHolder.setContext(authenticationToken);</span><br><span class="line">            <span class="comment">// 该方法会去调用UserDetailsServiceImpl.loadUserByUsername</span></span><br><span class="line">            authentication = authenticationManager.authenticate(authenticationToken);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> BadCredentialsException)</span><br><span class="line">            &#123;</span><br><span class="line">                AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL,   MessageUtils.message(<span class="string">&quot;user.password.not.match&quot;</span>)));</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserPasswordNotMatchException</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL,   e.getMessage()));</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span></span><br><span class="line">        &#123;</span><br><span class="line">            AuthenticationContextHolder.clearContext();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//记录操作日志</span></span><br><span class="line">        AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_SUCCESS, MessageUtils.message(<span class="string">&quot;user.login.success&quot;</span>)));</span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> (LoginUser) authentication.getPrincipal();</span><br><span class="line">        <span class="comment">//记录用户最新的登录信息</span></span><br><span class="line">        recordLoginInfo(loginUser.getUserId());</span><br><span class="line">        <span class="comment">// 生成token</span></span><br><span class="line">        <span class="keyword">return</span> tokenService.createToken(loginUser); <span class="comment">//调用createToken</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验验证码</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uuid 唯一标识</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validateCaptcha</span><span class="params">(String username, String code, String uuid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">captchaEnabled</span> <span class="operator">=</span> configService.selectCaptchaEnabled();</span><br><span class="line">        <span class="keyword">if</span> (captchaEnabled)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">verifyKey</span> <span class="operator">=</span> CacheConstants.CAPTCHA_CODE_KEY + StringUtils.nvl(uuid, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">captcha</span> <span class="operator">=</span> redisCache.getCacheObject(verifyKey); <span class="comment">//从Redis里面获取key值对应的答案  </span></span><br><span class="line">            redisCache.deleteObject(verifyKey); <span class="comment">//从Redis里面删除key值</span></span><br><span class="line">            <span class="keyword">if</span> (captcha == <span class="literal">null</span>) <span class="comment">//如果Redis答案不存在</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//异步日志</span></span><br><span class="line">                AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;user.jcaptcha.expire&quot;</span>)));</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CaptchaExpireException</span>(); <span class="comment">//抛出过期异常</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!code.equalsIgnoreCase(captcha)) <span class="comment">//如果验证码答案和Redis答案不一致</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//异步日志</span></span><br><span class="line">                AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;user.jcaptcha.error&quot;</span>)));</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CaptchaException</span>(); <span class="comment">//抛出错误异常</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录前置校验</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 用户密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loginPreCheck</span><span class="params">(String username, String password)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 用户名或密码为空 错误</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(username) || StringUtils.isEmpty(password))</span><br><span class="line">        &#123;</span><br><span class="line">            AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;not.null&quot;</span>)));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserNotExistsException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 密码如果不在指定范围内 错误</span></span><br><span class="line">        <span class="keyword">if</span> (password.length() &lt; UserConstants.PASSWORD_MIN_LENGTH</span><br><span class="line">                || password.length() &gt; UserConstants.PASSWORD_MAX_LENGTH)</span><br><span class="line">        &#123;</span><br><span class="line">            AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;user.password.not.match&quot;</span>)));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserPasswordNotMatchException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 用户名不在指定范围内 错误</span></span><br><span class="line">        <span class="keyword">if</span> (username.length() &lt; UserConstants.USERNAME_MIN_LENGTH</span><br><span class="line">                || username.length() &gt; UserConstants.USERNAME_MAX_LENGTH)</span><br><span class="line">        &#123;</span><br><span class="line">            AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;user.password.not.match&quot;</span>)));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserPasswordNotMatchException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// IP黑名单校验</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">blackStr</span> <span class="operator">=</span> configService.selectConfigByKey(<span class="string">&quot;sys.login.blackIPList&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (IpUtils.isMatchedIp(blackStr, IpUtils.getIpAddr()))</span><br><span class="line">        &#123;</span><br><span class="line">            AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message(<span class="string">&quot;login.blocked&quot;</span>)));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BlackListException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 记录登录信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordLoginInfo</span><span class="params">(Long userId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SysUser</span>();</span><br><span class="line">        sysUser.setUserId(userId);</span><br><span class="line">        sysUser.setLoginIp(IpUtils.getIpAddr());</span><br><span class="line">        sysUser.setLoginDate(DateUtils.getNowDate());</span><br><span class="line">        userService.updateUserProfile(sysUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-framework.com.ruoyi.framework.web.service.TokenService</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * token验证处理</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(TokenService.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 令牌自定义标识</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;token.header&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String header;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 令牌秘钥</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;token.secret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String secret;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 令牌有效期（默认30分钟）</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;token.expireTime&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> expireTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">MILLIS_SECOND</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">MILLIS_MINUTE</span> <span class="operator">=</span> <span class="number">60</span> * MILLIS_SECOND;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Long</span> <span class="variable">MILLIS_MINUTE_TEN</span> <span class="operator">=</span> <span class="number">20</span> * <span class="number">60</span> * <span class="number">1000L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户身份信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> LoginUser <span class="title function_">getLoginUser</span><span class="params">(HttpServletRequest request)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取请求携带的令牌</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> getToken(request);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(token))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> parseToken(token);</span><br><span class="line">                <span class="comment">// 解析对应的权限以及用户信息</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> (String) claims.get(Constants.LOGIN_USER_KEY);</span><br><span class="line">                <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> getTokenKey(uuid);</span><br><span class="line">                <span class="type">LoginUser</span> <span class="variable">user</span> <span class="operator">=</span> redisCache.getCacheObject(userKey);</span><br><span class="line">                <span class="keyword">return</span> user;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                log.error(<span class="string">&quot;获取用户信息异常&#x27;&#123;&#125;&#x27;&quot;</span>, e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置用户身份信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLoginUser</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotNull(loginUser) &amp;&amp; StringUtils.isNotEmpty(loginUser.getToken()))</span><br><span class="line">        &#123;</span><br><span class="line">            refreshToken(loginUser);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除用户身份信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delLoginUser</span><span class="params">(String token)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(token))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> getTokenKey(token);</span><br><span class="line">            redisCache.deleteObject(userKey);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建令牌</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginUser 用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 令牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createToken</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> IdUtils.fastUUID();</span><br><span class="line">        loginUser.setToken(token);</span><br><span class="line">        setUserAgent(loginUser);</span><br><span class="line">        refreshToken(loginUser);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        claims.put(Constants.LOGIN_USER_KEY, token);</span><br><span class="line">        <span class="keyword">return</span> createToken(claims);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 验证令牌有效期，相差不足20分钟，自动刷新缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginUser</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 令牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">verifyToken</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">expireTime</span> <span class="operator">=</span> loginUser.getExpireTime();</span><br><span class="line">        <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">if</span> (expireTime - currentTime &lt;= MILLIS_MINUTE_TEN)</span><br><span class="line">        &#123;</span><br><span class="line">            refreshToken(loginUser);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 刷新令牌有效期</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginUser 登录信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refreshToken</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        loginUser.setLoginTime(System.currentTimeMillis());</span><br><span class="line">        loginUser.setExpireTime(loginUser.getLoginTime() + expireTime * MILLIS_MINUTE);</span><br><span class="line">        <span class="comment">// 根据uuid将loginUser缓存</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> getTokenKey(loginUser.getToken());</span><br><span class="line">        redisCache.setCacheObject(userKey, loginUser, expireTime, TimeUnit.MINUTES);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置用户代理信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginUser 登录信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserAgent</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UserAgent</span> <span class="variable">userAgent</span> <span class="operator">=</span> UserAgent.parseUserAgentString(ServletUtils.getRequest().getHeader(<span class="string">&quot;User-Agent&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> IpUtils.getIpAddr();</span><br><span class="line">        loginUser.setIpaddr(ip);</span><br><span class="line">        loginUser.setLoginLocation(AddressUtils.getRealAddressByIP(ip));</span><br><span class="line">        loginUser.setBrowser(userAgent.getBrowser().getName());</span><br><span class="line">        loginUser.setOs(userAgent.getOperatingSystem().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从数据声明生成令牌</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> claims 数据声明</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 令牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">createToken</span><span class="params">(Map&lt;String, Object&gt; claims)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">                .setClaims(claims)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS512, secret).compact();</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从令牌中获取数据声明</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token 令牌</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 数据声明</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Claims <span class="title function_">parseToken</span><span class="params">(String token)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.parser()</span><br><span class="line">                .setSigningKey(secret)</span><br><span class="line">                .parseClaimsJws(token)</span><br><span class="line">                .getBody();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从令牌中获取用户名</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token 令牌</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsernameFromToken</span><span class="params">(String token)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> parseToken(token);</span><br><span class="line">        <span class="keyword">return</span> claims.getSubject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取请求token</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getToken</span><span class="params">(HttpServletRequest request)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(header);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(token) &amp;&amp; token.startsWith(Constants.TOKEN_PREFIX))</span><br><span class="line">        &#123;</span><br><span class="line">            token = token.replace(Constants.TOKEN_PREFIX, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getTokenKey</span><span class="params">(String uuid)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> CacheConstants.LOGIN_TOKEN_KEY + uuid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="3-2-3-前端实现"><a href="#3-2-3-前端实现" class="headerlink" title="3-2-3 前端实现"></a>3-2-3 前端实现</h3><ul>
<li>login.vue</li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">handleLogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">loginForm</span>.<span class="title function_">validate</span>(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">loginForm</span>.<span class="property">rememberMe</span>) &#123; <span class="comment">//检验是否保存密码</span></span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">set</span>(<span class="string">&quot;username&quot;</span>, <span class="variable language_">this</span>.<span class="property">loginForm</span>.<span class="property">username</span>, &#123; <span class="attr">expires</span>: <span class="number">30</span> &#125;);</span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">set</span>(<span class="string">&quot;password&quot;</span>, <span class="title function_">encrypt</span>(<span class="variable language_">this</span>.<span class="property">loginForm</span>.<span class="property">password</span>), &#123; <span class="attr">expires</span>: <span class="number">30</span> &#125;);</span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">set</span>(<span class="string">&#x27;rememberMe&#x27;</span>, <span class="variable language_">this</span>.<span class="property">loginForm</span>.<span class="property">rememberMe</span>, &#123; <span class="attr">expires</span>: <span class="number">30</span> &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">remove</span>(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">remove</span>(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">                <span class="title class_">Cookies</span>.<span class="title function_">remove</span>(<span class="string">&#x27;rememberMe&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&quot;Login&quot;</span>, <span class="variable language_">this</span>.<span class="property">loginForm</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//调用Login</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="variable language_">this</span>.<span class="property">redirect</span> || <span class="string">&quot;/&quot;</span> &#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;&#125;);</span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">captchaEnabled</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">getCode</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.store.modules.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 登录</span></span><br><span class="line"><span class="title class_">Login</span>(&#123; commit &#125;, userInfo) &#123;</span><br><span class="line">    <span class="keyword">const</span> username = userInfo.<span class="property">username</span>.<span class="title function_">trim</span>()</span><br><span class="line">    <span class="keyword">const</span> password = userInfo.<span class="property">password</span></span><br><span class="line">    <span class="keyword">const</span> code = userInfo.<span class="property">code</span></span><br><span class="line">    <span class="keyword">const</span> uuid = userInfo.<span class="property">uuid</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">login</span>(username, password, code, uuid).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123; <span class="comment">//调用login</span></span><br><span class="line">            <span class="title function_">setToken</span>(res.<span class="property">token</span>)</span><br><span class="line">            <span class="title function_">commit</span>(<span class="string">&#x27;SET_TOKEN&#x27;</span>, res.<span class="property">token</span>)</span><br><span class="line">            <span class="title function_">resolve</span>()</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(error)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.login.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">username, password, code, uuid</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = &#123;</span><br><span class="line">    username,</span><br><span class="line">    password,</span><br><span class="line">    code,</span><br><span class="line">    uuid</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="attr">isToken</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">repeatSubmit</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="4-获取用户角色和权限"><a href="#4-获取用户角色和权限" class="headerlink" title="4- 获取用户角色和权限"></a>4- 获取用户角色和权限</h1><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>获取当前用户的角色和权限信息，存储到 vuex 中。</p>
<h2 id="4-1-前端实现"><a href="#4-1-前端实现" class="headerlink" title="4-1 前端实现"></a>4-1 前端实现</h2><ul>
<li>permission.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//全局路由管理器，前端每个页面跳转都要进入他</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title class_">NProgress</span>.<span class="title function_">start</span>()</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">getToken</span>()) &#123;</span><br><span class="line">    to.<span class="property">meta</span>.<span class="property">title</span> &amp;&amp; store.<span class="title function_">dispatch</span>(<span class="string">&#x27;settings/setTitle&#x27;</span>, to.<span class="property">meta</span>.<span class="property">title</span>)</span><br><span class="line">    <span class="comment">/* has token*/</span></span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">      <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(to.<span class="property">path</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">roles</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        isRelogin.<span class="property">show</span> = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// 判断当前用户是否已拉取完user_info信息</span></span><br><span class="line">        store.<span class="title function_">dispatch</span>(<span class="string">&#x27;GetInfo&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//调用GetInfo</span></span><br><span class="line">          isRelogin.<span class="property">show</span> = <span class="literal">false</span></span><br><span class="line">          store.<span class="title function_">dispatch</span>(<span class="string">&#x27;GenerateRoutes&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">accessRoutes</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 根据roles权限生成可访问的路由表</span></span><br><span class="line">            router.<span class="title function_">addRoutes</span>(accessRoutes) <span class="comment">// 动态添加可访问路由表</span></span><br><span class="line">            <span class="title function_">next</span>(&#123; ...to, <span class="attr">replace</span>: <span class="literal">true</span> &#125;) <span class="comment">// hack方法 确保addRoutes已完成</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            store.<span class="title function_">dispatch</span>(<span class="string">&#x27;LogOut&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="title class_">Message</span>.<span class="title function_">error</span>(err)</span><br><span class="line">              <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 没有token</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(to.<span class="property">path</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// 在免登录白名单，直接进入</span></span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">`/login?redirect=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(to.fullPath)&#125;</span>`</span>) <span class="comment">// 否则全部重定向到登录页</span></span><br><span class="line">      <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.store.modules.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取用户信息</span></span><br><span class="line"><span class="title class_">GetInfo</span>(&#123; commit, state &#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">getInfo</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123; <span class="comment">//调用getInfo</span></span><br><span class="line">            <span class="keyword">const</span> user = res.<span class="property">user</span></span><br><span class="line">            <span class="keyword">const</span> avatar = (user.<span class="property">avatar</span> == <span class="string">&quot;&quot;</span> || user.<span class="property">avatar</span> == <span class="literal">null</span>) ? <span class="built_in">require</span>(<span class="string">&quot;@/assets/images/profile.jpg&quot;</span>) : process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span> + user.<span class="property">avatar</span>;</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">roles</span> &amp;&amp; res.<span class="property">roles</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 验证返回的roles是否是一个非空数组</span></span><br><span class="line">                <span class="comment">//如果存在，将角色与权限存到vuex里面，做全局存储</span></span><br><span class="line">                <span class="title function_">commit</span>(<span class="string">&#x27;SET_ROLES&#x27;</span>, res.<span class="property">roles</span>)</span><br><span class="line">                <span class="title function_">commit</span>(<span class="string">&#x27;SET_PERMISSIONS&#x27;</span>, res.<span class="property">permissions</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">commit</span>(<span class="string">&#x27;SET_ROLES&#x27;</span>, [<span class="string">&#x27;ROLE_DEFAULT&#x27;</span>])</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">commit</span>(<span class="string">&#x27;SET_ID&#x27;</span>, user.<span class="property">userId</span>)</span><br><span class="line">            <span class="title function_">commit</span>(<span class="string">&#x27;SET_NAME&#x27;</span>, user.<span class="property">userName</span>)</span><br><span class="line">            <span class="title function_">commit</span>(<span class="string">&#x27;SET_AVATAR&#x27;</span>, avatar)</span><br><span class="line">            <span class="title function_">resolve</span>(res)</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(error)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.login.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/getInfo&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="4-2-后端实现"><a href="#4-2-后端实现" class="headerlink" title="4-2 后端实现"></a>4-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysLoginController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SysPermissionService permissionService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 获取用户信息</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> 用户信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getInfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">getInfo</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">SysUser</span> <span class="variable">user</span> <span class="operator">=</span> SecurityUtils.getLoginUser().getUser(); <span class="comment">//获取用户信息</span></span><br><span class="line">    <span class="comment">// 角色集合</span></span><br><span class="line">    Set&lt;String&gt; roles = permissionService.getRolePermission(user);</span><br><span class="line">    <span class="comment">// 权限集合</span></span><br><span class="line">    Set&lt;String&gt; permissions = permissionService.getMenuPermission(user);</span><br><span class="line">    <span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">    ajax.put(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line">    ajax.put(<span class="string">&quot;roles&quot;</span>, roles);</span><br><span class="line">    ajax.put(<span class="string">&quot;permissions&quot;</span>, permissions);</span><br><span class="line">    <span class="keyword">return</span> ajax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-framework.com.ruoyi.framework.web.service.SysPermissionService</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取角色数据权限</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 角色权限信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">getRolePermission</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    Set&lt;String&gt; roles = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line">    <span class="comment">// 管理员拥有所有权限</span></span><br><span class="line">    <span class="keyword">if</span> (user.isAdmin()) <span class="comment">//判断是否为超级管理员</span></span><br><span class="line">    &#123;</span><br><span class="line">        roles.add(<span class="string">&quot;admin&quot;</span>); <span class="comment">//&quot;admin&quot;代表超级管理员</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        roles.addAll(roleService.selectRolePermissionByUserId(user.getUserId()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> roles;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取菜单数据权限</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 菜单权限信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">getMenuPermission</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    Set&lt;String&gt; perms = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line">    <span class="comment">// 管理员拥有所有权限</span></span><br><span class="line">    <span class="keyword">if</span> (user.isAdmin()) <span class="comment">//判断是否为超级管理员</span></span><br><span class="line">    &#123;</span><br><span class="line">        perms.add(<span class="string">&quot;*:*:*&quot;</span>); <span class="comment">//&quot;*:*:*&quot;代表有所有权限</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;SysRole&gt; roles = user.getRoles();</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(roles))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 多角色设置permissions属性，以便数据权限匹配权限</span></span><br><span class="line">            <span class="keyword">for</span> (SysRole role : roles)</span><br><span class="line">            &#123;</span><br><span class="line">                Set&lt;String&gt; rolePerms = menuService.selectMenuPermsByRoleId(role.getRoleId());</span><br><span class="line">                role.setPermissions(rolePerms);</span><br><span class="line">                perms.addAll(rolePerms);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            perms.addAll(menuService.selectMenuPermsByUserId(user.getUserId()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> perms;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="4-3-数据库"><a href="#4-3-数据库" class="headerlink" title="4-3 数据库"></a>4-3 数据库</h2><ul>
<li>sys-role（角色表）</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528154630969.png"
                      alt="image-20240528154630969"
                ></p>
<ul>
<li>sys-user（用户表）</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528154657836.png"
                      alt="image-20240528154657836"
                ></p>
<ul>
<li>sys-user-role（中间链接表）</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528154809411.png"
                      alt="image-20240528154809411"
                ></p>
<h1 id="5-获取动态菜单路由"><a href="#5-获取动态菜单路由" class="headerlink" title="5- 获取动态菜单路由"></a>5- 获取动态菜单路由</h1><h2 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h2><p>根据当前用户的权限获取动态路由。</p>
<h2 id="5-1-前端实现"><a href="#5-1-前端实现" class="headerlink" title="5-1 前端实现"></a>5-1 前端实现</h2><ul>
<li>permission.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//全局路由管理器，前端每个页面跳转都要进入他</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title class_">NProgress</span>.<span class="title function_">start</span>()</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">getToken</span>()) &#123;</span><br><span class="line">    to.<span class="property">meta</span>.<span class="property">title</span> &amp;&amp; store.<span class="title function_">dispatch</span>(<span class="string">&#x27;settings/setTitle&#x27;</span>, to.<span class="property">meta</span>.<span class="property">title</span>)</span><br><span class="line">    <span class="comment">/* has token*/</span></span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">      <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(to.<span class="property">path</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">roles</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        isRelogin.<span class="property">show</span> = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// 判断当前用户是否已拉取完user_info信息</span></span><br><span class="line">        store.<span class="title function_">dispatch</span>(<span class="string">&#x27;GetInfo&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          isRelogin.<span class="property">show</span> = <span class="literal">false</span></span><br><span class="line">          store.<span class="title function_">dispatch</span>(<span class="string">&#x27;GenerateRoutes&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">accessRoutes</span> =&gt;</span> &#123; <span class="comment">//调用GenerateRoutes</span></span><br><span class="line">            <span class="comment">// 根据roles权限生成可访问的路由表</span></span><br><span class="line">            router.<span class="title function_">addRoutes</span>(accessRoutes) <span class="comment">// 动态添加可访问路由表</span></span><br><span class="line">            <span class="title function_">next</span>(&#123; ...to, <span class="attr">replace</span>: <span class="literal">true</span> &#125;) <span class="comment">// hack方法 确保addRoutes已完成</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            store.<span class="title function_">dispatch</span>(<span class="string">&#x27;LogOut&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="title class_">Message</span>.<span class="title function_">error</span>(err)</span><br><span class="line">              <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 没有token</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(to.<span class="property">path</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// 在免登录白名单，直接进入</span></span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">`/login?redirect=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(to.fullPath)&#125;</span>`</span>) <span class="comment">// 否则全部重定向到登录页</span></span><br><span class="line">      <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.store.modules.permission.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">  <span class="comment">// 生成路由</span></span><br><span class="line">  <span class="title class_">GenerateRoutes</span>(&#123; commit &#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 向后端请求路由数据</span></span><br><span class="line">      <span class="title function_">getRouters</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123; <span class="comment">//调用getRouters</span></span><br><span class="line">        <span class="keyword">const</span> sdata = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>))</span><br><span class="line">        <span class="keyword">const</span> rdata = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>))</span><br><span class="line">        <span class="keyword">const</span> sidebarRoutes = <span class="title function_">filterAsyncRouter</span>(sdata)</span><br><span class="line">        <span class="keyword">const</span> rewriteRoutes = <span class="title function_">filterAsyncRouter</span>(rdata, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">const</span> asyncRoutes = <span class="title function_">filterDynamicRoutes</span>(dynamicRoutes);</span><br><span class="line">        rewriteRoutes.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>, <span class="attr">redirect</span>: <span class="string">&#x27;/404&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">        router.<span class="title function_">addRoutes</span>(asyncRoutes);</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;SET_ROUTES&#x27;</span>, rewriteRoutes)</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;SET_SIDEBAR_ROUTERS&#x27;</span>, constantRoutes.<span class="title function_">concat</span>(sidebarRoutes))</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;SET_DEFAULT_ROUTES&#x27;</span>, sidebarRoutes)</span><br><span class="line">        <span class="title function_">commit</span>(<span class="string">&#x27;SET_TOPBAR_ROUTES&#x27;</span>, sidebarRoutes)</span><br><span class="line">        <span class="title function_">resolve</span>(rewriteRoutes)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.menu.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getRouters</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/getRouters&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="5-2-后端实现"><a href="#5-2-后端实现" class="headerlink" title="5-2 后端实现"></a>5-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysLoginController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ISysMenuService menuService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取路由信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 路由信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getRouters&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">getRouters</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> SecurityUtils.getUserId(); <span class="comment">//获取用户id</span></span><br><span class="line">    List&lt;SysMenu&gt; menus = menuService.selectMenuTreeByUserId(userId); <span class="comment">//获取对应的分级菜单列表</span></span><br><span class="line">    <span class="keyword">return</span> AjaxResult.success(menuService.buildMenus(menus)); <span class="comment">//构建前端路由所需要的菜单，返回</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysMenuServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户ID查询菜单</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId 用户名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 菜单列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SysMenu&gt; <span class="title function_">selectMenuTreeByUserId</span><span class="params">(Long userId)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysMenu&gt; menus = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (SecurityUtils.isAdmin(userId)) <span class="comment">//判断是否为超级管理员</span></span><br><span class="line">    &#123;</span><br><span class="line">    	menus = menuMapper.selectMenuTreeAll(); <span class="comment">//调用selectMenuTreeAll，根据用户ID查询菜单树信息（所有）</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    	menus = menuMapper.selectMenuTreeByUserId(userId); <span class="comment">//调用selectMenuTreeByUserId，根据用户ID查询菜单树信息</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> getChildPerms(menus, <span class="number">0</span>); <span class="comment">//调用getChildPerms，把菜单树信息转换成分级菜单列表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysMenuServiceImpl</li>
</ul>
<p>本代码是先得到上面（数据库的24条数据和parentId为0），然后找到 parentId为0 的4条数据；</p>
<p>然后从4条数据中的 ”系统管理“ 的menuId和24条数据的 parentId 比较，得到  parentId为1 的9条数据；</p>
<p>然后判断这9条数据是否还有子节点，如果有，则递归，将 “日志管理” 的menuId和24条数据的 parentId 比较，得到 parentId为108 的2条数据。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据父节点的ID获取所有子节点</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> list 分类表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parentId 传入的父节点ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SysMenu&gt; <span class="title function_">getChildPerms</span><span class="params">(List&lt;SysMenu&gt; list, <span class="type">int</span> parentId)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysMenu&gt; returnList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;SysMenu&gt;(); </span><br><span class="line">    <span class="keyword">for</span> (Iterator&lt;SysMenu&gt; iterator = list.iterator(); iterator.hasNext();) <span class="comment">//遍历每个节点  </span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysMenu</span> <span class="variable">t</span> <span class="operator">=</span> (SysMenu) iterator.next();</span><br><span class="line">        <span class="comment">// 一、根据传入的某个父节点ID,遍历该父节点的所有子节点</span></span><br><span class="line">        <span class="keyword">if</span> (t.getParentId() == parentId)</span><br><span class="line">        &#123;</span><br><span class="line">            recursionFn(list, t); <span class="comment">//调用recursionFn，为每个节点设置子节点（如果有） </span></span><br><span class="line">            returnList.add(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> returnList; <span class="comment">//返回分级菜单列表</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递归列表</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> list 分类表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> t 子节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">recursionFn</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 得到子节点列表</span></span><br><span class="line">    List&lt;SysMenu&gt; childList = getChildList(list, t); <span class="comment">//调用getChildList，得到子节点列表</span></span><br><span class="line">    t.setChildren(childList); <span class="comment">//设置子节点</span></span><br><span class="line">    <span class="keyword">for</span> (SysMenu tChild : childList) <span class="comment">//遍历子节点</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasChild(list, tChild))  <span class="comment">//调用hasChild，判断是否子节点还有子节点</span></span><br><span class="line">        &#123;</span><br><span class="line">            recursionFn(list, tChild); <span class="comment">//递归处理</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到子节点列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;SysMenu&gt; <span class="title function_">getChildList</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysMenu&gt; tlist = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;SysMenu&gt;();</span><br><span class="line">    Iterator&lt;SysMenu&gt; it = list.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysMenu</span> <span class="variable">n</span> <span class="operator">=</span> (SysMenu) it.next();</span><br><span class="line">        <span class="keyword">if</span> (n.getParentId().longValue() == t.getMenuId().longValue())</span><br><span class="line">        &#123;</span><br><span class="line">            tlist.add(n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tlist;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断是否有子节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">hasChild</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> getChildList(list, t).size() &gt; <span class="number">0</span>; <span class="comment">//调用getChildList</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="5-3-数据库"><a href="#5-3-数据库" class="headerlink" title="5-3 数据库"></a>5-3 数据库</h2><ul>
<li>sys-menu</li>
</ul>
<p>菜单表是通过 menu-id 与 parent-id 来形成分级菜单的。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240528164545407.png"
                      alt="image-20240528164545407"
                ></p>
<h1 id="6-首页数据加载"><a href="#6-首页数据加载" class="headerlink" title="6- 首页数据加载"></a>6- 首页数据加载</h1><h2 id="6-1-侧边栏菜单"><a href="#6-1-侧边栏菜单" class="headerlink" title="6-1 侧边栏菜单"></a>6-1 侧边栏菜单</h2><ul>
<li>ruoyi-ui.src.layout.components.Sidebar.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;sidebar-item       </span><br><span class="line">    v-for=&quot;(route, index) in sidebarRouters&quot;  //通过遍历，实现侧边栏菜单。   </span><br><span class="line">    :key=&quot;route.path  + index&quot;</span><br><span class="line">    :item=&quot;route&quot;</span><br><span class="line">    :base-path=&quot;route.path&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="6-2-主页面"><a href="#6-2-主页面" class="headerlink" title="6-2 主页面"></a>6-2 主页面</h2><ul>
<li>ruoyi-ui.src.router.index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="title class_">Layout</span>, <span class="comment">//登录后跳向 layout.index.vue </span></span><br><span class="line">  <span class="attr">redirect</span>: <span class="string">&#x27;index&#x27;</span>, <span class="comment">//重定向，从 layout.index.vue 自动跳向 views/index.vue</span></span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/index&#x27;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Index&#x27;</span>,</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;首页&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;dashboard&#x27;</span>, <span class="attr">affix</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.layout.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div :class=&quot;classObj&quot; class=&quot;app-wrapper&quot; :style=&quot;&#123;&#x27;--current-color&#x27;: theme&#125;&quot;&gt;</span><br><span class="line">    &lt;div v-if=&quot;device===&#x27;mobile&#x27;&amp;&amp;sidebar.opened&quot; class=&quot;drawer-bg&quot; @click=&quot;handleClickOutside&quot;/&gt;</span><br><span class="line">    &lt;sidebar v-if=&quot;!sidebar.hide&quot; class=&quot;sidebar-container&quot;/&gt; //侧边栏</span><br><span class="line">    &lt;div :class=&quot;&#123;hasTagsView:needTagsView,sidebarHide:sidebar.hide&#125;&quot; class=&quot;main-container&quot;&gt;</span><br><span class="line">      &lt;div :class=&quot;&#123;&#x27;fixed-header&#x27;:fixedHeader&#125;&quot;&gt;</span><br><span class="line">        &lt;navbar/&gt;</span><br><span class="line">        &lt;tags-view v-if=&quot;needTagsView&quot;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;app-main/&gt; //主页面</span><br><span class="line">      &lt;right-panel&gt;</span><br><span class="line">        &lt;settings/&gt;</span><br><span class="line">      &lt;/right-panel&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.index.vue</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240529200143986.png"
                      alt="image-20240529200143986"
                ></p>
<h2 id="6-3-页面跳转"><a href="#6-3-页面跳转" class="headerlink" title="6-3 页面跳转"></a>6-3 页面跳转</h2><p>从数据库 sys-menu 表中的 component 得到对应功能的 前端页面路径，默认是其下面的 index.vue。</p>
<h1 id="7-用户管理-分页查询"><a href="#7-用户管理-分页查询" class="headerlink" title="7- 用户管理-分页查询"></a>7- 用户管理-分页查询</h1><h2 id="7-1-前端实现"><a href="#7-1-前端实现" class="headerlink" title="7-1 前端实现"></a>7-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 查询用户列表 */</span></span><br><span class="line"><span class="title function_">getList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">true</span>; <span class="comment">//是否开启加载效果</span></span><br><span class="line">    <span class="comment">//调用listUser，携带参数 页数和每页条数</span></span><br><span class="line">    <span class="title function_">listUser</span>(<span class="variable language_">this</span>.<span class="title function_">addDateRange</span>(<span class="variable language_">this</span>.<span class="property">queryParams</span>, <span class="variable language_">this</span>.<span class="property">dateRange</span>)).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">userList</span> = response.<span class="property">rows</span>; <span class="comment">//所有的数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">total</span> = response.<span class="property">total</span>; <span class="comment">//数据总数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span>; <span class="comment">//当加载完毕后，关闭加载效果</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查询用户列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">listUser</span>(<span class="params">query</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user/list&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: query</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="7-2-后端实现"><a href="#7-2-后端实现" class="headerlink" title="7-2 后端实现"></a>7-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:list&#x27;)&quot;)</span> <span class="comment">//判断用户是否有权限</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> TableDataInfo <span class="title function_">list</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    startPage(); <span class="comment">// 调用startPage，此方法配合前端完成自动分页</span></span><br><span class="line">    List&lt;SysUser&gt; list = userService.selectUserList(user); <span class="comment">//调用selectUserList，从数据库查询数据</span></span><br><span class="line">    <span class="keyword">return</span> getDataTable(list); <span class="comment">//返回表格分页数据对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><ul>
<li>ruoyi-common.com.ruoyi.common.utils.PageUtils</li>
</ul>
<p>PageHelper 中的 reasonable 对参数进行逻辑处理，保证参数的正确性。</p>
<p>比如 pageNum &#x3D; 0、-1，那 pageNum 默认 &#x3D;1。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置请求分页数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">startPage</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//1.创建一个PageDomain对象，用于接收前端分页的参数；</span></span><br><span class="line">    <span class="type">PageDomain</span> <span class="variable">pageDomain</span> <span class="operator">=</span> TableSupport.buildPageRequest(); <span class="comment">//调用buildPageRequest，获取分页参数</span></span><br><span class="line">    <span class="comment">//2.从PageDomain对象中提取出当前页码、每页大小、排序条件；</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">pageNum</span> <span class="operator">=</span> pageDomain.getPageNum(); <span class="comment">//获取当前页码</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">pageSize</span> <span class="operator">=</span> pageDomain.getPageSize(); <span class="comment">//获取每页大小</span></span><br><span class="line">    <span class="comment">//3.对排序条件进行转义处理，防止SQL注入；</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">orderBy</span> <span class="operator">=</span> SqlUtil.escapeOrderBySql(pageDomain.getOrderBy());</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">reasonable</span> <span class="operator">=</span> pageDomain.getReasonable(); <span class="comment">//获取是否合理分页</span></span><br><span class="line">    <span class="comment">//4.使用PageHelper开启分页，设置页码、每页大小、排序条件和是否合理分页。</span></span><br><span class="line">    PageHelper.startPage(pageNum, pageSize, orderBy).setReasonable(reasonable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-common.com.ruoyi.common.core.page.TableSupport</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当前记录起始索引</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAGE_NUM</span> <span class="operator">=</span> <span class="string">&quot;pageNum&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 每页显示记录数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAGE_SIZE</span> <span class="operator">=</span> <span class="string">&quot;pageSize&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 排序列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDER_BY_COLUMN</span> <span class="operator">=</span> <span class="string">&quot;orderByColumn&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 排序的方向 &quot;desc&quot; 或者 &quot;asc&quot;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">IS_ASC</span> <span class="operator">=</span> <span class="string">&quot;isAsc&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页参数合理化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REASONABLE</span> <span class="operator">=</span> <span class="string">&quot;reasonable&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装分页对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> PageDomain <span class="title function_">getPageDomain</span><span class="params">()</span> <span class="comment">//获取前端传入的分页参数</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">PageDomain</span> <span class="variable">pageDomain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageDomain</span>();</span><br><span class="line">    pageDomain.setPageNum(Convert.toInt(ServletUtils.getParameter(PAGE_NUM), <span class="number">1</span>));</span><br><span class="line">    pageDomain.setPageSize(Convert.toInt(ServletUtils.getParameter(PAGE_SIZE), <span class="number">10</span>));</span><br><span class="line">    pageDomain.setOrderByColumn(ServletUtils.getParameter(ORDER_BY_COLUMN));</span><br><span class="line">    pageDomain.setIsAsc(ServletUtils.getParameter(IS_ASC));</span><br><span class="line">    pageDomain.setReasonable(ServletUtils.getParameterToBool(REASONABLE));</span><br><span class="line">    <span class="keyword">return</span> pageDomain;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> PageDomain <span class="title function_">buildPageRequest</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> getPageDomain(); <span class="comment">//调用getPageDomain</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<p>注解 @DataScope(deptAlias &#x3D; “d”, userAlias &#x3D; “u”)  作用：</p>
<p>给表设置别名的，sys_dept 是 d，sys_user 是 u。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据条件分页查询用户列表</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 用户信息集合信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@DataScope(deptAlias = &quot;d&quot;, userAlias = &quot;u&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SysUser&gt; <span class="title function_">selectUserList</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> userMapper.selectUserList(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="8-用户管理-公司树状图"><a href="#8-用户管理-公司树状图" class="headerlink" title="8- 用户管理-公司树状图"></a>8- 用户管理-公司树状图</h1><h2 id="8-1-前端实现"><a href="#8-1-前端实现" class="headerlink" title="8-1 前端实现"></a>8-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 查询部门下拉树结构 */</span></span><br><span class="line"><span class="title function_">getDeptTree</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">deptTreeSelect</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; <span class="comment">//调用deptTreeSelect</span></span><br><span class="line">    	<span class="variable language_">this</span>.<span class="property">deptOptions</span> = response.<span class="property">data</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查询部门下拉树结构</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deptTreeSelect</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user/deptTree&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="8-2-后端实现"><a href="#8-2-后端实现" class="headerlink" title="8-2 后端实现"></a>8-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取部门树列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:list&#x27;)&quot;)</span>  <span class="comment">//判断用户是否有权限</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/deptTree&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">deptTree</span><span class="params">(SysDept dept)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> success(deptService.selectDeptTreeList(dept)); <span class="comment">//调用selectDeptTreeList</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysDeptServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询部门树结构信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dept 部门信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 部门树信息集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;TreeSelect&gt; <span class="title function_">selectDeptTreeList</span><span class="params">(SysDept dept)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//调用selectDeptList，得到所有部门数据</span></span><br><span class="line">    List&lt;SysDept&gt; depts = SpringUtils.getAopProxy(<span class="built_in">this</span>).selectDeptList(dept); </span><br><span class="line">    <span class="keyword">return</span> buildDeptTreeSelect(depts); <span class="comment">//调用buildDeptTreeSelect，将得到的部门数据构造成树 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="查询-1"><a href="#查询-1" class="headerlink" title="查询"></a>查询</h3><ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysDeptServiceImpl</li>
</ul>
<p>注解 @DataScope(deptAlias &#x3D; “d”)  作用：</p>
<p>给表设置别名的，sys_dept 是 d。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询部门管理数据</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dept 部门信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 部门信息集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@DataScope(deptAlias = &quot;d&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SysDept&gt; <span class="title function_">selectDeptList</span><span class="params">(SysDept dept)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> deptMapper.selectDeptList(dept);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="构造树"><a href="#构造树" class="headerlink" title="构造树"></a>构造树</h3><ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysDeptServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构建前端所需要下拉树结构</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> depts 部门列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 下拉树结构列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;TreeSelect&gt; <span class="title function_">buildDeptTreeSelect</span><span class="params">(List&lt;SysDept&gt; depts)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysDept&gt; deptTrees = buildDeptTree(depts); <span class="comment">//调用buildDeptTree（核心方法），将传入的部门数据构造成树状图</span></span><br><span class="line">    <span class="comment">//将泛型 SysDept 转成 TreeSelect</span></span><br><span class="line">    <span class="keyword">return</span> deptTrees.stream().map(TreeSelect::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>构造树状图</p>
<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysDeptServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构建前端所需要树结构</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> depts 部门列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 树结构列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SysDept&gt; <span class="title function_">buildDeptTree</span><span class="params">(List&lt;SysDept&gt; depts)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysDept&gt; returnList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;SysDept&gt;();</span><br><span class="line">    List&lt;Long&gt; tempList = depts.stream().map(SysDept::getDeptId).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">for</span> (SysDept dept : depts) <span class="comment">//遍历节点</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果是顶级节点, 遍历该父节点的所有子节点</span></span><br><span class="line">        <span class="keyword">if</span> (!tempList.contains(dept.getParentId()))</span><br><span class="line">        &#123;</span><br><span class="line">            recursionFn(depts, dept); <span class="comment">//调用recursionFn，为每个节点设置子节点（如果有） </span></span><br><span class="line">            returnList.add(dept);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (returnList.isEmpty())</span><br><span class="line">    &#123;</span><br><span class="line">        returnList = depts;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> returnList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysMenuServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递归列表</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> list 分类表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> t 子节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">recursionFn</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 得到子节点列表</span></span><br><span class="line">    List&lt;SysMenu&gt; childList = getChildList(list, t); <span class="comment">//调用getChildList，得到子节点列表</span></span><br><span class="line">    t.setChildren(childList); <span class="comment">//设置子节点</span></span><br><span class="line">    <span class="keyword">for</span> (SysMenu tChild : childList) <span class="comment">//遍历子节点</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasChild(list, tChild))  <span class="comment">//调用hasChild，判断是否子节点还有子节点</span></span><br><span class="line">        &#123;</span><br><span class="line">            recursionFn(list, tChild); <span class="comment">//递归处理</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到子节点列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;SysMenu&gt; <span class="title function_">getChildList</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;SysMenu&gt; tlist = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;SysMenu&gt;();</span><br><span class="line">    Iterator&lt;SysMenu&gt; it = list.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysMenu</span> <span class="variable">n</span> <span class="operator">=</span> (SysMenu) it.next();</span><br><span class="line">        <span class="keyword">if</span> (n.getParentId().longValue() == t.getMenuId().longValue())</span><br><span class="line">        &#123;</span><br><span class="line">            tlist.add(n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tlist;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断是否有子节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">hasChild</span><span class="params">(List&lt;SysMenu&gt; list, SysMenu t)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> getChildList(list, t).size() &gt; <span class="number">0</span>; <span class="comment">//调用getChildList</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>转换泛型</p>
<ul>
<li>ruoyi-common.com.ruoyi.common.core.domain.TreeSelect</li>
</ul>
<p>通过构造方法，将 数据库对应的部门树状图 转变为 前端对应的部门树状图</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 节点ID */</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 节点名称 */</span></span><br><span class="line"><span class="keyword">private</span> String label;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 子节点 */</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_EMPTY)</span></span><br><span class="line"><span class="keyword">private</span> List&lt;TreeSelect&gt; children;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">TreeSelect</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">TreeSelect</span><span class="params">(SysDept dept)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">this</span>.id = dept.getDeptId();</span><br><span class="line">    <span class="built_in">this</span>.label = dept.getDeptName();</span><br><span class="line">    <span class="built_in">this</span>.children = dept.getChildren().stream().map(TreeSelect::<span class="keyword">new</span>).collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>数据库对应</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240530205740821.png"
                      alt="image-20240530205740821"
                ></p>
<ul>
<li>前端对应</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240530205811054.png"
                      alt="image-20240530205811054"
                ></p>
<h2 id="8-3-数据库"><a href="#8-3-数据库" class="headerlink" title="8-3 数据库"></a>8-3 数据库</h2><ul>
<li>sys-dept</li>
</ul>
<p>公司树是通过 dept-id 与 parent-id 来形成树状图的。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240530170350824.png"
                      alt="image-20240530170350824"
                ></p>
<h1 id="9-用户管理-点击树状图查询"><a href="#9-用户管理-点击树状图查询" class="headerlink" title="9- 用户管理-点击树状图查询"></a>9- 用户管理-点击树状图查询</h1><h2 id="9-1-前端实现"><a href="#9-1-前端实现" class="headerlink" title="9-1 前端实现"></a>9-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;head-container&quot;&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">         :data=&quot;deptOptions&quot;</span><br><span class="line">         :props=&quot;defaultProps&quot;</span><br><span class="line">         :expand-on-click-node=&quot;false&quot;</span><br><span class="line">         :filter-node-method=&quot;filterNode&quot;</span><br><span class="line">         ref=&quot;tree&quot;</span><br><span class="line">         node-key=&quot;id&quot;</span><br><span class="line">         default-expand-all</span><br><span class="line">         highlight-current</span><br><span class="line">         @node-click=&quot;handleNodeClick&quot; //点击方法</span><br><span class="line">         /&gt;</span><br><span class="line">&lt;/div&gt;        </span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 节点单击事件</span></span><br><span class="line"><span class="title function_">handleNodeClick</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queryParams</span>.<span class="property">deptId</span> = data.<span class="property">id</span>; <span class="comment">//得到点击的部门ID，作为参数传入后端</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">handleQuery</span>(); <span class="comment">//调用handleQuery</span></span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"><span class="comment">/** 搜索按钮操作 */</span></span><br><span class="line"><span class="title function_">handleQuery</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queryParams</span>.<span class="property">pageNum</span> = <span class="number">1</span>; <span class="comment">//将页数设置为1</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getList</span>(); <span class="comment">//调用getList，获取用户</span></span><br><span class="line">&#125;,    </span><br></pre></td></tr></table></figure></div>

<h2 id="9-2-后端实现"><a href="#9-2-后端实现" class="headerlink" title="9-2 后端实现"></a>9-2 后端实现</h2><p>和 用户管理-分页查询 的后端流程一样，只是会多加一个参数 dept-id，参与查询。</p>
<h1 id="10-添加用户数据预加载（表单）"><a href="#10-添加用户数据预加载（表单）" class="headerlink" title="10- 添加用户数据预加载（表单）"></a>10- 添加用户数据预加载（表单）</h1><h2 id="10-1-前端实现"><a href="#10-1-前端实现" class="headerlink" title="10-1 前端实现"></a>10-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 新增按钮 --&gt;</span><br><span class="line">&lt;el-col :span=&quot;1.5&quot;&gt;</span><br><span class="line">    &lt;el-button</span><br><span class="line">    	type=&quot;primary&quot;</span><br><span class="line">        plain</span><br><span class="line">        icon=&quot;el-icon-plus&quot;</span><br><span class="line">        size=&quot;mini&quot;</span><br><span class="line">        @click=&quot;handleAdd&quot;</span><br><span class="line">        v-hasPermi=&quot;[&#x27;system:user:add&#x27;]&quot;</span><br><span class="line">     &gt;新增&lt;/el-button&gt;</span><br><span class="line">&lt;/el-col&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 新增按钮操作 */</span></span><br><span class="line"><span class="title function_">handleAdd</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">reset</span>(); <span class="comment">//调用reset，表单重置</span></span><br><span class="line">    <span class="title function_">getUser</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; <span class="comment">//调用getUser，获取岗位和角色 </span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">postOptions</span> = response.<span class="property">posts</span>; <span class="comment">//岗位</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">roleOptions</span> = response.<span class="property">roles</span>; <span class="comment">//角色</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">true</span>; <span class="comment">//打开用户表单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&quot;添加用户&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">password</span> = <span class="variable language_">this</span>.<span class="property">initPassword</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 表单重置</span></span><br><span class="line"><span class="title function_">reset</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">form</span> = &#123;</span><br><span class="line">        <span class="attr">userId</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">deptId</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">userName</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">nickName</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">phonenumber</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">email</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">sex</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="attr">remark</span>: <span class="literal">undefined</span>,</span><br><span class="line">        <span class="attr">postIds</span>: [],</span><br><span class="line">        <span class="attr">roleIds</span>: []</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">resetForm</span>(<span class="string">&quot;form&quot;</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查询用户详细</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getUser</span>(<span class="params">userId</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user/&#x27;</span> + <span class="title function_">parseStrEmpty</span>(userId),</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="10-2-后端实现"><a href="#10-2-后端实现" class="headerlink" title="10-2 后端实现"></a>10-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<p>添加和修改使用同一个，有 userId 是修改，无 userId 是添加。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据用户编号获取详细信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:query&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(value = &#123; &quot;/&quot;, &quot;/&#123;userId&#125;&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;userId&quot;, required = false)</span> Long userId)</span></span><br><span class="line">&#123;</span><br><span class="line">    userService.checkUserDataScope(userId); <span class="comment">//调用checkUserDataScope，判断用户是否有数据权限，只有管理员可以</span></span><br><span class="line">    <span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">    List&lt;SysRole&gt; roles = roleService.selectRoleAll();</span><br><span class="line">    <span class="comment">//如果是管理员，获取所有角色；如果不是管理员，则排除管理员角色</span></span><br><span class="line">    ajax.put(<span class="string">&quot;roles&quot;</span>, SysUser.isAdmin(userId) ? roles : roles.stream().filter(r -&gt; !r.isAdmin()).collect(Collectors.toList()));</span><br><span class="line">    <span class="comment">//获取所有岗位</span></span><br><span class="line">    ajax.put(<span class="string">&quot;posts&quot;</span>, postService.selectPostAll());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断是否有userId，如果没有，直接返回；如果有，则获取他的用户信息、角色、岗位返回</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotNull(userId))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> userService.selectUserById(userId);</span><br><span class="line">        ajax.put(AjaxResult.DATA_TAG, sysUser);</span><br><span class="line">        ajax.put(<span class="string">&quot;postIds&quot;</span>, postService.selectPostListByUserId(userId));                                ajax.put(<span class="string">&quot;roleIds&quot;</span>,sysUser.getRoles().stream().map(SysRole::getRoleId).collect(Collectors.toList()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ajax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 校验用户是否有数据权限</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId 用户id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkUserDataScope</span><span class="params">(Long userId)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!SysUser.isAdmin(SecurityUtils.getUserId()))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SysUser</span>();</span><br><span class="line">        user.setUserId(userId);</span><br><span class="line">        List&lt;SysUser&gt; users = SpringUtils.getAopProxy(<span class="built_in">this</span>).selectUserList(user);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(users))</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;没有权限访问用户数据！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="10-3-数据库"><a href="#10-3-数据库" class="headerlink" title="10-3 数据库"></a>10-3 数据库</h2><ul>
<li>sys-post</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240531141555881.png"
                      alt="image-20240531141555881"
                ></p>
<h1 id="11-添加用户"><a href="#11-添加用户" class="headerlink" title="11- 添加用户"></a>11- 添加用户</h1><h2 id="11-1-前端实现"><a href="#11-1-前端实现" class="headerlink" title="11-1 前端实现"></a>11-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<p>归属部门：deptOptions 是 公司树状图的 this.deptOptions &#x3D; response.data，得到树状图。</p>
<p>岗位：item in postOptions 是 this.postOptions &#x3D; response.posts，通过 添加预加载 得到的岗位数据，然后遍历显示。</p>
<p>角色：item in roleOptions 是 this.roleOptions &#x3D; response.roles，通过 添加预加载 得到的角色数据，然后遍历显示。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 添加或修改用户配置对话框 --&gt;</span><br><span class="line">    &lt;el-dialog :title=&quot;title&quot; :visible.sync=&quot;open&quot; width=&quot;600px&quot; append-to-body&gt;</span><br><span class="line">      &lt;el-form ref=&quot;form&quot; :model=&quot;form&quot; :rules=&quot;rules&quot; label-width=&quot;80px&quot;&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;用户昵称&quot; prop=&quot;nickName&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.nickName&quot; placeholder=&quot;请输入用户昵称&quot; maxlength=&quot;30&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;归属部门&quot; prop=&quot;deptId&quot;&gt;</span><br><span class="line">              &lt;treeselect v-model=&quot;form.deptId&quot; :options=&quot;deptOptions&quot; :show-count=&quot;true&quot; placeholder=&quot;请选择归属部门&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;手机号码&quot; prop=&quot;phonenumber&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.phonenumber&quot; placeholder=&quot;请输入手机号码&quot; maxlength=&quot;11&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;邮箱&quot; prop=&quot;email&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.email&quot; placeholder=&quot;请输入邮箱&quot; maxlength=&quot;50&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item v-if=&quot;form.userId == undefined&quot; label=&quot;用户名称&quot; prop=&quot;userName&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.userName&quot; placeholder=&quot;请输入用户名称&quot; maxlength=&quot;30&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item v-if=&quot;form.userId == undefined&quot; label=&quot;用户密码&quot; prop=&quot;password&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.password&quot; placeholder=&quot;请输入用户密码&quot; type=&quot;password&quot; maxlength=&quot;20&quot; show-password/&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;用户性别&quot;&gt;</span><br><span class="line">              &lt;el-select v-model=&quot;form.sex&quot; placeholder=&quot;请选择性别&quot;&gt;</span><br><span class="line">                &lt;el-option</span><br><span class="line">                  v-for=&quot;dict in dict.type.sys_user_sex&quot;</span><br><span class="line">                  :key=&quot;dict.value&quot;</span><br><span class="line">                  :label=&quot;dict.label&quot;</span><br><span class="line">                  :value=&quot;dict.value&quot;</span><br><span class="line">                &gt;&lt;/el-option&gt;</span><br><span class="line">              &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;状态&quot;&gt;</span><br><span class="line">              &lt;el-radio-group v-model=&quot;form.status&quot;&gt;</span><br><span class="line">                &lt;el-radio</span><br><span class="line">                  v-for=&quot;dict in dict.type.sys_normal_disable&quot;</span><br><span class="line">                  :key=&quot;dict.value&quot;</span><br><span class="line">                  :label=&quot;dict.value&quot;</span><br><span class="line">                &gt;&#123;&#123;dict.label&#125;&#125;&lt;/el-radio&gt;</span><br><span class="line">              &lt;/el-radio-group&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;岗位&quot;&gt;</span><br><span class="line">              &lt;el-select v-model=&quot;form.postIds&quot; multiple placeholder=&quot;请选择岗位&quot;&gt;</span><br><span class="line">                &lt;el-option</span><br><span class="line">                  v-for=&quot;item in postOptions&quot;</span><br><span class="line">                  :key=&quot;item.postId&quot;</span><br><span class="line">                  :label=&quot;item.postName&quot;</span><br><span class="line">                  :value=&quot;item.postId&quot;</span><br><span class="line">                  :disabled=&quot;item.status == 1&quot;</span><br><span class="line">                &gt;&lt;/el-option&gt;</span><br><span class="line">              &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;角色&quot;&gt;</span><br><span class="line">              &lt;el-select v-model=&quot;form.roleIds&quot; multiple placeholder=&quot;请选择角色&quot;&gt;</span><br><span class="line">                &lt;el-option</span><br><span class="line">                  v-for=&quot;item in roleOptions&quot;</span><br><span class="line">                  :key=&quot;item.roleId&quot;</span><br><span class="line">                  :label=&quot;item.roleName&quot;</span><br><span class="line">                  :value=&quot;item.roleId&quot;</span><br><span class="line">                  :disabled=&quot;item.status == 1&quot;</span><br><span class="line">                &gt;&lt;/el-option&gt;</span><br><span class="line">              &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;24&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;备注&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;form.remark&quot; type=&quot;textarea&quot; placeholder=&quot;请输入内容&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm&quot;&gt;确 定&lt;/el-button&gt; //点击确认，提交表单</span><br><span class="line">        &lt;el-button @click=&quot;cancel&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<p>在 数据库sys-user 的user-id，如果存在，是修改；如果不存在，是添加。</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 提交按钮 */</span></span><br><span class="line"><span class="attr">submitForm</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$refs</span>[<span class="string">&quot;form&quot;</span>].<span class="title function_">validate</span>(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">userId</span> != <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="title function_">updateUser</span>(<span class="variable language_">this</span>.<span class="property">form</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">msgSuccess</span>(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">getList</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">addUser</span>(<span class="variable language_">this</span>.<span class="property">form</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; <span class="comment">//调用addUser，参数是整个表单</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">msgSuccess</span>(<span class="string">&quot;新增成功&quot;</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">getList</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 新增用户</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">addUser</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="11-2-后端实现"><a href="#11-2-后端实现" class="headerlink" title="11-2 后端实现"></a>11-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:add&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@Log(title = &quot;用户管理&quot;, businessType = BusinessType.INSERT)</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">add</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!userService.checkUserNameUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;新增用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，登录账号已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isNotEmpty(user.getPhonenumber()) &amp;&amp; !userService.checkPhoneUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;新增用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，手机号码已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isNotEmpty(user.getEmail()) &amp;&amp; !userService.checkEmailUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;新增用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，邮箱账号已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    user.setCreateBy(getUsername()); <span class="comment">//将用户是谁添加的，赋到用户的 create-by 字段</span></span><br><span class="line">    user.setPassword(SecurityUtils.encryptPassword(user.getPassword())); <span class="comment">//将用户的密码进行加密</span></span><br><span class="line">    <span class="keyword">return</span> toAjax(userService.insertUser(user)); <span class="comment">//调用insertUser</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增保存用户信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 新增用户信息</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> userMapper.insertUser(user);</span><br><span class="line">    <span class="comment">// 新增用户岗位关联</span></span><br><span class="line">    insertUserPost(user); <span class="comment">//数据库表sys-user-post</span></span><br><span class="line">    <span class="comment">// 新增用户与角色管理</span></span><br><span class="line">    insertUserRole(user); <span class="comment">//数据库表sys-user-role</span></span><br><span class="line">    <span class="keyword">return</span> rows;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="11-3-数据库"><a href="#11-3-数据库" class="headerlink" title="11-3 数据库"></a>11-3 数据库</h2><ul>
<li>sys-user-post</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240531222541280.png"
                      alt="image-20240531222541280"
                ></p>
<ul>
<li>sys-user-role</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240531222558574.png"
                      alt="image-20240531222558574"
                ></p>
<h1 id="12-修改用户"><a href="#12-修改用户" class="headerlink" title="12- 修改用户"></a>12- 修改用户</h1><h2 id="12-1-修改前获取用户信息"><a href="#12-1-修改前获取用户信息" class="headerlink" title="12-1 修改前获取用户信息"></a>12-1 修改前获取用户信息</h2><h3 id="12-1-1-前端实现"><a href="#12-1-1-前端实现" class="headerlink" title="12-1-1 前端实现"></a>12-1-1 前端实现</h3><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template slot-scope=&quot;scope&quot; v-if=&quot;scope.row.userId !== 1&quot;&gt;</span><br><span class="line">    &lt;el-button</span><br><span class="line">        size=&quot;mini&quot;</span><br><span class="line">        type=&quot;text&quot;</span><br><span class="line">        icon=&quot;el-icon-edit&quot;</span><br><span class="line">        @click=&quot;handleUpdate(scope.row)&quot; //点击修改</span><br><span class="line">        v-hasPermi=&quot;[&#x27;system:user:edit&#x27;]&quot;</span><br><span class="line">    &gt;修改&lt;/el-button&gt;</span><br><span class="line">&lt;/template&gt;    </span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 修改按钮操作 */</span></span><br><span class="line"><span class="title function_">handleUpdate</span>(<span class="params">row</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">reset</span>(); <span class="comment">//调用reset，表单重置 </span></span><br><span class="line">  <span class="keyword">const</span> userId = row.<span class="property">userId</span> || <span class="variable language_">this</span>.<span class="property">ids</span>; <span class="comment">//获取用户Id</span></span><br><span class="line">  <span class="title function_">getUser</span>(userId).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; <span class="comment">//调用getUser，参数是userId；获取岗位和角色，同时获取用户信息 </span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">form</span> = response.<span class="property">data</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">postOptions</span> = response.<span class="property">posts</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">roleOptions</span> = response.<span class="property">roles</span>;</span><br><span class="line">    <span class="variable language_">this</span>.$set(<span class="variable language_">this</span>.<span class="property">form</span>, <span class="string">&quot;postIds&quot;</span>, response.<span class="property">postIds</span>);</span><br><span class="line">    <span class="variable language_">this</span>.$set(<span class="variable language_">this</span>.<span class="property">form</span>, <span class="string">&quot;roleIds&quot;</span>, response.<span class="property">roleIds</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">true</span>; <span class="comment">//打开用户表单</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&quot;修改用户&quot;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">password</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查询用户详细</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getUser</span>(<span class="params">userId</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user/&#x27;</span> + <span class="title function_">parseStrEmpty</span>(userId),</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="12-1-2-后端实现"><a href="#12-1-2-后端实现" class="headerlink" title="12-1-2 后端实现"></a>12-1-2 后端实现</h3><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据用户编号获取详细信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:query&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(value = &#123; &quot;/&quot;, &quot;/&#123;userId&#125;&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;userId&quot;, required = false)</span> Long userId)</span></span><br><span class="line">&#123;</span><br><span class="line">    userService.checkUserDataScope(userId); <span class="comment">//调用checkUserDataScope，判断用户是否有权限，只有管理员可以</span></span><br><span class="line">    <span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">    List&lt;SysRole&gt; roles = roleService.selectRoleAll();</span><br><span class="line">    <span class="comment">//如果是管理员，获取所有角色；如果不是管理员，则排除管理员角色</span></span><br><span class="line">    ajax.put(<span class="string">&quot;roles&quot;</span>, SysUser.isAdmin(userId) ? roles : roles.stream().filter(r -&gt; !r.isAdmin()).collect(Collectors.toList()));</span><br><span class="line">    <span class="comment">//获取所有岗位</span></span><br><span class="line">    ajax.put(<span class="string">&quot;posts&quot;</span>, postService.selectPostAll());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断是否有userId，如果没有，直接返回；如果有，则获取他的用户信息、角色、岗位返回</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotNull(userId))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> userService.selectUserById(userId);</span><br><span class="line">        ajax.put(AjaxResult.DATA_TAG, sysUser);</span><br><span class="line">        <span class="comment">//将用户角色赋给 postIds</span></span><br><span class="line">        ajax.put(<span class="string">&quot;postIds&quot;</span>, postService.selectPostListByUserId(userId));</span><br><span class="line">        <span class="comment">//将用户岗位赋给roleIds</span></span><br><span class="line">       ajax.put(<span class="string">&quot;roleIds&quot;</span>,sysUser.getRoles().stream().map(SysRole::getRoleId).collect(Collectors.toList()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ajax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="12-2-修改"><a href="#12-2-修改" class="headerlink" title="12-2 修改"></a>12-2 修改</h2><h3 id="12-2-1-前端实现"><a href="#12-2-1-前端实现" class="headerlink" title="12-2-1 前端实现"></a>12-2-1 前端实现</h3><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 提交按钮 */</span></span><br><span class="line"><span class="attr">submitForm</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$refs</span>[<span class="string">&quot;form&quot;</span>].<span class="title function_">validate</span>(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">userId</span> != <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="title function_">updateUser</span>(<span class="variable language_">this</span>.<span class="property">form</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; <span class="comment">//调用updateUser，参数是整个表单</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">msgSuccess</span>(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">getList</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">addUser</span>(<span class="variable language_">this</span>.<span class="property">form</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">msgSuccess</span>(<span class="string">&quot;新增成功&quot;</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">open</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">getList</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 修改用户</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">updateUser</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="12-2-2-后端实现"><a href="#12-2-2-后端实现" class="headerlink" title="12-2-2 后端实现"></a>12-2-2 后端实现</h3><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:edit&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@Log(title = &quot;用户管理&quot;, businessType = BusinessType.UPDATE)</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">edit</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    userService.checkUserAllowed(user); <span class="comment">//调用checkUserAllowed，判断用户是否可以被操作</span></span><br><span class="line">    userService.checkUserDataScope(user.getUserId());</span><br><span class="line">    <span class="keyword">if</span> (!userService.checkUserNameUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;修改用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，登录账号已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isNotEmpty(user.getPhonenumber()) &amp;&amp; !userService.checkPhoneUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;修改用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，手机号码已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isNotEmpty(user.getEmail()) &amp;&amp; !userService.checkEmailUnique(user))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;修改用户&#x27;&quot;</span> + user.getUserName() + <span class="string">&quot;&#x27;失败，邮箱账号已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    user.setUpdateBy(getUsername()); <span class="comment">//将用户是谁修改的，赋到用户的 update-by 字段</span></span><br><span class="line">    <span class="keyword">return</span> toAjax(userService.updateUser(user)); <span class="comment">//调用updateUser</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 校验用户是否允许操作</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkUserAllowed</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotNull(user.getUserId()) &amp;&amp; user.isAdmin())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(<span class="string">&quot;不允许操作超级管理员用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改保存用户信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(SysUser user)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getUserId();</span><br><span class="line">    <span class="comment">// 删除用户与角色关联</span></span><br><span class="line">    userRoleMapper.deleteUserRoleByUserId(userId);</span><br><span class="line">    <span class="comment">// 新增用户与角色管理</span></span><br><span class="line">    insertUserRole(user);</span><br><span class="line">    <span class="comment">// 删除用户与岗位关联</span></span><br><span class="line">    userPostMapper.deleteUserPostByUserId(userId);</span><br><span class="line">    <span class="comment">// 新增用户与岗位管理</span></span><br><span class="line">    insertUserPost(user);</span><br><span class="line">    <span class="keyword">return</span> userMapper.updateUser(user); <span class="comment">//调用updateUser，修改用户信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="13-删除用户"><a href="#13-删除用户" class="headerlink" title="13- 删除用户"></a>13- 删除用户</h1><h2 id="13-1-前端实现"><a href="#13-1-前端实现" class="headerlink" title="13-1 前端实现"></a>13-1 前端实现</h2><ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button</span><br><span class="line">	size=&quot;mini&quot;</span><br><span class="line">    type=&quot;text&quot;</span><br><span class="line">    icon=&quot;el-icon-delete&quot;</span><br><span class="line">    @click=&quot;handleDelete(scope.row)&quot; //点击删除</span><br><span class="line">    v-hasPermi=&quot;[&#x27;system:user:remove&#x27;]&quot;</span><br><span class="line">&gt;删除&lt;/el-button&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.views.system.user.index.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 删除按钮操作 */</span></span><br><span class="line"><span class="title function_">handleDelete</span>(<span class="params">row</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> userIds = row.<span class="property">userId</span> || <span class="variable language_">this</span>.<span class="property">ids</span>; <span class="comment">//获取用户Id</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">confirm</span>(<span class="string">&#x27;是否确认删除用户编号为&quot;&#x27;</span> + userIds + <span class="string">&#x27;&quot;的数据项？&#x27;</span>).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">//弹窗</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">delUser</span>(userIds); <span class="comment">//调用delUser，参数是userIds</span></span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getList</span>(); <span class="comment">//调用getList，获取用户</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$modal</span>.<span class="title function_">msgSuccess</span>(<span class="string">&quot;删除成功&quot;</span>); </span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-ui.src.api.system.user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除用户</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">delUser</span>(<span class="params">userId</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/system/user/&#x27;</span> + userId,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="13-2-后端实现"><a href="#13-2-后端实现" class="headerlink" title="13-2 后端实现"></a>13-2 后端实现</h2><ul>
<li>ruoyi-admin.com.ruoyi.web.controller.system.SysUserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;system:user:remove&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@Log(title = &quot;用户管理&quot;, businessType = BusinessType.DELETE)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;userIds&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> Long[] userIds)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//通过比对 要删除的用户Id与当前登录用户的Id，不能删除当前用户</span></span><br><span class="line">    <span class="keyword">if</span> (ArrayUtils.contains(userIds, getUserId()))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;当前用户不能删除&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> toAjax(userService.deleteUserByIds(userIds));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-system.com.ruoyi.system.service.impl.SysUserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量删除用户信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userIds 需要删除的用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteUserByIds</span><span class="params">(Long[] userIds)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (Long userId : userIds)</span><br><span class="line">    &#123;</span><br><span class="line">        checkUserAllowed(<span class="keyword">new</span> <span class="title class_">SysUser</span>(userId)); <span class="comment">//调用checkUserAllowed，判断用户是否可以被操作</span></span><br><span class="line">        checkUserDataScope(userId); <span class="comment">//调用checkUserDataScope，判断用户是否有数据权限</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除用户与角色关联</span></span><br><span class="line">    userRoleMapper.deleteUserRole(userIds);</span><br><span class="line">    <span class="comment">// 删除用户与岗位关联</span></span><br><span class="line">    userPostMapper.deleteUserPost(userIds);</span><br><span class="line">    <span class="comment">//调用deleteUserByIds，删除用户信息（逻辑删除），他并不是把用户信息删除，而是更改 del-flag，使从0 --&gt; 2，逻辑上删除。</span></span><br><span class="line">    <span class="keyword">return</span> userMapper.deleteUserByIds(userIds); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="14-异步任务管理器"><a href="#14-异步任务管理器" class="headerlink" title="14- 异步任务管理器"></a>14- 异步任务管理器</h1><ul>
<li>ruoyi-framework.com.ruoyi.framework.web.service.SysLoginService</li>
</ul>
<p>通过异步任务管理器记录登录日志。</p>
<p>1、AsyncManager.me()：</p>
<p>​	获取一个 AsycnManager 对象，饿汉式。</p>
<p>2、execute()：</p>
<p>​	调用execute；</p>
<p>​	执行这个任务，传入的是一个 Task(任务) 对象。</p>
<p>3、AsyncFactory.recordLogininfor(username,Constants.LOGIN_FAIL,MessageUtils.message(“user.jcaptcha.expire”))：</p>
<p>​	调用 recordLogininfor；</p>
<p>​	实现了 Runnable 接口，是一个任务，由线程 Thread 去执行。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (captcha == <span class="literal">null</span>) <span class="comment">//如果Redis答案不存在</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//异步日志</span></span><br><span class="line">    AsyncManager.me().execute(AsyncFactory.recordLogininfor(username,Constants.LOGIN_FAIL,</span><br><span class="line">     	MessageUtils.message(<span class="string">&quot;user.jcaptcha.expire&quot;</span>))); </span><br><span class="line">  	<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CaptchaExpireException</span>(); <span class="comment">//抛出过期异常</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!code.equalsIgnoreCase(captcha)) <span class="comment">//如果验证码答案和Redis答案不一致</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//异步日志</span></span><br><span class="line">    AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, 	   </span><br><span class="line">    	MessageUtils.message(<span class="string">&quot;user.jcaptcha.error&quot;</span>)));</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CaptchaException</span>(); <span class="comment">//抛出错误异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-framework.com.ruoyi.framework.manager.factory.AsyncFactory</li>
</ul>
<p>封装了登录用户的信息，执行添加操作，这里不会执行，而是将任务交给线程对象来执行。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 记录登录信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status 状态</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> message 消息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args 列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 任务task</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> TimerTask <span class="title function_">recordLogininfor</span><span class="params">(<span class="keyword">final</span> String username, <span class="keyword">final</span> String status, <span class="keyword">final</span> String message,</span></span><br><span class="line"><span class="params">            <span class="keyword">final</span> Object... args)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">UserAgent</span> <span class="variable">userAgent</span> <span class="operator">=</span> UserAgent.parseUserAgentString(ServletUtils.getRequest().getHeader(<span class="string">&quot;User-Agent&quot;</span>));</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> IpUtils.getIpAddr();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TimerTask</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> AddressUtils.getRealAddressByIP(ip);</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            s.append(LogUtils.getBlock(ip));</span><br><span class="line">            s.append(address);</span><br><span class="line">            s.append(LogUtils.getBlock(username));</span><br><span class="line">            s.append(LogUtils.getBlock(status));</span><br><span class="line">            s.append(LogUtils.getBlock(message));</span><br><span class="line">            <span class="comment">// 打印信息到日志</span></span><br><span class="line">            sys_user_logger.info(s.toString(), args);</span><br><span class="line">            <span class="comment">// 获取客户端操作系统</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">os</span> <span class="operator">=</span> userAgent.getOperatingSystem().getName();</span><br><span class="line">            <span class="comment">// 获取客户端浏览器</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">browser</span> <span class="operator">=</span> userAgent.getBrowser().getName();</span><br><span class="line">            <span class="comment">// 封装对象</span></span><br><span class="line">            <span class="type">SysLogininfor</span> <span class="variable">logininfor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SysLogininfor</span>();</span><br><span class="line">            logininfor.setUserName(username);</span><br><span class="line">            logininfor.setIpaddr(ip);</span><br><span class="line">            logininfor.setLoginLocation(address);</span><br><span class="line">            logininfor.setBrowser(browser);</span><br><span class="line">            logininfor.setOs(os);</span><br><span class="line">            logininfor.setMsg(message);</span><br><span class="line">            <span class="comment">// 日志状态</span></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.equalsAny(status, Constants.LOGIN_SUCCESS, Constants.LOGOUT, Constants.REGISTER))</span><br><span class="line">            &#123;</span><br><span class="line">                logininfor.setStatus(Constants.SUCCESS);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (Constants.LOGIN_FAIL.equals(status))</span><br><span class="line">            &#123;</span><br><span class="line">                logininfor.setStatus(Constants.FAIL);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 插入数据</span></span><br><span class="line">            SpringUtils.getBean(ISysLogininforService.class).insertLogininfor(logininfor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ruoyi-framework.com.ruoyi.framework.manager.AsyncManager</li>
</ul>
<p>异步任务管理器，内部定义了一个线程池，然后根据业务创建添加日志的任务，交给线程池来处理，这样做到日志和业务的抽象，解合，日志全部统一处理。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异步任务管理器</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作延迟10毫秒</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">OPERATE_DELAY_TIME</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异步操作任务调度线程池</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ScheduledExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> SpringUtils.getBean(<span class="string">&quot;scheduledExecutorService&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单例模式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">AsyncManager</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">AsyncManager</span> <span class="variable">me</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AsyncManager</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AsyncManager <span class="title function_">me</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> me;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行任务</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task 任务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(TimerTask task)</span></span><br><span class="line">    &#123;</span><br><span class="line">        executor.schedule(task, OPERATE_DELAY_TIME, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 停止任务线程池</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Threads.shutdownAndAwaitTermination(executor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="15-代码自动生成"><a href="#15-代码自动生成" class="headerlink" title="15- 代码自动生成"></a>15- 代码自动生成</h1><h2 id="15-1-创建数据表"><a href="#15-1-创建数据表" class="headerlink" title="15-1 创建数据表"></a>15-1 创建数据表</h2><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line">use ruoyi_vue;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_user(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">11</span>),</span><br><span class="line">	password <span class="type">varchar</span>(<span class="number">11</span>)</span><br><span class="line">&#125;;		</span><br></pre></td></tr></table></figure></div>

<h2 id="15-2-使用工具"><a href="#15-2-使用工具" class="headerlink" title="15-2 使用工具"></a>15-2 使用工具</h2><ul>
<li>启动 若依管理系统 ，点击 系统工具，找到 代码生成。</li>
<li>点击 导入，点击 你要生成的数据库表，点击 确定。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240705153600650.png"
                      alt="image-20240705153600650"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602160352961.png"
                      alt="image-20240602160352961"
                ></p>
<ul>
<li>点击 预览，可以看到生成的 java后端，sql数据库，vue前端的代码。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602160655452.png"
                      alt="image-20240602160655452"
                ></p>
<h2 id="15-3-编辑"><a href="#15-3-编辑" class="headerlink" title="15-3 编辑"></a>15-3 编辑</h2><ul>
<li>点击 编辑</li>
<li>必须添加 字段描述</li>
<li>必须添加 表描述</li>
<li>生成模版：单表、树表、主子表</li>
<li>上级菜单：生成的接口会在哪个下面</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602160928700.png"
                      alt="image-20240602160928700"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602161001621.png"
                      alt="image-20240602161001621"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240602161220369.png"
                      alt="image-20240602161220369"
                ></p>
<h2 id="15-4-生成代码"><a href="#15-4-生成代码" class="headerlink" title="15-4 生成代码"></a>15-4 生成代码</h2><ul>
<li>点击 生成代码，点击 下载</li>
<li>会在桌面生成一个压缩包</li>
</ul>
<h2 id="15-5-解压"><a href="#15-5-解压" class="headerlink" title="15-5 解压"></a>15-5 解压</h2><ul>
<li>main (Java 后端代码)</li>
<li>vue (Vue 前端代码)</li>
<li>sql (菜单 SQL)</li>
</ul>
<h2 id="15-6-导入"><a href="#15-6-导入" class="headerlink" title="15-6 导入"></a>15-6 导入</h2><ul>
<li>复制代码，导入项目</li>
<li>菜单 由 菜单管理 编辑</li>
</ul>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<h1 id="二、"><a href="#二、" class="headerlink" title="二、"></a>二、</h1><h1 id="1-使用代码生成器"><a href="#1-使用代码生成器" class="headerlink" title="1- 使用代码生成器"></a>1- 使用代码生成器</h1><h2 id="1-1-准备相应的数据库表"><a href="#1-1-准备相应的数据库表" class="headerlink" title="1-1 准备相应的数据库表"></a>1-1 准备相应的数据库表</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708195813114.png"
                      alt="image-20240708195813114"
                ></p>
<h2 id="1-2-准备SQL并导入数据库中"><a href="#1-2-准备SQL并导入数据库中" class="headerlink" title="1-2 准备SQL并导入数据库中"></a>1-2 准备SQL并导入数据库中</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708195923608.png"
                      alt="image-20240708195923608"
                ></p>
<h2 id="1-3-配置代码生成信息"><a href="#1-3-配置代码生成信息" class="headerlink" title="1-3 配置代码生成信息"></a>1-3 配置代码生成信息</h2><ul>
<li>点击 系统工具，点击 代码生成，点击 导入，点击 你想要的数据库表，点击 确定。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708202813444.png"
                      alt="image-20240708202813444"
                ></p>
<ul>
<li>点击 编辑。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708202923556.png"
                      alt="image-20240708202923556"
                ></p>
<ul>
<li>基本信息</li>
<li>实体类名称：默认是根据表名称生成的，可以修改。</li>
<li>作者：默认是ruoyi，可以修改。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708203032924.png"
                      alt="image-20240708203032924"
                ></p>
<ul>
<li>字段信息</li>
<li>字段描述：决定最终在页面上展示的效果。</li>
<li>java属性：默认与字段列名一样，只不过下划线的（create_time）变成其他样式（createTime）。</li>
<li>插入、编辑、列表、查询、查询方式、必填、显示类型：根据想要的自己配置。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708203733187.png"
                      alt="image-20240708203733187"
                ></p>
<ul>
<li><p>生成信息</p>
</li>
<li><p>生成包路径、生成模块名、生成业务名：根据想要的自己修改。</p>
</li>
<li><p>上级菜单：默认生成在 系统工具 下，也可以自己修改。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708204437129.png"
                      alt="image-20240708204437129"
                ></p>
<h2 id="1-4-下载代码并导入项目"><a href="#1-4-下载代码并导入项目" class="headerlink" title="1-4 下载代码并导入项目"></a>1-4 下载代码并导入项目</h2><ul>
<li>1、点击 生成代码。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708205033594.png"
                      alt="image-20240708205033594"
                ></p>
<ul>
<li>2、解压，里面有三部分：main、vue、sql。</li>
<li>3、导入sql。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708205601791.png"
                      alt="image-20240708205601791"
                ></p>
<ul>
<li><p>4、导入vue。</p>
</li>
<li><p>分为 api 和 views 两部分。</p>
</li>
<li><p>api 导入到 src \ api 中；views 导入到 src \ views 中。</p>
</li>
<li><p>5、导入main。</p>
</li>
<li><p>分为 java 和 resources 两部分。</p>
</li>
<li><p>java 导入到 ruoyi-admin \ src \ main \ java 中。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708211525297.png"
                      alt="image-20240708211525297"
                ></p>
<ul>
<li>resources .mapper 导入到 ruoyi-admin \ src \ main \ resources 中。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708211943558.png"
                      alt="image-20240708211943558"
                ></p>
<h1 id="2-功能详解"><a href="#2-功能详解" class="headerlink" title="2- 功能详解"></a>2- 功能详解</h1><h2 id="2-1-权限控制"><a href="#2-1-权限控制" class="headerlink" title="2-1 权限控制"></a>2-1 权限控制</h2><h3 id="2-1-1-RBAC"><a href="#2-1-1-RBAC" class="headerlink" title="2-1-1 RBAC"></a>2-1-1 RBAC</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708213749693.png"
                      alt="image-20240708213749693"
                ></p>
<h3 id="2-1-2-表关系"><a href="#2-1-2-表关系" class="headerlink" title="2-1-2 表关系"></a>2-1-2 表关系</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708214021407.png"
                      alt="image-20240708214021407"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708214058966.png"
                      alt="image-20240708214058966"
                ></p>
<h3 id="2-1-3-菜单管理"><a href="#2-1-3-菜单管理" class="headerlink" title="2-1-3 菜单管理"></a>2-1-3 菜单管理</h3><ul>
<li>菜单分为：目录菜单、页面菜单、按钮菜单。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709070952141.png"
                      alt="image-20240709070952141"
                ></p>
<ul>
<li>目录菜单 匹配 主类目。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712094912300.png"
                      alt="image-20240712094912300"
                ></p>
<ul>
<li>页面菜单 匹配 目录菜单 或 主类目。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712095235714.png"
                      alt="image-20240712095235714"
                ></p>
<ul>
<li>按钮菜单 匹配  页面菜单。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-09%20071120.png"
                      alt="屏幕截图 2024-07-09 071120"
                ></p>
<h2 id="2-2-数据字典"><a href="#2-2-数据字典" class="headerlink" title="2-2 数据字典"></a>2-2 数据字典</h2><h3 id="2-2-1-概念"><a href="#2-2-1-概念" class="headerlink" title="2-2-1 概念"></a>2-2-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709073639071.png"
                      alt="image-20240709073639071"
                ></p>
<h3 id="2-2-2-表关系"><a href="#2-2-2-表关系" class="headerlink" title="2-2-2 表关系"></a>2-2-2 表关系</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709073534331.png"
                      alt="image-20240709073534331"
                ></p>
<h3 id="2-2-3-使用"><a href="#2-2-3-使用" class="headerlink" title="2-2-3 使用"></a>2-2-3 使用</h3><ul>
<li>添加 字典类型 和 字典数据</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709074207425.png"
                      alt="image-20240709074207425"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709074241216.png"
                      alt="image-20240709074241216"
                ></p>
<ul>
<li>修改代码生成信息</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709074513823.png"
                      alt="image-20240709074513823"
                ></p>
<ul>
<li><p>下载代码，导入</p>
</li>
<li><p>如果之前没有代码生成，则需要按上述 使用代码生成器 的第四步。</p>
</li>
<li><p>如果之前有代码生成，则只需要导入 vue \ views 中的 index.vue，先将对应的 vue 文件删掉，然后导入。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709082908972.png"
                      alt="image-20240709082908972"
                ></p>
<ul>
<li>修改数据库</li>
<li>如果修改后的字段有问题，则修改原数据库表中的该字段值。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709082848507.png"
                      alt="image-20240709082848507"
                ></p>
<h2 id="2-3-其他功能"><a href="#2-3-其他功能" class="headerlink" title="2-3 其他功能"></a>2-3 其他功能</h2><h3 id="2-3-1-参数设置"><a href="#2-3-1-参数设置" class="headerlink" title="2-3-1 参数设置"></a>2-3-1 参数设置</h3><ul>
<li>对系统中的参数进行动态维护。</li>
<li>通过修改参数键值，无需修改代码，直接刷新即可。动态使用。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709153631564.png"
                      alt="image-20240709153631564"
                ></p>
<h3 id="2-3-2-通知公告"><a href="#2-3-2-通知公告" class="headerlink" title="2-3-2 通知公告"></a>2-3-2 通知公告</h3><ul>
<li><p>促进组织内部信息传递。</p>
</li>
<li><p>若依提供了在本页面的通知公告的增删改查，而其他的形式需要开发者自己开发。</p>
</li>
</ul>
<h3 id="2-3-3-日志管理"><a href="#2-3-3-日志管理" class="headerlink" title="2-3-3 日志管理"></a>2-3-3 日志管理</h3><ul>
<li>轻松追踪用户行为和系统运行状况。</li>
</ul>
<h2 id="2-4-监控相关"><a href="#2-4-监控相关" class="headerlink" title="2-4 监控相关"></a>2-4 监控相关</h2><ul>
<li>若依提供了一些列强大的监控工具，能够帮助开发者和运维快速了解应用程序的性能状态。</li>
<li>包括：在线用户、数据监控（内置德鲁伊，账号：ruoyi、123456）、服务监控、缓存监控、缓存列表。</li>
</ul>
<h2 id="2-5-定时任务"><a href="#2-5-定时任务" class="headerlink" title="2-5 定时任务"></a>2-5 定时任务</h2><h3 id="2-5-1-作用"><a href="#2-5-1-作用" class="headerlink" title="2-5-1 作用"></a>2-5-1 作用</h3><ul>
<li>若依为定时任务功能提供方便友好的web界面，实现动态管理任务。</li>
</ul>
<h3 id="2-5-2-使用"><a href="#2-5-2-使用" class="headerlink" title="2-5-2 使用"></a>2-5-2 使用</h3><ul>
<li>在 ruoyi-quartz 包下的 task 包下创建任务。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710114025772.png"
                      alt="image-20240710114025772"
                ></p>
<ul>
<li>点击 系统监控，点击 定时任务，点击 新增。</li>
<li>调用方法： 模块名 .方法名。</li>
<li>执行策略：</li>
<li>有一个任务需求，每半个小时执行一次。当在8点服务器当机了，在9点15恢复了，此时的8点半、9点的任务没有执行。</li>
<li>立即执行 - 把之间的所有任务执行。</li>
<li>执行一次 - 只执行最近的一次。</li>
<li>放弃执行 - 把之间的所有任务不执行，使用最多。</li>
<li>是否并发：当是没有固定先后关系的，一般是允许并发的；如果有固定先后关系，则是禁止并发的。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710140056696.png"
                      alt="image-20240710140056696"
                ></p>
<ul>
<li>点击 cron表达式，设置时间表达式。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710140526678.png"
                      alt="image-20240710140526678"
                ></p>
<ul>
<li>点击状态，启用。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710143158539.png"
                      alt="image-20240710143158539"
                ></p>
<h2 id="2-6-表单结构"><a href="#2-6-表单结构" class="headerlink" title="2-6 表单结构"></a>2-6 表单结构</h2><h3 id="2-6-1-作用"><a href="#2-6-1-作用" class="headerlink" title="2-6-1 作用"></a>2-6-1 作用</h3><ul>
<li>表单构建工具，只需要开发者通过图形界面和拖拽等操作，可以快速构建复杂的表单。</li>
</ul>
<h3 id="2-6-2-使用"><a href="#2-6-2-使用" class="headerlink" title="2-6-2 使用"></a>2-6-2 使用</h3><ul>
<li>制作表单。</li>
<li>左侧是组件区域，先将布局型组件拖拽，再使用输入型组件或选择型组件。</li>
<li>右侧是对选中组件的设置，必须要改的是字段名、标题。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-10%20195050.png"
                      alt="屏幕截图 2024-07-10 195050"
                ></p>
<ul>
<li>导出并下载。</li>
<li>点击 导出vue文件，选择是 页面 或 弹窗，输入文件名。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710201035866.png"
                      alt="image-20240710201035866"
                ></p>
<ul>
<li>复制到前端工程。</li>
<li>找到自己想要的位置，复制过去。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710202842829.png"
                      alt="image-20240710202842829"
                ></p>
<ul>
<li><p>创建动态菜单。</p>
</li>
<li><p>点击 菜单管理，设置上级目录、菜单类型、路由地址、组件路径。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710203018232.png"
                      alt="image-20240710203018232"
                ></p>
<h2 id="2-7-代码生成"><a href="#2-7-代码生成" class="headerlink" title="2-7 代码生成"></a>2-7 代码生成</h2><h3 id="2-7-1-树表"><a href="#2-7-1-树表" class="headerlink" title="2-7-1 树表"></a>2-7-1 树表</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710204309895.png"
                      alt="image-20240710204309895"
                ></p>
<h3 id="2-7-2-主子表"><a href="#2-7-2-主子表" class="headerlink" title="2-7-2 主子表"></a>2-7-2 主子表</h3><ul>
<li>一对多。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710204501738.png"
                      alt="image-20240710204501738"
                ></p>
<h2 id="2-8-系统接口"><a href="#2-8-系统接口" class="headerlink" title="2-8 系统接口"></a>2-8 系统接口</h2><ul>
<li>Swagger，能够自动生成 API 的同步在线文档，并提供Web界面进行接口调用和测试。</li>
<li>若依的 token 值在 Admin-Token 中。</li>
<li>点击 Authorize ，输入 token 值，完成授权。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-10%20205220.png"
                      alt="屏幕截图 2024-07-10 205220"
                ></p>
<ul>
<li>找到想要的 api 接口，点击 完成接口的调用与测试。</li>
<li>注意接口中的 &#x2F;dev-api ，去掉它才能正确请求后端接口。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710205501666.png"
                      alt="image-20240710205501666"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710205745198.png"
                      alt="image-20240710205745198"
                ></p>
<h1 id="3-项目结构"><a href="#3-项目结构" class="headerlink" title="3- 项目结构"></a>3- 项目结构</h1><h2 id="3-1-后端结构"><a href="#3-1-后端结构" class="headerlink" title="3-1 后端结构"></a>3-1 后端结构</h2><h3 id="3-1-1-admin"><a href="#3-1-1-admin" class="headerlink" title="3-1-1 admin"></a>3-1-1 admin</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710211404517.png"
                      alt="image-20240710211404517"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710215422345.png"
                      alt="image-20240710215422345"
                ></p>
<h3 id="3-1-2-common"><a href="#3-1-2-common" class="headerlink" title="3-1-2 common"></a>3-1-2 common</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710211601428.png"
                      alt="image-20240710211601428"
                ></p>
<h3 id="3-1-3-framework"><a href="#3-1-3-framework" class="headerlink" title="3-1-3 framework"></a>3-1-3 framework</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710213631662.png"
                      alt="image-20240710213631662"
                ></p>
<h3 id="3-1-4-system与其他"><a href="#3-1-4-system与其他" class="headerlink" title="3-1-4 system与其他"></a>3-1-4 system与其他</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710214750713.png"
                      alt="image-20240710214750713"
                ></p>
<h3 id="3-1-5-模块依赖关系"><a href="#3-1-5-模块依赖关系" class="headerlink" title="3-1-5 模块依赖关系"></a>3-1-5 模块依赖关系</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710215944691.png"
                      alt="image-20240710215944691"
                ></p>
<h2 id="3-2-前端结构"><a href="#3-2-前端结构" class="headerlink" title="3-2 前端结构"></a>3-2 前端结构</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710220432554.png"
                      alt="image-20240710220432554"
                ></p>
<h2 id="3-3-表结构"><a href="#3-3-表结构" class="headerlink" title="3-3 表结构"></a>3-3 表结构</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710220839461.png"
                      alt="image-20240710220839461"
                ></p>
<h1 id="4-源码阅读"><a href="#4-源码阅读" class="headerlink" title="4- 源码阅读"></a>4- 源码阅读</h1><h2 id="4-1-前端代码分析"><a href="#4-1-前端代码分析" class="headerlink" title="4-1 前端代码分析"></a>4-1 前端代码分析</h2><ul>
<li>前端内容太多，只写了几个。</li>
<li>v-hasPermi &#x3D; “ [ ‘course:course:add’ ] “ ：若依自定义属性，用于权限控制。</li>
<li>@ keyup.enter &#x3D; “ handleQuery “ ：键盘回车事件，点击键盘回车，调用 handleQuery 方法。</li>
<li>@ selection-change &#x3D; “ handleSelectionChange “：监听复选框，调用 handleSelectionChange 方法。</li>
<li>&lt; el-table-column type &#x3D; “ selection “ width &#x3D; “ 55 “ align &#x3D; “ center “ &#x2F; &gt;：复选框。</li>
</ul>
<h2 id="4-2-后端代码分析"><a href="#4-2-后端代码分析" class="headerlink" title="4-2 后端代码分析"></a>4-2 后端代码分析</h2><ul>
<li><p>后端内容太多，只写了几个。</p>
</li>
<li><p>@PreAuthorize ( “@ss.hasPermi ( ‘course:course:add’ )” )：若依自定义属性，用于权限控制。</p>
</li>
<li><p>BaseController ：web层通用数据处理。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709145830321.png"
                      alt="image-20240709145830321"
                ></p>
<ul>
<li>TableDataInfo：表格分页数据对象。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709150959410.png"
                      alt="image-20240709150959410"
                ></p>
<ul>
<li>AjaxResult：操作消息提醒。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709151051003.png"
                      alt="image-20240709151051003"
                ></p>
<ul>
<li>BaseEntity ：Entity基类。</li>
<li>searchValue：全局检索。</li>
<li>params：前端多加了个参数，后端没有修改，可以用它接收。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709151232639.png"
                      alt="image-20240709151232639"
                ></p>
<h2 id="4-3-权限注解"><a href="#4-3-权限注解" class="headerlink" title="4-3 权限注解"></a>4-3 权限注解</h2><ul>
<li>注解</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709084430177.png"
                      alt="image-20240709084430177"
                ></p>
<ul>
<li>控制流程图</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709085818488.png"
                      alt="image-20240709085818488"
                ></p>
<h1 id="5-二次开发"><a href="#5-二次开发" class="headerlink" title="5- 二次开发"></a>5- 二次开发</h1><h2 id="5-1-新建业务模块"><a href="#5-1-新建业务模块" class="headerlink" title="5-1 新建业务模块"></a>5-1 新建业务模块</h2><h3 id="5-1-1-若依框架修改器"><a href="#5-1-1-若依框架修改器" class="headerlink" title="5-1-1 若依框架修改器"></a>5-1-1 若依框架修改器</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711171905312.png"
                      alt="image-20240711171905312"
                ></p>
<h3 id="5-1-2-新建业务模块"><a href="#5-1-2-新建业务模块" class="headerlink" title="5-1-2 新建业务模块"></a>5-1-2 新建业务模块</h3><ul>
<li>新建子模块并引入核心依赖。</li>
<li>点击 项目，右击鼠标，点击 新建 -&gt; 新模块。</li>
<li>核心依赖在 sky-admin 的 pom.xml 中。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711172606344.png"
                      alt="image-20240711172606344"
                ></p>
<ul>
<li>父工程版本锁定。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711173123954.png"
                      alt="image-20240711173123954"
                ></p>
<ul>
<li>sky-admin 添加依赖。</li>
<li>在 sky-admin 的 pom.xml 中添加。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711173231869.png"
                      alt="image-20240711173231869"
                ></p>
<h2 id="5-2-菜品管理（主子表）"><a href="#5-2-菜品管理（主子表）" class="headerlink" title="5-2 菜品管理（主子表）"></a>5-2 菜品管理（主子表）</h2><h3 id="5-2-1-功能"><a href="#5-2-1-功能" class="headerlink" title="5-2-1 功能"></a>5-2-1 功能</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711174406926.png"
                      alt="image-20240711174406926"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711174429699.png"
                      alt="image-20240711174429699"
                ></p>
<h3 id="5-2-2-数据库表与主子表"><a href="#5-2-2-数据库表与主子表" class="headerlink" title="5-2-2 数据库表与主子表"></a>5-2-2 数据库表与主子表</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711174728640.png"
                      alt="image-20240711174728640"
                ></p>
<h3 id="5-2-3-配置并生成代码"><a href="#5-2-3-配置并生成代码" class="headerlink" title="5-2-3 配置并生成代码"></a>5-2-3 配置并生成代码</h3><ul>
<li>1、准备SQL并导入数据库。</li>
<li>2、点击 代码生成，点击 导入，导入两张表。</li>
<li>3、因为 售卖状态 是 下拉框，所以通过 字典管理 来配置。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711190634131.png"
                      alt="image-20240711190634131"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711190658071.png"
                      alt="image-20240711190658071"
                ></p>
<ul>
<li>4、根据页面配置代码生成信息。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711191926076.png"
                      alt="image-20240711191926076"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711192535578.png"
                      alt="image-20240711192535578"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711193259481.png"
                      alt="image-20240711193259481"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711193429389.png"
                      alt="image-20240711193429389"
                ></p>
<ul>
<li><p>5、只下载主表代码。</p>
</li>
<li><p>6、导入sql。</p>
</li>
<li><p>7、导入vue。分为 api 和 views 两部分。api 导入到 src \ api 中；views 导入到 src \ views 中。</p>
</li>
<li><p>8、导入main。分为 java 和 resources 两部分。java 导入到 ruoyi-admin \ src \ main \ java 中；resources .mapper 导入到 ruoyi-admin \ src \ main \ resources 中。</p>
</li>
<li><p>9、重启后端。</p>
</li>
</ul>
<h3 id="5-2-4-修改菜单位置"><a href="#5-2-4-修改菜单位置" class="headerlink" title="5-2-4 修改菜单位置"></a>5-2-4 修改菜单位置</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711195312961.png"
                      alt="image-20240711195312961"
                ></p>
<h3 id="5-2-5-对前端代码微调"><a href="#5-2-5-对前端代码微调" class="headerlink" title="5-2-5 对前端代码微调"></a>5-2-5 对前端代码微调</h3><ul>
<li>主键id：注销前端代码。</li>
<li>售价</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711205916107.png"
                      alt="image-20240711205916107"
                ></p>
<ul>
<li>最后操作时间</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711210245638.png"
                      alt="image-20240711210245638"
                ></p>
<ul>
<li>图片回显</li>
<li>一般数据库中保存的是图片保存在云上的 url；而使用若依后，保存在数据库的是图片保存在本地的地址，默认D:&#x2F;ruoyi&#x2F;uploadPath。</li>
<li>因为回显的图片前面有 “ http: &#x2F;&#x2F;localhost &#x2F;dev-api “，所以显示不出来。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711211258908.png"
                      alt="image-20240711211258908"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711211909838.png"
                      alt="image-20240711211909838"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711211643638.png"
                      alt="image-20240711211643638"
                ></p>
<ul>
<li>口味</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711213906667.png"
                      alt="image-20240711213906667"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711213843946.png"
                      alt="image-20240711213843946"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711212835486.png"
                      alt="image-20240711212835486"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711214148886.png"
                      alt="image-20240711214148886"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="C:\Users\31518\AppData\Roaming\Typora\typora-user-images\image-20240711214353527.png"
                      alt="image-20240711214353527"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711214245838.png"
                      alt="image-20240711214245838"
                ></p>
<h2 id="5-3-页面调整"><a href="#5-3-页面调整" class="headerlink" title="5-3 页面调整"></a>5-3 页面调整</h2><h3 id="5-3-1-浏览器标签页icon、标题"><a href="#5-3-1-浏览器标签页icon、标题" class="headerlink" title="5-3-1 浏览器标签页icon、标题"></a>5-3-1 浏览器标签页icon、标题</h3><ul>
<li><p>将原本的 pubilc \ favicon.ico 修改，作废。</p>
</li>
<li><p>将标签页 icon 图片，保存在 pubilc \ favicon.ico 中。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711220815190.png"
                      alt="image-20240711220815190"
                ></p>
<ul>
<li>在 index.html 中，将 “若依管理系统” 修改为自己想要的。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711221117211.png"
                      alt="image-20240711221117211"
                ></p>
<h3 id="5-3-2-系统页面中的logo、标题"><a href="#5-3-2-系统页面中的logo、标题" class="headerlink" title="5-3-2 系统页面中的logo、标题"></a>5-3-2 系统页面中的logo、标题</h3><ul>
<li>将原本的 src \ assets \ logo \ logo.png 修改，作废。</li>
<li>将系统页面 logo 图片，保存在 src \ assets \ logo \ logo.png 中。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712073118606.png"
                      alt="image-20240712073118606"
                ></p>
<ul>
<li>在 .env.development 中，将 “若依管理系统” 修改为自己想要的。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712072211214.png"
                      alt="image-20240712072211214"
                ></p>
<h3 id="5-3-3-去除头部导航"><a href="#5-3-3-去除头部导航" class="headerlink" title="5-3-3 去除头部导航"></a>5-3-3 去除头部导航</h3><ul>
<li>在 src \ layout \ components \ Navbar.vue 中，将头部的不需要组件注释掉。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712074948445.png"
                      alt="image-20240712074948445"
                ></p>
<h3 id="5-2-4-主题修改"><a href="#5-2-4-主题修改" class="headerlink" title="5-2-4 主题修改"></a>5-2-4 主题修改</h3><ul>
<li>点击 右上角图标，点击 布局设置，修改主题。</li>
<li>注意只在本地生效，其他设备登录访问看到是还是默认的。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712075551937.png"
                      alt="image-20240712075551937"
                ></p>
<h3 id="5-2-5-自定义图标"><a href="#5-2-5-自定义图标" class="headerlink" title="5-2-5 自定义图标"></a>5-2-5 自定义图标</h3><ul>
<li><p>一般的图标：点击 菜单管理，点击 修改，点击 菜单图标，进行配置。</p>
</li>
<li><p>自定义的图标：</p>
</li>
<li><p>登录 iconfont - 阿里巴巴矢量图标库。</p>
</li>
<li><p>搜索 图标，选择 颜色，使用 SVG下载。</p>
</li>
<li><p>然后保存在 src \ assets \ icons \ svg 中。</p>
</li>
<li><p>最后点击 菜单管理，点击 修改，点击 菜单图标，进行配置。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712085826645.png"
                      alt="image-20240712085826645"
                ></p>
<h3 id="5-2-6-登录页面中标题、背景图"><a href="#5-2-6-登录页面中标题、背景图" class="headerlink" title="5-2-6 登录页面中标题、背景图"></a>5-2-6 登录页面中标题、背景图</h3><ul>
<li>在 src \ views \ login.vue 中，将 “若依后台管理系统” 修改为自己想要的。</li>
<li>将原本的 src \ assets \ images \ login-background.jpg 修改，作废。</li>
<li>将想要的图片保存在 src \ assets \ images \ login-background.jpg 中。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712092132636.png"
                      alt="image-20240712092132636"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712092253598.png"
                      alt="image-20240712092253598"
                ></p>
]]></content>
      <categories>
        <category>RuoYi</category>
        <category>RuoYi框架</category>
      </categories>
      <tags>
        <tag>自研笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue2</title>
    <url>/2024/07/08/Vue2/</url>
    <content><![CDATA[<h1 id="一、理论"><a href="#一、理论" class="headerlink" title="一、理论"></a>一、理论</h1><h1 id="1-快速上手"><a href="#1-快速上手" class="headerlink" title="1- 快速上手"></a>1- 快速上手</h1><h2 id="1-1-Vue概念"><a href="#1-1-Vue概念" class="headerlink" title="1-1 Vue概念"></a>1-1 Vue概念</h2><p>Vue 是一个用于 构建用户界面 的 渐进式 框架。</p>
<ul>
<li><p>构建用户界面：基于数据渲染出用户看到的页面。</p>
</li>
<li><p>渐进式：循序渐进。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708072110066.png"
                      alt="image-20240708072110066"
                ></p>
</li>
<li><p>框架：一套完整的项目解决方案。可以提升开发效率（理解规则 -&gt; 官网）。</p>
</li>
</ul>
<h2 id="1-2-构建Vue实例"><a href="#1-2-构建Vue实例" class="headerlink" title="1-2 构建Vue实例"></a>1-2 构建Vue实例</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708072951874.png"
                      alt="image-20240708072951874"
                ></p>
<ul>
<li>引入的是开发版本包，包含完整的注释和警告。</li>
<li>一旦引入 VueJs 核心包，在全局环境，就有了 Vue 构造函数。</li>
</ul>
<h2 id="1-3-插值表达式"><a href="#1-3-插值表达式" class="headerlink" title="1-3 插值表达式"></a>1-3 插值表达式</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708074148262.png"
                      alt="image-20240708074148262"
                ></p>
<h2 id="1-4-Vue响应式特性"><a href="#1-4-Vue响应式特性" class="headerlink" title="1-4 Vue响应式特性"></a>1-4 Vue响应式特性</h2><p>响应式：</p>
<ul>
<li>数据改变，视图自动更新。</li>
<li>使用 Vue 开发 -&gt; 专注于业务核心逻辑 即可。</li>
</ul>
<p>访问或修改数据：</p>
<ul>
<li>data 中的数据，最终会被添加到实例上。</li>
<li>访问数据：” 实例 .属性名 “</li>
<li>修改数据：” 实例 .属性名 “ &#x3D; “ 值 “</li>
</ul>
<h1 id="2-Vue指令"><a href="#2-Vue指令" class="headerlink" title="2- Vue指令"></a>2- Vue指令</h1><h2 id="2-1-概念"><a href="#2-1-概念" class="headerlink" title="2-1 概念"></a>2-1 概念</h2><p>Vue 会根据不同的【指令】，针对标签实现不同的【功能】。</p>
<p>指令：带有 v- 前缀 的 特殊 标签属性。</p>
<h2 id="2-2-v-html"><a href="#2-2-v-html" class="headerlink" title="2-2 v-html"></a>2-2 v-html</h2><p>作用：动态解析标签，设置元素的 innerHTML。</p>
<p>语法：v-html &#x3D; “ 表达式 “</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708091134224.png"
                      alt="image-20240708091134224"
                ></p>
<h2 id="2-3-v-show"><a href="#2-3-v-show" class="headerlink" title="2-3 v-show"></a>2-3 v-show</h2><p>作用：控制元素显示隐藏。</p>
<p>语法：v-show &#x3D; “ 表达式 “，表达式值 true 显示， false 隐藏。</p>
<p>底层原理：切换 css 的 display: none 来控制 显示 和 隐藏。</p>
<p>场景：频繁切换显示隐藏的场景。</p>
<h2 id="2-4-v-if"><a href="#2-4-v-if" class="headerlink" title="2-4 v-if"></a>2-4 v-if</h2><p>作用：控制元素显示隐藏（条件渲染）。</p>
<p>语法：v-if &#x3D; “ 表达式 “，表达式值 true 显示， false 隐藏。</p>
<p>底层原理：根据 判断条件 控制元素节点的 创建 和 移除。</p>
<p>场景：要么显示，要么隐藏，不频繁切换的场景。</p>
<h2 id="2-5-v-else-与-v-else-if"><a href="#2-5-v-else-与-v-else-if" class="headerlink" title="2-5 v-else 与 v-else-if"></a>2-5 v-else 与 v-else-if</h2><p>作用：辅助 v-if 进行判断渲染。</p>
<p>语法：v-else</p>
<p>语法：v-else-if &#x3D; “ 表达式 “</p>
<p>注意：需要紧挨着 v-if 一起使用。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-08%20094643.png"
                      alt="屏幕截图 2024-07-08 094643"
                ></p>
<h2 id="2-6-v-on"><a href="#2-6-v-on" class="headerlink" title="2-6 v-on"></a>2-6 v-on</h2><p>作用：注册事件 &#x3D; 添加监听 + 提供处理逻辑。</p>
<p>语法：</p>
<ul>
<li><p>v-on：事件名 &#x3D; “ 内联语句 “</p>
</li>
<li><p>v-on：事件名 &#x3D; “ methods中的函数名 “</p>
</li>
</ul>
<p>简写：@事件名</p>
<p>注意：methods 函数内的 this 指向 Vue 实例。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708095731810.png"
                      alt="image-20240708095731810"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708100747646.png"
                      alt="image-20240708100747646"
                ></p>
<h2 id="2-7-v-on调用传参"><a href="#2-7-v-on调用传参" class="headerlink" title="2-7 v-on调用传参"></a>2-7 v-on调用传参</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708101525642.png"
                      alt="image-20240708101525642"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708101554164.png"
                      alt="image-20240708101554164"
                ></p>
<h2 id="2-8-v-bind"><a href="#2-8-v-bind" class="headerlink" title="2-8 v-bind"></a>2-8 v-bind</h2><p>作用：动态的设置 html 的标签属性 -&gt; src、url、title…</p>
<p>语法：v-bind：属性名 &#x3D; “ 表达式 “</p>
<p>简写：: 属性名 &#x3D; “ 表达式 “</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708105400142.png"
                      alt="image-20240708105400142"
                ></p>
<h2 id="2-9-v-for"><a href="#2-9-v-for" class="headerlink" title="2-9 v-for"></a>2-9 v-for</h2><p>作用：基于数据循环，多次渲染整个元素 -&gt;  数组、对象、数字…</p>
<p>遍历数组语法：</p>
<ul>
<li><p>v-for &#x3D; “ ( item, index ) in 数组 “</p>
</li>
<li><p>省略 index：v-for &#x3D; “ item in 数组 “</p>
</li>
<li><p>item 每一项</p>
</li>
<li><p>index 下标（从0开始）</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708110646069.png"
                      alt="image-20240708110646069"
                ></p>
<h2 id="2-10-v-for的key"><a href="#2-10-v-for的key" class="headerlink" title="2-10 v-for的key"></a>2-10 v-for的key</h2><p>作用：给列表项添加的唯一标识。便于Vue进行列表项的正确排序复用。</p>
<p>语法：key属性 &#x3D; “ 唯一标识 “</p>
<p>注意点：</p>
<ul>
<li>key 的值只能是 字符串 或 数字类型。</li>
<li>key 的值必须具有 唯一性。</li>
<li>推荐使用 id 作为 key（唯一），不推荐使用 index 作为 key（会变化，不对应）。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708160208873.png"
                      alt="image-20240708160208873"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708160356031.png"
                      alt="image-20240708160356031"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710082751895.png"
                      alt="image-20240710082751895"
                ></p>
<h2 id="2-11-v-model"><a href="#2-11-v-model" class="headerlink" title="2-11 v-model"></a>2-11 v-model</h2><p>作用：给 表单元素 使用，双向数据绑定 -&gt; 可以快速 获取 或 设置 表单元素内容。</p>
<ul>
<li>数据变化 -&gt; 视图自动更新</li>
<li>视图变化 -&gt; 数据自动更新</li>
</ul>
<p>语法：v-model &#x3D; “ 变量 “ </p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240708161454324.png"
                      alt="image-20240708161454324"
                ></p>
<h1 id="3-指令补充"><a href="#3-指令补充" class="headerlink" title="3- 指令补充"></a>3- 指令补充</h1><h2 id="3-1-指令修饰符"><a href="#3-1-指令修饰符" class="headerlink" title="3-1 指令修饰符"></a>3-1 指令修饰符</h2><p>概念：通过 “ , “ 指明一些指令 后缀，不同 后缀 封装了不同的处理操作 -&gt; 简化代码。</p>
<p>按键修饰符：</p>
<ul>
<li>@keyup .enter：键盘回车监听</li>
</ul>
<p>v-model修饰符：</p>
<ul>
<li>v-model .trim：去除首尾空格</li>
<li>v-model .number：转数字</li>
</ul>
<p>事件修饰符：</p>
<ul>
<li>@事件名 .stop：阻止冒泡，用在子模块</li>
<li>@事件名 .prevent：阻止默认行为</li>
</ul>
<h2 id="3-2-v-bind操作class"><a href="#3-2-v-bind操作class" class="headerlink" title="3-2 v-bind操作class"></a>3-2 v-bind操作class</h2><ul>
<li>语法</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709173947734.png"
                      alt="image-20240709173947734"
                ></p>
<ul>
<li>实例</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709193118247.png"
                      alt="image-20240709193118247"
                ></p>
<h2 id="3-3-v-bind操作style"><a href="#3-3-v-bind操作style" class="headerlink" title="3-3 v-bind操作style"></a>3-3 v-bind操作style</h2><ul>
<li>语法</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709193007230.png"
                      alt="image-20240709193007230"
                ></p>
<ul>
<li>实例</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709192940869.png"
                      alt="image-20240709192940869"
                ></p>
<h2 id="3-4-v-model应用于其他表单元素"><a href="#3-4-v-model应用于其他表单元素" class="headerlink" title="3-4 v-model应用于其他表单元素"></a>3-4 v-model应用于其他表单元素</h2><ul>
<li>语法</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709195046333.png"
                      alt="image-20240709195046333"
                ></p>
<ul>
<li>实例</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709195237001.png"
                      alt="image-20240709195237001"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709195349812.png"
                      alt="image-20240709195349812"
                ></p>
<h1 id="4-计算属性"><a href="#4-计算属性" class="headerlink" title="4- 计算属性"></a>4- 计算属性</h1><h2 id="4-1-计算属性基础使用"><a href="#4-1-计算属性基础使用" class="headerlink" title="4-1 计算属性基础使用"></a>4-1 计算属性基础使用</h2><ul>
<li>概念与语法</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240709200732741.png"
                      alt="image-20240709200732741"
                ></p>
<ul>
<li>实例</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for:</span>(<span class="attr">item</span>, <span class="attr">index</span>) <span class="attr">in</span> <span class="attr">list</span> <span class="attr">:key</span>=<span class="string">item.id</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;&#123; item.name &#125;&#125; - &#123;&#123; item.num &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>   </span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>礼物总数:&#123;&#123; totalcount &#125;&#125;个<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>    </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">data</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="comment">// 现有的数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">list</span>:[</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#123;<span class="attr">id</span>:<span class="number">1</span>, <span class="attr">name</span>:<span class="string">&#x27;篮球&#x27;</span>, <span class="attr">num</span>:<span class="number">3</span>&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#123;<span class="attr">id</span>:<span class="number">2</span>, <span class="attr">name</span>:<span class="string">&#x27;玩具&#x27;</span>, <span class="attr">num</span>:<span class="number">2</span>&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#123;<span class="attr">id</span>:<span class="number">3</span>, <span class="attr">name</span>:<span class="string">&#x27;铅笔&#x27;</span>, <span class="attr">num</span>:<span class="number">5</span>&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            ]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">computed</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="title function_">totalcount</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="comment">//基于现有的数据，编写求值逻辑</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="comment">//计算属性函数内部，可以直接通过 this 访问到 app 实例</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="comment">//需求:对 this.list 数组里面的 num 进行求和 → reduce</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="comment">//把0先赋给sum，然后sum加上遍历的实例的num后，再赋给sum累加，直到遍历完毕</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="keyword">let</span> total = <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, item</span>) =&gt;</span> sum + item.<span class="property">num</span>, <span class="number">0</span>) </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="keyword">return</span> total</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span>    </span><br></pre></td></tr></table></figure></div>

<h2 id="4-2-computed计算属性-vs-methods方法"><a href="#4-2-computed计算属性-vs-methods方法" class="headerlink" title="4-2 computed计算属性 vs methods方法"></a>4-2 computed计算属性 vs methods方法</h2><ul>
<li>对比</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710073817294.png"
                      alt="image-20240710073817294"
                ></p>
<ul>
<li>实例</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for:</span>(<span class="attr">item</span>, <span class="attr">index</span>) <span class="attr">in</span> <span class="attr">list</span> <span class="attr">:key</span>=<span class="string">item.id</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;&#123; item.name &#125;&#125; - &#123;&#123; item.num &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>    </span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>小黑的礼物清单雪<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; totalcountFn() &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>小黑的礼物清单雪<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; totalcountFn() &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>小黑的礼物清单雪<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; totalcount &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>小黑的礼物清单雪<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; totalcount &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">data</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="comment">// 现有的数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">list</span>:[</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#123;<span class="attr">id</span>:<span class="number">1</span>, <span class="attr">name</span>:<span class="string">&#x27;篮球&#x27;</span>, <span class="attr">num</span>:<span class="number">3</span>&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#123;<span class="attr">id</span>:<span class="number">2</span>, <span class="attr">name</span>:<span class="string">&#x27;玩具&#x27;</span>, <span class="attr">num</span>:<span class="number">2</span>&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#123;<span class="attr">id</span>:<span class="number">3</span>, <span class="attr">name</span>:<span class="string">&#x27;铅笔&#x27;</span>, <span class="attr">num</span>:<span class="number">5</span>&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            ]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">methods</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="title function_">totalcountFn</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;methods方法执行了&#x27;</span>) <span class="comment">//执行2次</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="keyword">let</span> total = <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, item</span>) =&gt;</span> sum + item.<span class="property">num</span>, <span class="number">0</span>) </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="keyword">return</span> total</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		&#125;,		</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">computed</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="title function_">totalcount</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="comment">//计算属性:有缓存的，一旦计算出来结果，就会立刻缓存</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="comment">//下一次读取 → 直接读缓存就行 → 性能特别高</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;computed方法执行了&#x27;</span>) <span class="comment">//执行1次</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="keyword">let</span> total = <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, item</span>) =&gt;</span> sum + item.<span class="property">num</span>, <span class="number">0</span>) </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">				<span class="keyword">return</span> total</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span>    </span><br></pre></td></tr></table></figure></div>

<h2 id="4-3-计算属性完整写法"><a href="#4-3-计算属性完整写法" class="headerlink" title="4-3 计算属性完整写法"></a>4-3 计算属性完整写法</h2><ul>
<li>概念与语法</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710075300172.png"
                      alt="image-20240710075300172"
                ></p>
<ul>
<li>实例</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">		<span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">		<span class="attr">data</span>:&#123;</span><br><span class="line">            <span class="attr">firstName</span>: <span class="string">&#x27;刘&#x27;</span></span><br><span class="line"> 			<span class="attr">lastName</span>: <span class="string">&#x27;备&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">methods</span>:&#123;</span><br><span class="line">			<span class="title function_">changeName</span>(<span class="params"></span>)&#123;</span><br><span class="line">				<span class="variable language_">this</span>.<span class="property">fullName</span> = <span class="string">&#x27;吕小布&#x27;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,		</span><br><span class="line">		<span class="attr">computed</span>:&#123;</span><br><span class="line">            <span class="comment">// 完整写法 → 获取 + 设置</span></span><br><span class="line">            <span class="attr">fullName</span>:&#123;</span><br><span class="line">                <span class="comment">//(1)当fullName计算属性，被获取求值时，执行get(有缓存)</span></span><br><span class="line">                <span class="comment">//会将返回值作为，求值的结果</span></span><br><span class="line">                <span class="title function_">get</span>(<span class="params"></span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="variable language_">this</span>.<span class="property">lastName</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">//(2)当fullName计算属性，被修改赋值时，执行set</span></span><br><span class="line">                <span class="comment">//修改的值，传递给set方法的形参</span></span><br><span class="line">                <span class="title function_">set</span>(<span class="params">value</span>)&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">firstName</span> = value.<span class="title function_">slice</span>(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">lastName</span> = value.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;	</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h1 id="5-watch侦听器"><a href="#5-watch侦听器" class="headerlink" title="5- watch侦听器"></a>5- watch侦听器</h1><h2 id="5-1-概念"><a href="#5-1-概念" class="headerlink" title="5-1 概念"></a>5-1 概念</h2><p>作用：监视数据变化，执行一些 业务逻辑 或 异步操作。</p>
<p>语法：</p>
<ul>
<li>简单写法 -&gt; 简单类型数据，直接监视</li>
<li>完整写法 -&gt; 添加额外配置项</li>
</ul>
<h2 id="5-2-简单写法"><a href="#5-2-简单写法" class="headerlink" title="5-2 简单写法"></a>5-2 简单写法</h2><ul>
<li>语法</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710083552727.png"
                      alt="image-20240710083552727"
                ></p>
<ul>
<li>实例（实时翻译）</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">		<span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">		<span class="attr">data</span>:&#123;</span><br><span class="line">            <span class="attr">words</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">result</span>:<span class="string">&#x27;&#x27;</span>, <span class="comment">//翻译后结果</span></span><br><span class="line">            <span class="comment">// timer:null //延时器id，可以去掉，只在下面逻辑有this.timer就行</span></span><br><span class="line">            <span class="attr">obj</span>: &#123;</span><br><span class="line">            	<span class="attr">words</span>:<span class="string">&#x27;&#x27;</span> <span class="comment">//需要翻译的数据</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">watch</span>:&#123;</span><br><span class="line">			<span class="comment">//该方法会在数据变化时调用执行</span></span><br><span class="line">			<span class="comment">//newValue新值，oldValue老值(一般不用)</span></span><br><span class="line">			<span class="title function_">words</span>(<span class="params">newValue</span>)&#123;</span><br><span class="line">				<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;变化了&#x27;</span>, newValue)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&#x27;obj.words&#x27;</span> (newValue)&#123;</span><br><span class="line">				<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;变化了&#x27;</span>, newValue)</span><br><span class="line">			&#125;,</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//翻译逻辑代码</span></span><br><span class="line">            <span class="string">&#x27;obj.words&#x27;</span> (newValue)&#123;</span><br><span class="line">                <span class="comment">//防抖:延迟执行 → 干啥事先等一等，延迟一会，一段时间内没有再次触发，才执行</span></span><br><span class="line">                <span class="built_in">clearTimeout</span>(<span class="variable language_">this</span>.<span class="property">timer</span>)</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="built_in">setTimeout</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">axios</span>(&#123;</span><br><span class="line">                        <span class="attr">url</span>:<span class="string">&quot;https://applet-base-api-t.itheima.net/api/&quot;</span></span><br><span class="line">                        <span class="attr">params</span>:&#123;</span><br><span class="line">                            <span class="attr">words</span>: newValue</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">result</span> = res.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">                &#125;,<span class="number">1000</span>) <span class="comment">//1秒</span></span><br><span class="line">            &#125;</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="5-3-完整写法"><a href="#5-3-完整写法" class="headerlink" title="5-3 完整写法"></a>5-3 完整写法</h2><ul>
<li>语法</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240710111306372.png"
                      alt="image-20240710111306372"
                ></p>
<ul>
<li>实例</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">		<span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">		<span class="attr">data</span>:&#123;</span><br><span class="line">            <span class="attr">result</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">//翻译后结果</span></span><br><span class="line">            <span class="attr">obj</span>: &#123;</span><br><span class="line">            	<span class="attr">words</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">//需要翻译的数据</span></span><br><span class="line">            	<span class="attr">lang</span>: <span class="string">&#x27;english&#x27;</span> <span class="comment">//设定翻译成的语言</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">watch</span>:&#123;</span><br><span class="line">            <span class="attr">obj</span>:&#123;</span><br><span class="line">            	<span class="attr">deep</span>: <span class="literal">true</span>, <span class="comment">//深度监视</span></span><br><span class="line">                <span class="attr">immediate</span>: <span class="literal">true</span>, <span class="comment">//初始化立刻执行一次handler方法 </span></span><br><span class="line">            	<span class="title function_">handler</span>(<span class="params">newValue</span>)&#123;</span><br><span class="line">            		<span class="built_in">clearTimeout</span>(<span class="variable language_">this</span>.<span class="property">timer</span>)</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="built_in">setTimeout</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">axios</span>(&#123;</span><br><span class="line">                            <span class="attr">url</span>:<span class="string">&quot;https://applet-base-api-t.itheima.net/api/&quot;</span>,</span><br><span class="line">                            <span class="attr">params</span>:newValue</span><br><span class="line">                        &#125;)</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">result</span> = res.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">                    &#125;,<span class="number">1000</span>) <span class="comment">//1秒</span></span><br><span class="line">            	&#125;</span><br><span class="line">            &#125;</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h1 id="6-生命周期"><a href="#6-生命周期" class="headerlink" title="6- 生命周期"></a>6- 生命周期</h1><h2 id="6-1-概念"><a href="#6-1-概念" class="headerlink" title="6-1 概念"></a>6-1 概念</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240731161701881.png"
                      alt="image-20240731161701881"
                ></p>
<h2 id="6-2-生命周期函数（钩子函数）"><a href="#6-2-生命周期函数（钩子函数）" class="headerlink" title="6-2 生命周期函数（钩子函数）"></a>6-2 生命周期函数（钩子函数）</h2><h3 id="6-2-1-概念"><a href="#6-2-1-概念" class="headerlink" title="6-2-1 概念"></a>6-2-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240731162322287.png"
                      alt="image-20240731162322287"
                ></p>
<h3 id="6-2-2-实例"><a href="#6-2-2-实例" class="headerlink" title="6-2-2 实例"></a>6-2-2 实例</h3><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//created函数</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="comment">//接口地址:http://hmajax.itheima.net/api/news</span></span><br><span class="line">	<span class="comment">//请求方式:get</span></span><br><span class="line">	<span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">		<span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">		<span class="attr">data</span>:&#123;</span><br><span class="line">			<span class="attr">list</span>:[]</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="keyword">async</span> <span class="title function_">created</span>(<span class="params"></span>)&#123;</span><br><span class="line">			<span class="comment">//1.发送请求，获取数据</span></span><br><span class="line">			<span class="keyword">const</span> res = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;http://hmajax.itheima.net/api/news&#x27;</span>)</span><br><span class="line">			<span class="comment">//2.将数据更新给 data 中的 list</span></span><br><span class="line">			<span class="variable language_">this</span>.<span class="property">list</span> = res.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//mounted函数</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">data</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="attr">words</span>:<span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="comment">//核心思路:</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">   		<span class="comment">//1.等输入框渲染出来</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">   		<span class="comment">//2.让输入框获取焦点</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">			<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#inp&#x27;</span>).<span class="title function_">focus</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div>

<h1 id="7-工程化开发-脚手架"><a href="#7-工程化开发-脚手架" class="headerlink" title="7- 工程化开发 &amp; 脚手架"></a>7- 工程化开发 &amp; 脚手架</h1><h2 id="7-1-概念"><a href="#7-1-概念" class="headerlink" title="7-1 概念"></a>7-1 概念</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240801073601940.png"
                      alt="image-20240801073601940"
                ></p>
<h2 id="7-2-脚手架目录文件介绍"><a href="#7-2-脚手架目录文件介绍" class="headerlink" title="7-2 脚手架目录文件介绍"></a>7-2 脚手架目录文件介绍</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240801075201474.png"
                      alt="image-20240801075201474"
                ></p>
<h2 id="7-3-项目运行流程"><a href="#7-3-项目运行流程" class="headerlink" title="7-3 项目运行流程"></a>7-3 项目运行流程</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240801101637239.png"
                      alt="image-20240801101637239"
                ></p>
<h1 id="8-组件化开发-根组件"><a href="#8-组件化开发-根组件" class="headerlink" title="8- 组件化开发 &amp; 根组件"></a>8- 组件化开发 &amp; 根组件</h1><h2 id="8-1-概念"><a href="#8-1-概念" class="headerlink" title="8-1 概念"></a>8-1 概念</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240801102520180.png"
                      alt="image-20240801102520180"
                ></p>
<h2 id="8-2-App根组件"><a href="#8-2-App根组件" class="headerlink" title="8-2 App根组件"></a>8-2 App根组件</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240801103339310.png"
                      alt="image-20240801103339310"
                ></p>
<ul>
<li>注意</li>
</ul>
<p>如果用 less，需要装两个依赖包：less 与 less-loader。命令：yarn add less less-loader -D（开发依赖）。</p>
<h2 id="8-3-普通组件-局部注册"><a href="#8-3-普通组件-局部注册" class="headerlink" title="8-3 普通组件-局部注册"></a>8-3 普通组件-局部注册</h2><h3 id="8-3-1-概念"><a href="#8-3-1-概念" class="headerlink" title="8-3-1 概念"></a>8-3-1 概念</h3><p>局部注册：只能在注册的组件内使用。</p>
<p>步骤：</p>
<ul>
<li>创建 .vue 文件（三个组成部分）。</li>
<li>在使用的组件内导入并注册。</li>
</ul>
<h3 id="8-3-2-使用"><a href="#8-3-2-使用" class="headerlink" title="8-3-2 使用"></a>8-3-2 使用</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240801141757804.png"
                      alt="image-20240801141757804"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240801141820120.png"
                      alt="image-20240801141820120"
                ></p>
<h3 id="8-3-3-实例"><a href="#8-3-3-实例" class="headerlink" title="8-3-3 实例"></a>8-3-3 实例</h3><ul>
<li>创建 components 包，创建 HmHeader.vue 文件。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;hm-header&quot;&gt;</span><br><span class="line">		我是hm-header</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	export default &#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .hm-hdader &#123;</span><br><span class="line">        height: 100px;</span><br><span class="line">        line-height: 100px;</span><br><span class="line">        text-align: center;</span><br><span class="line">        font-size: 30px;</span><br><span class="line">        background-color: #8064a2;</span><br><span class="line">        color: white;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在 App.vue 文件，导入并注册，使用。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;App&quot;&gt;</span><br><span class="line">		&lt;!--使用 头部组件 --&gt;</span><br><span class="line">		&lt;HmHeader&gt;&lt;/HmHeader&gt;</span><br><span class="line">        </span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    //导入</span><br><span class="line">    import HmHeader from &#x27;./components/HmHeader.vue&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        //注册</span><br><span class="line">		components:&#123;</span><br><span class="line">            //&#x27;组件名&#x27;:组件对象</span><br><span class="line">            HmHeader: HmHeader</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">	.App &#123;</span><br><span class="line">		width: 600px;</span><br><span class="line">		height: 700px;</span><br><span class="line">		background-color: #87ceeb;</span><br><span class="line">		margin: 0 auto;</span><br><span class="line">		padding: 20px;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="8-4-普通组件-全局注册"><a href="#8-4-普通组件-全局注册" class="headerlink" title="8-4 普通组件-全局注册"></a>8-4 普通组件-全局注册</h2><h3 id="8-4-1-概念"><a href="#8-4-1-概念" class="headerlink" title="8-4-1 概念"></a>8-4-1 概念</h3><p>全局注册：所有组件内都能使用。</p>
<p>步骤：</p>
<ul>
<li>创建 .vue 文件（三个组成部分）。</li>
<li>main.js 中进行全局注册。</li>
</ul>
<h3 id="8-4-2-使用"><a href="#8-4-2-使用" class="headerlink" title="8-4-2 使用"></a>8-4-2 使用</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240801150049913.png"
                      alt="image-20240801150049913"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240801141820120.png"
                      alt="image-20240801141820120"
                ></p>
<h3 id="8-4-3-实例"><a href="#8-4-3-实例" class="headerlink" title="8-4-3 实例"></a>8-4-3 实例</h3><ul>
<li>在 components 包下，创建 HmButton.vue 文件。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;button class=&quot;hm-button&quot;&gt;</span><br><span class="line">        通用按钮</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	export default &#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .hm-button &#123;</span><br><span class="line">		height: 50px;</span><br><span class="line">        line-height: 50px;</span><br><span class="line">        padding: 0 20px;</span><br><span class="line">        background-color: #3bae56;</span><br><span class="line">        border-radius: 5px;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在 main.js 文件，导入并注册。</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span></span><br><span class="line"><span class="comment">//导入</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HmButton</span> <span class="keyword">from</span> <span class="string">&#x27;./components/HmButton.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//注册</span></span><br><span class="line"><span class="comment">//Vue.component(组件名，组件对象)</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;HmButton&#x27;</span>, <span class="title class_">HmButton</span>)</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在 HmHeader.vue 文件，使用。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;hm-header&quot;&gt;</span><br><span class="line">		我是hm-header</span><br><span class="line">        &lt;!--使用 --&gt;</span><br><span class="line">		&lt;HmButton&gt;&lt;/HmButton&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="8-5-scoped样式冲突"><a href="#8-5-scoped样式冲突" class="headerlink" title="8-5 scoped样式冲突"></a>8-5 scoped样式冲突</h2><h3 id="8-5-1-场景"><a href="#8-5-1-场景" class="headerlink" title="8-5-1 场景"></a>8-5-1 场景</h3><p>当在给局部组件，添加 style 样式时，如果标签名与其他组件的标签名一样，那么给局部组件的样式也会加到其他组件。</p>
<p>此时，在 style 标签后加上 scoped，使样式只对本组件有效。</p>
<h3 id="8-5-2-使用"><a href="#8-5-2-使用" class="headerlink" title="8-5-2 使用"></a>8-5-2 使用</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;BaseTwo&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">	/*</span><br><span class="line">	1.默认的style样式，会作用于全局→全局样式</span><br><span class="line">	2.加上scoped属性的style样式，只会作用于当前组件→局部样式</span><br><span class="line">	</span><br><span class="line">	组件应该有着自己独立的样式，推荐加上scoped</span><br><span class="line">	*/</span><br><span class="line">    /*</span><br><span class="line">    scoped原理:</span><br><span class="line">	1.给当前组件模板的所有元素，都会被添加上一个自定义属性data-v-hash值</span><br><span class="line">		data-v-5f6a9d56 区分开不同的组件</span><br><span class="line">    2.css选择器后面，被自动处理，添加上了属性选择器div[data-v-5f6a9d56]</span><br><span class="line">    */</span><br><span class="line">	div &#123;</span><br><span class="line">		border: 3px solid blue;</span><br><span class="line">		margin: 30px;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="8-6-data是一个函数"><a href="#8-6-data是一个函数" class="headerlink" title="8-6 data是一个函数"></a>8-6 data是一个函数</h2><h3 id="8-6-1-概念"><a href="#8-6-1-概念" class="headerlink" title="8-6-1 概念"></a>8-6-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240802165216581.png"
                      alt="image-20240802165216581"
                ></p>
<h3 id="8-6-2-实例"><a href="#8-6-2-实例" class="headerlink" title="8-6-2 实例"></a>8-6-2 实例</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;base-count&quot;&gt;</span><br><span class="line">		&lt;button @click=&quot;count--&quot;&gt;-&lt;/button&gt;</span><br><span class="line">		&lt;span&gt;&#123;&#123; count &#125;&#125;&lt;/span&gt;</span><br><span class="line">		&lt;button @click=&quot;count++&quot;&gt;+&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	export default &#123;</span><br><span class="line">		data() &#123;</span><br><span class="line">			return&#123;</span><br><span class="line">				count:999</span><br><span class="line">			&#125;	</span><br><span class="line">		&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h1 id="9-组件通信"><a href="#9-组件通信" class="headerlink" title="9- 组件通信"></a>9- 组件通信</h1><h2 id="9-1-概念"><a href="#9-1-概念" class="headerlink" title="9-1 概念"></a>9-1 概念</h2><p>组件通信，就是指 组件与组件 之间的数据传递。</p>
<ul>
<li>组件的数据是独立的，无法直接访问其他组件的数据。</li>
<li>想用其他组件的数据，必须使用组件通信。</li>
</ul>
<h2 id="9-2-组件关系"><a href="#9-2-组件关系" class="headerlink" title="9-2 组件关系"></a>9-2 组件关系</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240802205957952.png"
                      alt="image-20240802205957952"
                ></p>
<h2 id="9-3-组件通信解决方案"><a href="#9-3-组件通信解决方案" class="headerlink" title="9-3 组件通信解决方案"></a>9-3 组件通信解决方案</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240802210055346.png"
                      alt="image-20240802210055346"
                ></p>
<h2 id="9-4-父子通信"><a href="#9-4-父子通信" class="headerlink" title="9-4 父子通信"></a>9-4 父子通信</h2><h3 id="9-4-1-流程图"><a href="#9-4-1-流程图" class="headerlink" title="9-4-1 流程图"></a>9-4-1 流程图</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240802213809839.png"
                      alt="image-20240802213809839"
                ></p>
<h3 id="9-4-2-实例"><a href="#9-4-2-实例" class="headerlink" title="9-4-2 实例"></a>9-4-2 实例</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240802220503407.png"
                      alt="image-20240802220503407"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240802220536046.png"
                      alt="image-20240802220536046"
                ></p>
<h2 id="9-5-props"><a href="#9-5-props" class="headerlink" title="9-5 props"></a>9-5 props</h2><h3 id="9-5-1-概念"><a href="#9-5-1-概念" class="headerlink" title="9-5-1 概念"></a>9-5-1 概念</h3><p>Prop 定义：组件上注册的一些 自定义属性。</p>
<p>Prop 作用：向子组件传递数据。</p>
<p>Prop 特点：</p>
<ul>
<li>可以 传递 任意数量 的prop。</li>
<li>可以 传递 任意类型 的prop。</li>
</ul>
<h3 id="9-5-2-props校验"><a href="#9-5-2-props校验" class="headerlink" title="9-5-2 props校验"></a>9-5-2 props校验</h3><p>作用：为组件的 prop 指定验证要求，不符合要求，控制台就会有错误提示。帮助开发者，快速发现错误。</p>
<p>语法：</p>
<ul>
<li>类型校验（最常用）</li>
<li>非空校验</li>
<li>默认值</li>
<li>自定义校验</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//基础写法（类型校验）</span></span><br><span class="line"><span class="attr">props</span>: &#123;</span><br><span class="line">	校验的属性名: 类型 <span class="comment">//Number String Boolean...</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//完整写法</span></span><br><span class="line"><span class="attr">props</span>: &#123;</span><br><span class="line">	校验的属性名: &#123;</span><br><span class="line">		<span class="attr">type</span>: 类型, <span class="comment">//Number String Boolean</span></span><br><span class="line">		<span class="attr">required</span>: <span class="literal">true</span>, <span class="comment">//是否必填</span></span><br><span class="line">		<span class="attr">default</span>: 默认值, <span class="comment">//默认值</span></span><br><span class="line">		<span class="title function_">validator</span>(<span class="params">value</span>) &#123;</span><br><span class="line">			<span class="comment">// 自定义校验逻辑</span></span><br><span class="line">			<span class="keyword">return</span> 是否通过校验</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        <span class="comment">// props: [&#x27;w&#x27;]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.基础写法（类型校验）</span></span><br><span class="line">        <span class="comment">// props: &#123;</span></span><br><span class="line">        <span class="comment">//		w: Number </span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.完整写法</span></span><br><span class="line">        <span class="attr">props</span>: &#123;</span><br><span class="line">            <span class="attr">W</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">                <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">default</span>:<span class="number">0</span>,</span><br><span class="line">                <span class="title function_">validator</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(value &gt;= <span class="number">0</span> &amp;&amp; value &lt;= <span class="number">100</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="9-5-3-prop-data、单向数据流"><a href="#9-5-3-prop-data、单向数据流" class="headerlink" title="9-5-3 prop &amp; data、单向数据流"></a>9-5-3 prop &amp; data、单向数据流</h3><p>共同点：都可以给组件提供数据。</p>
<p>区别：</p>
<ul>
<li>data 的数据是自己的，随便改。</li>
<li>prop 的数据是外部的 ，不能直接改，要遵循 单向数据流。</li>
</ul>
<p>单向数据流：父级 prop 的数据更新，会向下流动，影响子组件。这个数据流动是单向的。</p>
<p>口诀：谁的数据谁负责。</p>
<h2 id="9-6-非父子通信"><a href="#9-6-非父子通信" class="headerlink" title="9-6 非父子通信"></a>9-6 非父子通信</h2><h3 id="9-6-1-event-bus-事件总线"><a href="#9-6-1-event-bus-事件总线" class="headerlink" title="9-6-1 event bus 事件总线"></a>9-6-1 event bus 事件总线</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240803161455136.png"
                      alt="image-20240803161455136"
                ></p>
<h3 id="9-6-2-provide-inject"><a href="#9-6-2-provide-inject" class="headerlink" title="9-6-2 provide &amp; inject"></a>9-6-2 provide &amp; inject</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901202901935.png"
                      alt="image-20240901202901935"
                ></p>
<ul>
<li>父组件</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">        <span class="title function_">provide</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>&#123;</span><br><span class="line">                <span class="comment">// 普通类型【非响应式】</span></span><br><span class="line">                <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">color</span>,</span><br><span class="line">                <span class="comment">// 复杂类型【响应式】- 推荐</span></span><br><span class="line">                <span class="attr">userInfo</span>: <span class="variable language_">this</span>.<span class="property">userInfo</span>,</span><br><span class="line">            &#125;	</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>&#123;</span><br><span class="line">                <span class="attr">color</span>:<span class="string">&#x27;pink&#x27;</span>, <span class="comment">//简单类型</span></span><br><span class="line">                <span class="attr">userInfo</span>:&#123; <span class="comment">// 复杂类型</span></span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">                    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>子&#x2F;孙组件</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		我是grandSon组件</span><br><span class="line">		&#123;&#123; color &#125;&#125;</span><br><span class="line">		&#123;&#123; userInfo.name &#125;&#125;</span><br><span class="line">		&#123;&#123; userInfo.age &#125;&#125;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default&#123;</span><br><span class="line">		inject: [&#x27;color&#x27;,&#x27;userInfo&#x27;],</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="9-7-v-model使用组件"><a href="#9-7-v-model使用组件" class="headerlink" title="9-7 v-model使用组件"></a>9-7 v-model使用组件</h2><h3 id="9-7-1-v-model原理"><a href="#9-7-1-v-model原理" class="headerlink" title="9-7-1 v-model原理"></a>9-7-1 v-model原理</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901205736857.png"
                      alt="image-20240901205736857"
                ></p>
<h3 id="9-7-2-表单类组件封装"><a href="#9-7-2-表单类组件封装" class="headerlink" title="9-7-2 表单类组件封装"></a>9-7-2 表单类组件封装</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901211851054.png"
                      alt="image-20240901211851054"
                ></p>
<ul>
<li>父组件</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;app&quot;&gt;</span><br><span class="line">		&lt;BaseSelect</span><br><span class="line">			:cityId = &quot;selectId&quot;</span><br><span class="line">			@changeId = &quot;selectId = $event&quot;&gt;</span><br><span class="line">		&lt;/BaseSelect&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import BaseSelect from &#x27;./子组件&#x27;,</span><br><span class="line">	export default &#123;</span><br><span class="line">		data()&#123;</span><br><span class="line">			return&#123;</span><br><span class="line">				selectId:&#x27;103&#x27;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		components:&#123;</span><br><span class="line">			BaseSelect</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>子组件</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;select :value=&quot;cityId&quot; @change=&quot;handleChange&quot;&gt; </span><br><span class="line">            &lt;option value=&quot;101&quot;&gt;北京&lt;/option&gt;</span><br><span class="line">            &lt;option value=&quot;102&quot;&gt;上海&lt;/option&gt;</span><br><span class="line">            &lt;option value=&quot;103&quot;&gt;武汉&lt;/option&gt;</span><br><span class="line">            &lt;option value=&quot;104&quot;&gt;深圳&lt;/option&gt;</span><br><span class="line">            &lt;option value=&quot;105&quot;&gt;广州&lt;/option&gt;</span><br><span class="line">		&lt;/select&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        props: &#123;</span><br><span class="line">        	cityId: String</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line">        	handleChange(e)&#123;</span><br><span class="line">        		//console.log(e.targpt.value)</span><br><span class="line">        		this.$emit(&#x27;changeId&#x27;,e.target.value)</span><br><span class="line">        	&#125;</span><br><span class="line">       	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="9-7-3-v-model简化组件封装"><a href="#9-7-3-v-model简化组件封装" class="headerlink" title="9-7-3 v-model简化组件封装"></a>9-7-3 v-model简化组件封装</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901214110153.png"
                      alt="image-20240901214110153"
                ></p>
<ul>
<li>父组件</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;app&quot;&gt;</span><br><span class="line">		&lt;BaseSelect</span><br><span class="line">			v-model=&quot;selectId&quot;&gt;</span><br><span class="line">		&lt;/BaseSelect&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import BaseSelect from &#x27;./子组件&#x27;,</span><br><span class="line">	export default &#123;</span><br><span class="line">		data()&#123;</span><br><span class="line">			return&#123;</span><br><span class="line">				selectId:&#x27;103&#x27;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		components:&#123;</span><br><span class="line">			BaseSelect</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>子组件</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;select :value=&quot;value&quot; @change=&quot;handleChange&quot;&gt; </span><br><span class="line">            &lt;option value=&quot;101&quot;&gt;北京&lt;/option&gt;</span><br><span class="line">            &lt;option value=&quot;102&quot;&gt;上海&lt;/option&gt;</span><br><span class="line">            &lt;option value=&quot;103&quot;&gt;武汉&lt;/option&gt;</span><br><span class="line">            &lt;option value=&quot;104&quot;&gt;深圳&lt;/option&gt;</span><br><span class="line">            &lt;option value=&quot;105&quot;&gt;广州&lt;/option&gt;</span><br><span class="line">		&lt;/select&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        props: &#123;</span><br><span class="line">        	value: String</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line">        	handleChange(e)&#123;</span><br><span class="line">        		//console.log(e.targpt.value)</span><br><span class="line">        		this.$emit(&#x27;input&#x27;,e.target.value)</span><br><span class="line">        	&#125;</span><br><span class="line">       	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="9-8-sync修饰符"><a href="#9-8-sync修饰符" class="headerlink" title="9-8 sync修饰符"></a>9-8 sync修饰符</h2><h3 id="9-8-1-概念"><a href="#9-8-1-概念" class="headerlink" title="9-8-1 概念"></a>9-8-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240902092635672.png"
                      alt="image-20240902092635672"
                ></p>
<h3 id="9-8-2-实例"><a href="#9-8-2-实例" class="headerlink" title="9-8-2 实例"></a>9-8-2 实例</h3><ul>
<li>父组件</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app&quot;&gt;</span><br><span class="line">        &lt;button class=&quot;logout&quot; @click=&quot;isShow = true&quot;&gt;退出按钮&lt;/button&gt;</span><br><span class="line">        &lt;BaseDialog</span><br><span class="line">         :visible.sync=&quot;isShow&quot;&gt;&lt;/BaseDialog&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import BaseDialog from &#x27;./子组件&#x27;,</span><br><span class="line">    export default &#123;</span><br><span class="line">        data()&#123;</span><br><span class="line">            return &#123;</span><br><span class="line">				isShow:false</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        components:&#123;</span><br><span class="line">            BaseDialog</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>子组件</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div v-show=&quot;visible&quot;&gt;</span><br><span class="line">		&lt;div class=&quot;base-dialog&quot;&gt;</span><br><span class="line">			&lt;div class=&quot;title&quot;&gt;</span><br><span class="line">				&lt;h3&gt;温馨提示:&lt;/h3&gt;</span><br><span class="line">				&lt;button class=&quot;close&quot; @click=&quot;close&quot;&gt;x&lt;/button&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">                &lt;p&gt;你确认要退出本系统么?&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;footer&quot;&gt;</span><br><span class="line">                &lt;button&gt;确认&lt;/button&gt;</span><br><span class="line">                &lt;button&gt;取消&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">		props: &#123;</span><br><span class="line">            visible: Boolean</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            close()&#123;</span><br><span class="line">               this.$emit(&#x27;update:visible&#x27;,false) </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="9-9-ref-和-refs"><a href="#9-9-ref-和-refs" class="headerlink" title="9-9 ref 和 $refs"></a>9-9 ref 和 $refs</h2><h3 id="9-9-1-概念"><a href="#9-9-1-概念" class="headerlink" title="9-9-1 概念"></a>9-9-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240902162450941.png"
                     
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240902170031858.png"
                      alt="image-20240902170031858"
                ></p>
<h3 id="9-9-2-获取dom元素"><a href="#9-9-2-获取dom元素" class="headerlink" title="9-9-2 获取dom元素"></a>9-9-2 获取dom元素</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240902165752540.png"
                      alt="image-20240902165752540"
                ></p>
<h3 id="9-9-3-组件实例"><a href="#9-9-3-组件实例" class="headerlink" title="9-9-3 组件实例"></a>9-9-3 组件实例</h3><ul>
<li>父组件</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;app&quot;&gt;</span><br><span class="line">		&lt;BaseForm ref=&quot;baseForm&quot;&gt;&lt;/BaseForm&gt;</span><br><span class="line">		&lt;button @click=&quot;handleGet&quot;&gt;获取数据&lt;/button&gt;</span><br><span class="line">		&lt;button @click=&quot;handleReset&quot;&gt;重置数据&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import BaseForm from &#x27;./子组件&#x27;,</span><br><span class="line">	export default &#123;</span><br><span class="line">		data()&#123;</span><br><span class="line">			return &#123;</span><br><span class="line">			</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		methods:&#123;</span><br><span class="line">			handleGet()&#123;</span><br><span class="line">				this.$refs.baseForm.getValues() //调用子组件的方法1</span><br><span class="line">			&#125;,</span><br><span class="line">			handleReset()&#123;</span><br><span class="line">				this.$refs.baseForm.resetValues() //调用子组件的方法2</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		components:&#123;</span><br><span class="line">			BaseForm</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>子组件</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">account</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">password</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">methods</span>: &#123;</span><br><span class="line">            <span class="comment">//方法1:收集表单数据，返回一个对象</span></span><br><span class="line">            <span class="title function_">getValues</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="attr">account</span>: <span class="variable language_">this</span>.<span class="property">account</span>,</span><br><span class="line">                    <span class="attr">password</span>: <span class="variable language_">this</span>.<span class="property">password</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//方法2:重置表单</span></span><br><span class="line">            <span class="title function_">resetValues</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">account</span> = <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">password</span> =<span class="string">&#x27;&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">      	&#125;</span><br><span class="line"> 	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="9-10-Vue异步更新、-nextTick"><a href="#9-10-Vue异步更新、-nextTick" class="headerlink" title="9-10 Vue异步更新、$nextTick"></a>9-10 Vue异步更新、$nextTick</h2><h3 id="9-10-1-概念"><a href="#9-10-1-概念" class="headerlink" title="9-10-1 概念"></a>9-10-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-02%20172843.png"
                      alt="屏幕截图 2024-09-02 172843"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240902173849192.png"
                      alt="image-20240902173849192"
                ></p>
<h3 id="9-10-2-实例"><a href="#9-10-2-实例" class="headerlink" title="9-10-2 实例"></a>9-10-2 实例</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app&quot;&gt;</span><br><span class="line">        &lt;!--是否在编辑状态--&gt;</span><br><span class="line">        &lt;div v-if=&quot;isshowEdit&quot;&gt;</span><br><span class="line">        	&lt;input ref=&quot;inp&quot; v-model=&quot;editValue&quot; type=&quot;text&quot; /&gt;</span><br><span class="line">        	&lt;button&gt;确认&lt;/button&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">    	&lt;!--默认状态 --&gt;</span><br><span class="line">    	&lt;div v-else&gt;</span><br><span class="line">    		&lt;span&gt;&#123;&#123; title &#125;&#125;&lt;/span&gt;</span><br><span class="line">    		&lt;button @click=&quot;handleEdit&quot;&gt;编辑&lt;/button&gt;</span><br><span class="line">    	&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default&#123;</span><br><span class="line">	data()&#123;</span><br><span class="line">		return&#123;</span><br><span class="line">		title: &#x27;大标题&#x27;,</span><br><span class="line">		editValue: &#x27;&#x27;,</span><br><span class="line">		isShowEdit: false</span><br><span class="line">	&#125;,</span><br><span class="line">	methods:&#123;</span><br><span class="line">		handleEdit()&#123;</span><br><span class="line">            //1.显示输入框(异步dom更新)</span><br><span class="line">            this.isShowEdit = true</span><br><span class="line">            //2.让输入框获取焦点($nextTick等dom更新完，立刻执行准备的函数体)</span><br><span class="line">			this.$nextTick(() =&gt; &#123;</span><br><span class="line">				//console.log(this.$refs.inp)</span><br><span class="line">				this.$refs.inp.focus()</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h1 id="10-自定义指令"><a href="#10-自定义指令" class="headerlink" title="10- 自定义指令"></a>10- 自定义指令</h1><h2 id="10-1-基础语法"><a href="#10-1-基础语法" class="headerlink" title="10-1 基础语法"></a>10-1 基础语法</h2><h3 id="10-1-1-概念"><a href="#10-1-1-概念" class="headerlink" title="10-1-1 概念"></a>10-1-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240903210825010.png"
                      alt="image-20240903210825010"
                ></p>
<h3 id="10-1-2-实例"><a href="#10-1-2-实例" class="headerlink" title="10-1-2 实例"></a>10-1-2 实例</h3><ul>
<li>app.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;h1&gt;自定义指令&lt;/h1&gt;</span><br><span class="line">        &lt;!-- v-focus：自定义指令 --&gt;</span><br><span class="line">		&lt;input v-focus ref=&quot;inp&quot; type=&quot;text&quot;&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	export default&#123;</span><br><span class="line">		//mounted()&#123;</span><br><span class="line">		//	this.$refs.inp.focus()</span><br><span class="line">		//&#125;</span><br><span class="line">        </span><br><span class="line">        //2.局部注册指令</span><br><span class="line">        directives: &#123;</span><br><span class="line">            // 指令名:指令的配置项</span><br><span class="line">            focus: &#123;</span><br><span class="line">                inserted(el)&#123;</span><br><span class="line">                    el.focus()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;        </span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>src&#x2F;main.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.全局注册指令</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">	<span class="comment">// inserted 会在 指令 所在的元素，被插入到页面中时触发</span></span><br><span class="line">	<span class="title function_">inserted</span>(<span class="params">el</span>)&#123;</span><br><span class="line">		<span class="comment">//el 就是指令所绑定的元素</span></span><br><span class="line">		<span class="comment">//console.log(el);</span></span><br><span class="line">		el.<span class="title function_">focus</span>()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="10-1-3-指令的值"><a href="#10-1-3-指令的值" class="headerlink" title="10-1-3 指令的值"></a>10-1-3 指令的值</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240903215643320.png"
                      alt="image-20240903215643320"
                ></p>
<h3 id="10-1-4-实例"><a href="#10-1-4-实例" class="headerlink" title="10-1-4 实例"></a>10-1-4 实例</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1 v-color=&quot;color1&quot;&gt;指令的值1测试&lt;/h1&gt;</span><br><span class="line">        &lt;h1 v-color=&quot;color2&quot;&gt;指令的值2测试&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data()&#123;</span><br><span class="line">            return&#123;</span><br><span class="line">				color1: &#x27;red&#x27;,</span><br><span class="line">				color2: &#x27;green&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        directives:&#123;</span><br><span class="line">        	color:&#123;</span><br><span class="line">                // 1.inserted 提供的是元素被添加到页面中时的逻辑</span><br><span class="line">        		inserted(el, binding)&#123;</span><br><span class="line">        			//console.log(el, binding.value);</span><br><span class="line">                    //binding.value 就是指令的值</span><br><span class="line">        			el.style.color = binding.value</span><br><span class="line">        		&#125;,</span><br><span class="line">                // 2.update 指令的值修改的时候触发，提供值变化后，dom更新的逻辑</span><br><span class="line">                update(el, binding)&#123;</span><br><span class="line">        			el.style.color = binding.value</span><br><span class="line">        		&#125;</span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;</span><br><span class="line">   	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="10-2-封装v-loading指令"><a href="#10-2-封装v-loading指令" class="headerlink" title="10-2 封装v-loading指令"></a>10-2 封装v-loading指令</h2><h3 id="10-2-1-概念"><a href="#10-2-1-概念" class="headerlink" title="10-2-1 概念"></a>10-2-1 概念</h3><p>场景：实际开发过程中，发送请求需要时间，在请求的数据未回来时，页面会处于空白状态 &#x3D;&gt; 用户体验不好。</p>
<p>需求：封装一个 v-loading 指令，实现加载中的效果。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904151649449.png"
                      alt="image-20240904151649449"
                ></p>
<h3 id="10-2-2-实例"><a href="#10-2-2-实例" class="headerlink" title="10-2-2 实例"></a>10-2-2 实例</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot; v-loading=&quot;isLoading&quot;&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">   data()&#123;</span><br><span class="line">       return &#123;</span><br><span class="line">           list: [],</span><br><span class="line">           isLoading: true</span><br><span class="line">       &#125;</span><br><span class="line">  	&#125;,</span><br><span class="line">    async created()&#123;</span><br><span class="line">        //1.发送请求获取数据</span><br><span class="line">        const res = await axios.get(&#x27;网址&#x27;)</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            //2.更新到 1ist 中，用于页面渲染 v-for</span><br><span class="line">            this.list = res.data.data</span><br><span class="line">            this.isLoading = false</span><br><span class="line">        &#125;,2000)</span><br><span class="line">    &#125;,</span><br><span class="line">    directives:&#123;</span><br><span class="line">        loading:&#123;</span><br><span class="line">            inserted(el, binding)&#123;</span><br><span class="line">                binding.value ? el.classList.add(&#x27;loading&#x27;) :  el.classList.remove(&#x27;loading&#x27;)</span><br><span class="line">            &#125;,</span><br><span class="line">            update(el, binding)&#123;</span><br><span class="line">                binding.value ? el.classList.add(&#x27;loading&#x27;) :  el.classList.remove(&#x27;loading&#x27;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;  </span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">	.loading:before &#123; </span><br><span class="line">		content: &#x27;&#x27;;</span><br><span class="line">		position: absolute;</span><br><span class="line">		left: 0;</span><br><span class="line">		top: 0;</span><br><span class="line">		width: 100%;</span><br><span class="line">		height: 100%;</span><br><span class="line">		background: #fff url(&#x27;./loading.gif&#x27;) no-repeat center; //url(&#x27;./loading.gif&#x27;)：使用特定图片</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h1 id="11-插槽"><a href="#11-插槽" class="headerlink" title="11- 插槽"></a>11- 插槽</h1><h2 id="11-1-默认插槽（定制一个）"><a href="#11-1-默认插槽（定制一个）" class="headerlink" title="11-1 默认插槽（定制一个）"></a>11-1 默认插槽（定制一个）</h2><h3 id="11-1-1-概述"><a href="#11-1-1-概述" class="headerlink" title="11-1-1 概述"></a>11-1-1 概述</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904160212677.png"
                      alt="image-20240904160212677"
                ></p>
<h3 id="11-1-2-实例"><a href="#11-1-2-实例" class="headerlink" title="11-1-2 实例"></a>11-1-2 实例</h3><ul>
<li>MyDialog.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;dialog&quot;&gt;</span><br><span class="line">    	&lt;div class=&quot;dialog-header&quot;&gt;</span><br><span class="line">    		&lt;h3&gt;友情提示&lt;/h3&gt;</span><br><span class="line">        	&lt;span class=&quot;close&quot;&gt;x&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div class=&quot;dialog-content&quot;&gt;</span><br><span class="line">        	&lt;!--1.在需要定制的位置，使用slot占位--&gt;</span><br><span class="line">        	&lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        	&lt;button&gt;取消&lt;/button&gt;</span><br><span class="line">        	&lt;button&gt;确认&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>App.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;!--2.在使用组件时，组件标签内填入内容--&gt;</span><br><span class="line">        &lt;MyDialog&gt;</span><br><span class="line">            &lt;div&gt;你确认要删除么&lt;/div&gt;</span><br><span class="line">    	&lt;/MyDialog&gt;</span><br><span class="line">        &lt;MyDialog&gt;</span><br><span class="line">    		&lt;p&gt;你确认要退出么&lt;/p&gt;</span><br><span class="line">            &lt;p&gt;你确认要退出么&lt;/p&gt;</span><br><span class="line">            &lt;p&gt;你确认要退出么&lt;/p&gt;</span><br><span class="line">    	&lt;/MyDialog&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import MyDialog from &#x27;./MyDialog.vue&#x27;</span><br><span class="line">	export default&#123;</span><br><span class="line">		components:&#123;</span><br><span class="line">			MyDialog</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="11-2-后备内容（默认值）"><a href="#11-2-后备内容（默认值）" class="headerlink" title="11-2 后备内容（默认值）"></a>11-2 后备内容（默认值）</h2><h3 id="11-2-1-概念"><a href="#11-2-1-概念" class="headerlink" title="11-2-1 概念"></a>11-2-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904191028715.png"
                      alt="image-20240904191028715"
                ></p>
<h3 id="11-2-2-实例"><a href="#11-2-2-实例" class="headerlink" title="11-2-2 实例"></a>11-2-2 实例</h3><ul>
<li>MyDialog.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;dialog&quot;&gt;</span><br><span class="line">    	&lt;div class=&quot;dialog-header&quot;&gt;</span><br><span class="line">    		&lt;h3&gt;友情提示&lt;/h3&gt;</span><br><span class="line">        	&lt;span class=&quot;close&quot;&gt;x&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div class=&quot;dialog-content&quot;&gt;</span><br><span class="line">        	&lt;!--往slot标签内部，编写内容，可以作为后备内容（默认值）---&gt;</span><br><span class="line">        	&lt;slot&gt;我是默认的文本内容&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        	&lt;button&gt;取消&lt;/button&gt;</span><br><span class="line">        	&lt;button&gt;确认&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="11-3-具名插槽（定制多个）"><a href="#11-3-具名插槽（定制多个）" class="headerlink" title="11-3 具名插槽（定制多个）"></a>11-3 具名插槽（定制多个）</h2><h3 id="11-3-1-概念"><a href="#11-3-1-概念" class="headerlink" title="11-3-1 概念"></a>11-3-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904192017036.png"
                      alt="image-20240904192017036"
                ></p>
<h3 id="11-3-1-实例"><a href="#11-3-1-实例" class="headerlink" title="11-3-1 实例"></a>11-3-1 实例</h3><ul>
<li>MyDialog.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;dialog&quot;&gt;</span><br><span class="line">    	&lt;div class=&quot;dialog-header&quot;&gt;</span><br><span class="line">            &lt;!--一旦插槽起了名字，就是具名插槽，只支持定向分发---&gt;</span><br><span class="line">    		&lt;slot name=&quot;head&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div class=&quot;dialog-content&quot;&gt;</span><br><span class="line">        	&lt;slot name=&quot;content&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        	&lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>App.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;MyDialog&gt;</span><br><span class="line">        	&lt;!--需要通过template标签包裹需要分发的结构，包成一个整体 --&gt;</span><br><span class="line">            &lt;template v-slot:head&gt;</span><br><span class="line">            	&lt;div&gt;我是大标题&lt;/div&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">            &lt;template #content&gt;</span><br><span class="line">				div&gt;我是内容&lt;/div&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">            &lt;template #footer&gt;</span><br><span class="line">            	&lt;button&gt;确认&lt;/button&gt;</span><br><span class="line">            	&lt;button&gt;取消&lt;/button&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">    	&lt;/MyDialog&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	import MyDialog from &#x27;./MyDialog.vue&#x27;</span><br><span class="line">	export default&#123;</span><br><span class="line">		components:&#123;</span><br><span class="line">			MyDialog</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="11-4-作用域插槽（传值）"><a href="#11-4-作用域插槽（传值）" class="headerlink" title="11-4 作用域插槽（传值）"></a>11-4 作用域插槽（传值）</h2><h3 id="11-4-1-概念"><a href="#11-4-1-概念" class="headerlink" title="11-4-1 概念"></a>11-4-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904193934068.png"
                      alt="image-20240904193934068"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904193957123.png"
                      alt="image-20240904193957123"
                ></p>
<h3 id="11-4-2-实例"><a href="#11-4-2-实例" class="headerlink" title="11-4-2 实例"></a>11-4-2 实例</h3><p> <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904200939197.png"
                      alt="image-20240904200939197"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240906195857770.png"
                      alt="image-20240906195857770"
                ></p>
<h1 id="12-路由"><a href="#12-路由" class="headerlink" title="12- 路由"></a>12- 路由</h1><h2 id="12-1-单页应用程序"><a href="#12-1-单页应用程序" class="headerlink" title="12-1 单页应用程序"></a>12-1 单页应用程序</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904201333199.png"
                      alt="image-20240904201333199"
                ></p>
<h2 id="12-2-VueRouter"><a href="#12-2-VueRouter" class="headerlink" title="12-2 VueRouter"></a>12-2 VueRouter</h2><h3 id="12-2-1-介绍"><a href="#12-2-1-介绍" class="headerlink" title="12-2-1 介绍"></a>12-2-1 介绍</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904201603904.png"
                      alt="image-20240904201603904"
                ></p>
<h3 id="12-2-2-使用"><a href="#12-2-2-使用" class="headerlink" title="12-2-2 使用"></a>12-2-2 使用</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904201648154.png"
                      alt="image-20240904201648154"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904202053002.png"
                      alt="image-20240904202053002"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904202211207.png"
                      alt="image-20240904202211207"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904202343276.png"
                      alt="image-20240904202343276"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904202451220.png"
                      alt="image-20240904202451220"
                ></p>
<h2 id="12-3-组件分类"><a href="#12-3-组件分类" class="headerlink" title="12-3 组件分类"></a>12-3 组件分类</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904202717934.png"
                      alt="image-20240904202717934"
                ></p>
<h2 id="12-4-路由模块封装"><a href="#12-4-路由模块封装" class="headerlink" title="12-4 路由模块封装"></a>12-4 路由模块封装</h2><h3 id="12-4-1-概念"><a href="#12-4-1-概念" class="headerlink" title="12-4-1 概念"></a>12-4-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904205919323.png"
                      alt="image-20240904205919323"
                ></p>
<h3 id="12-4-2-实例"><a href="#12-4-2-实例" class="headerlink" title="12-4-2 实例"></a>12-4-2 实例</h3><p>在 src 下创建 router，再在 router 下创建 index.js</p>
<ul>
<li>router &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//基于 @ 指代 src 目录，从 src 目录出发找组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Find</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/Find&#x27;</span> </span><br><span class="line"><span class="keyword">import</span> <span class="title class_">My</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/My&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Friend</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/Friend&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>) <span class="comment">//VueRouter插件初始化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建了一个路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">	<span class="comment">// routes 路由规则们</span></span><br><span class="line">    <span class="comment">// route一条路由规则 &#123; path:路径，component:组件 &#125;</span></span><br><span class="line">	<span class="attr">routes</span>:[</span><br><span class="line">		&#123; <span class="attr">path</span>:<span class="string">&#x27;/find&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Find</span> &#125;,</span><br><span class="line">		&#123; <span class="attr">path</span>:<span class="string">&#x27;/my&#x27;</span>, <span class="attr">component</span>: <span class="title class_">My</span> &#125;,</span><br><span class="line">		&#123; <span class="attr">path</span>:<span class="string">&#x27;/friend&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Friend</span> &#125;</span><br><span class="line">	]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure></div>

<ul>
<li>main.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">	<span class="attr">render</span>:<span class="function"><span class="params">h</span> =&gt;</span><span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">	router</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<h2 id="12-5-声明式导航-导航链接（router-link）"><a href="#12-5-声明式导航-导航链接（router-link）" class="headerlink" title="12-5 声明式导航-导航链接（router-link）"></a>12-5 声明式导航-导航链接（router-link）</h2><h3 id="12-5-1-概念"><a href="#12-5-1-概念" class="headerlink" title="12-5-1 概念"></a>12-5-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904211629666.png"
                      alt="image-20240904211629666"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904212211554.png"
                      alt="image-20240904212211554"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240904213155112.png"
                      alt="image-20240904213155112"
                ></p>
<h3 id="12-5-2-实例"><a href="#12-5-2-实例" class="headerlink" title="12-5-2 实例"></a>12-5-2 实例</h3><p>1、原类型</p>
<ul>
<li>App.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;div class=&quot;footer wrap&#x27;&gt;</span><br><span class="line">            &lt;router-link to=&quot;/find&quot;&gt;发现音乐&lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/my&quot;&gt;我的音乐&lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/friend&quot;&gt;朋友&lt;/router-link&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">  		&lt;RouterView&gt;&lt;/RouterView&gt;</span><br><span class="line">  	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .footer wrap a&#123;</span><br><span class="line">        flex: 1;</span><br><span class="line">		text-decoration: none;</span><br><span class="line">        padding: 20px 0;</span><br><span class="line">        line-height: 20px;</span><br><span class="line">        background-color: #333;</span><br><span class="line">        color: #ccc;</span><br><span class="line">        border: 1px solid black;</span><br><span class="line">    &#125;</span><br><span class="line">	.footer wrap a.router-link-active &#123;</span><br><span class="line">		background-color:purple;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<p>2、自定义类型</p>
<ul>
<li>router &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//基于 @ 指代 src 目录，从 src 目录出发找组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Find</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/Find&#x27;</span> </span><br><span class="line"><span class="keyword">import</span> <span class="title class_">My</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/My&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Friend</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/Friend&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>) <span class="comment">//VueRouter插件初始化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建了一个路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">	<span class="comment">// routes 路由规则们</span></span><br><span class="line">    <span class="comment">// route一条路由规则 &#123; path:路径，component:组件 &#125;</span></span><br><span class="line">	<span class="attr">routes</span>:[</span><br><span class="line">		&#123; <span class="attr">path</span>:<span class="string">&#x27;/find&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Find</span> &#125;,</span><br><span class="line">		&#123; <span class="attr">path</span>:<span class="string">&#x27;/my&#x27;</span>, <span class="attr">component</span>: <span class="title class_">My</span> &#125;,</span><br><span class="line">		&#123; <span class="attr">path</span>:<span class="string">&#x27;/friend&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Friend</span> &#125;</span><br><span class="line">	],</span><br><span class="line">    <span class="comment">// link自定义高亮类名</span></span><br><span class="line">	<span class="attr">linkActiveClass</span>: <span class="string">&#x27;active&#x27;</span>, <span class="comment">//配置模糊匹配的类名</span></span><br><span class="line">    <span class="attr">linkExactActiveclass</span>: <span class="string">&#x27;exact-active&#x27;</span> <span class="comment">//配置精确匹配的类名</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure></div>

<ul>
<li>App.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;div class=&quot;footer wrap&#x27;&gt;</span><br><span class="line">            &lt;router-link to=&quot;/find&quot;&gt;发现音乐&lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/my&quot;&gt;我的音乐&lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/friend&quot;&gt;朋友&lt;/router-link&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">  		&lt;RouterView&gt;&lt;/RouterView&gt;</span><br><span class="line">  	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .footer wrap a&#123;</span><br><span class="line">        flex: 1;</span><br><span class="line">		text-decoration: none;</span><br><span class="line">        padding: 20px 0;</span><br><span class="line">        line-height: 20px;</span><br><span class="line">        background-color: #333;</span><br><span class="line">        color: #ccc;</span><br><span class="line">        border: 1px solid black;</span><br><span class="line">    &#125;</span><br><span class="line">	.footer wrap a.active &#123;</span><br><span class="line">		background-color:purple;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="12-6-声明式导航-跳转传参"><a href="#12-6-声明式导航-跳转传参" class="headerlink" title="12-6 声明式导航-跳转传参"></a>12-6 声明式导航-跳转传参</h2><h3 id="12-6-1-概念"><a href="#12-6-1-概念" class="headerlink" title="12-6-1 概念"></a>12-6-1 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905153005411.png"
                      alt="image-20240905153005411"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905154301336.png"
                      alt="image-20240905154301336"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905155513316.png"
                      alt="image-20240905155513316"
                ></p>
<h3 id="12-6-2-实例"><a href="#12-6-2-实例" class="headerlink" title="12-6-2 实例"></a>12-6-2 实例</h3><ul>
<li>查询参数传参</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905153706888.png"
                      alt="image-20240905153706888"
                ></p>
<ul>
<li><p>动态路由传参</p>
</li>
<li><p>router &#x2F; index.js</p>
</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/Home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Search</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/Search&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>) <span class="comment">//VueRouter插件初始化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建了一个路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>:[</span><br><span class="line">    	&#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Home</span> &#125;,</span><br><span class="line">    	&#123; <span class="attr">path</span>: <span class="string">&#x27;/search/:words?&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Search</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Home.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;hot-link&quot;&gt;</span><br><span class="line">		热门搜索:</span><br><span class="line">		&lt;router-link to=&quot;/search/黑马程序员&quot;&gt;黑马程序员&lt;/router-link&gt;</span><br><span class="line">		&lt;router-link to=&quot;/search/前端培训&quot;&gt;前端培训&lt;/router-link&gt;</span><br><span class="line">		&lt;router-link to=&quot;/search/如何成为前端大牛&quot;&gt;如何成为前端大牛&lt;/router-link&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Search.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;search&quot;&gt;</span><br><span class="line">		&lt;p&gt;搜索关键字:&#123;&#123; $route.params.words &#125;&#125;&lt;/p&gt;</span><br><span class="line">		&lt;p&gt;搜索结果:&lt;/p&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;1i&gt;..&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;...&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;....&lt;/1i&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        created()&#123;</span><br><span class="line">            //在created中，获取路由参数</span><br><span class="line">            console.log(this.$route.params.words);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="12-7-Vue路由"><a href="#12-7-Vue路由" class="headerlink" title="12-7 Vue路由"></a>12-7 Vue路由</h2><h3 id="12-7-1-重定向"><a href="#12-7-1-重定向" class="headerlink" title="12-7-1 重定向"></a>12-7-1 重定向</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905162939883.png"
                      alt="image-20240905162939883"
                ></p>
<h3 id="12-7-2-404"><a href="#12-7-2-404" class="headerlink" title="12-7-2  404"></a>12-7-2  404</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905163217629.png"
                      alt="image-20240905163217629"
                ></p>
<h3 id="12-7-3-模式设置"><a href="#12-7-3-模式设置" class="headerlink" title="12-7-3 模式设置"></a>12-7-3 模式设置</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905163548585.png"
                      alt="image-20240905163548585"
                ></p>
<h2 id="12-8-编程式导航"><a href="#12-8-编程式导航" class="headerlink" title="12-8 编程式导航"></a>12-8 编程式导航</h2><h3 id="12-8-1-基本跳转"><a href="#12-8-1-基本跳转" class="headerlink" title="12-8-1 基本跳转"></a>12-8-1 基本跳转</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905165007136.png"
                      alt="image-20240905165007136"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905165048027.png"
                      alt="image-20240905165048027"
                ></p>
<h3 id="12-8-3-路由传参"><a href="#12-8-3-路由传参" class="headerlink" title="12-8-3 路由传参"></a>12-8-3 路由传参</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905171254127.png"
                      alt="image-20240905171254127"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905171455688.png"
                      alt="image-20240905171455688"
                ></p>
<ul>
<li>Home.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;search-box&quot;&gt;</span><br><span class="line">            &lt;input v-model=&quot;inpValue&quot; type=&quot;text&quot;&gt;</span><br><span class="line">            &lt;button @click=&quot;gosearch&quot;&gt;搜索一下&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	export default &#123;</span><br><span class="line">		data()&#123;</span><br><span class="line">			return&#123;</span><br><span class="line">				inpValue: &#x27;&#x27;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		methods:&#123;</span><br><span class="line">			goSearch()&#123;</span><br><span class="line">                // 1.简单写法</span><br><span class="line">				this.$router.push(&#x27;/search? key= $&#123;this.inpValue&#125; &#x27;)</span><br><span class="line">                // 2.完整写法，更适合传参</span><br><span class="line">                this.$router.push(&#123;</span><br><span class="line">                    path:&#x27;/search&#x27;,</span><br><span class="line">                    query:&#123;</span><br><span class="line">                        key: this.inpValue</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                // 3.</span><br><span class="line">                this.$router.push(&#x27;/search/ $&#123;this.inpValue&#125; &#x27;&#125;</span><br><span class="line">                // 4.</span><br><span class="line">                this.$router.push(&#123;</span><br><span class="line">                	path:&#x27;/search/ $&#123;this.inpValue&#125; &#x27;</span><br><span class="line">               	&#125;)                  </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Search.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;search&quot;&gt;</span><br><span class="line">        // query传参</span><br><span class="line">		&lt;p&gt;搜索关键字:&#123;&#123; $route.query.key &#125;&#125;&lt;/p&gt;</span><br><span class="line">        </span><br><span class="line">        // 动态路由传参</span><br><span class="line">        &lt;p&gt;搜索关键字:&#123;&#123; $route.params.words &#125;&#125;&lt;/p&gt;</span><br><span class="line">        </span><br><span class="line">		&lt;p&gt;搜索结果:&lt;/p&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;1i&gt;..&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;...&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;....&lt;/1i&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        created()&#123;</span><br><span class="line">            // query传参</span><br><span class="line">            console.log(this.$route.query.key);</span><br><span class="line">            // 动态路由传参</span><br><span class="line">            console.log(this.$route.params.words);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>router &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/Home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Search</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/Search&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>) <span class="comment">//VueRouter插件初始化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建了一个路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>:[</span><br><span class="line">    	&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">redirect</span>:<span class="string">&#x27;/home&#x27;</span> &#125;,</span><br><span class="line">    	&#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Home</span> &#125;,</span><br><span class="line">    	&#123; <span class="attr">path</span>: <span class="string">&#x27;/search/:words?&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Search</span> &#125;,</span><br><span class="line">    	&#123; <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>, <span class="attr">component</span>: <span class="title class_">NotFind</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905173842882.png"
                      alt="image-20240905173842882"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905173937592.png"
                      alt="image-20240905173937592"
                ></p>
<ul>
<li>Home.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;search-box&quot;&gt;</span><br><span class="line">            &lt;input v-model=&quot;inpValue&quot; type=&quot;text&quot;&gt;</span><br><span class="line">            &lt;button @click=&quot;gosearch&quot;&gt;搜索一下&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	export default &#123;</span><br><span class="line">		data()&#123;</span><br><span class="line">			return&#123;</span><br><span class="line">				inpValue: &#x27;&#x27;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		methods:&#123;</span><br><span class="line">			goSearch()&#123;</span><br><span class="line">				// 1.</span><br><span class="line">                this.$router.push(&#123;</span><br><span class="line">                	name:&#x27;search&#x27;,</span><br><span class="line">                	query:&#123;</span><br><span class="line">                		key: this.inpValue</span><br><span class="line">                	&#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            	// 2.</span><br><span class="line">                this.$router.push(&#123;</span><br><span class="line">                	name:&#x27;search&#x27;,</span><br><span class="line">                	params:&#123;</span><br><span class="line">                		words: this.inpValue</span><br><span class="line">                	&#125;</span><br><span class="line">                &#125;)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Search.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;search&quot;&gt;</span><br><span class="line">        // query传参</span><br><span class="line">		&lt;p&gt;搜索关键字:&#123;&#123; $route.query.key &#125;&#125;&lt;/p&gt;</span><br><span class="line">        </span><br><span class="line">        // 动态路由传参</span><br><span class="line">        &lt;p&gt;搜索关键字:&#123;&#123; $route.params.words &#125;&#125;&lt;/p&gt;</span><br><span class="line">        </span><br><span class="line">		&lt;p&gt;搜索结果:&lt;/p&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;1i&gt;..&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;...&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;....&lt;/1i&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        created()&#123;</span><br><span class="line">            // query传参</span><br><span class="line">            console.log(this.$route.query.key);</span><br><span class="line">            // 动态路由传参</span><br><span class="line">            console.log(this.$route.params.words);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>router &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/Home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Search</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/Search&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>) <span class="comment">//VueRouter插件初始化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建了一个路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>:[</span><br><span class="line">    	&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">redirect</span>:<span class="string">&#x27;/home&#x27;</span> &#125;,</span><br><span class="line">    	&#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Home</span> &#125;,</span><br><span class="line">    	&#123; <span class="attr">path</span>: <span class="string">&#x27;/search/:words?&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Search</span> &#125;,</span><br><span class="line">    	&#123; <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>, <span class="attr">component</span>: <span class="title class_">NotFind</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure></div>

<h2 id="12-9-二级路由"><a href="#12-9-二级路由" class="headerlink" title="12-9 二级路由"></a>12-9 二级路由</h2><ul>
<li>配置路由</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905195550753.png"
                      alt="image-20240905195550753"
                ></p>
<ul>
<li>配置路由出口</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905195635695.png"
                      alt="image-20240905195635695"
                ></p>
<h2 id="12-10-缓存组件"><a href="#12-10-缓存组件" class="headerlink" title="12-10 缓存组件"></a>12-10 缓存组件</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905201151443.png"
                      alt="image-20240905201151443"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905201243563.png"
                      alt="image-20240905201243563"
                ></p>
<ul>
<li>Layout.vue</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">		<span class="comment">//组件名，如果没有配置 name，才会找文件名作为组件名</span></span><br><span class="line">		<span class="attr">name</span>: <span class="string">&quot;LayoutPage&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>App.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;h5-wrapper&quot;&gt;</span><br><span class="line">        &lt;!-- LayoutPage组件(被缓存)-多两个生命周期钩子</span><br><span class="line">			actived 激活时，组件被看到时触发</span><br><span class="line">			deactived 失活时，离开页面组件看不见时触发 --&gt;</span><br><span class="line">        &lt;keep-alive :include=&quot;keepArr&quot;&gt;</span><br><span class="line">        	&lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">        &lt;/keep-alive&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123; </span><br><span class="line">        name:&#x27;h5-wrapper&#x27;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                //缓存组件名的数组</span><br><span class="line">                keepArr: [&#x27;LayoutPage&#x27;]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="12-11-基于VueCli自定义创建项目"><a href="#12-11-基于VueCli自定义创建项目" class="headerlink" title="12-11 基于VueCli自定义创建项目"></a>12-11 基于VueCli自定义创建项目</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905202912690.png"
                      alt="image-20240905202912690"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905203224491.png"
                      alt="image-20240905203224491"
                ></p>
<h1 id="13-ESlint-代码规范"><a href="#13-ESlint-代码规范" class="headerlink" title="13- ESlint 代码规范"></a>13- ESlint 代码规范</h1><h2 id="13-1-认识代码规范"><a href="#13-1-认识代码规范" class="headerlink" title="13-1 认识代码规范"></a>13-1 认识代码规范</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905210704849.png"
                      alt="image-20240905210704849"
                ></p>
<h2 id="13-2-解决代码规范错误"><a href="#13-2-解决代码规范错误" class="headerlink" title="13-2 解决代码规范错误"></a>13-2 解决代码规范错误</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905210850769.png"
                      alt="image-20240905210850769"
                ></p>
<h3 id="13-2-1-手动修正"><a href="#13-2-1-手动修正" class="headerlink" title="13-2-1 手动修正"></a>13-2-1 手动修正</h3><p>根据错误提示来一项一项手动修改纠正。</p>
<p>如果你不认识命令行中的语法报错是什么意思，根据错误代码去 [ESLint 规则表] 中查找其具体含义。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905211529841.png"
                      alt="image-20240905211529841"
                ></p>
<h3 id="13-2-2-自动修正"><a href="#13-2-2-自动修正" class="headerlink" title="13-2-2 自动修正"></a>13-2-2 自动修正</h3><p>基于 vscode 插件 ESLint 高亮错误，并通过配置 自动 帮助我们修复错误。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905211908936.png"
                      alt="image-20240905211908936"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905212029856.png"
                      alt="image-20240905212029856"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240905212107702.png"
                      alt="image-20240905212107702"
                ></p>
<h1 id="14-vuex"><a href="#14-vuex" class="headerlink" title="14- vuex"></a>14- vuex</h1><h2 id="14-1-概述"><a href="#14-1-概述" class="headerlink" title="14-1 概述"></a>14-1 概述</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240906202246101.png"
                      alt="image-20240906202246101"
                ></p>
<h2 id="14-2-创建一个空仓库"><a href="#14-2-创建一个空仓库" class="headerlink" title="14-2 创建一个空仓库"></a>14-2 创建一个空仓库</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240906203151987.png"
                      alt="image-20240906203151987"
                ></p>
<ul>
<li>store &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这里面存放的就是 vuex 相关的核心代码</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//插件安装</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建仓库(空仓库)</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出给main.js使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure></div>

<ul>
<li>main.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router/index&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">	<span class="attr">render</span>:<span class="function"><span class="params">h</span> =&gt;</span><span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">	router,</span><br><span class="line">	store</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<h2 id="14-3-核心概念-state状态、辅助函数mapState"><a href="#14-3-核心概念-state状态、辅助函数mapState" class="headerlink" title="14-3 核心概念-state状态、辅助函数mapState"></a>14-3 核心概念-state状态、辅助函数mapState</h2><h3 id="14-3-1-提供vuex的数据"><a href="#14-3-1-提供vuex的数据" class="headerlink" title="14-3-1 提供vuex的数据"></a>14-3-1 提供vuex的数据</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240906203914172.png"
                      alt="image-20240906203914172"
                ></p>
<h3 id="14-3-2-使用vuex的数据"><a href="#14-3-2-使用vuex的数据" class="headerlink" title="14-3-2 使用vuex的数据"></a>14-3-2 使用vuex的数据</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240906204105968.png"
                      alt="image-20240906204105968"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240906205015982.png"
                      alt="image-20240906205015982"
                ></p>
<ul>
<li>App.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">        &lt;h1&gt;</span><br><span class="line">        	根组件 - &#123;&#123; $store.state.title &#125;&#125; - &#123;&#123; $store.state.count &#125;&#125;</span><br><span class="line">            根组件 - &#123;&#123; title &#125;&#125; - &#123;&#123; count &#125;&#125;</span><br><span class="line">        &lt;/h1&gt;</span><br><span class="line">    	&lt;input type=&quot;text&quot;&gt;&lt;/input&gt;</span><br><span class="line">    	&lt;Son1&gt;&lt;/Son1&gt;</span><br><span class="line">    	&lt;hr&gt;</span><br><span class="line">    	&lt;Son2&gt;&lt;/Son2&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import Son1 from &#x27;./components/Son1.vue&#x27;</span><br><span class="line">    import Son2 from &#x27;./components/Son2.vue&#x27;</span><br><span class="line">    import &#123; mapState &#125; from &#x27;vuex&#x27;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &#x27;app&#x27;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">			...mapstate([&#x27;count&#x27;,&#x27;title&#x27;])</span><br><span class="line">        &#125;,</span><br><span class="line">        components: &#123;</span><br><span class="line">            Son1,</span><br><span class="line">            Son2</span><br><span class="line">        &#125;,</span><br><span class="line">        created()&#123;</span><br><span class="line">            console.log(this.$store.state.count) </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="14-4-核心概念-mutations"><a href="#14-4-核心概念-mutations" class="headerlink" title="14-4 核心概念-mutations"></a>14-4 核心概念-mutations</h2><h3 id="14-4-1-基础语法"><a href="#14-4-1-基础语法" class="headerlink" title="14-4-1 基础语法"></a>14-4-1 基础语法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240906210931392.png"
                      alt="image-20240906210931392"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240906211212206.png"
                      alt="image-20240906211212206"
                ></p>
<ul>
<li>store &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这里面存放的就是 vuex 相关的核心代码</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//插件安装</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建仓库(空仓库)</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">	<span class="comment">//严格模式(有利于初学者，检测不规范的代码)</span></span><br><span class="line">	<span class="attr">strict</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="comment">//1.通过 state 可以提供数据(所有组件共享的数据)</span></span><br><span class="line">	<span class="attr">state</span>:&#123;</span><br><span class="line">		<span class="attr">title</span>: <span class="string">&#x27;仓库大标题&#x27;</span>,</span><br><span class="line">        <span class="attr">count</span>: <span class="number">100</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//2.通过 mutations 可以提供修改数据的方法</span></span><br><span class="line">	<span class="attr">mutations</span>:&#123;</span><br><span class="line">		<span class="comment">//所有mutation函数，第一个参数，都是state</span></span><br><span class="line">		<span class="title function_">addcount</span>(<span class="params">state</span>)&#123;</span><br><span class="line">			<span class="comment">//修改数据</span></span><br><span class="line">			state.<span class="property">count</span> += <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="title function_">changeTitle</span>(<span class="params">state</span>)&#123;</span><br><span class="line">			state.<span class="property">title</span> = <span class="string">&#x27;仓库小标题&#x27;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出给main.js使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Son1.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot;&gt;  </span><br><span class="line">    	&lt;h2&gt;Son1 子组件&lt;/h2&gt;</span><br><span class="line">    	从vuex中获取的值:</span><br><span class="line">        &lt;label&gt;&#123;&#123; $store.state.count &#125;&#125;&lt;/label&gt;</span><br><span class="line">    	&lt;br&gt;</span><br><span class="line">    	&lt;button @click=&quot;handleAdd&quot;&gt;值 + 1&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;change&quot;&gt;改标题&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">    	name:&#x27;Son1Com&#x27;,</span><br><span class="line">    	methods:&#123;</span><br><span class="line">    		handleAdd()&#123;</span><br><span class="line">    			//错误代码(vue默认不会监测,监测需要成本)</span><br><span class="line">    			//this.$store.state.count++</span><br><span class="line">    			</span><br><span class="line">    			//应该通过 mutation 核心概念，进行修改数据</span><br><span class="line">    			//需要提交调用mutation</span><br><span class="line">    			this.$store.commit(&#x27;addcount&#x27;)</span><br><span class="line">    		&#125;,</span><br><span class="line">            change()&#123;</span><br><span class="line">                this.$store.commit(&#x27;changeTitle&#x27;)</span><br><span class="line">            &#125;    </span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="14-4-2-传参语法"><a href="#14-4-2-传参语法" class="headerlink" title="14-4-2 传参语法"></a>14-4-2 传参语法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240907171341434.png"
                      alt="image-20240907171341434"
                ></p>
<ul>
<li>store &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这里面存放的就是 vuex 相关的核心代码</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//插件安装</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建仓库(空仓库)</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">	<span class="comment">//严格模式(有利于初学者，检测不规范的代码)</span></span><br><span class="line">	<span class="attr">strict</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="comment">//1.通过 state 可以提供数据(所有组件共享的数据)</span></span><br><span class="line">	<span class="attr">state</span>:&#123;</span><br><span class="line">		<span class="attr">title</span>: <span class="string">&#x27;仓库大标题&#x27;</span>,</span><br><span class="line">        <span class="attr">count</span>: <span class="number">100</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//2.通过 mutations 可以提供修改数据的方法</span></span><br><span class="line">	<span class="attr">mutations</span>:&#123;</span><br><span class="line">		<span class="comment">//所有mutation函数，第一个参数，都是state</span></span><br><span class="line">         <span class="comment">//n：所带参数</span></span><br><span class="line">		<span class="title function_">addcount</span>(<span class="params">state, n</span>)&#123;</span><br><span class="line">			<span class="comment">//修改数据</span></span><br><span class="line">			state.<span class="property">count</span> += n</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="title function_">changeTitle</span>(<span class="params">state, newTitle</span>)&#123;</span><br><span class="line">			state.<span class="property">title</span> = newTitle</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出给main.js使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Son1.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot;&gt;  </span><br><span class="line">    	&lt;h2&gt;Son1 子组件&lt;/h2&gt;</span><br><span class="line">    	从vuex中获取的值:</span><br><span class="line">        &lt;label&gt;&#123;&#123; $store.state.count &#125;&#125;&lt;/label&gt;</span><br><span class="line">    	&lt;br&gt;</span><br><span class="line">    	&lt;button @click=&quot;handleAdd(1)&quot;&gt;值 + 1&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(5)&quot;&gt;值 + 5&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(10)&quot;&gt;值 + 10&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;change&quot;&gt;改标题&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">    	name:&#x27;Son1Com&#x27;,</span><br><span class="line">    	methods:&#123;</span><br><span class="line">    		handleAdd(n)&#123;</span><br><span class="line">    			//应该通过 mutation 核心概念，进行修改数据</span><br><span class="line">    			//需要提交调用mutation</span><br><span class="line">    			this.$store.commit(&#x27;addcount&#x27;, n)</span><br><span class="line">    		&#125;,</span><br><span class="line">            change()&#123;</span><br><span class="line">                this.$store.commit(&#x27;changeTitle&#x27;, &#x27;黑马程序员&#x27;)</span><br><span class="line">            &#125;    </span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="14-4-3-传多个参"><a href="#14-4-3-传多个参" class="headerlink" title="14-4-3 传多个参"></a>14-4-3 传多个参</h3><p>mutation参数有且只能有一个，如果需要多个参数，包装成一个对象。</p>
<ul>
<li>store &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这里面存放的就是 vuex 相关的核心代码</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//插件安装</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建仓库(空仓库)</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">	<span class="comment">//严格模式(有利于初学者，检测不规范的代码)</span></span><br><span class="line">	<span class="attr">strict</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="comment">//1.通过 state 可以提供数据(所有组件共享的数据)</span></span><br><span class="line">	<span class="attr">state</span>:&#123;</span><br><span class="line">		<span class="attr">title</span>: <span class="string">&#x27;仓库大标题&#x27;</span>,</span><br><span class="line">        <span class="attr">count</span>: <span class="number">100</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//2.通过 mutations 可以提供修改数据的方法</span></span><br><span class="line">	<span class="attr">mutations</span>:&#123;</span><br><span class="line">		<span class="comment">//所有mutation函数，第一个参数，都是state</span></span><br><span class="line">		<span class="title function_">change</span>(<span class="params">state, obj</span>)&#123;</span><br><span class="line">			<span class="comment">//修改数据</span></span><br><span class="line">            <span class="comment">//obj是包装的对象</span></span><br><span class="line">			state.<span class="property">count</span> += obj.<span class="property">count</span>,</span><br><span class="line">            state.<span class="property">title</span> = obj.<span class="property">title</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出给main.js使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Son1.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot;&gt;  </span><br><span class="line">    	&lt;h2&gt;Son1 子组件&lt;/h2&gt;</span><br><span class="line">    	从vuex中获取的值:</span><br><span class="line">        &lt;label&gt;&#123;&#123; $store.state.count &#125;&#125;&lt;/label&gt;</span><br><span class="line">    	&lt;br&gt;</span><br><span class="line">        &lt;button @click=&quot;change&quot;&gt;修改&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">    	name:&#x27;Son1Com&#x27;,</span><br><span class="line">    	methods:&#123;</span><br><span class="line">            change()&#123;</span><br><span class="line">                this.$store.commit(&#x27;change&#x27;, &#123;</span><br><span class="line">                    count: 10,</span><br><span class="line">                    title: &#x27;传智博客&#x27;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;    </span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="14-4-4-实时跟新"><a href="#14-4-4-实时跟新" class="headerlink" title="14-4-4 实时跟新"></a>14-4-4 实时跟新</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240907195624813.png"
                      alt="image-20240907195624813"
                ></p>
<ul>
<li>store &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这里面存放的就是 vuex 相关的核心代码</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//插件安装</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建仓库(空仓库)</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">	<span class="comment">//严格模式(有利于初学者，检测不规范的代码)</span></span><br><span class="line">	<span class="attr">strict</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="comment">//1.通过 state 可以提供数据(所有组件共享的数据)</span></span><br><span class="line">	<span class="attr">state</span>:&#123;</span><br><span class="line">		<span class="attr">title</span>: <span class="string">&#x27;仓库大标题&#x27;</span>,</span><br><span class="line">        <span class="attr">count</span>: <span class="number">100</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//2.通过 mutations 可以提供修改数据的方法</span></span><br><span class="line">	<span class="attr">mutations</span>:&#123;</span><br><span class="line">		<span class="comment">//所有mutation函数，第一个参数，都是state</span></span><br><span class="line">		<span class="title function_">changeCount</span>(<span class="params">state, newCount</span>)&#123;</span><br><span class="line">			<span class="comment">//修改数据</span></span><br><span class="line">			state.<span class="property">count</span> = newCount</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出给main.js使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure></div>

<ul>
<li>App.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">        &lt;h1&gt;</span><br><span class="line">        	根组件 - &#123;&#123; $store.state.title &#125;&#125; - &#123;&#123; $store.state.count &#125;&#125;</span><br><span class="line">            根组件 - &#123;&#123; title &#125;&#125; - &#123;&#123; count &#125;&#125;</span><br><span class="line">        &lt;/h1&gt;</span><br><span class="line">    	&lt;input :value=&quot;count&quot; @input=&quot;handleInput&quot; type=&quot;text&quot;&gt;&lt;/input&gt;</span><br><span class="line">    	&lt;Son1&gt;&lt;/Son1&gt;</span><br><span class="line">    	&lt;hr&gt;</span><br><span class="line">    	&lt;Son2&gt;&lt;/Son2&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import Son1 from &#x27;./components/Son1.vue&#x27;</span><br><span class="line">    import Son2 from &#x27;./components/Son2.vue&#x27;</span><br><span class="line">    import &#123; mapState &#125; from &#x27;vuex&#x27;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &#x27;app&#x27;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">			...mapstate([&#x27;count&#x27;,&#x27;title&#x27;])</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            handleInput()&#123;</span><br><span class="line">                //1.实时获取输入框的值</span><br><span class="line">                const num = +e.target.value</span><br><span class="line">				//2.提交mutation，调用mutation函数</span><br><span class="line">                this.$store.commit(&#x27;changeCount&#x27;, num)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        components: &#123;</span><br><span class="line">            Son1,</span><br><span class="line">            Son2</span><br><span class="line">        &#125;,</span><br><span class="line">        created()&#123;</span><br><span class="line">            console.log(this.$store.state.count) </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="14-5-辅助函数-mapMutations"><a href="#14-5-辅助函数-mapMutations" class="headerlink" title="14-5 辅助函数-mapMutations"></a>14-5 辅助函数-mapMutations</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240907203102952.png"
                      alt="image-20240907203102952"
                ></p>
<ul>
<li>Son2.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot;&gt;  </span><br><span class="line">    	&lt;h2&gt;Son2 子组件&lt;/h2&gt;</span><br><span class="line">    	从vuex中获取的值:</span><br><span class="line">        &lt;label&gt;&#123;&#123; $store.state.count &#125;&#125;&lt;/label&gt;</span><br><span class="line">    	&lt;br&gt;</span><br><span class="line">        &lt;!-- 1、第一种  --&gt;</span><br><span class="line">        &lt;button @click=&quot;change(1)&quot;&gt;值 + 1&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;change(5)&quot;&gt;值 + 5&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;change(10)&quot;&gt;值 + 10&lt;/button&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- 2、第二种  --&gt;</span><br><span class="line">        &lt;button @click=&quot;addcount(1)&quot;&gt;值 + 1&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;addcount(5)&quot;&gt;值 + 5&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;addcount(10)&quot;&gt;值 + 10&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123; mapMutations &#125; from &#x27;vuex&#x27;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">    	name:&#x27;Son2Com&#x27;,</span><br><span class="line">    	methods:&#123;</span><br><span class="line">            ...mapMutations([&#x27;addcount&#x27;]),</span><br><span class="line">            //1、第一种    </span><br><span class="line">            change(n)&#123;</span><br><span class="line">                this.addcount(n)</span><br><span class="line">            &#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="14-6-核心概念-actions"><a href="#14-6-核心概念-actions" class="headerlink" title="14-6 核心概念-actions"></a>14-6 核心概念-actions</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240907205617513.png"
                      alt="image-20240907205617513"
                ></p>
<ul>
<li>store &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这里面存放的就是 vuex 相关的核心代码</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//插件安装</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建仓库(空仓库)</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">	<span class="comment">//严格模式(有利于初学者，检测不规范的代码)</span></span><br><span class="line">	<span class="attr">strict</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="comment">//1.通过 state 可以提供数据(所有组件共享的数据)</span></span><br><span class="line">	<span class="attr">state</span>:&#123;</span><br><span class="line">		<span class="attr">title</span>: <span class="string">&#x27;仓库大标题&#x27;</span>,</span><br><span class="line">        <span class="attr">count</span>: <span class="number">100</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//2.通过 mutations 可以提供修改数据的方法</span></span><br><span class="line">	<span class="attr">mutations</span>:&#123;</span><br><span class="line">		<span class="comment">//所有mutation函数，第一个参数，都是state</span></span><br><span class="line">		<span class="title function_">changeCount</span>(<span class="params">state, newCount</span>)&#123;</span><br><span class="line">			<span class="comment">//修改数据</span></span><br><span class="line">			state.<span class="property">count</span> = newCount</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//3.actions 处理异步</span></span><br><span class="line">	<span class="comment">//注意:不能直接操作 state，操作 state，还是需要 commit mutation</span></span><br><span class="line">	<span class="attr">actions</span>:&#123;</span><br><span class="line">		<span class="comment">// context 上下文(此处未分模块，可以当成store仓库)</span></span><br><span class="line">		<span class="comment">// context.commit(&#x27;mutation名字&#x27;，额外参数)</span></span><br><span class="line">		<span class="title function_">changeCountAction</span>(<span class="params">context, num</span>)&#123;</span><br><span class="line">			<span class="comment">// 这里是setTimeout模拟异步，以后大部分场景是发请求</span></span><br><span class="line">			<span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">				context.<span class="title function_">commit</span>(<span class="string">&#x27;changeCount&#x27;</span>, num)</span><br><span class="line">			&#125;，<span class="number">1000</span>)	</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出给main.js使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Son1.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot;&gt;  </span><br><span class="line">    	&lt;h2&gt;Son1 子组件&lt;/h2&gt;</span><br><span class="line">    	从vuex中获取的值:</span><br><span class="line">        &lt;label&gt;&#123;&#123; $store.state.count &#125;&#125;&lt;/label&gt;</span><br><span class="line">    	&lt;br&gt;</span><br><span class="line">    	&lt;button @click=&quot;handleAdd(1)&quot;&gt;值 + 1&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(5)&quot;&gt;值 + 5&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(10)&quot;&gt;值 + 10&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handlechange&quot;&gt;一秒后修改成666&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;change&quot;&gt;改标题&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">    	name:&#x27;Son1Com&#x27;,</span><br><span class="line">    	methods:&#123;</span><br><span class="line">    		handleAdd(n)&#123;</span><br><span class="line">    			//应该通过 mutation 核心概念，进行修改数据</span><br><span class="line">    			//需要提交调用mutation</span><br><span class="line">    			this.$store.commit(&#x27;addcount&#x27;, n)</span><br><span class="line">    		&#125;,</span><br><span class="line">            change()&#123;</span><br><span class="line">                this.$store.commit(&#x27;changeTitle&#x27;, &#x27;黑马程序员&#x27;)</span><br><span class="line">            &#125;,</span><br><span class="line">            handleChange()&#123;</span><br><span class="line">				// 调用action</span><br><span class="line">				// this.$store.dispatch(&#x27;action名字&#x27;，额外参数)</span><br><span class="line">				this.$store.dispatch(&#x27;changeCountAction&#x27;,666)</span><br><span class="line">			&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="14-7-辅助函数-mapActions"><a href="#14-7-辅助函数-mapActions" class="headerlink" title="14-7 辅助函数-mapActions"></a>14-7 辅助函数-mapActions</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240908161226341.png"
                      alt="image-20240908161226341"
                ></p>
<ul>
<li>Son2.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot;&gt;  </span><br><span class="line">    	&lt;h2&gt;Son2 子组件&lt;/h2&gt;</span><br><span class="line">    	从vuex中获取的值:</span><br><span class="line">        &lt;label&gt;&#123;&#123; $store.state.count &#125;&#125;&lt;/label&gt;</span><br><span class="line">    	&lt;br&gt;</span><br><span class="line">        &lt;button @click=&quot;changecountAction(888)&quot;&gt;1秒后改成888&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123; mapState, mapMutations, mapActions &#125; from &#x27;vuex&#x27;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">    	name:&#x27;Son2Com&#x27;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">			...mapState([&#x27;count&#x27;])</span><br><span class="line">        &#125;,</span><br><span class="line">    	methods:&#123;</span><br><span class="line">            ...mapMutations([&#x27;addcount&#x27;]),</span><br><span class="line">            ...mapActions([&#x27;changeCountAction&#x27;]),</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="14-8-核心概念-getters、辅助函数mapGetters"><a href="#14-8-核心概念-getters、辅助函数mapGetters" class="headerlink" title="14-8 核心概念-getters、辅助函数mapGetters"></a>14-8 核心概念-getters、辅助函数mapGetters</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240908164509833.png"
                      alt="image-20240908164509833"
                ></p>
<ul>
<li>store &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这里面存放的就是 vuex 相关的核心代码</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//插件安装</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建仓库(空仓库)</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">	<span class="comment">//严格模式(有利于初学者，检测不规范的代码)</span></span><br><span class="line">	<span class="attr">strict</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="comment">//1.通过 state 可以提供数据(所有组件共享的数据)</span></span><br><span class="line">	<span class="attr">state</span>:&#123;</span><br><span class="line">		<span class="attr">title</span>: <span class="string">&#x27;仓库大标题&#x27;</span>,</span><br><span class="line">        <span class="attr">count</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="attr">list</span>:[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//2.通过 mutations 可以提供修改数据的方法</span></span><br><span class="line">	<span class="attr">mutations</span>:&#123;</span><br><span class="line">		<span class="comment">//所有mutation函数，第一个参数，都是state</span></span><br><span class="line">		<span class="title function_">changeCount</span>(<span class="params">state, newCount</span>)&#123;</span><br><span class="line">			<span class="comment">//修改数据</span></span><br><span class="line">			state.<span class="property">count</span> = newCount</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//3.actions 处理异步</span></span><br><span class="line">	<span class="comment">//注意:不能直接操作 state，操作 state，还是需要 commit mutation</span></span><br><span class="line">	<span class="attr">actions</span>:&#123;</span><br><span class="line">		<span class="comment">// context 上下文(此处未分模块，可以当成store仓库)</span></span><br><span class="line">		<span class="comment">// context.commit(&#x27;mutation名字&#x27;，额外参数)</span></span><br><span class="line">		<span class="title function_">changeCountAction</span>(<span class="params">context, num</span>)&#123;</span><br><span class="line">			<span class="comment">// 这里是setTimeout模拟异步，以后大部分场景是发请求</span></span><br><span class="line">			<span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">				context.<span class="title function_">commit</span>(<span class="string">&#x27;changeCount&#x27;</span>, num)</span><br><span class="line">			&#125;，<span class="number">1000</span>)	</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">    <span class="comment">//4.getters 类似于计算属性</span></span><br><span class="line">    <span class="attr">getters</span>:&#123;</span><br><span class="line">        <span class="comment">// 注意点:</span></span><br><span class="line">        <span class="comment">//1.形参第一个参数，就是state</span></span><br><span class="line">        <span class="comment">//2.必须有返回值，返回值就是getters的值</span></span><br><span class="line">        <span class="title function_">filterList</span>(<span class="params">state</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> state.<span class="property">list</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item &gt; <span class="number">5</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出给main.js使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Son1.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot;&gt;  </span><br><span class="line">    	&lt;h2&gt;Son1 子组件&lt;/h2&gt;</span><br><span class="line">    	从vuex中获取的值:</span><br><span class="line">        &lt;label&gt;&#123;&#123; $store.state.count &#125;&#125;&lt;/label&gt;</span><br><span class="line">        &lt;label&gt;&#123;&#123; count &#125;&#125;&lt;/label&gt;</span><br><span class="line">    	&lt;br&gt;</span><br><span class="line">    	&lt;button @click=&quot;handleAdd(1)&quot;&gt;值 + 1&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(5)&quot;&gt;值 + 5&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(10)&quot;&gt;值 + 10&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handlechange&quot;&gt;一秒后修改成666&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;change&quot;&gt;改标题&lt;/button&gt;</span><br><span class="line">        &lt;hr&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.list &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.getters.filterList &#125;&#125;&lt;/div&gt;                       </span><br><span class="line">        &lt;div&gt;&#123;&#123; filterList &#125;&#125;&lt;/div&gt;                       </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123; mapState, mapGetters &#125; from &#x27;vuex&#x27;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">    	name:&#x27;Son1Com&#x27;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">			//mapState和 mapGetters 都是映射属性</span><br><span class="line">        	...mapState([&#x27;count&#x27;]),</span><br><span class="line">            ...mapGetters([&#x27;filterList&#x27;])</span><br><span class="line">        &#125;,</span><br><span class="line">    	methods:&#123;</span><br><span class="line">    		handleAdd(n)&#123;</span><br><span class="line">    			//应该通过 mutation 核心概念，进行修改数据</span><br><span class="line">    			//需要提交调用mutation</span><br><span class="line">    			this.$store.commit(&#x27;addcount&#x27;, n)</span><br><span class="line">    		&#125;,</span><br><span class="line">            change()&#123;</span><br><span class="line">                this.$store.commit(&#x27;changeTitle&#x27;, &#x27;黑马程序员&#x27;)</span><br><span class="line">            &#125;,</span><br><span class="line">            handleChange()&#123;</span><br><span class="line">				// 调用action</span><br><span class="line">				// this.$store.dispatch(&#x27;action名字&#x27;，额外参数)</span><br><span class="line">				this.$store.dispatch(&#x27;changeCountAction&#x27;,666)</span><br><span class="line">			&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="14-9-核心概念-模块module（进阶语法）"><a href="#14-9-核心概念-模块module（进阶语法）" class="headerlink" title="14-9 核心概念-模块module（进阶语法）"></a>14-9 核心概念-模块module（进阶语法）</h2><h3 id="14-9-1-创建"><a href="#14-9-1-创建" class="headerlink" title="14-9-1 创建"></a>14-9-1 创建</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240908171439869.png"
                      alt="image-20240908171439869"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240908172713338.png"
                      alt="image-20240908172713338"
                ></p>
<ul>
<li>store &#x2F; modules &#x2F; user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// user模块</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">	<span class="attr">userInfo</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">score</span>: <span class="number">80</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123; &#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123; &#125;</span><br><span class="line"><span class="keyword">const</span> getters = &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    state,</span><br><span class="line">    mutations,</span><br><span class="line">    actions,</span><br><span class="line">    getters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>store &#x2F; modules &#x2F; setting.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// setting模块</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">	<span class="attr">theme</span>: <span class="string">&#x27;light&#x27;</span>, <span class="comment">//主题色</span></span><br><span class="line">	<span class="attr">desc</span>: <span class="string">&#x27;测试demo&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123; &#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123; &#125;</span><br><span class="line"><span class="keyword">const</span> getters = &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">	state,</span><br><span class="line">    mutations,</span><br><span class="line">    actions,</span><br><span class="line">	getters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>store &#x2F; index.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这里面存放的就是 vuex 相关的核心代码</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&#x27;./modules/user&#x27;</span></span><br><span class="line"><span class="keyword">import</span> setting <span class="keyword">from</span> <span class="string">&#x27;./modules/setting&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//插件安装</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建仓库(空仓库)</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">	<span class="comment">//严格模式(有利于初学者，检测不规范的代码)</span></span><br><span class="line">	<span class="attr">strict</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="comment">//1.通过 state 可以提供数据(所有组件共享的数据)</span></span><br><span class="line">	<span class="attr">state</span>:&#123;</span><br><span class="line">		<span class="attr">title</span>: <span class="string">&#x27;仓库大标题&#x27;</span>,</span><br><span class="line">        <span class="attr">count</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="attr">list</span>:[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//2.通过 mutations 可以提供修改数据的方法</span></span><br><span class="line">	<span class="attr">mutations</span>:&#123;</span><br><span class="line">		<span class="comment">//所有mutation函数，第一个参数，都是state</span></span><br><span class="line">		<span class="title function_">changeCount</span>(<span class="params">state, newCount</span>)&#123;</span><br><span class="line">			<span class="comment">//修改数据</span></span><br><span class="line">			state.<span class="property">count</span> = newCount</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//3.actions 处理异步</span></span><br><span class="line">	<span class="comment">//注意:不能直接操作 state，操作 state，还是需要 commit mutation</span></span><br><span class="line">	<span class="attr">actions</span>:&#123;</span><br><span class="line">		<span class="comment">// context 上下文(此处未分模块，可以当成store仓库)</span></span><br><span class="line">		<span class="comment">// context.commit(&#x27;mutation名字&#x27;，额外参数)</span></span><br><span class="line">		<span class="title function_">changeCountAction</span>(<span class="params">context, num</span>)&#123;</span><br><span class="line">			<span class="comment">// 这里是setTimeout模拟异步，以后大部分场景是发请求</span></span><br><span class="line">			<span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">				context.<span class="title function_">commit</span>(<span class="string">&#x27;changeCount&#x27;</span>, num)</span><br><span class="line">			&#125;，<span class="number">1000</span>)	</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">    <span class="comment">//4.getters 类似于计算属性</span></span><br><span class="line">    <span class="attr">getters</span>:&#123;</span><br><span class="line">        <span class="comment">// 注意点:</span></span><br><span class="line">        <span class="comment">//1.形参第一个参数，就是state</span></span><br><span class="line">        <span class="comment">//2.必须有返回值，返回值就是getters的值</span></span><br><span class="line">        <span class="title function_">filterList</span>(<span class="params">state</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> state.<span class="property">list</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item &gt; <span class="number">5</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//5.modules 模块</span></span><br><span class="line">    <span class="attr">modules</span>:&#123;</span><br><span class="line">        user,</span><br><span class="line">        setting</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出给main.js使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure></div>

<h3 id="14-9-2-使用state语法"><a href="#14-9-2-使用state语法" class="headerlink" title="14-9-2 使用state语法"></a>14-9-2 使用state语法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240908210449454.png"
                      alt="image-20240908210449454"
                ></p>
<ul>
<li>store &#x2F; modules &#x2F; user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// user模块</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">	<span class="attr">userInfo</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">score</span>: <span class="number">80</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123; &#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123; &#125;</span><br><span class="line"><span class="keyword">const</span> getters = &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">    state,</span><br><span class="line">    mutations,</span><br><span class="line">    actions,</span><br><span class="line">    getters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Son1.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot;&gt;  </span><br><span class="line">    	&lt;h2&gt;Son1 子组件&lt;/h2&gt;</span><br><span class="line">    	从vuex中获取的值:</span><br><span class="line">        &lt;label&gt;&#123;&#123; $store.state.count &#125;&#125;&lt;/label&gt;</span><br><span class="line">        &lt;label&gt;&#123;&#123; count &#125;&#125;&lt;/label&gt;</span><br><span class="line">    	&lt;br&gt;</span><br><span class="line">    	&lt;button @click=&quot;handleAdd(1)&quot;&gt;值 + 1&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(5)&quot;&gt;值 + 5&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(10)&quot;&gt;值 + 10&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handlechange&quot;&gt;一秒后修改成666&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;change&quot;&gt;改标题&lt;/button&gt;</span><br><span class="line">        &lt;hr&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.list &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.getters.filterList &#125;&#125;&lt;/div&gt;                       </span><br><span class="line">        &lt;div&gt;&#123;&#123; filterList &#125;&#125;&lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- module模块使用 --&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.user.userInfo.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.setting.theme &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; user.userInfo.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; setting.theme &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; userInfo.name &#125;&#125;&lt;/div&gt;       </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123; mapState, mapGetters &#125; from &#x27;vuex&#x27;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">    	name:&#x27;Son1Com&#x27;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">			//mapState和 mapGetters 都是映射属性</span><br><span class="line">        	...mapState([&#x27;count&#x27;, &#x27;user&#x27;, &#x27;setting&#x27;]),</span><br><span class="line">           	...mapState(&#x27;user&#x27;,  [&#x27;userInfo&#x27;]),</span><br><span class="line">            ...mapGetters([&#x27;filterList&#x27;])</span><br><span class="line">        &#125;,</span><br><span class="line">    	methods:&#123;</span><br><span class="line">    		handleAdd(n)&#123;</span><br><span class="line">    			//应该通过 mutation 核心概念，进行修改数据</span><br><span class="line">    			//需要提交调用mutation</span><br><span class="line">    			this.$store.commit(&#x27;addcount&#x27;, n)</span><br><span class="line">    		&#125;,</span><br><span class="line">            change()&#123;</span><br><span class="line">                this.$store.commit(&#x27;changeTitle&#x27;, &#x27;黑马程序员&#x27;)</span><br><span class="line">            &#125;,</span><br><span class="line">            handleChange()&#123;</span><br><span class="line">				// 调用action</span><br><span class="line">				// this.$store.dispatch(&#x27;action名字&#x27;，额外参数)</span><br><span class="line">				this.$store.dispatch(&#x27;changeCountAction&#x27;,666)</span><br><span class="line">			&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="14-9-3-使用getters语法"><a href="#14-9-3-使用getters语法" class="headerlink" title="14-9-3 使用getters语法"></a>14-9-3 使用getters语法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240909155523505.png"
                      alt="image-20240909155523505"
                ></p>
<ul>
<li>store &#x2F; modules &#x2F; user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// user模块</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">	<span class="attr">userInfo</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">score</span>: <span class="number">80</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123; &#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123; &#125;</span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">	<span class="comment">// 分模块后，state指代子模块的state</span></span><br><span class="line">    <span class="title class_">UpperCaseName</span>(state)&#123;</span><br><span class="line">        <span class="keyword">return</span> state.<span class="property">userInfo</span>.<span class="property">name</span>.<span class="title function_">toUpperCase</span>() <span class="comment">// 转为大写</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">    state,</span><br><span class="line">    mutations,</span><br><span class="line">    actions,</span><br><span class="line">    getters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Son1.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot;&gt;  </span><br><span class="line">    	&lt;h2&gt;Son1 子组件&lt;/h2&gt;</span><br><span class="line">    	从vuex中获取的值:</span><br><span class="line">        &lt;label&gt;&#123;&#123; $store.state.count &#125;&#125;&lt;/label&gt;</span><br><span class="line">        &lt;label&gt;&#123;&#123; count &#125;&#125;&lt;/label&gt;</span><br><span class="line">    	&lt;br&gt;</span><br><span class="line">    	&lt;button @click=&quot;handleAdd(1)&quot;&gt;值 + 1&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(5)&quot;&gt;值 + 5&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(10)&quot;&gt;值 + 10&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handlechange&quot;&gt;一秒后修改成666&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;change&quot;&gt;改标题&lt;/button&gt;</span><br><span class="line">        &lt;hr&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.list &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.getters.filterList &#125;&#125;&lt;/div&gt;                       </span><br><span class="line">        &lt;div&gt;&#123;&#123; filterList &#125;&#125;&lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- 模块化 module模块使用state --&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.user.userInfo.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.setting.theme &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; user.userInfo.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; setting.theme &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; userInfo.name &#125;&#125;&lt;/div&gt; </span><br><span class="line">        </span><br><span class="line">        &lt;!-- 模块化 module模块使用getter --&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.getters[&#x27;user/UpperCaseName&#x27;] &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; UpperCaseName &#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123; mapState, mapGetters &#125; from &#x27;vuex&#x27;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">    	name:&#x27;Son1Com&#x27;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">			//mapState和 mapGetters 都是映射属性</span><br><span class="line">        	...mapState([&#x27;count&#x27;, &#x27;user&#x27;, &#x27;setting&#x27;]),</span><br><span class="line">           	...mapState(&#x27;user&#x27;,  [&#x27;userInfo&#x27;]),</span><br><span class="line">            ...mapGetters([&#x27;filterList&#x27;]),</span><br><span class="line">            ...mapGetters(&#x27;user&#x27;, [&#x27;UpperCaseName&#x27;])</span><br><span class="line">        &#125;,</span><br><span class="line">    	methods:&#123;</span><br><span class="line">    		handleAdd(n)&#123;</span><br><span class="line">    			//应该通过 mutation 核心概念，进行修改数据</span><br><span class="line">    			//需要提交调用mutation</span><br><span class="line">    			this.$store.commit(&#x27;addcount&#x27;, n)</span><br><span class="line">    		&#125;,</span><br><span class="line">            change()&#123;</span><br><span class="line">                this.$store.commit(&#x27;changeTitle&#x27;, &#x27;黑马程序员&#x27;)</span><br><span class="line">            &#125;,</span><br><span class="line">            handleChange()&#123;</span><br><span class="line">				// 调用action</span><br><span class="line">				// this.$store.dispatch(&#x27;action名字&#x27;，额外参数)</span><br><span class="line">				this.$store.dispatch(&#x27;changeCountAction&#x27;,666)</span><br><span class="line">			&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="14-9-4-使用mutation语法"><a href="#14-9-4-使用mutation语法" class="headerlink" title="14-9-4 使用mutation语法"></a>14-9-4 使用mutation语法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240909164811468.png"
                      alt="image-20240909164811468"
                ></p>
<ul>
<li>store &#x2F; modules &#x2F; user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// user模块</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">	<span class="attr">userInfo</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">score</span>: <span class="number">80</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123; </span><br><span class="line">	<span class="title function_">setUser</span>(<span class="params">state, newUserInfo</span>)&#123;</span><br><span class="line">        state.<span class="property">userInfo</span> = newUserInfo</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123; &#125;</span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">	<span class="comment">// 分模块后，state指代子模块的state</span></span><br><span class="line">    <span class="title class_">UpperCaseName</span>(state)&#123;</span><br><span class="line">        <span class="keyword">return</span> state.<span class="property">userInfo</span>.<span class="property">name</span>.<span class="title function_">toUpperCase</span>() <span class="comment">// 转为大写</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">    state,</span><br><span class="line">    mutations,</span><br><span class="line">    actions,</span><br><span class="line">    getters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Son1.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot;&gt;  </span><br><span class="line">    	&lt;h2&gt;Son1 子组件&lt;/h2&gt;</span><br><span class="line">    	从vuex中获取的值:</span><br><span class="line">        &lt;label&gt;&#123;&#123; $store.state.count &#125;&#125;&lt;/label&gt;</span><br><span class="line">        &lt;label&gt;&#123;&#123; count &#125;&#125;&lt;/label&gt;</span><br><span class="line">    	&lt;br&gt;</span><br><span class="line">    	&lt;button @click=&quot;handleAdd(1)&quot;&gt;值 + 1&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(5)&quot;&gt;值 + 5&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(10)&quot;&gt;值 + 10&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handlechange&quot;&gt;一秒后修改成666&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;change&quot;&gt;改标题&lt;/button&gt;</span><br><span class="line">        &lt;hr&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.list &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.getters.filterList &#125;&#125;&lt;/div&gt;                       </span><br><span class="line">        &lt;div&gt;&#123;&#123; filterList &#125;&#125;&lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- 模块化 module模块使用state --&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.user.userInfo.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.setting.theme &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; user.userInfo.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; setting.theme &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; userInfo.name &#125;&#125;&lt;/div&gt; </span><br><span class="line">        </span><br><span class="line">        &lt;!-- 模块化 module模块使用getter --&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.getters[&#x27;user/UpperCaseName&#x27;] &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; UpperCaseName &#125;&#125;&lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">         &lt;!-- 模块化 module模块使用mutation --&gt;</span><br><span class="line">        &lt;button @click=&quot;updateUser&quot;&gt;更新个人信息&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;setUser(&#123; name: &#x27;xiaoli&#x27;, age: 80&#125;)&quot;&gt;更新个人信息&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123; mapState, mapGetters, mapMutations &#125; from &#x27;vuex&#x27;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">    	name:&#x27;Son1Com&#x27;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">			//mapState和 mapGetters 都是映射属性</span><br><span class="line">        	...mapState([&#x27;count&#x27;, &#x27;user&#x27;, &#x27;setting&#x27;]),</span><br><span class="line">           	...mapState(&#x27;user&#x27;,  [&#x27;userInfo&#x27;]),</span><br><span class="line">            ...mapGetters([&#x27;filterList&#x27;]),</span><br><span class="line">            ...mapGetters(&#x27;user&#x27;, [&#x27;UpperCaseName&#x27;])</span><br><span class="line">        &#125;,</span><br><span class="line">    	methods:&#123;</span><br><span class="line">            //user子模块</span><br><span class="line">            ...mapMutations(&#x27;user&#x27;, [&#x27;setUser&#x27;]),</span><br><span class="line">            updateUser()&#123;</span><br><span class="line">                this.$store.commit(&#x27;user/setUser&#x27;,&#123;</span><br><span class="line">                    name: &#x27;xiaowang&#x27;,</span><br><span class="line">                    age: 25</span><br><span class="line">                &#125;)                    </span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">    		handleAdd(n)&#123;</span><br><span class="line">    			//应该通过 mutation 核心概念，进行修改数据</span><br><span class="line">    			//需要提交调用mutation</span><br><span class="line">    			this.$store.commit(&#x27;addcount&#x27;, n)</span><br><span class="line">    		&#125;,</span><br><span class="line">            change()&#123;</span><br><span class="line">                this.$store.commit(&#x27;changeTitle&#x27;, &#x27;黑马程序员&#x27;)</span><br><span class="line">            &#125;,</span><br><span class="line">            handleChange()&#123;</span><br><span class="line">				// 调用action</span><br><span class="line">				// this.$store.dispatch(&#x27;action名字&#x27;，额外参数)</span><br><span class="line">				this.$store.dispatch(&#x27;changeCountAction&#x27;,666)</span><br><span class="line">			&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="14-9-5-使用action语法"><a href="#14-9-5-使用action语法" class="headerlink" title="14-9-5 使用action语法"></a>14-9-5 使用action语法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240909171803311.png"
                      alt="image-20240909171803311"
                ></p>
<ul>
<li>store &#x2F; modules &#x2F; user.js</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// user模块</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">	<span class="attr">userInfo</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">score</span>: <span class="number">80</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123; </span><br><span class="line">	<span class="title function_">setUser</span>(<span class="params">state, newUserInfo</span>)&#123;</span><br><span class="line">        state.<span class="property">userInfo</span> = newUserInfo</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">	<span class="title function_">setUserSecond</span>(<span class="params">context, newUserInfo</span>)&#123;</span><br><span class="line">        <span class="comment">// 将异步在action中进行封装</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// context上下文，默认提交的就是自己模块的action和mutation</span></span><br><span class="line">            context.<span class="title function_">commit</span>(<span class="string">&#x27;setUser&#x27;</span>, newUserInfo)</span><br><span class="line">		&#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">	<span class="comment">// 分模块后，state指代子模块的state</span></span><br><span class="line">    <span class="title class_">UpperCaseName</span>(state)&#123;</span><br><span class="line">        <span class="keyword">return</span> state.<span class="property">userInfo</span>.<span class="property">name</span>.<span class="title function_">toUpperCase</span>() <span class="comment">// 转为大写</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">    state,</span><br><span class="line">    mutations,</span><br><span class="line">    actions,</span><br><span class="line">    getters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Son1.vue</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;box&quot;&gt;  </span><br><span class="line">    	&lt;h2&gt;Son1 子组件&lt;/h2&gt;</span><br><span class="line">    	从vuex中获取的值:</span><br><span class="line">        &lt;label&gt;&#123;&#123; $store.state.count &#125;&#125;&lt;/label&gt;</span><br><span class="line">        &lt;label&gt;&#123;&#123; count &#125;&#125;&lt;/label&gt;</span><br><span class="line">    	&lt;br&gt;</span><br><span class="line">    	&lt;button @click=&quot;handleAdd(1)&quot;&gt;值 + 1&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(5)&quot;&gt;值 + 5&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleAdd(10)&quot;&gt;值 + 10&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handlechange&quot;&gt;一秒后修改成666&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;change&quot;&gt;改标题&lt;/button&gt;</span><br><span class="line">        &lt;hr&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.list &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.getters.filterList &#125;&#125;&lt;/div&gt;                       </span><br><span class="line">        &lt;div&gt;&#123;&#123; filterList &#125;&#125;&lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- 模块化 module模块使用state --&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.user.userInfo.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.state.setting.theme &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; user.userInfo.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; setting.theme &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; userInfo.name &#125;&#125;&lt;/div&gt; </span><br><span class="line">        </span><br><span class="line">        &lt;!-- 模块化 module模块使用getter --&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; $store.getters[&#x27;user/UpperCaseName&#x27;] &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123; UpperCaseName &#125;&#125;&lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">         &lt;!-- 模块化 module模块使用mutation --&gt;</span><br><span class="line">        &lt;button @click=&quot;updateUser&quot;&gt;更新个人信息&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;setUser(&#123; name: &#x27;xiaoli&#x27;, age: 80&#125;)&quot;&gt;更新个人信息&lt;/button&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- 模块化 module模块使用action --&gt;</span><br><span class="line">        &lt;button @click=&quot;updateUser2&quot;&gt;一秒后更新信息&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;setUserSecond(&#123; name: &#x27;xiaozhao&#x27;, age: 90&#125;)&quot;&gt;一秒后更新信息&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123; mapState, mapGetters, mapMutations, mapActions &#125; from &#x27;vuex&#x27;</span><br><span class="line">    </span><br><span class="line">    export default &#123;</span><br><span class="line">    	name:&#x27;Son1Com&#x27;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">			//mapState和 mapGetters 都是映射属性</span><br><span class="line">        	...mapState([&#x27;count&#x27;, &#x27;user&#x27;, &#x27;setting&#x27;]),</span><br><span class="line">           	...mapState(&#x27;user&#x27;,  [&#x27;userInfo&#x27;]),</span><br><span class="line">            ...mapGetters([&#x27;filterList&#x27;]),</span><br><span class="line">            ...mapGetters(&#x27;user&#x27;,[&#x27;UpperCaseName&#x27;])</span><br><span class="line">        &#125;,</span><br><span class="line">    	methods:&#123;</span><br><span class="line">            //user子模块</span><br><span class="line">            ...mapMutations(&#x27;user&#x27;, [&#x27;setUser&#x27;]),</span><br><span class="line">            updateUser()&#123;</span><br><span class="line">                this.$store.commit(&#x27;user/setUser&#x27;,&#123;</span><br><span class="line">                    name: &#x27;xiaowang&#x27;,</span><br><span class="line">                    age: 25</span><br><span class="line">                &#125;)                    </span><br><span class="line">            &#125;,</span><br><span class="line">            ...mapActions(&#x27;user&#x27;, [&#x27;setUserSecond&#x27;]),</span><br><span class="line">            updateUser2()&#123;</span><br><span class="line">                this.$store.dispatch(&#x27;user/setUserSecond&#x27;,&#123;</span><br><span class="line">                    name: &#x27;xiaohong&#x27;,</span><br><span class="line">                    age: 28</span><br><span class="line">                &#125;)                    </span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">    		handleAdd(n)&#123;</span><br><span class="line">    			//应该通过 mutation 核心概念，进行修改数据</span><br><span class="line">    			//需要提交调用mutation</span><br><span class="line">    			this.$store.commit(&#x27;addcount&#x27;, n)</span><br><span class="line">    		&#125;,</span><br><span class="line">            change()&#123;</span><br><span class="line">                this.$store.commit(&#x27;changeTitle&#x27;, &#x27;黑马程序员&#x27;)</span><br><span class="line">            &#125;,</span><br><span class="line">            handleChange()&#123;</span><br><span class="line">				// 调用action</span><br><span class="line">				// this.$store.dispatch(&#x27;action名字&#x27;，额外参数)</span><br><span class="line">				this.$store.dispatch(&#x27;changeCountAction&#x27;,666)</span><br><span class="line">			&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h1 id="二、实战"><a href="#二、实战" class="headerlink" title="二、实战"></a>二、实战</h1>]]></content>
      <categories>
        <category>前端</category>
        <category>Vue2</category>
      </categories>
      <tags>
        <tag>自研笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2024/01/12/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a class="link"   href="https://hexo.io/" >Hexo <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>! This is your very first post. Check <a class="link"   href="https://hexo.io/docs/" >documentation <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> for more info. If you get any problems when using Hexo, you can find the answer in <a class="link"   href="https://hexo.io/docs/troubleshooting.html" >troubleshooting <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> or you can ask me on <a class="link"   href="https://github.com/hexojs/hexo/issues" >GitHub <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>More info: <a class="link"   href="https://hexo.io/docs/writing.html" >Writing <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure></div>

<p>More info: <a class="link"   href="https://hexo.io/docs/server.html" >Server <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure></div>

<p>More info: <a class="link"   href="https://hexo.io/docs/generating.html" >Generating <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure></div>

<p>More info: <a class="link"   href="https://hexo.io/docs/one-command-deployment.html" >Deployment <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
  </entry>
  <entry>
    <title>RuoYi框架实战开发</title>
    <url>/2024/07/12/RuoYi%E6%A1%86%E6%9E%B6%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h1 id="1-项目介绍"><a href="#1-项目介绍" class="headerlink" title="1. 项目介绍"></a>1. 项目介绍</h1><h2 id="1-1-是什么"><a href="#1-1-是什么" class="headerlink" title="1.1 是什么"></a>1.1 是什么</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712171717250.png"
                      alt="image-20240712171717250"
                ></p>
<h2 id="1-2-售货机术语"><a href="#1-2-售货机术语" class="headerlink" title="1.2 售货机术语"></a>1.2 售货机术语</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712171750178.png"
                      alt="image-20240712171750178"
                ></p>
<h2 id="1-3-角色与功能"><a href="#1-3-角色与功能" class="headerlink" title="1.3 角色与功能"></a>1.3 角色与功能</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712172145708.png"
                      alt="image-20240712172145708"
                ></p>
<h2 id="1-4-业务流程"><a href="#1-4-业务流程" class="headerlink" title="1.4 业务流程"></a>1.4 业务流程</h2><ul>
<li>平台管理员</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712192010840.png"
                      alt="image-20240712192010840"
                ></p>
<h2 id="1-5-库表设计"><a href="#1-5-库表设计" class="headerlink" title="1.5 库表设计"></a>1.5 库表设计</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712192432967.png"
                      alt="image-20240712192432967"
                ></p>
<h2 id="1-6-页面原型"><a href="#1-6-页面原型" class="headerlink" title="1.6 页面原型"></a>1.6 页面原型</h2><ul>
<li><a class="link"   href="https://codesign.qq.com/s/426304924036117" >帝可得 - 产品原型 - 腾讯 CoDesign (qq.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<h1 id="2-初始AI"><a href="#2-初始AI" class="headerlink" title="2. 初始AI"></a>2. 初始AI</h1><h2 id="2-1-AIGC"><a href="#2-1-AIGC" class="headerlink" title="2.1 AIGC"></a>2.1 AIGC</h2><ul>
<li>AIGC（AI Generated content）：是AI领域的一个应用分支，专注于利用AI技术自动生成内容。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712193042657.png"
                      alt="image-20240712193042657"
                ></p>
<ul>
<li>国内常见的通用大模型（AGI）产品：文心一言、讯飞星火、通义千问、KIMI。</li>
</ul>
<h2 id="2-2-提示工程"><a href="#2-2-提示工程" class="headerlink" title="2.2 提示工程"></a>2.2 提示工程</h2><h3 id="2-2-1-概念"><a href="#2-2-1-概念" class="headerlink" title="2.2.1 概念"></a>2.2.1 概念</h3><ul>
<li>提示工程（Prompt Engineering）也被称为上下文提示。设计和优化输入文本（Prompt）来引导AI模型生成预期的输出。</li>
</ul>
<h3 id="2-2-2-Prompt的组成"><a href="#2-2-2-Prompt的组成" class="headerlink" title="2.2.2 Prompt的组成"></a>2.2.2 Prompt的组成</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712194115753.png"
                      alt="image-20240712194115753"
                ></p>
<h3 id="2-2-3-常见的编程相关的Prompt"><a href="#2-2-3-常见的编程相关的Prompt" class="headerlink" title="2.2.3 常见的编程相关的Prompt"></a>2.2.3 常见的编程相关的Prompt</h3><h4 id="2-2-3-1-表结构"><a href="#2-2-3-1-表结构" class="headerlink" title="2.2.3.1 表结构"></a>2.2.3.1 表结构</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712195440974.png"
                      alt="image-20240712195440974"
                ></p>
<h4 id="2-2-3-2-生成数据库说明文档"><a href="#2-2-3-2-生成数据库说明文档" class="headerlink" title="2.2.3.2 生成数据库说明文档"></a>2.2.3.2 生成数据库说明文档</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712195539500.png"
                      alt="image-20240712195539500"
                ></p>
<h4 id="2-2-3-3-生成代码"><a href="#2-2-3-3-生成代码" class="headerlink" title="2.2.3.3 生成代码"></a>2.2.3.3 生成代码</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712195852429.png"
                      alt="image-20240712195852429"
                ></p>
<h4 id="2-2-3-4-生成代码流程图"><a href="#2-2-3-4-生成代码流程图" class="headerlink" title="2.2.3.4 生成代码流程图"></a>2.2.3.4 生成代码流程图</h4><ul>
<li><p>你是一个软件工程师，为了方便理解代码执行流程，需要给出代码执行的流程图，代码如下：</p>
</li>
<li><p>代码内容</p>
</li>
<li><p>输出：请使用 mermaid 语言来描述这个方法的流程</p>
</li>
<li><p>注意：生成的 mermaid 语言可以使用 markdown 将其转为图像。</p>
</li>
</ul>
<h1 id="3-项目搭建"><a href="#3-项目搭建" class="headerlink" title="3. 项目搭建"></a>3. 项目搭建</h1><h2 id="3-1-后端"><a href="#3-1-后端" class="headerlink" title="3.1 后端"></a>3.1 后端</h2><ul>
<li>Git 克隆并初始化项目（点击 从VCS获取，输入 仓库地址，选择 目录，打开 项目）（多了 dkd-manage 子模块）</li>
<li>MySQL 导入与配置</li>
<li>启动 Redis 与配置</li>
<li>将 admin 中的 mybatis-config.xml 中的 “使用驼峰命名法转换字段” 开启。</li>
<li>运行后端项目</li>
</ul>
<h2 id="3-2-前端"><a href="#3-2-前端" class="headerlink" title="3.2 前端"></a>3.2 前端</h2><ul>
<li><p>Git 克隆并初始化项目（点击 克隆仓库，输入 仓库地址，选择 下载地址，打开 项目）</p>
</li>
<li><p>安装依赖（npm install）</p>
</li>
<li><p>运行前端项目</p>
</li>
</ul>
<h1 id="4-点位管理"><a href="#4-点位管理" class="headerlink" title="4. 点位管理"></a>4. 点位管理</h1><h2 id="4-1-需求说明"><a href="#4-1-需求说明" class="headerlink" title="4.1 需求说明"></a>4.1 需求说明</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712202906881.png"
                      alt="image-20240712202906881"
                ></p>
<h2 id="4-2-库表设计"><a href="#4-2-库表设计" class="headerlink" title="4.2 库表设计"></a>4.2 库表设计</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712214833188.png"
                      alt="image-20240712214833188"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712215457075.png"
                      alt="image-20240712215457075"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240712215940131.png"
                      alt="image-20240712215940131"
                ></p>
<h2 id="4-3-生成基础代码"><a href="#4-3-生成基础代码" class="headerlink" title="4.3 生成基础代码"></a>4.3 生成基础代码</h2><h3 id="4-3-1-创建目录菜单"><a href="#4-3-1-创建目录菜单" class="headerlink" title="4.3.1 创建目录菜单"></a>4.3.1 创建目录菜单</h3><ul>
<li>点击 菜单管理。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713082638675.png"
                      alt="image-20240713082638675"
                ></p>
<h3 id="4-3-2-添加数据字典"><a href="#4-3-2-添加数据字典" class="headerlink" title="4.3.2 添加数据字典"></a>4.3.2 添加数据字典</h3><ul>
<li>点击 字典管理。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713082817497.png"
                      alt="image-20240713082817497"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713082852621.png"
                      alt="image-20240713082852621"
                ></p>
<h3 id="4-3-3-配置代码生成信息"><a href="#4-3-3-配置代码生成信息" class="headerlink" title="4.3.3 配置代码生成信息"></a>4.3.3 配置代码生成信息</h3><ul>
<li>点击 代码生成，导入 生成的三张表。</li>
</ul>
<h4 id="4-3-3-1-区域管理"><a href="#4-3-3-1-区域管理" class="headerlink" title="4.3.3.1 区域管理"></a>4.3.3.1 区域管理</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713083425634.png"
                      alt="image-20240713083425634"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713083658545.png"
                      alt="image-20240713083658545"
                ></p>
<h4 id="4-3-3-2-合作商管理"><a href="#4-3-3-2-合作商管理" class="headerlink" title="4.3.3.2 合作商管理"></a>4.3.3.2 合作商管理</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713084113979.png"
                      alt="image-20240713084113979"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713084148017.png"
                      alt="image-20240713084148017"
                ></p>
<h4 id="4-3-3-3-点位管理"><a href="#4-3-3-3-点位管理" class="headerlink" title="4.3.3.3 点位管理"></a>4.3.3.3 点位管理</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713084539621.png"
                      alt="image-20240713084539621"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713084558430.png"
                      alt="image-20240713084558430"
                ></p>
<h2 id="4-4-下载代码并导入项目"><a href="#4-4-下载代码并导入项目" class="headerlink" title="4.4 下载代码并导入项目"></a>4.4 下载代码并导入项目</h2><ul>
<li><p>会生成一个 main，一个 vue，三个 sql。</p>
</li>
<li><p>sql文件导入数据库。</p>
</li>
<li><p>vue文件中的 api .manage 导入 api 中，views .manage 导入 views 中。</p>
</li>
<li><p>main文件中的 java 导入 dkd-manage .java 中，resources 导入 dkd-manage .resources 中。</p>
</li>
</ul>
<h2 id="4-5-区域管理改造"><a href="#4-5-区域管理改造" class="headerlink" title="4.5 区域管理改造"></a>4.5 区域管理改造</h2><h3 id="4-5-1-自排序序号"><a href="#4-5-1-自排序序号" class="headerlink" title="4.5.1 自排序序号"></a>4.5.1 自排序序号</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">原：</span><br><span class="line">&lt;el-table-column label=&quot;主键id&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;</span><br><span class="line">改：</span><br><span class="line">&lt;el-table-column label=&quot;序号&quot; type=&quot;index&quot; width=&quot;50&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="4-5-2-图标移除"><a href="#4-5-2-图标移除" class="headerlink" title="4.5.2 图标移除"></a>4.5.2 图标移除</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">原：</span><br><span class="line">&lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">	&lt;el-button link type=&quot;primary&quot; icon=&quot;Edit&quot; @click=&quot;handleUpdate (scope.row)&quot; v-hasPermi=&quot;		[&#x27;manage:region:edit&#x27;]&quot;&gt;修改</span><br><span class="line">	&lt;el-button link type=&quot;primary&quot; icon=&quot;Delete&quot; @click=&quot;handleDelete (scope.row)&quot; v-haspermi=&quot;[&#x27;manage:region:remove&#x27;]&quot;&gt;删除</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">改：</span><br><span class="line">将 icon=&quot;Edit&quot; 与 icon=&quot;Delete&quot; 移除</span><br></pre></td></tr></table></figure></div>

<h3 id="4-5-3-在查询区域列表时，同时显示每个区域的点位数"><a href="#4-5-3-在查询区域列表时，同时显示每个区域的点位数" class="headerlink" title="4.5.3 在查询区域列表时，同时显示每个区域的点位数"></a>4.5.3 在查询区域列表时，同时显示每个区域的点位数</h3><h4 id="4-5-3-1-mapper-调用"><a href="#4-5-3-1-mapper-调用" class="headerlink" title="4.5.3.1 mapper 调用"></a>4.5.3.1 mapper 调用</h4><ul>
<li>传统模式</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--传统模式</span></span><br><span class="line"><span class="comment">--1.先聚合统计每个区域下的点位数</span></span><br><span class="line"><span class="comment">--确定查询表 tb_node</span></span><br><span class="line"><span class="comment">--确定分组字段 region_id</span></span><br><span class="line"><span class="keyword">select</span> region_id,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> node_count <span class="keyword">from</span> tb_node <span class="keyword">group</span> <span class="keyword">by</span> region_id;</span><br><span class="line"><span class="comment">--2.然后与区域表进行关联查询</span></span><br><span class="line"><span class="keyword">select</span> r.id,r.region_name,r.remark,ifnull(n.node_count,<span class="number">0</span>) <span class="keyword">as</span> node_count <span class="keyword">from</span> tb_region r</span><br><span class="line">	<span class="keyword">left</span> <span class="keyword">join</span> (<span class="keyword">select</span> region_id,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> node_count <span class="keyword">from</span> tb_node <span class="keyword">group</span> <span class="keyword">by</span> region_id) n </span><br><span class="line">	<span class="keyword">on</span> r.id<span class="operator">=</span>n.region_id;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713095008530.png"
                      alt="image-20240713095008530"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713095037889.png"
                      alt="image-20240713095037889"
                ></p>
<ul>
<li>AI辅助编程模式</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--查询区域表所有的信息，需要显示示每个区域的点位数</span></span><br><span class="line"><span class="keyword">SELECT</span> F.<span class="operator">*</span>, <span class="built_in">COUNT</span>(n.id) <span class="keyword">As</span> node_count <span class="keyword">FROM</span> tb_region r <span class="keyword">LEFT</span> J0IN tb_node n <span class="keyword">ON</span> r.id <span class="operator">=</span> n.region_id </span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> r.id;</span><br></pre></td></tr></table></figure></div>

<h4 id="4-5-3-2-后端编写"><a href="#4-5-3-2-后端编写" class="headerlink" title="4.5.3.2 后端编写"></a>4.5.3.2 后端编写</h4><ul>
<li>在 domain 包下创建 vo 包，作为返回到前端的数据。</li>
<li>在 vo 包 下创建 RegionVo 模块</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dkd.manage.domain.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.dkd.manage.domain.Region;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegionVo</span> <span class="keyword">extends</span> <span class="title class_">Region</span> &#123;</span><br><span class="line">	<span class="comment">//点位数量</span></span><br><span class="line">	<span class="keyword">private</span> Integer nodeCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>RegionMapper 接口 与 实现</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询区域列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> region</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> RegionVo集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> List&lt;RegionVo&gt; <span class="title function_">selectRegionVoList</span> <span class="params">(Region region)</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">select</span> id<span class="operator">=</span>&quot;selectRegionVoList&quot; resultType<span class="operator">=</span>&quot;com.dkd.manage.domain.vo.RegionVo&quot;<span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">SELECT</span> F.<span class="operator">*</span>, <span class="built_in">COUNT</span>(n.id) <span class="keyword">As</span> node_count <span class="keyword">FROM</span> tb_region r <span class="keyword">LEFT</span> J0IN tb_node n <span class="keyword">ON</span> r.id <span class="operator">=</span> n.region_id </span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">where</span><span class="operator">&gt;</span></span><br><span class="line">		<span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;regionName != null and regionName != &#x27;&#x27;&quot;<span class="operator">&gt;</span> <span class="keyword">and</span> r.region_name <span class="keyword">like</span> concat(<span class="string">&#x27;%&#x27;</span>, #						&#123;regionName&#125;, <span class="string">&#x27;%&#x27;</span>)<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">where</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> r.id</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">select</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>IRegionService 与 RegionServiceimpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;RegionVo&gt; <span class="title function_">selectRegionVoList</span> <span class="params">(Region region)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;RegionVo&gt; <span class="title function_">selectRegionVoList</span><span class="params">(Region region)</span> &#123; </span><br><span class="line">	<span class="keyword">return</span> regionMapper.selectRegionVoList(region);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>RegionController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *查询区域管理列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;manage:region:list&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> TableDataInfo <span class="title function_">list</span><span class="params">(Region region)</span>&#123;</span><br><span class="line">	startPage();</span><br><span class="line">	List&lt;RegionVo&gt; voList = regionService.selectRegionVoList(region);</span><br><span class="line">	<span class="keyword">return</span> getDataTable(voList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="4-5-3-3-前端编写"><a href="#4-5-3-3-前端编写" class="headerlink" title="4.5.3.3 前端编写"></a>4.5.3.3 前端编写</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-table-column label=&quot;点位数&quot; align=&quot;center&quot; prop=&quot;nodeCount&quot;/&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="4-6-合作商管理改造"><a href="#4-6-合作商管理改造" class="headerlink" title="4.6 合作商管理改造"></a>4.6 合作商管理改造</h2><h3 id="4-6-1-自排序序号"><a href="#4-6-1-自排序序号" class="headerlink" title="4.6.1 自排序序号"></a>4.6.1 自排序序号</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">原：</span><br><span class="line">&lt;el-table-column label=&quot;主键id&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;</span><br><span class="line">改：</span><br><span class="line">&lt;el-table-column label=&quot;序号&quot; type=&quot;index&quot; width=&quot;50&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="4-6-2-添加-后缀"><a href="#4-6-2-添加-后缀" class="headerlink" title="4.6.2 添加%后缀"></a>4.6.2 添加%后缀</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-table-column label=&quot;分成比例&quot; align=&quot;center&quot; prop=&quot;profitRatio&quot;&gt;</span><br><span class="line">	&lt;template #default=&quot;scope&quot;&gt; &#123;&#123; scope.row.profitRatio &#125;&#125;% &lt;/template&gt;</span><br><span class="line">&lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="4-6-3-图标移除"><a href="#4-6-3-图标移除" class="headerlink" title="4.6.3 图标移除"></a>4.6.3 图标移除</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">原：</span><br><span class="line">&lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">	&lt;el-button link type=&quot;primary&quot; icon=&quot;Edit&quot; @click=&quot;handleUpdate (scope.row)&quot; v-hasPermi=&quot;		[&#x27;manage:partner:edit&#x27;]&quot;&gt;修改&lt;/el-button&gt;</span><br><span class="line">	&lt;el-button link type=&quot;primary&quot; icon=&quot;Delete&quot; @click=&quot;handleDelete (scope.row)&quot; v-haspermi=&quot;[&#x27;manage:partner:remove&#x27;]&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">改：</span><br><span class="line">将 icon=&quot;Edit&quot; 与 icon=&quot;Delete&quot; 移除</span><br></pre></td></tr></table></figure></div>

<h3 id="4-6-4-修改表单改造"><a href="#4-6-4-修改表单改造" class="headerlink" title="4.6.4 修改表单改造"></a>4.6.4 修改表单改造</h3><ul>
<li>修改表单 比 添加表单 缺少 账号与密码，多一个 创建时间（只能回显，不能修改）</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;创建时间&quot; prop=&quot;createTime&quot; V-if=&quot;form.id != nu11&quot;&gt;</span><br><span class="line">	&#123;&#123; form.createTime &#125;&#125;</span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line">&lt;el-form-item label=&quot;账号&quot; prop=&quot;account&quot; v-if=&quot;form.id == null&quot;&gt;</span><br><span class="line">	&lt;el-input v-model=&quot;form.account&quot; placeholder=&quot;请输入账号&quot;/&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line">&lt;el-form-item label=&quot;密码&quot; prop=&quot;password&quot; v-if=&quot;form.id == null&quot;&gt;</span><br><span class="line">	&lt;el-input v-model=&quot;form.password&quot; type=&quot;password&quot; placeholder=&quot;请输入密码&quot;/&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="4-6-5-加密密码"><a href="#4-6-5-加密密码" class="headerlink" title="4.6.5 加密密码"></a>4.6.5 加密密码</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *新增合作商管理</span></span><br><span class="line"><span class="comment"> *<span class="doctag">@param</span> partner 合作商管理</span></span><br><span class="line"><span class="comment"> *<span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertPartner</span><span class="params">(Partner partner)</span>&#123;</span><br><span class="line">	<span class="comment">//使用springSecurity工具类，对前端传入的密码进行加密</span></span><br><span class="line">	partner.setPassword(SecurityUtils.encryptPassword(partner.getPassword()));</span><br><span class="line">    </span><br><span class="line">   	partner.setCreateTime(DateUtils.getNowDate());</span><br><span class="line">	<span class="keyword">return</span> partnerMapper.insertPartner(partner);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="4-6-6-查看详情"><a href="#4-6-6-查看详情" class="headerlink" title="4.6.6 查看详情"></a>4.6.6 查看详情</h3><ul>
<li>要求：新增按钮，需要显示合作商名称、联系人、联系电话、分成比例。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 查看合作商详情对话框 --&gt;</span><br><span class="line">&lt;el-dialog title=&quot;合作商详情&quot; v-model=&quot;partnerInfoOpen&quot; width=&quot;500px&quot; append-to-body&gt;</span><br><span class="line">	&lt;!-- 使用el-descriptions组件以卡片形式展示信息，更加整洁 --&gt;</span><br><span class="line">    &lt;el-descriptions :column=&quot;2&quot; border&gt;</span><br><span class="line">		&lt;el-descriptions-item label=&quot;合作商名称&quot;&gt;&#123;&#123; form.partnerName &#125;&#125;&lt;/el-descriptions-item&gt;</span><br><span class="line">        &lt;el-descriptions-item label=&quot;朕系人&quot;&gt;&#123;&#123; form.contactPerson &#125;&#125;&lt;/el-descriptions-item&gt;</span><br><span class="line">        &lt;el-descriptions-item label=&quot;联系电话&quot;&gt;&#123;&#123; form.contactPhone &#125;&#125;&lt;/el-descriptions-item&gt;</span><br><span class="line">        &lt;el-descriptions-item label=&quot;分成比例&quot;&gt;&#123;&#123; form.profitRatio &#125;&#125;&lt;/el-descriptions-item&gt;</span><br><span class="line">    &lt;/el-descriptions&gt;</span><br><span class="line">&lt;/el-dialog&gt;</span><br><span class="line"></span><br><span class="line">&lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">	&lt;el-button link type=&quot;primary&quot; @click=&quot;getParnterInfo(scope.row)&quot; v-hasPermi=&quot;								[&#x27;manage:partner:query&#x27;]&quot;&gt;查看详情&lt;/el-button&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*查看合作商详情*/</span></span><br><span class="line"><span class="keyword">const</span> partnerInfoOpen = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getParnterInfo</span>(<span class="params">row</span>) &#123;</span><br><span class="line">	<span class="title function_">reset</span>();</span><br><span class="line">	<span class="keyword">const</span> _id = row.<span class="property">id</span></span><br><span class="line">	<span class="title function_">getPartner</span>(_id).<span class="property">then</span> (<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">		form.<span class="property">value</span> = response.<span class="property">data</span>;</span><br><span class="line">		partnerInfoOpen.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="4-6-7-在查询合作商列表时，同时显示每个合作商的点位数"><a href="#4-6-7-在查询合作商列表时，同时显示每个合作商的点位数" class="headerlink" title="4.6.7 在查询合作商列表时，同时显示每个合作商的点位数"></a>4.6.7 在查询合作商列表时，同时显示每个合作商的点位数</h3><h4 id="4-6-7-1-mapper-调用"><a href="#4-6-7-1-mapper-调用" class="headerlink" title="4.6.7.1 mapper 调用"></a>4.6.7.1 mapper 调用</h4><ul>
<li>AI辅助编程模式</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--查询合作商表的所有信息，同时显示每个合作商的点位数</span></span><br><span class="line"><span class="keyword">select</span> p.<span class="operator">*</span>,<span class="built_in">count</span>(n.id)<span class="keyword">as</span> node_count</span><br><span class="line">	<span class="keyword">from</span> tb_partner p</span><br><span class="line">		<span class="keyword">left</span> <span class="keyword">join</span> tb_node n <span class="keyword">on</span> p.id <span class="operator">=</span> n.partner_id</span><br><span class="line">	<span class="keyword">group</span> <span class="keyword">by</span> p.id;</span><br></pre></td></tr></table></figure></div>

<h4 id="4-6-7-2-后端编写"><a href="#4-6-7-2-后端编写" class="headerlink" title="4.6.7.2 后端编写"></a>4.6.7.2 后端编写</h4><ul>
<li>在 vo 包 下创建 RartnerVo 模块</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dkd.manage.domain.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.dkd.manage.domain.Partner;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PartnerVo</span> <span class="keyword">extends</span> <span class="title class_">Partner</span> &#123;</span><br><span class="line">	<span class="comment">//点位数量</span></span><br><span class="line">	<span class="keyword">private</span> Integer nodeCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>RartnerMapper 接口 与 实现</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;PartnerVo&gt; <span class="title function_">selectPartnerVolist</span><span class="params">(Partner partner)</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">select</span> id<span class="operator">=</span>&quot;selectPartnerVoList&quot; resultType<span class="operator">=</span>&quot;com.dkd.manage.domain.vo.PartnerVo&quot;<span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">SELECT</span> p.<span class="operator">*</span>,<span class="built_in">COUNT</span>(n.id)<span class="keyword">AS</span> node_count</span><br><span class="line">		<span class="keyword">FROM</span> tb_partner p</span><br><span class="line">			<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tb_node n <span class="keyword">ON</span> p.id <span class="operator">=</span> n.partner_id</span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">where</span><span class="operator">&gt;</span></span><br><span class="line">		<span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;partnerName != null and partnerName != &#x27;&#x27;&quot;<span class="operator">&gt;</span> <span class="keyword">and</span> partner_name <span class="keyword">like</span> concat(<span class="string">&#x27;%&#x27;</span>, #						&#123;partnerName&#125;, <span class="string">&#x27;%&#x27;</span>)<span class="operator">&lt;</span>if<span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">where</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> p.id</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">select</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>IPartnerService 与 PartnerServiceimpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;PartnerVo&gt; <span class="title function_">selectPartnerVoList</span><span class="params">(Partner partner)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;PartnerVo&gt; <span class="title function_">selectPartnerVolist</span><span class="params">(Partner partner)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> partnerMapper.selectPartnerVoList(partner);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></div>

<ul>
<li>PartnerController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;ss.hasPermi(&#x27;manage:partner:list&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> TableDataInfo <span class="title function_">list</span><span class="params">(Partner partner)</span> &#123;</span><br><span class="line">	startPage();</span><br><span class="line">	List&lt;PartnerVo&gt; voList = partnerService.selectPartnerVoList(partner);</span><br><span class="line">	<span class="keyword">return</span> getDataTable(voList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="4-6-7-3-前端编写"><a href="#4-6-7-3-前端编写" class="headerlink" title="4.6.7.3 前端编写"></a>4.6.7.3 前端编写</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-table-column label=&quot;点位数&quot; align=&quot;center&quot; prop=&quot;nodeCount&quot;/&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="4-6-8-重置密码"><a href="#4-6-8-重置密码" class="headerlink" title="4.6.8 重置密码"></a>4.6.8 重置密码</h3><h4 id="4-6-8-1-开发流程"><a href="#4-6-8-1-开发流程" class="headerlink" title="4.6.8.1 开发流程"></a>4.6.8.1 开发流程</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240713205945005.png"
                      alt="image-20240713205945005"
                ></p>
<h4 id="4-6-8-2-后端编写"><a href="#4-6-8-2-后端编写" class="headerlink" title="4.6.8.2 后端编写"></a>4.6.8.2 后端编写</h4><ul>
<li>PartnerController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 重置合作商密码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;manage:partner:edit&#x27;)&quot;)</span> <span class="comment">//修改</span></span><br><span class="line"><span class="meta">@Log(title =&quot;重置合作商密码&quot;, businessType = BusinessType.UPDATE)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;resetPwd/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">resetPwd</span><span class="params">( <span class="meta">@PathVariable</span> Long id )</span>&#123; <span class="comment">//1.接收请求参数</span></span><br><span class="line">	<span class="comment">//2.创建合作商对象</span></span><br><span class="line">	<span class="type">Partner</span> <span class="variable">partner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Partner</span>();</span><br><span class="line">	partner.setId(id); <span class="comment">//设置id</span></span><br><span class="line">	partner.setPassword(Securityutils.encryptPassword(<span class="string">&quot;123456&quot;</span>)); <span class="comment">//设置加密后的初始密码</span></span><br><span class="line">	<span class="comment">//3.调用service更新密码</span></span><br><span class="line">	<span class="keyword">return</span> toAjax(partnerService.updatePartner(partner));</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure></div>

<h4 id="4-6-8-3-前端编写"><a href="#4-6-8-3-前端编写" class="headerlink" title="4.6.8.3 前端编写"></a>4.6.8.3 前端编写</h4><ul>
<li>api \ partner</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//重置合作商密码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">resetPartnerPwd</span> (id) &#123;</span><br><span class="line">	<span class="keyword">return</span> request (&#123;</span><br><span class="line">		<span class="attr">url</span>: <span class="string">&quot;/manage/partner/resetPwd/&#x27;+id,</span></span><br><span class="line"><span class="string">		method: &#x27;put&#x27;</span></span><br><span class="line"><span class="string">	&#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>views \ manage \ partner</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template #<span class="keyword">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">link</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;resetPwd(scope.row)&quot;</span> <span class="attr">v-hasPermi</span>=<span class="string">&quot;									[&#x27;manage:partner:edit&#x27;]&quot;</span>&gt;</span>重置密码<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; listPartner, getPartner, delPartner, addPartner, updatePartner, resetPartnerPwd &#125; <span class="keyword">from</span> 					<span class="string">&quot;@/api/manage/partner&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 重置密码按钮操作 */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resetPwd</span> (row) &#123;</span><br><span class="line">	<span class="keyword">const</span> _id = row.<span class="property">id</span>;</span><br><span class="line">	proxy.<span class="property">$modal</span>.<span class="title function_">confirm</span>(<span class="string">&#x27;你确定要重置该合作商密码吗?&#x27;</span>).<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_">resetPartnerPwd</span>(_id);</span><br><span class="line">	&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		proxy.<span class="property">$modal</span>.<span class="title function_">msqsuccess</span>(<span class="string">&quot;重置密码成功&quot;</span>);</span><br><span class="line">	&#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="4-7-点位管理改造"><a href="#4-7-点位管理改造" class="headerlink" title="4.7 点位管理改造"></a>4.7 点位管理改造</h2><h3 id="4-7-1-下拉式区域搜索"><a href="#4-7-1-下拉式区域搜索" class="headerlink" title="4.7.1 下拉式区域搜索"></a>4.7.1 下拉式区域搜索</h3><ul>
<li><p>通过设置 第一页、每页10000条 数据，使 区域列表 在页面全部展示出来 。</p>
</li>
<li><p>views \ manage \ node</p>
</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-select v-model=<span class="string">&quot;queryParams.regionId&quot;</span> placeholder=<span class="string">&quot;请选择区域&quot;</span> clearable&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">el-option</span> <span class="attr">v-for</span>=<span class="string">&quot;item in regionlist&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;item.regionName&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span></span><br><span class="line">&lt;/el-select&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; listRegion &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/manage/region&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查询所有的条件对象 */</span></span><br><span class="line"><span class="keyword">const</span> loadAllParams = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">	<span class="attr">pageNum</span>:<span class="number">1</span>,</span><br><span class="line">	<span class="attr">pagesize</span>:<span class="number">10000</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查询区域列表 */</span></span><br><span class="line"><span class="keyword">const</span> regionlist = <span class="title function_">ref</span>([]);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRegionList</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="title function_">listRegion</span>(loadAllParams).<span class="title function_">then</span>( <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">		regionlist.<span class="property">value</span> = response.<span class="property">rows</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getRegionList</span>();</span><br></pre></td></tr></table></figure></div>

<h3 id="4-7-2-自排序序号"><a href="#4-7-2-自排序序号" class="headerlink" title="4.7.2 自排序序号"></a>4.7.2 自排序序号</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">原：</span><br><span class="line">&lt;el-table-column label=&quot;主键id&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;</span><br><span class="line">改：</span><br><span class="line">&lt;el-table-column label=&quot;序号&quot; type=&quot;index&quot; width=&quot;50&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="4-7-3-图标移除"><a href="#4-7-3-图标移除" class="headerlink" title="4.7.3 图标移除"></a>4.7.3 图标移除</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">原：</span><br><span class="line">&lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">	&lt;el-button link type=&quot;primary&quot; icon=&quot;Edit&quot; @click=&quot;handleUpdate (scope.row)&quot; v-hasPermi=&quot;		[&#x27;manage:node:edit&#x27;]&quot;&gt;修改&lt;/el-button&gt;</span><br><span class="line">	&lt;el-button link type=&quot;primary&quot; icon=&quot;Delete&quot; @click=&quot;handleDelete (scope.row)&quot; v-haspermi=&quot;[&#x27;manage:node:remove&#x27;]&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">改：</span><br><span class="line">将 icon=&quot;Edit&quot; 与 icon=&quot;Delete&quot; 移除</span><br></pre></td></tr></table></figure></div>

<h3 id="4-7-4-下拉式合作商搜索"><a href="#4-7-4-下拉式合作商搜索" class="headerlink" title="4.7.4 下拉式合作商搜索"></a>4.7.4 下拉式合作商搜索</h3><ul>
<li>views \ manage \ node</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-select v-model=<span class="string">&quot;form.partnerId&quot;</span> placeholder=<span class="string">&quot;请选择合作商&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">el-option</span> <span class="attr">v-for</span>=<span class="string">&quot;item in partnerlist&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;item.partnerName&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span></span><br><span class="line">&lt;/el-select&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; listPartner &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/manage/partner&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查询所有的条件对象 */</span></span><br><span class="line"><span class="keyword">const</span> loadAllParams = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">	<span class="attr">pageNum</span>:<span class="number">1</span>,</span><br><span class="line">	<span class="attr">pagesize</span>:<span class="number">10000</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查询合作商列表 */</span></span><br><span class="line"><span class="keyword">const</span> partnerlist = <span class="title function_">ref</span>([]);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPartnerList</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="title function_">listPartner</span>(loadAllParams).<span class="title function_">then</span>( <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">		partnerlist.<span class="property">value</span> = response.<span class="property">rows</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getPartnerList</span>();</span><br></pre></td></tr></table></figure></div>

<h3 id="4-7-5-添加-修改表单改造"><a href="#4-7-5-添加-修改表单改造" class="headerlink" title="4.7.5 添加&#x2F;修改表单改造"></a>4.7.5 添加&#x2F;修改表单改造</h3><ul>
<li>将上述 下拉式区域搜索、下拉式合作商搜索，应用到表单上。</li>
</ul>
<h3 id="4-7-6-封装-分页参数"><a href="#4-7-6-封装-分页参数" class="headerlink" title="4.7.6 封装 分页参数"></a>4.7.6 封装 分页参数</h3><ul>
<li>在 api 包下，创建 page.js 文件。</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> loadAllParams = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">	<span class="attr">pageNum</span>:<span class="number">1</span>,</span><br><span class="line">	<span class="attr">pagesize</span>:<span class="number">10000</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<ul>
<li>使用时引入。</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; loadAllParams &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/page&quot;</span>;</span><br></pre></td></tr></table></figure></div>

<h3 id="4-7-7-表格组件内容隐藏超出部分"><a href="#4-7-7-表格组件内容隐藏超出部分" class="headerlink" title="4.7.7 表格组件内容隐藏超出部分"></a>4.7.7 表格组件内容隐藏超出部分</h3><ul>
<li>show-overflow-tooltip：表格组件内容隐藏超出部分。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-table-column label=&quot;详细地址&quot; align=&quot;center&quot; prop=&quot;address&quot; show-overflow-tooltip=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="4-7-8在查询点位列表时，关联显示区域、合作商等信息"><a href="#4-7-8在查询点位列表时，关联显示区域、合作商等信息" class="headerlink" title="4.7.8在查询点位列表时，关联显示区域、合作商等信息"></a>4.7.8在查询点位列表时，关联显示区域、合作商等信息</h3><ul>
<li>&lt; association &gt;&lt; &#x2F;association &gt;：一对一、多对一情况下，映射单个结果的集合。</li>
<li>&lt; collection &gt;&lt; &#x2F;collection &gt;：一对多情况下，映射多个结果的集合。</li>
<li>统计点位下的设备用mapper；点位与区域、合作商关联用mybatis。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240715163128188.png"
                      alt="image-20240715163128188"
                ></p>
<h4 id="4-7-8-1-mapper-调用"><a href="#4-7-8-1-mapper-调用" class="headerlink" title="4.7.8.1 mapper 调用"></a>4.7.8.1 mapper 调用</h4><ul>
<li>统计点位下的设备</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	n.id,</span><br><span class="line">	n.node_name,</span><br><span class="line">	n.address,</span><br><span class="line">	n.business_type,</span><br><span class="line">	n.region_id,</span><br><span class="line">	n.partner_id,</span><br><span class="line">	n.create_time,</span><br><span class="line">	n.update_time,</span><br><span class="line">	n.create_by,</span><br><span class="line">	n.update_by,</span><br><span class="line">	n.remank,</span><br><span class="line">	<span class="built_in">COUNT</span>(v.id) <span class="keyword">As</span> vm_count</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	tb_node n</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">	tb_vending_machine v <span class="keyword">ON</span> n.id <span class="operator">=</span> v.node_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	n.id;</span><br></pre></td></tr></table></figure></div>

<h4 id="4-7-8-2-后端编写"><a href="#4-7-8-2-后端编写" class="headerlink" title="4.7.8.2 后端编写"></a>4.7.8.2 后端编写</h4><ul>
<li>在 vo 包下创建 NodeVo 模块</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.dkd.manage.domain.Node;</span><br><span class="line"><span class="keyword">import</span> com.dkd.manage.domain.Partner;</span><br><span class="line"><span class="keyword">import</span> com.dkd.manage.domain.Region;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NodeVo</span> <span class="keyword">extends</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">	<span class="comment">//设备数量</span></span><br><span class="line">	<span class="keyword">private</span> Integer vmCount;</span><br><span class="line">	<span class="comment">//区域信息</span></span><br><span class="line">	<span class="keyword">private</span> Region region;</span><br><span class="line">	<span class="comment">//合作商信息</span></span><br><span class="line">	<span class="keyword">private</span> Partner partner;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>NodeMapper 接口 与 实现</p>
</li>
<li><p>&lt; association property&#x3D;”region” javaType&#x3D;”Region” column&#x3D;”region_id” 											select&#x3D;”com.dkd.manage.mapper.RegionMapper.selectRegionById”  &#x2F;&gt;：</p>
</li>
<li><p>select：连接其他要使用的 mapper 接口；</p>
</li>
<li><p>column：连接本表的字段；</p>
</li>
<li><p>javaType：返回的数据类型；</p>
</li>
<li><p>property：具体映射到的属性名。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;NodeVo&gt; <span class="title function_">selectNodeVolist</span><span class="params">(Node node)</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">&lt;</span>resultMap id<span class="operator">=</span>&quot;NodeVoResult&quot; type<span class="operator">=</span>&quot;NodeVo&quot;<span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;id&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;id&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;nodeName&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;node_name&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;address&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;address&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;businessType&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;business_type&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;regionId&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;region_id&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;partnerId&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;partner_id&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;createTime&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;create_time&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;updateTime&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;update_time&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;createBy&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;create_by&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;updateBy&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;update_by&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;remark&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;remark&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">result</span> property<span class="operator">=</span>&quot;vmCount&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;vm_count&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span>association property<span class="operator">=</span>&quot;region&quot; javaType<span class="operator">=</span>&quot;Region&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;region_id&quot; 											<span class="keyword">select</span><span class="operator">=</span>&quot;com.dkd.manage.mapper.RegionMapper.selectRegionById&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span>association property<span class="operator">=</span>&quot;partner&quot; javaType<span class="operator">=</span>&quot;Partner&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;partner_id&quot; 											<span class="keyword">select</span><span class="operator">=</span>&quot;com.dkd.manage.mapper.PartnerMapper.selectPartnerById&quot; <span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span>resultMap<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">select</span> id<span class="operator">=</span>&quot;selectNodeVoList&quot; resultMap<span class="operator">=</span>&quot;NodeVoResult&quot;<span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">        n.id,</span><br><span class="line">        n.node_name,</span><br><span class="line">        n.address,</span><br><span class="line">        n.business_type,</span><br><span class="line">        n.region_id,</span><br><span class="line">        n.partner_id,</span><br><span class="line">        n.create_time,</span><br><span class="line">        n.update_time,</span><br><span class="line">        n.create_by,</span><br><span class="line">        n.update_by,</span><br><span class="line">        n.remank,</span><br><span class="line">        <span class="built_in">COUNT</span>(v.id) <span class="keyword">As</span> vm_count</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        tb_node n</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">        tb_vending_machine v <span class="keyword">ON</span> n.id <span class="operator">=</span> v.node_id   </span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">where</span><span class="operator">&gt;</span></span><br><span class="line">		<span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;nodeName != null and nodeName !=&#x27;&#x27;&quot;<span class="operator">&gt;</span> <span class="keyword">and</span> n.node_name <span class="keyword">like</span> concat(<span class="string">&#x27;%&#x27;</span>, #&#123;nodeName&#125;, <span class="string">&#x27;%&#x27;</span>)<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">		<span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;regionId != null &quot;<span class="operator">&gt;</span> <span class="keyword">and</span> n.region_id <span class="operator">=</span> #&#123; regionId &#125;<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">		<span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;partnerId != null &quot;<span class="operator">&gt;</span> <span class="keyword">and</span> n.partner_id <span class="operator">=</span> #&#123; partnerId &#125;<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">where</span><span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">        n.id;		</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">select</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>INodeService 与 NodeServiceimpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;NodeVo&gt; <span class="title function_">selectNodeVoList</span><span class="params">(Node node)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;NodeVo&gt; <span class="title function_">selectNodeVoList</span><span class="params">(Node node)</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> nodeMapper.selectNodeVolist(node); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>NodeController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询点位管理列表</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;@ss.hasPermi(&#x27;manage:node:list&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> TableDataInfo <span class="title function_">list</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">	startPage();</span><br><span class="line">	List&lt;NodeVo&gt; voList = nodeService.selectNodeVoList(node);</span><br><span class="line">	<span class="keyword">return</span> getDataTable(voList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="4-7-8-3-前端编写"><a href="#4-7-8-3-前端编写" class="headerlink" title="4.7.8.3 前端编写"></a>4.7.8.3 前端编写</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-table-column label=&quot;所在区域&quot; align=&quot;center&quot; prop=&quot;region.regionName&quot; /&gt;</span><br><span class="line">&lt;el-table-column label=&quot;合作商&quot; align=&quot;center&quot; prop=&quot;partner.partnerName&quot; /&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="4-8-区域查看详情"><a href="#4-8-区域查看详情" class="headerlink" title="4.8 区域查看详情"></a>4.8 区域查看详情</h2><h3 id="4-8-1-需求说明"><a href="#4-8-1-需求说明" class="headerlink" title="4.8.1 需求说明"></a>4.8.1 需求说明</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716182959781.png"
                      alt="image-20240716182959781"
                ></p>
<h3 id="4-8-2-前端编写"><a href="#4-8-2-前端编写" class="headerlink" title="4.8.2 前端编写"></a>4.8.2 前端编写</h3><ul>
<li>views \ manage \ region</li>
<li>disabled：意味着输入框不可用。</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-button link type=<span class="string">&quot;primary&quot;</span> @click=<span class="string">&quot;getRegionInfo(scope.row)&quot;</span> v-hasPermi=<span class="string">&quot;[&#x27;manage:node:list&#x27;]&quot;</span>&gt;查看详情&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 查看详情对话框 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;区域详情&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;regionInfoOpen&quot;</span> <span class="attr">width</span>=<span class="string">&quot;500px&quot;</span> <span class="attr">append-to-body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;区域名称&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;regionName&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">e1-input</span> <span class="attr">v-model</span>=<span class="string">&quot;form.regionName&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入区域名称&quot;</span>/ <span class="attr">disabled</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">label</span>&gt;</span>包含点位:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">el-table</span> <span class="attr">:data</span>=<span class="string">&quot;nodeList”&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">		&lt;el-table-column label=&quot;</span><span class="attr">序号</span>&quot; <span class="attr">type</span>=<span class="string">&quot;index&quot;</span> <span class="attr">width</span>=<span class="string">&quot;50&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;点位名称&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;nodeName&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;设备数量&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;vmCount&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">import &#123; listNode &#125; from &quot;@/api/manage/node&quot;;</span></span><br><span class="line"><span class="language-xml">import &#123; loadAllParams &#125; from &quot;@/api/page&quot;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">/*查看详情操作按钮*/</span></span><br><span class="line"><span class="language-xml">const regionInfoOpen = ref(false); //对话框开关</span></span><br><span class="line"><span class="language-xml">const nodeList = ref([]);</span></span><br><span class="line"><span class="language-xml">function getRegionInfo(row)&#123;</span></span><br><span class="line"><span class="language-xml">	//查询区域信息</span></span><br><span class="line"><span class="language-xml">	reset();</span></span><br><span class="line"><span class="language-xml">	const _id = row.id;</span></span><br><span class="line"><span class="language-xml">	getRegion(_id).then(response =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">		form.value = response.data;</span></span><br><span class="line"><span class="language-xml">	&#125;);</span></span><br><span class="line"><span class="language-xml">	//查看点位列表</span></span><br><span class="line"><span class="language-xml">	loadAllParams.regionId = row.id;</span></span><br><span class="line"><span class="language-xml">	listNode(loadAllParams).then(response =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">		nodeList.value = response.rows;</span></span><br><span class="line"><span class="language-xml">	&#125;);</span></span><br><span class="line"><span class="language-xml">	regionInfoOpen.value = true;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="4-9-数据完整性"><a href="#4-9-数据完整性" class="headerlink" title="4.9 数据完整性"></a>4.9 数据完整性</h2><h3 id="4-9-1-父子表关联"><a href="#4-9-1-父子表关联" class="headerlink" title="4.9.1 父子表关联"></a>4.9.1 父子表关联</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716194211078.png"
                      alt="image-20240716194211078"
                ></p>
<h3 id="4-9-2-修改父子表关联"><a href="#4-9-2-修改父子表关联" class="headerlink" title="4.9.2 修改父子表关联"></a>4.9.2 修改父子表关联</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716200000902.png"
                      alt="image-20240716200000902"
                ></p>
<h3 id="4-9-3-全局异常处理器，捕获并处理异常"><a href="#4-9-3-全局异常处理器，捕获并处理异常" class="headerlink" title="4.9.3 全局异常处理器，捕获并处理异常"></a>4.9.3 全局异常处理器，捕获并处理异常</h3><ul>
<li><p>SQLntegrityConstraintViolationException：这个类通常用于表示 SQL 数据库操作中的完整性约束违反异常。</p>
</li>
<li><p>例如：外键约束、唯一约束等。当数据库操作违反了这些约束时，就会抛出这个异常。</p>
</li>
<li><p>DatalntegrityViolationException：在使用 SpringBoot 框架时，如果违反了数据完整性抛出这个异常。</p>
</li>
<li><p>dkd-framework \ web \ exception \ GlobalExceptionHandler</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据完整性异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExceptionHandler(DataIntegrityViolationException.class)</span></span><br><span class="line"><span class="keyword">public</span> AiaxResult <span class="title function_">handleDataIntegrityViolationException</span><span class="params">(DataIntegrityViolationException e)</span></span><br><span class="line">&#123;</span><br><span class="line">	log.error(e.getMessage(), e);</span><br><span class="line">	<span class="keyword">if</span>(e.getMessage().contains(<span class="string">&quot;foreign&quot;</span>))&#123;</span><br><span class="line">		<span class="keyword">return</span> AjaxResult.error(<span class="string">&quot;无法删除，有其他数据引用&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> AjaxResult.error(<span class="string">&quot;数据完整性异常，请联系管理员&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="4-10-点位查看详情"><a href="#4-10-点位查看详情" class="headerlink" title="4.10 点位查看详情"></a>4.10 点位查看详情</h2><h3 id="4-10-1-需求说明"><a href="#4-10-1-需求说明" class="headerlink" title="4.10.1 需求说明"></a>4.10.1 需求说明</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240722150631342.png"
                      alt="image-20240722150631342"
                ></p>
<h3 id="4-10-2-前端编写"><a href="#4-10-2-前端编写" class="headerlink" title="4.10.2 前端编写"></a>4.10.2 前端编写</h3><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-button link type=<span class="string">&quot;primary&quot;</span> @click=<span class="string">&quot;getNodeInfo(scope.row)&quot;</span> v-hasPermi=<span class="string">&quot;[&#x27;manage:vm:list&#x27;]&quot;</span>&gt;查看详情</span><br><span class="line">&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 查看详情对话框 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;点位详情 &quot;</span><span class="attr">v-model</span>=<span class="string">&quot;nodeOpen&quot;</span> <span class="attr">width</span>=<span class="string">&quot;500px&quot;</span> <span class="attr">append-to-body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">el-table</span> <span class="attr">:data</span>=<span class="string">&quot;vmList&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;序号&quot;</span> <span class="attr">type</span>=<span class="string">&quot;index&quot;</span> <span class="attr">width</span>=<span class="string">&quot;55&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;设备编号&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;innerCode&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;设备状态&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;vmStatus&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">				<span class="tag">&lt;<span class="name">dict-tag</span> <span class="attr">:options</span>=<span class="string">&quot;vm_status&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;scope.row.vmStatus&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;最后一次供货时间&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;vmstatus&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">				&#123;&#123; parseTime(scope.row.lastSupplyTime,&#x27;&#123;y&#125;-&#123;m&#125;-&#123;d&#125; &#123;h&#125;:&#123;i&#125;:&#123;s&#125;&#x27;) &#125;&#125;</span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; listVm &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/manage/vm&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; vm_status &#125; = proxy.<span class="title function_">useDict</span>(<span class="string">&#x27;vm_status&#x27;</span>); <span class="comment">//设备状态字典</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查看详情 */</span></span><br><span class="line"><span class="keyword">const</span> nodeOpen = <span class="title function_">ref</span>(<span class="literal">false</span>); <span class="comment">//对话框开关</span></span><br><span class="line"><span class="keyword">const</span> vmList = <span class="title function_">ref</span>([]);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getNodeInfo</span>(<span class="params">row</span>)&#123;</span><br><span class="line">	<span class="comment">//根据点位，查询设备列表</span></span><br><span class="line">	loadAllParams.<span class="property">nodeId</span> = row.<span class="property">id</span>;</span><br><span class="line">	<span class="title function_">listVm</span>(loadAllParams).<span class="title function_">then</span>( <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">		vmList.<span class="property">value</span> = response.<span class="property">rows</span>;</span><br><span class="line">		nodeOpen.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="5-人员管理"><a href="#5-人员管理" class="headerlink" title="5. 人员管理"></a>5. 人员管理</h1><h2 id="5-1-需求说明"><a href="#5-1-需求说明" class="headerlink" title="5.1 需求说明"></a>5.1 需求说明</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716200407504.png"
                      alt="image-20240716200407504"
                ></p>
<h2 id="5-2-库表设计"><a href="#5-2-库表设计" class="headerlink" title="5.2 库表设计"></a>5.2 库表设计</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716203747202.png"
                      alt="image-20240716203747202"
                ></p>
<h2 id="5-3-生成基础代码"><a href="#5-3-生成基础代码" class="headerlink" title="5.3 生成基础代码"></a>5.3 生成基础代码</h2><h3 id="5-3-1-创建目录菜单"><a href="#5-3-1-创建目录菜单" class="headerlink" title="5.3.1 创建目录菜单"></a>5.3.1 创建目录菜单</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716204931308.png"
                      alt="image-20240716204931308"
                ></p>
<h3 id="5-3-2-添加数据字典"><a href="#5-3-2-添加数据字典" class="headerlink" title="5.3.2 添加数据字典"></a>5.3.2 添加数据字典</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716205741398.png"
                      alt="image-20240716205741398"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716205808836.png"
                      alt="image-20240716205808836"
                ></p>
<h3 id="5-3-3-配置代码生成信息"><a href="#5-3-3-配置代码生成信息" class="headerlink" title="5.3.3 配置代码生成信息"></a>5.3.3 配置代码生成信息</h3><ul>
<li>点击 代码生成，导入 生成的两张表。</li>
</ul>
<h4 id="5-3-3-1-人员列表"><a href="#5-3-3-1-人员列表" class="headerlink" title="5.3.3.1 人员列表"></a>5.3.3.1 人员列表</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716211517617.png"
                      alt="image-20240716211517617"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716212218433.png"
                      alt="image-20240716212218433"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716212402041.png"
                      alt="image-20240716212402041"
                ></p>
<h4 id="5-3-3-2-工单角色表"><a href="#5-3-3-2-工单角色表" class="headerlink" title="5.3.3.2 工单角色表"></a>5.3.3.2 工单角色表</h4><ul>
<li>不需要前端页面。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716212601454.png"
                      alt="image-20240716212601454"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240716212705481.png"
                      alt="image-20240716212705481"
                ></p>
<h2 id="5-4-下载代码并导入项目"><a href="#5-4-下载代码并导入项目" class="headerlink" title="5.4 下载代码并导入项目"></a>5.4 下载代码并导入项目</h2><ul>
<li>会生成一个 main，一个 vue，两个 sql。</li>
<li>只把 empMenu .sql 文件导入数据库。</li>
<li>vue 文件中的 api .manage 导入 api 中，views .manage .emp导入 views  .manage中，而另一个舍弃。</li>
<li>main 文件中的 java 导入 dkd-manage .java 中，resources 导入 dkd-manage .resources 中。</li>
</ul>
<h2 id="5-5-人员列表改造"><a href="#5-5-人员列表改造" class="headerlink" title="5.5 人员列表改造"></a>5.5 人员列表改造</h2><h3 id="5-5-1-自排序序号"><a href="#5-5-1-自排序序号" class="headerlink" title="5.5.1 自排序序号"></a>5.5.1 自排序序号</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">原：</span><br><span class="line">&lt;el-table-column label=&quot;主键id&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;</span><br><span class="line">改：</span><br><span class="line">&lt;el-table-column label=&quot;序号&quot; type=&quot;index&quot; width=&quot;50&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="5-5-2-图标移除"><a href="#5-5-2-图标移除" class="headerlink" title="5.5.2 图标移除"></a>5.5.2 图标移除</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">原：</span><br><span class="line">&lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">	&lt;el-button link type=&quot;primary&quot; icon=&quot;Edit&quot; @click=&quot;handleUpdate (scope.row)&quot; v-hasPermi=&quot;		[&#x27;manage:emp:edit&#x27;]&quot;&gt;修改&lt;/el-button&gt;</span><br><span class="line">	&lt;el-button link type=&quot;primary&quot; icon=&quot;Delete&quot; @click=&quot;handleDelete (scope.row)&quot; v-haspermi=&quot;[&#x27;manage:emp:remove&#x27;]&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">改：</span><br><span class="line">将 icon=&quot;Edit&quot; 与 icon=&quot;Delete&quot; 移除</span><br></pre></td></tr></table></figure></div>

<h3 id="5-5-3-添加-修改表单改造"><a href="#5-5-3-添加-修改表单改造" class="headerlink" title="5.5.3 添加&#x2F;修改表单改造"></a>5.5.3 添加&#x2F;修改表单改造</h3><ul>
<li>下拉式角色选择</li>
<li>下拉式区域选择</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-form-item label=<span class="string">&quot;角色&quot;</span> prop=<span class="string">&quot;roleId&quot;</span>&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;form.roleld&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择角色&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">el-option</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">v-for</span>=<span class="string">&quot;item in roleList&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">:key</span>=<span class="string">&quot;item.roleId&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">:label</span>=<span class="string">&quot;item.roleName&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">:value</span>=<span class="string">&quot;item.roleId&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">		/&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span></span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;负责区域&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;regionId&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;form.regionId&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择负责区域&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">e1-option</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">v-for</span>=<span class="string">&quot;item in regionList&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">:label</span>=<span class="string">&quot;item.reqionName&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">:value</span>=<span class="string">&quot;item.id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">		/&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;创建时间&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;mobile&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;form.id != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	&#123;&#123; form.createTime &#125;&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; listRole &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/manage/role&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; listRegion &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/manage/region&quot;</span>;</span><br><span class="line"><span class="keyword">import</span>&#123; loadAllParams &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/page&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查询角色列表*/</span></span><br><span class="line"><span class="keyword">const</span> rolelist = <span class="title function_">ref</span>([]);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRoleList</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="title function_">listRole</span>(loadAllParams).<span class="title function_">then</span>( <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">		rolelist.<span class="property">value</span> = response.<span class="property">rows</span>;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查询区域列表 */</span></span><br><span class="line"><span class="keyword">const</span> regionlist = <span class="title function_">ref</span>([]);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRegionList</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="title function_">listRegion</span>(loadAllParams).<span class="title function_">then</span>( <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">		regionlist.<span class="property">value</span> = response.<span class="property">rows</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getRegionList</span>();    </span><br><span class="line"><span class="title function_">getRoleList</span>();</span><br></pre></td></tr></table></figure></div>

<h3 id="5-5-4-联合新增、修改"><a href="#5-5-4-联合新增、修改" class="headerlink" title="5.5.4 联合新增、修改"></a>5.5.4 联合新增、修改</h3><ul>
<li>EmpServicelmpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowiredprivate</span> </span><br><span class="line">RegionMapper regionMapper;</span><br><span class="line"><span class="meta">@Autowiredprivate</span> </span><br><span class="line">RoleMapper roleMapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">//新增人员列表</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertEmp</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">    <span class="comment">// 补充区域名称</span></span><br><span class="line">	emp.setRegionName(regionMapper.selectRegionById(emp.getRegionId()).getRegionName());</span><br><span class="line">	<span class="comment">// 补充角色信息</span></span><br><span class="line">	<span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> roleMapper.selectRoleByRoleId(emp.getRoleId());</span><br><span class="line">    emp.setRoleName(role.getRoleName());</span><br><span class="line">    emp.setRoleCode(role.getRoleCode());</span><br><span class="line">    </span><br><span class="line">	emp.setCreateTime(DateUtils.getNowDate());</span><br><span class="line">	<span class="keyword">return</span> empMapper.insertEmp(emp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改人员列表</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateEmp</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">    <span class="comment">// 补充区域名称</span></span><br><span class="line">	emp.setRegionName(regionMapper.selectRegionById(emp.getRegionId()).getRegionName());</span><br><span class="line">	<span class="comment">// 补充角色信息</span></span><br><span class="line">	<span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> roleMapper.selectRoleByRoleId(emp.getRoleId());</span><br><span class="line">    emp.setRoleName(role.getRoleName());</span><br><span class="line">    emp.setRoleCode(role.getRoleCode());</span><br><span class="line">    </span><br><span class="line">	emp.setUpdateTime(DateUtils.getNowDate());</span><br><span class="line">    <span class="keyword">return</span> empMapper.updateEmp(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="5-5-5-同步存储"><a href="#5-5-5-同步存储" class="headerlink" title="5.5.5 同步存储"></a>5.5.5 同步存储</h3><h4 id="5-5-5-1-方案"><a href="#5-5-5-1-方案" class="headerlink" title="5.5.5.1 方案"></a>5.5.5.1 方案</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240717152105073.png"
                      alt="image-20240717152105073"
                ></p>
<h4 id="5-5-5-2-后端编写"><a href="#5-5-5-2-后端编写" class="headerlink" title="5.5.5.2 后端编写"></a>5.5.5.2 后端编写</h4><ul>
<li>EmpMapper</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据区域id修改区域名称</span></span><br><span class="line"><span class="meta">@Update(&quot;update tb_emp set region_name=#&#123;regionName&#125; where region_id=#&#123;regionId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateByRegionId</span><span class="params">(<span class="meta">@Param(&quot;regionName&quot;)</span>String regionName,<span class="meta">@Param(&quot;regionId&quot;)</span>Long regionId)</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>RegionServicelmpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改区域管理</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateRegion</span><span class="params">(Region region)</span> &#123;</span><br><span class="line">    <span class="comment">//先更新区域信息</span></span><br><span class="line">    region.setUpdateTime(DateUtils.getNowDate());</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> regionMapper.updateRegion(region);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//同步更新员工表区域名称</span></span><br><span class="line">    empMapper.updateByRegionId(region.getRegionName(),region.getId());</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="5-6-文件存储"><a href="#5-6-文件存储" class="headerlink" title="5.6 文件存储"></a>5.6 文件存储</h2><h3 id="5-6-1-阿里云OSS准备"><a href="#5-6-1-阿里云OSS准备" class="headerlink" title="5.6.1 阿里云OSS准备"></a>5.6.1 阿里云OSS准备</h3><ul>
<li>注册阿里云（实名认证）。</li>
<li>开通对象存储服务（OSS）。</li>
<li>创建 Bucket。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240717162222336.png"
                      alt="image-20240717162222336"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240717162142435.png"
                      alt="image-20240717162142435"
                ></p>
<ul>
<li>获取并配置 AccessKey （秘钥）。</li>
<li>配置AK &amp; SK。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240717165057260.png"
                      alt="image-20240717165057260"
                ></p>
<h3 id="5-6-2-阿里云OSS入门"><a href="#5-6-2-阿里云OSS入门" class="headerlink" title="5.6.2 阿里云OSS入门"></a>5.6.2 阿里云OSS入门</h3><ul>
<li><p>找到 SDK 下载，找到 java SDK。</p>
</li>
<li><p>安装 SDK。</p>
</li>
<li><p>dkd-common \ pom.xml</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--阿里云OSS--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.15.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>找到 对象&#x2F;文件，找到 上传文件，找到 简单上传，找到 上传文件流，复制代码到新建模块。</li>
<li>新建模块。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240717190415000.png"
                      alt="image-20240717190415000"
                ></p>
<ul>
<li>简单介绍。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240717190943239.png"
                      alt="image-20240717190943239"
                ></p>
<h3 id="5-6-3-集成x-file-storage"><a href="#5-6-3-集成x-file-storage" class="headerlink" title="5.6.3 集成x-file-storage"></a>5.6.3 集成x-file-storage</h3><h4 id="5-6-3-1-介绍"><a href="#5-6-3-1-介绍" class="headerlink" title="5.6.3.1 介绍"></a>5.6.3.1 介绍</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240717192228744.png"
                      alt="image-20240717192228744"
                ></p>
<h4 id="5-6-3-2-引入依赖"><a href="#5-6-3-2-引入依赖" class="headerlink" title="5.6.3.2 引入依赖"></a>5.6.3.2 引入依赖</h4><ul>
<li>在 dkd-common \ pom.xml 中引入依赖与对应平台依赖。</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.dromara.x-file-storage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>x-file-storage-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--阿里云OSS--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.16.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>在 dkd-admin \ resources \ application.yml 中添加基础配置。</li>
<li>将默认使用的存储平台 修改为 要使用的 存储平台标识。</li>
<li>可以配置多个平台。</li>
</ul>
<div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 文件上传</span></span><br><span class="line"><span class="attr">dromara:</span></span><br><span class="line">  <span class="attr">x-file-storage:</span> <span class="comment">#文件存储配置</span></span><br><span class="line">    <span class="attr">default-platform:</span> <span class="string">aliyun-oss-1</span> <span class="comment">#默认使用的存储平台</span></span><br><span class="line">    <span class="attr">thumbnail-suffix:</span> <span class="string">&quot;.min.jpg&quot;</span> <span class="comment">#缩略图后缀，例如【.min.jpg】【.png】</span></span><br><span class="line">    <span class="comment">#对应平台的配置写在这里，注意缩进要对齐</span></span><br><span class="line">    <span class="attr">aliyun-oss:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">aliyun-oss-1</span> <span class="comment"># 存储平台标识</span></span><br><span class="line">        <span class="attr">enable-storage:</span> <span class="literal">true</span>  <span class="comment"># 启用存储</span></span><br><span class="line">        <span class="attr">access-key:</span> <span class="string">??</span> <span class="comment"># 自己修改</span></span><br><span class="line">        <span class="attr">secret-key:</span> <span class="string">??</span> <span class="comment"># 自己修改</span></span><br><span class="line">        <span class="attr">end-point:</span> <span class="string">oss-cn-beijing.aliyuncs.com</span> </span><br><span class="line">        <span class="attr">bucket-name:</span> <span class="string">dkd-itheima</span></span><br><span class="line">        <span class="attr">domain:</span> <span class="string">https://dkd-itheima.oss-cn-beijing.aliyuncs.com/</span> <span class="comment"># 访问域名，注意“/”结尾，例如：https://abc.oss-cn-shanghai.aliyuncs.com/</span></span><br><span class="line">        <span class="attr">base-path:</span> <span class="string">dkd-images/</span> <span class="comment"># 基础路径</span></span><br></pre></td></tr></table></figure></div>

<h4 id="5-6-3-3-编码"><a href="#5-6-3-3-编码" class="headerlink" title="5.6.3.3 编码"></a>5.6.3.3 编码</h4><ul>
<li>在启动类上添加注解。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">@EnableFileStorage</span><br></pre></td></tr></table></figure></div>

<ul>
<li>业务代码</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 上传文件，成功返回文件 url</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/upload2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">upload2</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">    <span class="type">FileInfo</span> <span class="variable">fileInfo</span> <span class="operator">=</span> fileStorageService.of(file)</span><br><span class="line">            .setPath(<span class="string">&quot;upload/&quot;</span>) <span class="comment">//保存到相对路径下，为了方便管理，不需要可以不写</span></span><br><span class="line">            .setSaveFilename(<span class="string">&quot;image.jpg&quot;</span>) <span class="comment">//设置保存的文件名，不需要可以不写，会随机生成</span></span><br><span class="line">            .setObjectId(<span class="string">&quot;0&quot;</span>)   <span class="comment">//关联对象id，为了方便管理，不需要可以不写</span></span><br><span class="line">            .setObjectType(<span class="string">&quot;0&quot;</span>) <span class="comment">//关联对象类型，为了方便管理，不需要可以不写</span></span><br><span class="line">            .putAttr(<span class="string">&quot;role&quot;</span>,<span class="string">&quot;admin&quot;</span>) <span class="comment">//保存一些属性，可以在切面、保存上传记录、自定义存储平台等地方获取使用，不需要可以不写</span></span><br><span class="line">            .upload();  <span class="comment">//将文件上传到对应地方</span></span><br><span class="line">    <span class="keyword">return</span> fileInfo == <span class="literal">null</span> ? <span class="string">&quot;上传失败！&quot;</span> : fileInfo.getUrl();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="5-6-4-修改若依自带文件上传代码"><a href="#5-6-4-修改若依自带文件上传代码" class="headerlink" title="5.6.4 修改若依自带文件上传代码"></a>5.6.4 修改若依自带文件上传代码</h3><h4 id="5-6-4-1-后端编写"><a href="#5-6-4-1-后端编写" class="headerlink" title="5.6.4.1 后端编写"></a>5.6.4.1 后端编写</h4><ul>
<li>原型</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">uploadFile</span><span class="params">(MultipartFile file)</span> throwss Exception</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">    	<span class="comment">//上传文件路径</span></span><br><span class="line">    	<span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> RuoYiconfig.getUploadPath();</span><br><span class="line">    	<span class="comment">//上传并返回新文件名称</span></span><br><span class="line">    	<span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> FileUploadutils.upload(filePath, file);</span><br><span class="line">    	String url= serverConfig.getUrl() + fileName;</span><br><span class="line">    	<span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">    	ajax.put(<span class="string">&quot;url&quot;</span>,url);</span><br><span class="line">    	ajax.put(<span class="string">&quot;fileName&quot;</span>,fileName); <span class="comment">//文件名</span></span><br><span class="line">        ajax.put(<span class="string">&quot;newFileName&quot;</span>,FileUtils.getName(fileName)); <span class="comment">//新文件名</span></span><br><span class="line">        ajax.put(<span class="string">&quot;originalFilename&quot;</span>,file.getOriginalFilename()); <span class="comment">//原始文件名</span></span><br><span class="line">        <span class="keyword">return</span> ajax;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>修改</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> FileStorageService fileStorageService;<span class="comment">//注入实列</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">uploadFile</span><span class="params">(MultipartFile file)</span> throwss Exception</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//指定oss保存文件路径 dkd-images/2024/06/19/文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> LocalDate.now().format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy/MM/dd&quot;</span>))+ <span class="string">&quot;/&quot;</span>;</span><br><span class="line">        <span class="comment">//上传图片，返回文件信息</span></span><br><span class="line">		<span class="type">FileInfo</span> <span class="variable">fileInfo</span> <span class="operator">=</span> filestorageService.of(file)</span><br><span class="line">            .setPath(objectName)</span><br><span class="line">            .upload();</span><br><span class="line">    	<span class="type">AjaxResult</span> <span class="variable">ajax</span> <span class="operator">=</span> AjaxResult.success();</span><br><span class="line">    	ajax.put(<span class="string">&quot;url&quot;</span>,fileInfo.getUrl());</span><br><span class="line">    	ajax.put(<span class="string">&quot;fileName&quot;</span>,fileInfo.getUrl()); <span class="comment">//注意:这里的值需要改为URL，因为前端的访问地址会做一个判断，如果一http开头-就直接显示图片</span></span><br><span class="line">        ajax.put(<span class="string">&quot;newFileName&quot;</span>,fileInfo.getUrl());</span><br><span class="line">        ajax.put(<span class="string">&quot;originalFilename&quot;</span>,file.getOriginalFilename());</span><br><span class="line">        <span class="keyword">return</span> ajax;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="5-6-4-2-前端编写"><a href="#5-6-4-2-前端编写" class="headerlink" title="5.6.4.2 前端编写"></a>5.6.4.2 前端编写</h4><ul>
<li>当以 http 开头的文件，会直接回显，不需要再与若依自带的 “ http: &#x2F;&#x2F;localhost &#x2F;dev-api “ 拼接。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240711211643638.png"
                      alt="image-20240711211643638"
                ></p>
<h1 id="6-设备管理"><a href="#6-设备管理" class="headerlink" title="6. 设备管理"></a>6. 设备管理</h1><h2 id="6-1-需求说明"><a href="#6-1-需求说明" class="headerlink" title="6.1 需求说明"></a>6.1 需求说明</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718165316077.png"
                      alt="image-20240718165316077"
                ></p>
<h2 id="6-2-库表设计"><a href="#6-2-库表设计" class="headerlink" title="6.2 库表设计"></a>6.2 库表设计</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718170811877.png"
                      alt="image-20240718170811877"
                ></p>
<h2 id="6-3-生成基础代码"><a href="#6-3-生成基础代码" class="headerlink" title="6.3 生成基础代码"></a>6.3 生成基础代码</h2><h3 id="6-3-1-创建目录菜单"><a href="#6-3-1-创建目录菜单" class="headerlink" title="6.3.1 创建目录菜单"></a>6.3.1 创建目录菜单</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718182224878.png"
                      alt="image-20240718182224878"
                ></p>
<h3 id="6-3-2-添加字典数据"><a href="#6-3-2-添加字典数据" class="headerlink" title="6.3.2 添加字典数据"></a>6.3.2 添加字典数据</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718182749400.png"
                      alt="image-20240718182749400"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718183111398.png"
                      alt="image-20240718183111398"
                ></p>
<h3 id="6-3-3-配置代码生成信息"><a href="#6-3-3-配置代码生成信息" class="headerlink" title="6.3.3 配置代码生成信息"></a>6.3.3 配置代码生成信息</h3><ul>
<li>点击 代码生成，导入 生成的三张表。</li>
</ul>
<h4 id="6-3-3-1-设备类型管理"><a href="#6-3-3-1-设备类型管理" class="headerlink" title="6.3.3.1 设备类型管理"></a>6.3.3.1 设备类型管理</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718184621276.png"
                      alt="image-20240718184621276"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718184850993.png"
                      alt="image-20240718184850993"
                ></p>
<h4 id="6-3-3-2-设备管理"><a href="#6-3-3-2-设备管理" class="headerlink" title="6.3.3.2 设备管理"></a>6.3.3.2 设备管理</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718213658452.png"
                      alt="image-20240718213658452"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718213745682.png"
                      alt="image-20240718213745682"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718214020631.png"
                      alt="image-20240718214020631"
                ></p>
<h4 id="6-3-3-3-售货机货道表"><a href="#6-3-3-3-售货机货道表" class="headerlink" title="6.3.3.3 售货机货道表"></a>6.3.3.3 售货机货道表</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718214152716.png"
                      alt="image-20240718214152716"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240718214226795.png"
                      alt="image-20240718214226795"
                ></p>
<h2 id="6-4-下载代码并导入项目"><a href="#6-4-下载代码并导入项目" class="headerlink" title="6.4 下载代码并导入项目"></a>6.4 下载代码并导入项目</h2><ul>
<li><p>会生成一个 main，一个 vue，三个 sql。</p>
</li>
<li><p>把 vmMenu .sql、vmTypeMenu .sql 文件导入数据库。</p>
</li>
<li><p>vue 文件中的 api .manage 中的 vm .js、vmType .js 导入 api 中，views .manage 中的 vm、vmType 导入 views  .manage中。</p>
</li>
<li><p>main 文件中的 java 导入 dkd-manage .java 中，resources 导入 dkd-manage .resources 中。</p>
</li>
</ul>
<h2 id="6-5-设备类型改造"><a href="#6-5-设备类型改造" class="headerlink" title="6.5 设备类型改造"></a>6.5 设备类型改造</h2><h3 id="6-5-1-移除图标、序号"><a href="#6-5-1-移除图标、序号" class="headerlink" title="6.5.1 移除图标、序号"></a>6.5.1 移除图标、序号</h3><ul>
<li>和上面一样。</li>
</ul>
<h3 id="6-5-2-新增-修改表单改造"><a href="#6-5-2-新增-修改表单改造" class="headerlink" title="6.5.2 新增&#x2F;修改表单改造"></a>6.5.2 新增&#x2F;修改表单改造</h3><h4 id="6-5-2-1-设备容量"><a href="#6-5-2-1-设备容量" class="headerlink" title="6.5.2.1 设备容量"></a>6.5.2.1 设备容量</h4><ul>
<li>改为数字输入框，容量为1~10。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;设备容量&quot; prop=&quot;channelMaxCapacity&quot;&gt;</span><br><span class="line">	&lt;el-input-number</span><br><span class="line">		v-model=&quot;form.channelMaxCapacity&quot;</span><br><span class="line">		:min=&quot;1&quot;</span><br><span class="line">		:max=&quot;10&quot;</span><br><span class="line">		placeholder=&quot;请输入设备容量&quot;</span><br><span class="line">	/&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="6-5-2-2-货道数"><a href="#6-5-2-2-货道数" class="headerlink" title="6.5.2.2 货道数"></a>6.5.2.2 货道数</h4><ul>
<li>改为数字输入框，容量为1~10。</li>
<li>两个在同一行。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;货道数&quot; prop=&quot;vmRow&quot;&gt;</span><br><span class="line">	&lt;el-input-number :min=&quot;1&quot; :max=&quot;10&quot; v-model=&quot;form.vmRow&quot; placeholder=&quot;请输入货道行&quot;/&gt;行 &amp;nbsp;&amp;nbsp;</span><br><span class="line">	&lt;e1-input-number :min=&quot;1&quot; :max=&quot;10&quot; v-model=&quot;form.vmCol&quot; placeholder=&quot;请输入货道列&quot;/&gt;列</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="6-6-设备管理改造"><a href="#6-6-设备管理改造" class="headerlink" title="6.6 设备管理改造"></a>6.6 设备管理改造</h2><h3 id="6-6-1-移除图标、删除方法"><a href="#6-6-1-移除图标、删除方法" class="headerlink" title="6.6.1 移除图标、删除方法"></a>6.6.1 移除图标、删除方法</h3><ul>
<li>和上面一样。</li>
</ul>
<h3 id="6-6-2-在查询设备列表时，关联显示设备型号、合作商等信息"><a href="#6-6-2-在查询设备列表时，关联显示设备型号、合作商等信息" class="headerlink" title="6.6.2 在查询设备列表时，关联显示设备型号、合作商等信息"></a>6.6.2 在查询设备列表时，关联显示设备型号、合作商等信息</h3><h4 id="6-6-2-1-前端编写"><a href="#6-6-2-1-前端编写" class="headerlink" title="6.6.2.1 前端编写"></a>6.6.2.1 前端编写</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-table-column label=<span class="string">&quot;设备型号&quot;</span> align=<span class="string">&quot;center&quot;</span> prop=<span class="string">&quot;vmTypeId&quot;</span>&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;item in vmTypeList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;item.id == scope.row.vmTypeId&quot;</span>&gt;</span>&#123;&#123; item.name &#125; &#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line">&lt;/el-table-column&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;合作商&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;partnerId&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;item in partnerlist&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;item.id == scope.row.partnerId&quot;</span>&gt;</span>&#123;&#123; item.partnerName &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; listVmType &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/manage/vmType&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; listPartner &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/manage/partner&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; loadAllParams &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/page&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 查询设备类型列表 */</span></span><br><span class="line"><span class="keyword">const</span> vmTypeList = <span class="title function_">ref</span>([]);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getVmTypeList</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="title function_">listVmType</span>(loadAllParams).<span class="title function_">then</span>( <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">		vmTypeList.<span class="property">value</span> = response.<span class="property">rows</span>;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*查询合作商列表*/</span></span><br><span class="line"><span class="keyword">const</span> partnerList = <span class="title function_">ref</span>([]);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPartnerList</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="title function_">listPartner</span>(loadAllParams).<span class="title function_">then</span>( <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">		partnerlist.<span class="property">value</span> = response.<span class="property">rows</span>;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">vmTypeList</span>();</span><br><span class="line"><span class="title function_">partnerList</span>();</span><br></pre></td></tr></table></figure></div>

<h3 id="6-6-3-添加表单改造"><a href="#6-6-3-添加表单改造" class="headerlink" title="6.6.3 添加表单改造"></a>6.6.3 添加表单改造</h3><h4 id="6-6-3-1-设备编号"><a href="#6-6-3-1-设备编号" class="headerlink" title="6.6.3.1 设备编号"></a>6.6.3.1 设备编号</h4><ul>
<li>如果为空，设备编号自动生成；如果不为空，只回显，不能修改。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;设备编号&quot; prop=&quot;innerCode&quot;&gt;</span><br><span class="line">	&lt;span&gt;&#123;&#123; form.innerCode == nu1l ?&#x27;系统自动生成&#x27; :form.innerCode &#125;&#125;&lt;/span&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="6-6-3-2-选择型号"><a href="#6-6-3-2-选择型号" class="headerlink" title="6.6.3.2 选择型号"></a>6.6.3.2 选择型号</h4><ul>
<li>改为下拉框。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;选择型号&quot; prop=&quot;vmTypeld&quot; v-if=&quot;form.innerCode == null&quot;&gt;</span><br><span class="line">	&lt;el-select v-model=&quot;form.vmTypeId&quot; placeholder=&quot;请选择设备型号&quot;&gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">            v-for=&quot;item in vmTypeList&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label=&quot;item.name&quot;</span><br><span class="line">            :value=&quot;item.id&quot; /&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="6-6-3-3-选择点位"><a href="#6-6-3-3-选择点位" class="headerlink" title="6.6.3.3 选择点位"></a>6.6.3.3 选择点位</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-form-item label=<span class="string">&quot;选择点位&quot;</span> prop=<span class="string">&quot;nodeId&quot;</span> v-<span class="keyword">if</span>=<span class="string">&quot;form.innerCode == null&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;form.nodeId&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择点位&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-option</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">v-for</span>=<span class="string">&quot;item in nodelist&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">:label</span>=<span class="string">&quot;item.nodeName&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">			<span class="attr">:value</span>=<span class="string">&quot;item.id&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span></span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; listNode &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/manage/node&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*查询点位列表*/</span></span><br><span class="line"><span class="keyword">const</span> nodeList = <span class="title function_">ref</span>([]);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getNodeList</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="title function_">listNode</span>(loadAllParams).<span class="title function_">then</span>( <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">		nodeList.<span class="property">value</span> = response.<span class="property">rows</span>;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getNodeList</span>();</span><br></pre></td></tr></table></figure></div>

<h3 id="6-6-4-修改表单改造"><a href="#6-6-4-修改表单改造" class="headerlink" title="6.6.4 修改表单改造"></a>6.6.4 修改表单改造</h3><ul>
<li>添加与修改是一个表单，但有条件筛选，如果 设备编号 不为空，则显示修改表单的东西。</li>
<li>parseTime()：将时间转化为特定格式。</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-form-item label=<span class="string">&quot;供货时间&quot;</span> v-<span class="keyword">if</span>=<span class="string">&quot;form.innerCode != null&quot;</span>&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; parseTime(form.lastsupplyTime,&quot;&#123;y&#125;-&#123;m&#125;-&#123;d&#125; &#123;h&#125;:&#123;i&#125;:&#123;s&#125;&quot;) &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;设备类型&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;form.innerCode != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;item in vTypeList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;item.id == form.vmTypeId&quot;</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;设备容量&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;form.innerCode != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; form.channelMaxCapacity &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;合作商&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;form.innerCode != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;item in partnerlist&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;item.id == form.partnerId&quot;</span>&gt;</span>&#123;&#123; item.partnerName &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;所属区域&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;form.innerCode != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;item in regionList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;item.id == form.regionId&quot;</span>&gt;</span>&#123;&#123; item.regionName &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;设备地址&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;form.innerCode != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; form.addr &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; listRegion &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/manage/region&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*查询区域列表 */</span></span><br><span class="line"><span class="keyword">const</span> regionList = <span class="title function_">ref</span>([]);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRegionList</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">listRegion</span>(loadAllParams).<span class="title function_">then</span>( <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        regionlist.<span class="property">value</span> = response.<span class="property">rows</span>;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getRegionList</span>();</span><br></pre></td></tr></table></figure></div>

<h3 id="6-6-5-设备新增"><a href="#6-6-5-设备新增" class="headerlink" title="6.6.5 设备新增"></a>6.6.5 设备新增</h3><h4 id="6-6-5-1-需求说明"><a href="#6-6-5-1-需求说明" class="headerlink" title="6.6.5.1 需求说明"></a>6.6.5.1 需求说明</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240721200112312.png"
                      alt="image-20240721200112312"
                ></p>
<h4 id="6-6-5-2-后端编写"><a href="#6-6-5-2-后端编写" class="headerlink" title="6.6.5.2 后端编写"></a>6.6.5.2 后端编写</h4><ul>
<li>dkd-manage \ controller \ VendingMachineController</li>
<li>BeanUtil.copyProperties()：参数分别是：来源、目标、忽略信息。作用是为同名字段批量赋值。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IVmTypeService vmTypeService;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> INodeService nodeService;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IChannelService channelService;</span><br><span class="line"></span><br><span class="line"><span class="comment">//新增设备管理</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">//要么同时添加成功，要么同时添加失败</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertVendingMachine</span><span class="params">(VendingMachine vendingMachine)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//1.新增设备</span></span><br><span class="line">	<span class="comment">//1-1 生成8位的唯一标识，补充货道编号</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">innerCode</span> <span class="operator">=</span> UUIDUtils.getUUID();</span><br><span class="line">    vendingMachine.setInnerCode(innerCode);</span><br><span class="line">    <span class="comment">//1-2 查询售货机类型表，补充设备容量</span></span><br><span class="line">	<span class="type">VmType</span> <span class="variable">vmType</span> <span class="operator">=</span> vmTypeService.selectVmTypeById(vendingMachine.getVmTypeId());</span><br><span class="line">    vendingMachine.setChannelMaxCapacity(vmType.getchannelMaxCapacity());</span><br><span class="line">    <span class="comment">//1-3 查询点位表，补充:区域、点位、合作商等信息</span></span><br><span class="line">	<span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> nodeService.selectNodeById(vendingMachine.getNodeId());</span><br><span class="line">    BeanUtil.copyProperties(node, vendingMachine, <span class="string">&quot;id&quot;</span>); <span class="comment">//商圈类型、区域、合作商</span></span><br><span class="line">    vendingMachine.setAddr(node.getAddress()); <span class="comment">//设备地址</span></span><br><span class="line">    <span class="comment">//1-4 设备状态</span></span><br><span class="line">	vendingMachine.setVmStatus(<span class="number">0L</span>); <span class="comment">//0-表示未投放</span></span><br><span class="line">	vendingMachine.setCreateTime(DateUtils.getNowDate()); <span class="comment">//创建时间</span></span><br><span class="line">    vendingMachine.setUpdateTime(DateUtils.getNowDate()); <span class="comment">//更新时间</span></span><br><span class="line">    <span class="comment">//1-5 保存</span></span><br><span class="line">	<span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> vendingMachineMapper.insertVendingMachine(vendingMachine);</span><br><span class="line">	<span class="comment">//2.新增货道</span></span><br><span class="line">    <span class="comment">//2-1 声明货道集合</span></span><br><span class="line">    List&lt;Channel&gt; channelList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">	<span class="comment">//2-2 双层for循环</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i&lt;= vmType.getVmRow(); i++)&#123; <span class="comment">//外层行</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>;j &lt;= vmType.getVmCol(); j++)&#123; <span class="comment">//内层列</span></span><br><span class="line">            <span class="comment">//1-1 1-2..2-1 2-2.. </span></span><br><span class="line">			<span class="comment">//2-3 封层channel对象</span></span><br><span class="line">			<span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Channel</span>();</span><br><span class="line">			channel.setChannelcode( i + <span class="string">&quot;-&quot;</span> + j ); <span class="comment">//货道编号</span></span><br><span class="line">            channel.setVmId(vendingMachine.getId()); <span class="comment">//售货机id</span></span><br><span class="line">            channel.setInnerCode(vendingMachine.getInnercode()); <span class="comment">//售货机编号</span></span><br><span class="line">            channel.setMaxCapacity(vmType.getchannelMaxCaparity()); <span class="comment">//货道最大容量</span></span><br><span class="line">			channel.setCreateTime(DateUtils.getNowDate()); <span class="comment">//创建时间	</span></span><br><span class="line">            channel.setUpdateTime(DateUtils.getNowDate()); <span class="comment">//修改时间</span></span><br><span class="line">            <span class="comment">////保存货道</span></span><br><span class="line">            <span class="comment">//channelService.insertChannel(channel);</span></span><br><span class="line">            channelList.add(channel);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2-4 批量保存</span></span><br><span class="line">    channelService.batchInsertchannels(channelList);</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>因为双层循环插入数据库，操作太频繁，改为批量插入。</p>
</li>
<li><p>ChannelMapper 接口 与 实现</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *批量新增售货机货道</span></span><br><span class="line"><span class="comment"> *<span class="doctag">@param</span> channelList</span></span><br><span class="line"><span class="comment"> *<span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">batchInsertChannels</span> <span class="params">(List&lt;Channel&gt; channelList)</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">insert</span> id<span class="operator">=</span>&quot;batchInsertChannels&quot; parameterType<span class="operator">=</span>&quot;java.util.List&quot;<span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">insert</span> <span class="keyword">into</span> tb_channel</span><br><span class="line">	(channel_code, sku id, vm_id, inner_code, max_ capacity, <span class="keyword">current</span> _capacity, last_supply_time, 					create_time, update_time)</span><br><span class="line">	<span class="keyword">values</span></span><br><span class="line">	<span class="operator">&lt;</span>foreach item<span class="operator">=</span>&quot;item&quot; index<span class="operator">=</span>&quot;index&quot; collection<span class="operator">=</span>&quot;list&quot; separator<span class="operator">=</span>&quot;,&quot;<span class="operator">&gt;</span></span><br><span class="line">	(#item.channelCode&#125;, #&#123;item.skuId&#125;, #&#123;item.vmId&#125;, #&#123;item.innerCode&#125;, #&#123;item.maxCapacity&#125;						#litem.currentCapacity&#125;, #&#123;item.lastSupplyTime&#125;, #&#123;item.createTime&#125;, #&#123;item.updateTime&#125;)</span><br><span class="line">	<span class="operator">&lt;</span><span class="operator">/</span>foreach<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">insert</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>IChannelService 与 ChannelServiceimpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">batchInsertChannels</span> <span class="params">(List&lt;Channel&gt; channelList)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">batchInsertChannels</span> <span class="params">(List&lt;channel&gt; channelList)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> channelMapper.batchInsertChannels(channelList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="6-6-6-设备修改"><a href="#6-6-6-设备修改" class="headerlink" title="6.6.6 设备修改"></a>6.6.6 设备修改</h3><h4 id="6-6-6-1-需求说明"><a href="#6-6-6-1-需求说明" class="headerlink" title="6.6.6.1 需求说明"></a>6.6.6.1 需求说明</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240721213512503.png"
                      alt="image-20240721213512503"
                ></p>
<h4 id="6-6-6-2-后端编写"><a href="#6-6-6-2-后端编写" class="headerlink" title="6.6.6.2 后端编写"></a>6.6.6.2 后端编写</h4><ul>
<li>dkd-manage \ controller \ VendingMachineController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateVendingMachine</span><span class="params">(VendingMachine vendingMachine)</span>&#123;</span><br><span class="line">	<span class="comment">//查询点位表，补充:区域、点位、合作商等信息</span></span><br><span class="line">	<span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> nodeService.selectNodeById(vendingMachine.getNodeId());</span><br><span class="line">	BeanUtil.copyProperties(node, vendingMachine, <span class="string">&quot;id&quot;</span>); <span class="comment">//商圈类型、区域、合作商</span></span><br><span class="line">	vendingMachine.setAddr(node.getAddress()); <span class="comment">//设备地址</span></span><br><span class="line">	vendingMachine.setUpdateTime(DateUtils.getNowDate()); <span class="comment">//更新时间</span></span><br><span class="line">	<span class="keyword">return</span> vendingMachineMapper.updateVendingMachine(vendingMachine);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="6-7-设备状态改造"><a href="#6-7-设备状态改造" class="headerlink" title="6.7 设备状态改造"></a>6.7 设备状态改造</h2><ul>
<li>设备状态没有前端原型，需要自己编写。</li>
</ul>
<h3 id="6-7-1-搭建原型"><a href="#6-7-1-搭建原型" class="headerlink" title="6.7.1 搭建原型"></a>6.7.1 搭建原型</h3><ul>
<li><p>创建 views \ manage \ vmStatus 包，然后将 设备管理 的 index 文件，复制粘贴到 新建包 下。</p>
</li>
<li><p>点击 菜单管理，点击 新增。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240722084304348.png"
                      alt="image-20240722084304348"
                ></p>
<h3 id="6-7-2-前端编写"><a href="#6-7-2-前端编写" class="headerlink" title="6.7.2 前端编写"></a>6.7.2 前端编写</h3><h4 id="6-7-2-1-移除"><a href="#6-7-2-1-移除" class="headerlink" title="6.7.2.1 移除"></a>6.7.2.1 移除</h4><ul>
<li>移除 新增、修改、删除、导出 按钮。</li>
<li>移除 复选框。</li>
<li>移除 合作商。</li>
</ul>
<h4 id="6-7-2-2-添加序号"><a href="#6-7-2-2-添加序号" class="headerlink" title="6.7.2.2 添加序号"></a>6.7.2.2 添加序号</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-table-column label=&quot;序号&quot; type=&quot;index&quot; width=&quot;55&quot; align=&quot;center&quot; /&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="6-7-2-3-添加运行状态"><a href="#6-7-2-3-添加运行状态" class="headerlink" title="6.7.2.3 添加运行状态"></a>6.7.2.3 添加运行状态</h4><ul>
<li>JSON.parse()：将 json 字符串 转化为 json 对象。</li>
<li>running_status：{ “statusCode”:”1001”, “status”:true }</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-table-column label=&quot;设备状态&quot; align=&quot;center&quot;&gt;</span><br><span class="line">	&lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">		&lt;span v-if=&quot;scope.row.runningStatus != null&quot;&gt;</span><br><span class="line">			&#123;&#123; JSON.parse(scope.row.runningStatus).status == true ? &#x27;正常&#x27; : &#x27;异常” &#125;&#125;</span><br><span class="line">		&lt;/span&gt;</span><br><span class="line">		&lt;span v-else&gt;异常&lt;/span&gt;</span><br><span class="line">		&#123;&#123; scope.row.runningStatus != null ? JSON.parse(scope.row.runningStatus).status==true?&#x27;正常&#x27;:&#x27;异常&#x27; : 			&#x27;异常&#x27; &#125;&#125;</span><br><span class="line">	&lt;/template&gt;</span><br><span class="line">&lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="6-7-2-4-查看详情"><a href="#6-7-2-4-查看详情" class="headerlink" title="6.7.2.4 查看详情"></a>6.7.2.4 查看详情</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-table-column label=<span class="string">&quot;操作&quot;</span> align=<span class="string">&quot;center&quot;</span> <span class="keyword">class</span>-name=<span class="string">&quot;small-padding fixed-width&quot;</span>&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">el-button</span> <span class="attr">link</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;getVmInfe(scope.row)&quot;</span> <span class="attr">v-hasPermi</span>=<span class="string">&quot;[&#x27;manage:vm:query&#x27;]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		査看详情<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line">&lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--添加或修改设备管理对话框--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:title</span>=<span class="string">&quot;title&quot;</span> <span class="attr">v-model</span> &quot;<span class="attr">open</span>&quot; <span class="attr">width</span>=<span class="string">&quot;500px&quot;</span> <span class="attr">append-to-body</span>&gt;</span><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**修改按钮操作 */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getVmInfo</span>(<span class="params">row</span>) &#123;</span><br><span class="line">	<span class="title function_">reset</span>();</span><br><span class="line">	<span class="keyword">const</span> _id = row.<span class="property">id</span> || ids.<span class="property">value</span></span><br><span class="line">	<span class="title function_">getVm</span>(_id).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">		form.<span class="property">value</span> = response.<span class="property">data</span>;</span><br><span class="line">		open.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">		title.<span class="property">value</span> =<span class="string">&quot;设备详情”</span></span><br><span class="line"><span class="string">	&#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></div>

<h1 id="7-策略管理"><a href="#7-策略管理" class="headerlink" title="7.策略管理"></a>7.策略管理</h1><h2 id="7-1-需求说明"><a href="#7-1-需求说明" class="headerlink" title="7.1 需求说明"></a>7.1 需求说明</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240913175348746.png"
                      alt="image-20240913175348746"
                ></p>
<h2 id="7-2-库表设计"><a href="#7-2-库表设计" class="headerlink" title="7.2 库表设计"></a>7.2 库表设计</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240913175618316.png"
                      alt="image-20240913175618316"
                ></p>
]]></content>
      <categories>
        <category>RuoYi</category>
        <category>RuoYi框架实战开发</category>
      </categories>
      <tags>
        <tag>自研笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3</title>
    <url>/2024/03/14/Vue3/</url>
    <content><![CDATA[<h1 id="1-Vue3初体验"><a href="#1-Vue3初体验" class="headerlink" title="1- Vue3初体验"></a>1- Vue3初体验</h1><h2 id="1-1-基本概念"><a href="#1-1-基本概念" class="headerlink" title="1-1 基本概念"></a>1-1 基本概念</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240314204538992.png"
                      alt="image-20240314204538992"
                ></li>
</ul>
<h2 id="1-2-初始化Vue3"><a href="#1-2-初始化Vue3" class="headerlink" title="1-2 初始化Vue3"></a>1-2 初始化Vue3</h2><p>create-vue 是 Vue 官方新的脚手架工具，底层切换到了 vite (下一代前端工具链)，为开发提供极速响应。</p>
<h3 id="1-2-1-前提环境条件"><a href="#1-2-1-前提环境条件" class="headerlink" title="1-2-1 前提环境条件"></a>1-2-1 前提环境条件</h3><p>已安装 16.0 或更高版本的 Node.js</p>
<p>安装命令</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure></div>

<h3 id="1-2-2-创建一个Vue应用"><a href="#1-2-2-创建一个Vue应用" class="headerlink" title="1-2-2 创建一个Vue应用"></a>1-2-2 创建一个Vue应用</h3><p>安装命令</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm init vue@latest</span><br></pre></td></tr></table></figure></div>

<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240320102012167.png"
                      alt="image-20240320102012167"
                ></li>
</ul>
<p>安装项目</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd 项目名字</span><br></pre></td></tr></table></figure></div>

<p>初始化项目</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure></div>

<p>运行项目</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure></div>

<h2 id="1-3-项目目录和关键文件"><a href="#1-3-项目目录和关键文件" class="headerlink" title="1-3 项目目录和关键文件"></a>1-3 项目目录和关键文件</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240320105436612.png"
                      alt="image-20240320105436612"
                ></li>
</ul>
<h2 id="1-4-Vue2与Vue3项目对比"><a href="#1-4-Vue2与Vue3项目对比" class="headerlink" title="1-4 Vue2与Vue3项目对比"></a>1-4 Vue2与Vue3项目对比</h2><p>vue2项目</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240314211045527.png"
                      alt="image-20240314211045527"
                ></li>
</ul>
<p>vue3项目</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240314211222562.png"
                      alt="image-20240314211222562"
                ></li>
</ul>
<h1 id="2-组合式API"><a href="#2-组合式API" class="headerlink" title="2- 组合式API"></a>2- 组合式API</h1><h2 id="2-1-setup"><a href="#2-1-setup" class="headerlink" title="2-1 setup"></a>2-1 setup</h2><p>生命周期：setup 在 beforeCreate 之前。</p>
<p>原生：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line"></span><br><span class="line">    setup()&#123;</span><br><span class="line">        const name = &#x27;jack&#x27;</span><br><span class="line">        const showName = () =&gt; &#123;</span><br><span class="line">        	console.log(name)</span><br><span class="line">        &#125;</span><br><span class="line">        //必须return才可以</span><br><span class="line">        return&#123;</span><br><span class="line">            name,</span><br><span class="line">            showName</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    beforeCreate()&#123;</span><br><span class="line">    	console.log(&#x27;beforeCreate&#x27;)</span><br><span class="line">    &#125;   </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">        &#123;&#123; name &#125;&#125;</span><br><span class="line">		&lt;button @click = &quot;showName&quot;&gt;显示姓名&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<p>语法糖：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">	const name = &#x27;jack&#x27;</span><br><span class="line">    const showName = () =&gt; &#123;</span><br><span class="line">    	console.log(name)</span><br><span class="line">    &#125;     </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">        &#123;&#123; name &#125;&#125;</span><br><span class="line">		&lt;button @click = &quot;showName&quot;&gt;显示姓名&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="2-2-响应式对象函数"><a href="#2-2-响应式对象函数" class="headerlink" title="2-2 响应式对象函数"></a>2-2 响应式对象函数</h2><p>如果没有响应式对象函数，页面不会响应数据。</p>
<h3 id="2-2-1-reactive"><a href="#2-2-1-reactive" class="headerlink" title="2-2-1 reactive"></a>2-2-1 reactive</h3><p>参数只能是对象</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">    //响应式对象</span><br><span class="line">	const state = reactive(&#123;</span><br><span class="line">		count : 0</span><br><span class="line">	&#125;)</span><br><span class="line">	const addCount = () =&gt; &#123;</span><br><span class="line">		state.count++</span><br><span class="line">		console.log(state.count) </span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;button @click = &quot;addCount&quot;&gt;&#123;&#123; state.count &#125;&#125;&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-2-ref"><a href="#2-2-2-ref" class="headerlink" title="2-2-2 ref"></a>2-2-2 ref</h3><p>参数允许是对象、简单类型、数组等</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;</span><br><span class="line">    </span><br><span class="line">    //1-对象</span><br><span class="line">	const num1 = ref(&#123;</span><br><span class="line">		count : 0</span><br><span class="line">	&#125;)</span><br><span class="line">	const addNum1 = () =&gt; &#123;</span><br><span class="line">		num1.value.count++</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    //2-简单类型，数字、字符串、布尔</span><br><span class="line">    const num2 = ref(0)</span><br><span class="line">    const addNum2 = () =&gt; &#123;</span><br><span class="line">        num2.value++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //3-简单类型，数字、字符串、布尔</span><br><span class="line">    //页面 数组[1,2,3,4,5,6] 在两秒后 添加7 </span><br><span class="line">    const list = ref([1,2,3,4,5,6])</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">		list.value.push(7)</span><br><span class="line">    &#125;,2000)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;button @click = &quot;addNum1&quot;&gt;&#123;&#123; num1.count &#125;&#125;&lt;/button&gt;</span><br><span class="line">        &lt;button @click = &quot;addNum2&quot;&gt;&#123;&#123; num2 &#125;&#125;&lt;/button&gt;</span><br><span class="line">        &#123;&#123; list &#125;&#125;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="2-3-属性"><a href="#2-3-属性" class="headerlink" title="2-3 属性"></a>2-3 属性</h2><h3 id="2-3-1-computed"><a href="#2-3-1-computed" class="headerlink" title="2-3-1 computed"></a>2-3-1 computed</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; computed, ref &#125; from &quot;vue&quot;</span><br><span class="line"></span><br><span class="line">	const data = ref(&#123;</span><br><span class="line">		totalPrice : 2000,</span><br><span class="line">		amount : 10,</span><br><span class="line">		discount : 8</span><br><span class="line">	&#125;)</span><br><span class="line">    </span><br><span class="line">    //原</span><br><span class="line">	const avgPrice = computed(() =&gt; &#123;</span><br><span class="line">		return (data.valve.totalPrice / data.value.amount) * (data.value.discount / 10);</span><br><span class="line">	&#125;)</span><br><span class="line">    </span><br><span class="line">    //get、set</span><br><span class="line">	const avgPrice = computed(&#123;</span><br><span class="line">        get()&#123;</span><br><span class="line">            console.log(&quot;调用计算属性avgPrice中Get函数&quot;)</span><br><span class="line">            return (data.valve.totalPrice / data.value.amount) * (data.value.discount / 10);</span><br><span class="line">        &#125;,</span><br><span class="line">        set(value)&#123;</span><br><span class="line">            console.log(&quot;调用计算属性avgPrice中Set函数&quot;)</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;)   </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		总价:&lt;input type=&quot;text&quot; v-model=&quot;data.totalPrice&quot;&gt; &lt;br/&gt;</span><br><span class="line">		数量:&lt;input type=&quot;text&quot; v-model=&quot;data.amount&quot;&gt; &lt;br/&gt;</span><br><span class="line">		折扣:&lt;input type=&quot;text&quot; v-model=&quot;data.discount&quot;&gt;折&lt;br/&gt;</span><br><span class="line">		折扣平均单价:&lt;input type=&quot;text&quot; v-model=&quot;avgPrice&quot;&gt;元&lt;br/&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-3-2-watch"><a href="#2-3-2-watch" class="headerlink" title="2-3-2 watch"></a>2-3-2 watch</h3><p>简单类型侦听与多值侦听</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; computed, ref &#125; from &quot;vue&quot;</span><br><span class="line"></span><br><span class="line">    let happy = ref(true)</span><br><span class="line">    let name = ref(&#x27;jack&#x27;)</span><br><span class="line"></span><br><span class="line">    const mood = computed(() =&gt; &#123;</span><br><span class="line">    	return happy.value ? &quot;高兴&quot; : &quot;难过&quot; ;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    const changeMood = () =&gt; &#123;</span><br><span class="line">    	happy.value = !happy.value;</span><br><span class="line">        name.value = happy.value ? &#x27;jack&#x27; : &#x27;tom&#x27; ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    watch([happy,name], ([newHappy,newName], [oldHappy,oldName]) =&gt; &#123;</span><br><span class="line">        console.log(&#x27;happy发生了变化，老值为 $&#123;oldHappy&#125;,$&#123;oldName&#125;,新值为 $&#123;newHappy&#125;,$&#123;newName&#125;&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">	watch(happy, (newValue,oldValue) =&gt; &#123;</span><br><span class="line">		console.log(&#x27;happy发生了变化,老值为 $&#123;oldValue&#125;,新值为 $&#123;newValue&#125;&#x27;)</span><br><span class="line">	&#125;)</span><br><span class="line">    watch(happy,(value) =&gt; &#123;</span><br><span class="line">		console.log(&#x27;happy发生了变化，新值为 $&#123;value&#125;&#x27;)</span><br><span class="line">    &#125;)    </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;h2&gt;我是&#123;&#123; name &#125;&#125;,今天我很&#123;&#123; mood &#125;&#125;&lt;/h2&gt;</span><br><span class="line">		&lt;button @click = &quot;changeMood&quot;&gt;改变心情和姓名&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<p>对象类型侦听与精确侦听</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; computed, ref &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">	const data = ref(&#123;</span><br><span class="line">		happy : true,</span><br><span class="line">		name : &quot;Jack&quot;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">	const mood = computed(() =&gt; &#123;</span><br><span class="line">		return data.value.happy ? &quot;高兴&quot; : &quot;难过&quot; ;</span><br><span class="line">	&#125;)</span><br><span class="line">	</span><br><span class="line">	const changeMood = () =&gt; &#123;</span><br><span class="line">    	data.value.happy = !data.value.happy ;  </span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	const changeName = () =&gt; &#123;</span><br><span class="line">    	data.value.name = data.value.happy ? &quot;Jack&quot; : &quot;Tom&quot; ;  </span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    //对象类型侦听,&#123;deep:true,immediate:true&#125;</span><br><span class="line">    watch(data, (value) =&gt; &#123;</span><br><span class="line">		console.log(&#x27;happy发生了变化，值为 $&#123;value.happy&#125;&#x27;)</span><br><span class="line">        console.log(&#x27;name发生了变化，值为 $&#123;valve.name&#125;&#x27;)</span><br><span class="line">    &#125;,&#123;deep:true,immediate:true&#125;)</span><br><span class="line"></span><br><span class="line">    //精确侦听</span><br><span class="line">    watch(() =&gt; data.value.happy, (newValue,oldValue) =&gt; &#123;</span><br><span class="line">        console.log(&#x27;happy发生了变化，老值为 $&#123;oldValue&#125;,新值为 $&#123;newValue&#125;&#x27;) </span><br><span class="line">    &#125;) </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;h2&gt;我是&#123;&#123; data.name &#125;&#125;,今天我很&#123;&#123; mood &#125;&#125;&lt;/h2&gt;</span><br><span class="line">		&lt;button @click = &quot;changeMood&quot;&gt;改变心情&lt;/button&gt;</span><br><span class="line">		&lt;button @click = &quot;changeName&quot;&gt;改变姓名&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="2-4-生命周期函数"><a href="#2-4-生命周期函数" class="headerlink" title="2-4 生命周期函数"></a>2-4 生命周期函数</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240315191430340.png"
                      alt="image-20240315191430340"
                ></li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; onBeforeMount, onMounted &#125; from &quot;vue&quot;</span><br><span class="line"></span><br><span class="line">    onBeforeMount(() =&gt; &#123;</span><br><span class="line">    	console.log(&quot;执行beforeMount生命周期函数&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">    	console.log(&quot;执行挂载逻辑onMounted()-1&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">    	console.log(&quot;执行挂载逻辑onMounted()-2&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="2-5-组件数据通信"><a href="#2-5-组件数据通信" class="headerlink" title="2-5 组件数据通信"></a>2-5 组件数据通信</h2><h3 id="2-5-1-父传子组件"><a href="#2-5-1-父传子组件" class="headerlink" title="2-5-1 父传子组件"></a>2-5-1 父传子组件</h3><p>基本思想：</p>
<ul>
<li><p>1.父组件中给子组件绑定属性</p>
</li>
<li><p>2.子组件内部通过props选项接收</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//Shool.Vue 子组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">	//2.通过 defineProps &quot;编译器宏&quot; 接收父组件传递的数据</span><br><span class="line">	const props = defineProps(&#123;</span><br><span class="line">		teacherName : String,</span><br><span class="line">		salary : Number,</span><br><span class="line">		age : Number</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;school-style&quot;&gt;</span><br><span class="line">        &lt;!-- 对于props传递过来的数据，模板中可以直接使用 --&gt;</span><br><span class="line">		&lt;h3&gt;子组件-School&lt;/h3&gt;</span><br><span class="line">		&lt;h3&gt;父组件App参数[teacherName]:&#123;&#123; teacherName &#125;&#125;&lt;/h3&gt;</span><br><span class="line">		&lt;h3&gt;父组件App参数[salary]:&#123;&#123; salary+1000 &#125;&#125;&lt;/h3&gt;</span><br><span class="line">		&lt;h3&gt;父组件App参数[age]:&#123;&#123; age &#125;&#125;&lt;/h3&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">	.school-style &#123;</span><br><span class="line">		background-color: #5bc0de;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;    </span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//App.Vue 父组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">//引入子组件</span><br><span class="line">//局部组件(导入进来就能用)</span><br><span class="line">import School from &quot;./components/School.vue&quot;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;</span><br><span class="line">    </span><br><span class="line">    //动态绑定</span><br><span class="line">	const age = ref(20)</span><br><span class="line">    //2秒后,age变为30</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">    	age.value = 30;</span><br><span class="line">    &#125;,2000)  </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;h2&gt;父组件-App&lt;/h2&gt;</span><br><span class="line">        &lt;!-- 1.绑定属性 --&gt;</span><br><span class="line">		&lt;School teacherName = &quot;李四&quot; :salary = &quot;5000&quot; :age = &quot;age&quot;&gt;&lt;/School&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-5-2-子传父组件"><a href="#2-5-2-子传父组件" class="headerlink" title="2-5-2 子传父组件"></a>2-5-2 子传父组件</h3><p>基本思想：</p>
<ul>
<li>1.父组件中给子组件标签通过@绑定事件</li>
<li>2.子组件内部通过 emit 方法触发事件</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//Shool.Vue 子组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    //2.通过 defineEmits &quot;编译器宏&quot; 生成emit方法</span><br><span class="line">	const emit = defineEmits([&#x27;funGetAddress&#x27;])</span><br><span class="line">    </span><br><span class="line">    //3.触发自定义事件 并传递参数</span><br><span class="line">	const sendAddress = () =&gt; &#123;</span><br><span class="line">		emit(&#x27;funGetAddress&#x27;,&#x27;浙江大学软件学院&#x27;)</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;school-style&quot;&gt;</span><br><span class="line">		&lt;h3&gt;子组件-School&lt;/h3&gt;</span><br><span class="line">		&lt;button @click = &quot;sendAddress&quot;&gt;使用$emit:向父组件发送学校地址&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">	.school-style &#123;</span><br><span class="line">		background-color: #5bc0de;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;  </span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//App.Vue 父组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">//引入子组件</span><br><span class="line">//局部组件(导入进来就能用)    </span><br><span class="line">import School from &quot;./components/School.vue&quot;;   </span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;;</span><br><span class="line">	</span><br><span class="line">	const myAddress = ref(&#x27;&#x27;)</span><br><span class="line">	const getAddress = (address) =&gt; &#123;</span><br><span class="line">		myAddress.value = address</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;h2&gt;父组件-App&lt;/h2&gt;</span><br><span class="line">		&lt;h2&gt;学校地址:&#123;&#123; myAddress &#125;&#125;&lt;/h2&gt;</span><br><span class="line">        &lt;!-- 1.绑定自定义事件 --&gt;</span><br><span class="line">		&lt;School @funGetAddress = &quot;getAddress&quot;&gt;&lt;/School&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;e</span><br></pre></td></tr></table></figure></div>

<h2 id="2-6-模板引用-ref"><a href="#2-6-模板引用-ref" class="headerlink" title="2-6 模板引用-ref"></a>2-6 模板引用-ref</h2><p>基本思想：</p>
<ul>
<li>1.调用ref函数，生成一个ref对象</li>
<li>2.通过ref标识，绑定ref对象到标签</li>
<li>3.通过ref对象.value，即可访问到绑定的元素</li>
<li>4.获取模板引用的时机 – 组件挂载完毕</li>
</ul>
<h3 id="2-6-defineExpose"><a href="#2-6-defineExpose" class="headerlink" title="2-6 defineExpose( )"></a>2-6 defineExpose( )</h3><p>默认情况下在&lt; script setup &gt;语法糖下组件内部的属性和方法是不开放给父组件访问的。</p>
<p>可以通过 defineExpose 编译器宏 指定哪些属性和方法允许访问。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//Shool.Vue 子组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;</span><br><span class="line"></span><br><span class="line">	const address = ref(&#x27;浙江大学软件学院&#x27;)</span><br><span class="line">	const loadData = (data) =&gt; &#123;</span><br><span class="line">		console.log(data);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    //暴露属性和方法允许访问</span><br><span class="line">	defineExpose(&#123;</span><br><span class="line">		address,</span><br><span class="line">		loadData</span><br><span class="line">	&#125;)	</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;school-style&quot;&gt;</span><br><span class="line">		&lt;h3&gt;子组件-School&lt;/h3&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">	.school-style &#123;</span><br><span class="line">		background-color: #5bc0de;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt; </span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//App.Vue 父组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; onMounted, ref &#125; from &quot;vue&quot;</span><br><span class="line">	</span><br><span class="line">	const school = ref(null)</span><br><span class="line">	const sendLoadData = () =&gt; &#123;</span><br><span class="line">		school.value.loadData(&#123;id:1, name:&#x27;jack&#x27;&#125;)</span><br><span class="line">	&#125; </span><br><span class="line">    </span><br><span class="line">	onMounted(() =&gt; &#123;</span><br><span class="line">		console.log(school.value.address)</span><br><span class="line">	&#125;)</span><br><span class="line">    </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;h2&gt;父组件-App&lt;/h2&gt;</span><br><span class="line">		&lt;h2&gt;学校地址:&#123;&#123; school &#125;&#125;&lt;/h2&gt;</span><br><span class="line">		&lt;button @click = &quot;sendLoadData&quot;&gt;向子组件传递数据&lt;/button&gt;</span><br><span class="line">		&lt;School ref=&quot;school&quot;&gt;&lt;/School&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="2-7-provide与inject"><a href="#2-7-provide与inject" class="headerlink" title="2-7 provide与inject"></a>2-7 provide与inject</h2><p>作用和场景：</p>
<ul>
<li>顶层组件向任意的底层组件传递数据和方法，实现跨层组件通信</li>
<li>顶层组件通过 provide 函数提供数据</li>
<li>底层组件通过 inject 函数获取数据</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//App.Vue 父组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import School from &quot;./components/School.vue&quot;</span><br><span class="line"></span><br><span class="line">    //1.跨层传递普通数据</span><br><span class="line">	provide(&#x27;studentName&#x27;,&#x27;jack&#x27;)</span><br><span class="line">    </span><br><span class="line">    //2.跨层传递响应式数据</span><br><span class="line">    const age = ref(20)</span><br><span class="line">    provide(&#x27;studentAge&#x27;,age)</span><br><span class="line">	setTimeout(() =&gt; &#123; </span><br><span class="line">        count.value = 30</span><br><span class="line">    &#125;,2000)</span><br><span class="line">    </span><br><span class="line">    //3.跨层传递函数 =&gt; 给子孙后代传递可以修改数据的</span><br><span class="line">	provide(&#x27;changeAge&#x27;,(newAge) =&gt; &#123;</span><br><span class="line">    	age.value = newAge</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;h1&gt;父组件-App&lt;/h1&gt;</span><br><span class="line">	&lt;School&gt;&lt;/school&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//Shool.Vue 子组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import student from &quot;./Student.vue&quot;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;school-style&quot;&gt;</span><br><span class="line">		&lt;h3&gt;子组件-School&lt;/h3&gt;</span><br><span class="line">		&lt;Student&gt;&lt;/student&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">	.school-style &#123;</span><br><span class="line">		background-color: #5bcode;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//Student.Vue 孙组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; inject &#125; from &quot;vue&quot;</span><br><span class="line"></span><br><span class="line">	const studentName = inject(&#x27;studentName&#x27;)</span><br><span class="line">	const studentAge = inject(&#x27;studentAge&#x27;)</span><br><span class="line">    const changeAge = inject(&#x27;changeAge&#x27;)</span><br><span class="line">    const clickFn = ()=&gt;&#123;</span><br><span class="line">        changeAge(50)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div class=&quot;student-style&quot;&gt;</span><br><span class="line">		&lt;h2&gt;学生姓名:&#123;&#123; studentName &#125;&#125;&lt;/h2&gt;</span><br><span class="line">        &lt;h2&gt;学生年龄:&#123;&#123; studentAge &#125;&#125;&lt;/h2&gt;</span><br><span class="line">        &lt;button @click = &quot;clickFn&quot;&gt;更新studentAge&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">	.student-style &#123;</span><br><span class="line">		background-color: pink;</span><br><span class="line">		margin:20px;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h1 id="3-快速对比案例"><a href="#3-快速对比案例" class="headerlink" title="3- 快速对比案例"></a>3- 快速对比案例</h1><h2 id="3-1-用户列表改造"><a href="#3-1-用户列表改造" class="headerlink" title="3-1 用户列表改造"></a>3-1 用户列表改造</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//Vue2</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &quot;axios&quot;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">	data()&#123;</span><br><span class="line">        return&#123;</span><br><span class="line">            users:[]</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	methods:&#123;</span><br><span class="line">		async getList()&#123;</span><br><span class="line">			const res = await axios.get(&quot;/users&quot;);</span><br><span class="line">			this.users = res.data.data;</span><br><span class="line">			console.log(this.users);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	mounted()&#123;</span><br><span class="line">		this.getList();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;template v-slot=&quot;scope&quot;&gt;</span><br><span class="line">    	&lt;el-button type=&quot;primary&quot; size=&quot;small&quot; href=&quot;#&quot; @click = &quot;updateById(scope.row.id)&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;danger&quot; size=&quot;small&quot; @click = &quot;deleteById(scope.row.id)&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">	&lt;/template&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//Vue3</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;</span><br><span class="line">import axios from &quot;axios&quot;</span><br><span class="line">	</span><br><span class="line">	const users = ref([])</span><br><span class="line">    </span><br><span class="line">	const getList = async () =&gt; &#123;</span><br><span class="line">		const res = await axios.get(&quot;/users&quot;);</span><br><span class="line">		users.value = res.data.data;</span><br><span class="line">		console.log(users.value);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	onmounted(() =&gt;</span><br><span class="line">    	getList()</span><br><span class="line">    )  </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;template #default=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">    	&lt;el-button type=&quot;primary&quot; size=&quot;small&quot; href=&quot;#&quot; @click = &quot;updateById(row.id)&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;danger&quot; size=&quot;small&quot; @click = &quot;deleteById(row.id)&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">	&lt;/template&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="3-2-用户删除改造"><a href="#3-2-用户删除改造" class="headerlink" title="3-2 用户删除改造"></a>3-2 用户删除改造</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//Vue2</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &quot;axios&quot;	</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">	data()&#123;</span><br><span class="line">        return&#123;</span><br><span class="line">            users:[]</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	methods:&#123;</span><br><span class="line">        async delUser(id)&#123;</span><br><span class="line">			this.$confirm(&quot;此操作将删除该同学信息与成绩, 是否继续?&quot;,&quot;提示&quot;, &#123;</span><br><span class="line">            	confirmButtonText:&#x27;确定&#x27;,</span><br><span class="line">				cancelButtonText:&#x27;取消&#x27;,</span><br><span class="line">            	type: &#x27;warning&#x27;</span><br><span class="line">            &#125;).then( async() =&gt; &#123;</span><br><span class="line">                await axios.delete(&#x27;/users/$&#123;id&#125;&#x27;);</span><br><span class="line">                this.getList();</span><br><span class="line">                this.$message(&#123;</span><br><span class="line">					type:&#x27;success&#x27;,</span><br><span class="line">					message:&#x27;删除成功!&#x27;</span><br><span class="line">                &#125;);</span><br><span class="line">			&#125;).catch(() =&gt; &#123;</span><br><span class="line">                this.$message(&#123;</span><br><span class="line">					type: &#x27;info&#x27;,</span><br><span class="line">					message:&#x27;已取消删除&#x27;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted()&#123;</span><br><span class="line">		this.getList();</span><br><span class="line">	&#125;    </span><br><span class="line">&#125;   </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//Vue3</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;</span><br><span class="line">import axios from &quot;axios&quot;</span><br><span class="line">	</span><br><span class="line">	const users = ref([])</span><br><span class="line"></span><br><span class="line">	const delUser = (id) =&gt; &#123;</span><br><span class="line">		ElMessageBox.confirm(</span><br><span class="line">			&#x27;此操作将永久删除用户数据，是否继续?&#x27;,</span><br><span class="line">			&#x27;提示&#x27;,</span><br><span class="line">            &#123;</span><br><span class="line">                confirmButtonText:&#x27;确定&#x27;,</span><br><span class="line">                cancelButtonText:&#x27;取消&#x27;,</span><br><span class="line">                type: &#x27;warning&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        ).then( async() =&gt; &#123;</span><br><span class="line">            await axios.delete(&#x27;/users/$&#123;id&#125;&#x27;);</span><br><span class="line">            await getList();</span><br><span class="line">            ElMessage(&#123;</span><br><span class="line">                type:&#x27;success&#x27;,</span><br><span class="line">                message: &#x27;删除成功!&#x27;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;).catch(() =&gt; &#123;</span><br><span class="line">			ElMessage(&#123;</span><br><span class="line">                type:&#x27;info&#x27;,</span><br><span class="line">                message:&#x27;已取消删除&#x27;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)          </span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	onmounted(() =&gt;</span><br><span class="line">    	getList()</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="3-3-用户修改改造"><a href="#3-3-用户修改改造" class="headerlink" title="3-3 用户修改改造"></a>3-3 用户修改改造</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//Vue2</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &quot;axios&quot;	</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">	data()&#123;</span><br><span class="line">        return&#123;</span><br><span class="line">           dialogVisible:false,</span><br><span class="line">           sexList:[&#123;value:0,label:&#x27;男&#x27;&#125;,&#123;value:1,label:&#x27;女&#x27;&#125;],</span><br><span class="line">           form:&#123;</span><br><span class="line">				id:&#x27;&#x27;,</span><br><span class="line">                img:&#x27;&#x27;,</span><br><span class="line">				name:&#x27;&#x27;,</span><br><span class="line">				sex:&#x27;&#x27;,</span><br><span class="line">				birthday:&#x27;&#x27;,</span><br><span class="line">				role:&#x27;&#x27;,</span><br><span class="line">				address:&#x27;&#x27;</span><br><span class="line">           &#125;      </span><br><span class="line">        &#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	methods:&#123;</span><br><span class="line">		open(row)&#123;</span><br><span class="line">			this.dialogvisible = true;</span><br><span class="line">            this.form.id = row.id;</span><br><span class="line">            this.form.img = row.img;</span><br><span class="line">            this.form.name = row.name;</span><br><span class="line">            this.form.sex = row.sex;</span><br><span class="line">            this.form.birthday = row.birthday;</span><br><span class="line">            this.form.role = row.role;</span><br><span class="line">            this.form.address =row.address;</span><br><span class="line">        &#125;,</span><br><span class="line">        async onupdate()&#123;</span><br><span class="line">            await axios.put(&quot;/users&quot;,this.form);</span><br><span class="line">            this.dialogVisible = false;</span><br><span class="line">            this.$emit(&quot;refresh&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted()&#123;</span><br><span class="line">		this.getList();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;  </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;el-dialog :visible.sync = &quot;dialogVisible&quot; title = &quot;编辑&quot; width = &quot;500px&quot;&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//Vue3</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;</span><br><span class="line">import axios from &quot;axios&quot;</span><br><span class="line">    </span><br><span class="line">    const dialogVisible = ref(flase)</span><br><span class="line">    const sexList = ref([&#123;value:0,label:&#x27;男&#x27;&#125;,&#123;value:1,label:&#x27;女&#x27;&#125;])</span><br><span class="line">    const form = ref(&#123;</span><br><span class="line">        id:&#x27;&#x27;,</span><br><span class="line">        img:&#x27;&#x27;,</span><br><span class="line">		name:&#x27;&#x27;,</span><br><span class="line">		sex:&#x27;&#x27;,</span><br><span class="line">		birthday:&#x27;&#x27;,</span><br><span class="line">		role:&#x27;&#x27;,</span><br><span class="line">		address:&#x27;&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    const open = (row) =&gt; &#123;</span><br><span class="line">        dialogvisible.value = true;</span><br><span class="line">        form.value.id = row.id;</span><br><span class="line">        form.value.img = row.img;</span><br><span class="line">        form.value.name = row.name;</span><br><span class="line">        form.value.sex = row.sex;</span><br><span class="line">        form.value.birthday = row.birthday;</span><br><span class="line">        form.value.role = row.role;</span><br><span class="line">        form.value.address = row.address;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    const emit = defineEmits([&#x27;refresh&#x27;])</span><br><span class="line">    const onUpdate = async() =&gt; &#123;</span><br><span class="line">        await axios.put(&quot;/users&quot;,form.value)</span><br><span class="line">        dialogVisible.value = false;</span><br><span class="line">        emit(&quot;refresh&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    defineExpose(&#123;</span><br><span class="line">        open</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&lt;/script&gt; </span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;el-dialog v-model = &quot;dialogVisible&quot; title = &quot;编辑&quot; width = &quot;500px&quot;&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h1 id="4-Vue3新特性"><a href="#4-Vue3新特性" class="headerlink" title="4- Vue3新特性"></a>4- Vue3新特性</h1><h2 id="4-1-defineOptions"><a href="#4-1-defineOptions" class="headerlink" title="4-1 defineOptions"></a>4-1 defineOptions</h2><p>介绍：</p>
<ul>
<li>在 Vue 3.3 中新引入了 defineOptions 宏。顾名思义，主要是用来定义 Options API的选项。可以用defineOptions 定义任意的选项，props，emits，expose，slots 除外（因为这些可以使用 defineXXX 来做到）。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">    //之前，还必须再定义一遍&lt;script&gt;</span><br><span class="line">	&lt;script&gt;</span><br><span class="line">    export default&#123;</span><br><span class="line">    	name: &quot;LoginIndex&quot;,</span><br><span class="line">    &#125;</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">    </span><br><span class="line">    //之后</span><br><span class="line">	defineOptions(&#123;</span><br><span class="line">		name: &quot;LoginIndex&quot;,</span><br><span class="line">		inheritAttrs: false,</span><br><span class="line">		//...更多自定义属性</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="4-2-defineModel"><a href="#4-2-defineModel" class="headerlink" title="4-2 defineModel"></a>4-2 defineModel</h2><p>介绍：</p>
<ul>
<li><p>是试验性质的方法，是父子间的方法</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240321180926093.png"
                      alt="image-20240321180926093"
                ></p>
</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//开启,在vite.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>:[</span><br><span class="line">	<span class="title function_">vue</span>(&#123;</span><br><span class="line">		<span class="attr">script</span>:&#123;</span><br><span class="line">			<span class="attr">defineModel</span>:<span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;),</span><br><span class="line">], </span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//子组件</span><br><span class="line"></span><br><span class="line">//之前</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">	defineProps(&#123;</span><br><span class="line">		modelValue: String</span><br><span class="line">	&#125;)</span><br><span class="line">	const emit = defineEmits([&#x27;update:modelValue&#x27;])</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;temple&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;input</span><br><span class="line">			type=&quot;text&quot;</span><br><span class="line">			:value=&quot;modelValue&quot;</span><br><span class="line">			@input=&quot;e =&gt; emit(&#x27;update:modelValue&#x27;, e.target.value)&quot;</span><br><span class="line">		&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/temple&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//之后</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; defineModel &#125; from &#x27;vue&#x27;</span><br><span class="line">    </span><br><span class="line">	const modelValue = defineModel()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;temple&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;input</span><br><span class="line">			type=&quot;text&quot;</span><br><span class="line">			:value=&quot;modelValue&quot;</span><br><span class="line">			@input=&quot;e =&gt; modelValue = e.target.value&quot;</span><br><span class="line">		&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/temple&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//父组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import MyInput from &#x27;@/components/my-input.vue</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">	</span><br><span class="line">	const txt = ref(&#x27;123456&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;MyInput v-model=&quot;txt&quot;&gt;&lt;/MyInput&gt;</span><br><span class="line">		&#123;&#123; txt &#125;&#125;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h1 id="5-Pinia"><a href="#5-Pinia" class="headerlink" title="5- Pinia"></a>5- Pinia</h1><h2 id="5-1-介绍"><a href="#5-1-介绍" class="headerlink" title="5-1 介绍"></a>5-1 介绍</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240321184212035.png"
                      alt="image-20240321184212035"
                ></li>
</ul>
<h2 id="5-2-添加Pinia"><a href="#5-2-添加Pinia" class="headerlink" title="5-2 添加Pinia"></a>5-2 添加Pinia</h2><p>1.使用 Vite 创建一个空的 Vue3 项目</p>
<ul>
<li>npm create vue@latest</li>
</ul>
<p>2.在创建时直接添加Pinia</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240322094512864.png"
                      alt="image-20240322094512864"
                ></li>
</ul>
<p>2.按照官方文档 安装 Pinia 到项目中</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240321202703333.png"
                      alt="image-20240321202703333"
                ></li>
</ul>
<h2 id="5-3-Pinia的基本语法"><a href="#5-3-Pinia的基本语法" class="headerlink" title="5-3 Pinia的基本语法"></a>5-3 Pinia的基本语法</h2><h3 id="5-3-1-基础语法介绍"><a href="#5-3-1-基础语法介绍" class="headerlink" title="5-3-1 基础语法介绍"></a>5-3-1 基础语法介绍</h3><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ref() 就是 state 属性</span></span><br><span class="line"><span class="comment">//computed() 就是 getters</span></span><br><span class="line"><span class="comment">//function() 就是 actions</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>,<span class="function">()	=&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">		count.<span class="property">value</span>++</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>&#123; </span><br><span class="line">        count,</span><br><span class="line">        increment </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h3 id="5-3-2-基础使用–计数器案例"><a href="#5-3-2-基础使用–计数器案例" class="headerlink" title="5-3-2 基础使用–计数器案例"></a>5-3-2 基础使用–计数器案例</h3><p>1.在 src 创建一个 store 文件夹，在里面创建仓库 counter.js</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义store</span></span><br><span class="line"><span class="comment">//defineStore (仓库的唯一标识,() =&gt; &#123; ... &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//声明数据 state - count </span></span><br><span class="line">    <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">100</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//声明操作数据的方法 action (普通函数)</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">addCount</span> = (<span class="params"></span>) =&gt; count.<span class="property">value</span>++</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">subCount</span> = (<span class="params"></span>) =&gt; count.<span class="property">value</span>--</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//声明基于数据派生的计算属性 getters (computed)</span></span><br><span class="line">    <span class="keyword">const</span> double = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span> * <span class="number">2</span> )</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//声明数据 state - msg</span></span><br><span class="line">    <span class="keyword">const</span> msg = <span class="title function_">ref</span>(<span class="string">&#x27;hello pinia&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        count,</span><br><span class="line">        msg,</span><br><span class="line">        addCount,</span><br><span class="line">        subCount,</span><br><span class="line">        double</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<p>2.实体Vue</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//父组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import Son1Com from &#x27;@/components/SonCom.vue&#x27;</span><br><span class="line">import &#123; useCounterStore &#125; from &#x27;@/store/counte&#x27;</span><br><span class="line">    </span><br><span class="line">    const counterStore = useCounterStore()    </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;h3&gt;App.vue根组件 - &#123;&#123; counterStore.count &#125;&#125; - &#123;&#123; counterStore.msg &#125;&#125;&lt;/h3&gt;</span><br><span class="line">		&lt;SonCom&gt;&lt;/SonCom&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">//子组件</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useCounterStore &#125; from &#x27;@/store/counte&#x27;</span><br><span class="line">    </span><br><span class="line">    const counterStore = useCounterStore()  </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		我是Son1.vue - &#123;&#123; counterStore.count &#125;&#125; - &#123;&#123; counterStore.double &#125;&#125;</span><br><span class="line">        &lt;button @click = &quot;counterStore.addCount&quot;&gt;+&lt;/button&gt;</span><br><span class="line">        我是Son2.vue - &#123;&#123; counterStore.count &#125;&#125;</span><br><span class="line">        &lt;button @click = &quot;counterStore.subCount&quot;&gt;-&lt;/button&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="5-4-action异步实现"><a href="#5-4-action异步实现" class="headerlink" title="5-4 action异步实现"></a>5-4 action异步实现</h2><p>介绍：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240322103147175.png"
                      alt="image-20240322103147175"
                ></li>
</ul>
<p>实现：</p>
<p>1.在 src 创建一个 store 文件夹，在里面创建仓库 channel.js</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useChannelStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;channel&#x27;</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//声明数据</span></span><br><span class="line">    <span class="keyword">const</span> channelList = <span class="title function_">ref</span>([])</span><br><span class="line"></span><br><span class="line">	<span class="comment">//声明操作数据的方法</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getList</span> = <span class="keyword">async</span>(<span class="params"></span>) =&gt; &#123;</span><br><span class="line">		<span class="comment">//支持异步</span></span><br><span class="line">		<span class="keyword">const</span> &#123; <span class="attr">data</span>:&#123; data &#125;&#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;http://geek.itheima.net/v1_0/channels&#x27;</span>)</span><br><span class="line">        channelList.<span class="property">value</span> = data.<span class="property">channels</span></span><br><span class="line">		<span class="variable language_">console</span>.1og(data.<span class="property">channels</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//声明getters相关</span></span><br><span class="line">    </span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">       	channelList,</span><br><span class="line">       	getList </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<p>2.实体Vue</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useChannelStore &#125; from &#x27;@/store/channel&#x27;</span><br><span class="line">    </span><br><span class="line">    const channelStore = useChannelStore()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;button @click = &quot;channelStore.getList&quot;&gt;获取频道数据&lt;/button&gt;</span><br><span class="line">       	&lt;ul&gt;</span><br><span class="line">            &lt;li v-for = &quot;item in channelStore.channelList&quot; :key = &quot;item.id&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;/li&gt;</span><br><span class="line">    	&lt;/ul&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="5-5-storeToRefs方法"><a href="#5-5-storeToRefs方法" class="headerlink" title="5-5 storeToRefs方法"></a>5-5 storeToRefs方法</h2><p>不使用方法</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useCounterStore &#125; from &#x27;@/store/counte&#x27;</span><br><span class="line">    </span><br><span class="line">    const counterStore = useCounterStore()  </span><br><span class="line">    </span><br><span class="line">    //1.此时，直接解构，不处理，数据会丢失响应式</span><br><span class="line">    const &#123; count, msg &#125; = counterStore</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">        &lt;!-- 2.数据直接调用 --&gt;</span><br><span class="line">		&lt;h3&gt;App.vue根组件 - &#123;&#123; count &#125;&#125; - &#123;&#123; msg &#125;&#125;&lt;/h3&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<p>使用方法</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useCounterStore &#125; from &#x27;@/store/counte&#x27;</span><br><span class="line">import &#123; useChannelStore &#125; from &#x27;@/store/channel&#x27;</span><br><span class="line">    </span><br><span class="line">    const counterStore = useCounterStore() </span><br><span class="line">    const channelStore = useChannelStore()</span><br><span class="line">    </span><br><span class="line">    //是响应式的ref</span><br><span class="line">    //同时通过插件添加的属性也会被提取为ref</span><br><span class="line">    //并且会跳过所有的 action 或 非响应式(不是 ref 或 reactive ) 的属性</span><br><span class="line">    const &#123; count, msg &#125; = storeToRefs (counterStore)</span><br><span class="line">    const &#123; channelList &#125; = storeToRefs (channelStore)</span><br><span class="line">    //作为 action 可以直接解构</span><br><span class="line">    const &#123; getList &#125; = channelStore</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">        &lt;!-- 数据直接调用 --&gt;</span><br><span class="line">		&lt;h3&gt;App.vue根组件 - &#123;&#123; count &#125;&#125; - &#123;&#123; msg &#125;&#125;&lt;/h3&gt;</span><br><span class="line">		&lt;button @click = &quot;getList&quot;&gt;获取频道数据&lt;/button&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li v-for = &quot;item in channelList&quot; :key = &quot;item.id&quot;&gt;&#123;&#123; item.name &#125;&#125;&lt;/li&gt;</span><br><span class="line">    	&lt;/ul&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="5-6-Pinia持久化"><a href="#5-6-Pinia持久化" class="headerlink" title="5-6 Pinia持久化"></a>5-6 Pinia持久化</h2><h3 id="5-6-1-基础使用"><a href="#5-6-1-基础使用" class="headerlink" title="5-6-1 基础使用"></a>5-6-1 基础使用</h3><p>1.安装依赖</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm i pinia-plugin-persistedstate</span><br></pre></td></tr></table></figure></div>

<p>2.添加插件到 mian.js</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> piniaPluginPersistedstate <span class="keyword">from</span> <span class="string">&#x27;pinia-plugin-persistedstate&#x27;</span> <span class="comment">//导入持久化的插件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>() <span class="comment">//创建Pinia实例</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>) <span class="comment">//创建根实例</span></span><br><span class="line">app.<span class="title function_">use</span>(pinia.<span class="title function_">use</span>(piniaPluginPersistedstate)) <span class="comment">//pinia插件的安装配置</span></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>) <span class="comment">//视图的挂载</span></span><br></pre></td></tr></table></figure></div>

<p>3.使用</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; definestore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useStore = <span class="title function_">definestore</span>(<span class="string">&#x27;main&#x27;</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">const</span> someState = <span class="title function_">ref</span>(<span class="string">&#x27;你好 pinia&#x27;</span>)</span><br><span class="line">		<span class="keyword">return</span> &#123; </span><br><span class="line">            someState </span><br><span class="line">        &#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">persist</span>: <span class="literal">true</span>, <span class="comment">//开启当前模块的持久化</span></span><br><span class="line">	&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<h3 id="5-6-2-其他配置"><a href="#5-6-2-其他配置" class="headerlink" title="5-6-2 其他配置"></a>5-6-2 其他配置</h3><p>使用 localstorage 进行存储</p>
<p>store.$id 作为 storage 默认的 key</p>
<p>整个 state 默认将被持久化</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">//persist: true,</span></span><br><span class="line">    persist &#123;</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;hm-counter&#x27;</span>, <span class="comment">//修改本地存储的唯一标识</span></span><br><span class="line">        <span class="attr">storage</span>: <span class="variable language_">sessionStorage</span>, <span class="comment">//这个 store 将被持久化存储在 sessionStorage</span></span><br><span class="line">        <span class="attr">paths</span>: [<span class="string">&#x27;count&#x27;</span>] <span class="comment">//存储的是哪些数据,默认是所有数据都持久化</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="6-基础准备"><a href="#6-基础准备" class="headerlink" title="6- 基础准备"></a>6- 基础准备</h1><h2 id="6-1-pnpm创建项目"><a href="#6-1-pnpm创建项目" class="headerlink" title="6-1 pnpm创建项目"></a>6-1 pnpm创建项目</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240322202543777.png"
                      alt="image-20240322202543777"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240322203835583.png"
                      alt="image-20240322203835583"
                ></li>
</ul>
<h2 id="6-2-ESLint配合Prettier配置代码风格"><a href="#6-2-ESLint配合Prettier配置代码风格" class="headerlink" title="6-2 ESLint配合Prettier配置代码风格"></a>6-2 ESLint配合Prettier配置代码风格</h2><p>配置文件 .eslintrc.cjs</p>
<ul>
<li>提示：安装Eslint且配置保存修复，不要开启默认的自动保存格式化</li>
</ul>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">root</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&#x27;extends&#x27;</span>: [</span><br><span class="line">    <span class="string">&#x27;plugin:vue/vue3-essential&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;eslint:recommended&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@vue/eslint-config-prettier/skip-formatting&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ecmaVersion</span>: <span class="string">&#x27;latest&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//  添加定制部分</span></span><br><span class="line">  <span class="attr">rule</span>: &#123;</span><br><span class="line">    <span class="comment">// prettier专注于代码的美观度(格式化工具)</span></span><br><span class="line">    <span class="comment">// 前置:</span></span><br><span class="line">    <span class="comment">// 1.禁用格式化插件 prettier format on save 关闭</span></span><br><span class="line">    <span class="comment">// 2.安装Eslint插件，并配置保存时自动修复</span></span><br><span class="line">    <span class="string">&#x27;prettier/prettier&#x27;</span>: [</span><br><span class="line">      <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">singleQuote</span>: <span class="literal">true</span>,<span class="comment">// 单引号</span></span><br><span class="line">        <span class="attr">semi</span>: <span class="literal">false</span>,<span class="comment">// 无分号</span></span><br><span class="line">        <span class="attr">printwidth</span>: <span class="number">80</span>,<span class="comment">// 每行宽度至多88字符</span></span><br><span class="line">        <span class="attr">trailingComma</span>: <span class="string">&#x27;none&#x27;</span>,<span class="comment">// 不加对象|数组最后逗号</span></span><br><span class="line">        <span class="attr">endOfLine</span>: <span class="string">&#x27;auto&#x27;</span> <span class="comment">//换行符号不限制(win mac 不一致)</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//ESLint关注于规范，如果不符合规范，报错</span></span><br><span class="line">    <span class="string">&#x27;vue/multi-word-component-names&#x27;</span>: [</span><br><span class="line">      <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">ignores</span>: [<span class="string">&#x27;index&#x27;</span>]<span class="comment">// vue组件名称多单词组成(忽略index.vue)</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;vue/no-setup-props-destructure&#x27;</span>: [<span class="string">&#x27;off&#x27;</span>],<span class="comment">// 关闭 props 解构的校验(props解构丢失响应式)</span></span><br><span class="line">    <span class="comment">// 添加未定义变量错误提示，create-vue@3.6.3 关闭，这里加上是为了支持下一个章节演示。</span></span><br><span class="line">    <span class="string">&#x27;no-undef&#x27;</span>: <span class="string">&#x27;error&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="6-3-基于husky的代码检查工作流"><a href="#6-3-基于husky的代码检查工作流" class="headerlink" title="6-3 基于husky的代码检查工作流"></a>6-3 基于husky的代码检查工作流</h2><p>介绍：</p>
<ul>
<li>husky 是一个 git hooks 工具 (git的钩子工具，可以在特定时机执行特定的命令)。</li>
<li>pnpm lint 是全量检查，有耗时问题、历史问题，使用pnpm lint-staged。</li>
</ul>
<h3 id="6-3-1-husky配置"><a href="#6-3-1-husky配置" class="headerlink" title="6-3-1 husky配置"></a>6-3-1 husky配置</h3><p>1.打开Git Bash 终端</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure></div>

<p>2.初始化 husky 工具配置 <a class="link"   href="https://typicode.github.io/husky/" >https://typicode.github.io/husky/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm dlx husky-init &amp;&amp; pnpm install</span><br></pre></td></tr></table></figure></div>

<p>3.修改 .husky&#x2F;pre-cbmmit 文件</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">修改 npm test 为 pnpm lint</span><br></pre></td></tr></table></figure></div>

<h3 id="6-3-2-暂存区eslint校验"><a href="#6-3-2-暂存区eslint校验" class="headerlink" title="6-3-2 暂存区eslint校验"></a>6-3-2 暂存区eslint校验</h3><p>1.安装</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm i lint-staged -D</span><br></pre></td></tr></table></figure></div>

<p>2.配置 package.json</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		......</span><br><span class="line">		<span class="attr">&quot;lint-staged&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lint-staged&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;lint-staged&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;*.&#123;js,ts,vue&#125;&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;eslint --fix&quot;</span></span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>3.修改 .husky&#x2F;pre-cbmmit 文件</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">修改 pnpm lint 为 pnpm lint-staged</span><br></pre></td></tr></table></figure></div>

<h2 id="6-4-调整目录"><a href="#6-4-调整目录" class="headerlink" title="6-4 调整目录"></a>6-4 调整目录</h2><p>主要是以下工作:</p>
<ul>
<li><p>1.删除一些初始化的默认文件</p>
<ul>
<li>删除 assets 包下的所有文件</li>
<li>删除 components 包下的所有文件</li>
<li>删除 stores 包下的所有文件</li>
<li>删除 views 包下的所有文件</li>
</ul>
</li>
<li><p>2.修改剩余代码内容</p>
<ul>
<li>删除 router 包下的 index.js 的 routers: [ ] 下的代码与相关引入</li>
<li>删除 App.vue 的内容，只留框架</li>
</ul>
</li>
<li><p>3.新增调整我们需要的目录结构</p>
<ul>
<li>新增文件夹 utils</li>
<li>新增文件夹 api</li>
</ul>
</li>
<li><p>4.拷贝全局样式和图片，安装预处理器支持</p>
<ul>
<li>安装命令：pnpm add sass -D</li>
</ul>
</li>
</ul>
<h1 id="7-项目"><a href="#7-项目" class="headerlink" title="7- 项目"></a>7- 项目</h1><h2 id="7-1-vue-router4-路由"><a href="#7-1-vue-router4-路由" class="headerlink" title="7-1 vue-router4 路由"></a>7-1 vue-router4 路由</h2><h3 id="7-1-1-router配置"><a href="#7-1-1-router配置" class="headerlink" title="7-1-1 router配置"></a>7-1-1 router配置</h3><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// createRouter 创建路由实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 history 模式</span></span><br><span class="line"><span class="comment">// 1.history模式: createWebHistory 地址栏不带#</span></span><br><span class="line"><span class="comment">// 2.hash模式: createWebHashHistory 地址栏带#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vite 中的环境变量: import.meta.env.BASE_URL，就是 vite.config.js 中的 base 配置项，可以在 vite.config.js 添加   ( base:&#x27;/&#x27;,)，也可以直接修改，默认是/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="comment">//history: createWebHistory(&#x27;/lrq&#x27;), </span></span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">BASE_URL</span>),</span><br><span class="line">  <span class="attr">routes</span>: [ ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure></div>

<h3 id="7-1-2-跳转网址"><a href="#7-1-2-跳转网址" class="headerlink" title="7-1-2 跳转网址"></a>7-1-2 跳转网址</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">// 在 Vue3 CompositionAPI 中</span><br><span class="line">// 1.获取路由对象 router useRouter</span><br><span class="line">// const router = useRouter()</span><br><span class="line">// 2.获取路由参数 route useRoute</span><br><span class="line">// const route = useRoute()</span><br><span class="line">    </span><br><span class="line">import &#123; useRoute, useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line"></span><br><span class="line">	const router = useRouter()</span><br><span class="line">	const route = useRoute()</span><br><span class="line">	</span><br><span class="line">	const goList = () =&gt;&#123;</span><br><span class="line">		router.push(&#x27;/list&#x27;)</span><br><span class="line">		console.log(router, route)</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;temple&gt;</span><br><span class="line">	&lt;button @click = &quot;$router.push(&#x27;/home&#x27;)&quot;&gt;跳首页&lt;/button&gt;</span><br><span class="line">	&lt;button @click = &quot;goList&quot;&gt;跳列表页&lt;/button&gt;</span><br><span class="line">&lt;/temple&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="7-2-引入-Element-Plus-组件库"><a href="#7-2-引入-Element-Plus-组件库" class="headerlink" title="7-2 引入 Element Plus 组件库"></a>7-2 引入 Element Plus 组件库</h2><p>1.安装</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm install element-plus</span><br></pre></td></tr></table></figure></div>

<p>2.首先需要安装 unplugin-vue-components 和 unplugin-auto-import 这两款插件</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install -D unplugin-vue-components unplugin-auto-import</span><br><span class="line">或</span><br><span class="line">pnpm add -D unplugin-vue-components unplugin-auto-import</span><br></pre></td></tr></table></figure></div>

<p>3.然后把下列代码插入到你的 vite.config.js 的配置文件中</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">AutoImport</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-auto-import/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Components</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElementPlusResolver</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/resolvers&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="title class_">AutoImport</span>(&#123;</span><br><span class="line">      <span class="attr">resolvers</span>: [<span class="title class_">ElementPlusResolver</span>()],</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title class_">Components</span>(&#123;</span><br><span class="line">      <span class="attr">resolvers</span>: [<span class="title class_">ElementPlusResolver</span>()],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<p>4.官网（<a class="link"   href="https://element-plus.org/zh-CN/" >一个 Vue 3 UI 框架 | Element Plus (element-plus.org) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>)查看组件，直接使用</p>
<p>5.彩蛋：默认 components 下的文件也会被 自动注册</p>
<h2 id="7-3-Pinia-构建仓库-和-持久化"><a href="#7-3-Pinia-构建仓库-和-持久化" class="headerlink" title="7-3 Pinia 构建仓库 和 持久化"></a>7-3 Pinia 构建仓库 和 持久化</h2><h3 id="7-3-1-pinia-独立维护"><a href="#7-3-1-pinia-独立维护" class="headerlink" title="7-3-1 pinia 独立维护"></a>7-3-1 pinia 独立维护</h3><p>1.在 stores 文件夹下创建 文件 index.js</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> piniaPluginPersistedstate <span class="keyword">from</span> <span class="string">&#x27;pinia-plugin-persistedstate&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line">pinia.<span class="title function_">use</span>(piniaPluginPersistedstate)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pinia</span><br></pre></td></tr></table></figure></div>

<p>2.修改文件 main.js</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> pinia <span class="keyword">from</span> <span class="string">&#x27;@/stores/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(pinia)</span><br><span class="line">app.<span class="title function_">use</span>(router)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="7-3-2-仓库-统一导出"><a href="#7-3-2-仓库-统一导出" class="headerlink" title="7-3-2 仓库 统一导出"></a>7-3-2 仓库 统一导出</h3><p>1.在 stores 文件夹下创建 文件夹 modules，把 仓库 .js 文件放入</p>
<p>2.修改文件 index.js</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> piniaPluginPersistedstate <span class="keyword">from</span> <span class="string">&#x27;pinia-plugin-persistedstate&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line">pinia.<span class="title function_">use</span>(piniaPluginPersistedstate)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pinia</span><br><span class="line"></span><br><span class="line"><span class="comment">//import &#123; useUserStore &#125; from &#x27;./modules/user&#x27;</span></span><br><span class="line"><span class="comment">//export &#123; useUserStore &#125;</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./modules/user&#x27;</span> <span class="comment">//等价上面两条语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//import &#123; useCountStore &#125; from &#x27;./modules/counter&#x27;</span></span><br><span class="line"><span class="comment">//export &#123; useCountStore &#125;</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./modules/counter&#x27;</span> <span class="comment">//等价上面两条语句</span></span><br></pre></td></tr></table></figure></div>

<p>3.在 vue 文件引入</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &#123; useUserStore, useCountStore &#125; from &#x27;@/stores&#x27;</span><br></pre></td></tr></table></figure></div>

<h2 id="7-4-数据交互-请求工具设计"><a href="#7-4-数据交互-请求工具设计" class="headerlink" title="7-4 数据交互-请求工具设计"></a>7-4 数据交互-请求工具设计</h2><h3 id="7-4-1-介绍"><a href="#7-4-1-介绍" class="headerlink" title="7-4-1 介绍"></a>7-4-1 介绍</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240325191507445.png"
                      alt="image-20240325191507445"
                ></li>
</ul>
<h3 id="7-4-2-配置-实例与拦截器"><a href="#7-4-2-配置-实例与拦截器" class="headerlink" title="7-4-2 配置-实例与拦截器"></a>7-4-2 配置-实例与拦截器</h3><p>1.安装 axios</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm add axios</span><br></pre></td></tr></table></figure></div>

<p>2.新建 utils&#x2F;request.js 封装 axios 模块，利用 axios.create 创建一个自定义的 axios 来使用</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@/stores/modules/user&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> baseURL = <span class="string">&#x27;http://big-event-vue-api-t.itheima.net&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line"><span class="comment">//TODO 1.基础地址，超时时间</span></span><br><span class="line">    baseURL,</span><br><span class="line">    <span class="attr">timeout</span>:<span class="number">10000</span> <span class="comment">//10秒</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">instance.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">    <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">//TODO 2.携带token</span></span><br><span class="line">        <span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>()</span><br><span class="line">        <span class="keyword">if</span>(userStore.<span class="property">token</span>)&#123;</span><br><span class="line">            config.<span class="property">headers</span>.<span class="property">Authorization</span> = userStore.<span class="property">token</span></span><br><span class="line">        &#125;</span><br><span class="line">		<span class="keyword">return</span> config</span><br><span class="line">    &#125;,</span><br><span class="line">	<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">instance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">    <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//TODO 3.摘取核心响应数据</span></span><br><span class="line">        <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//TODO 4.处理业务失败</span></span><br><span class="line">        <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">message</span> || <span class="string">&#x27;服务异常&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(res.<span class="property">data</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">	<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//TODO 5.处理401错误</span></span><br><span class="line">        <span class="comment">//错误的特殊情况 =&gt; 401权限不足或token过期 =&gt; 拦截到登录</span></span><br><span class="line">        <span class="keyword">if</span>(err.<span class="property">response</span>?.<span class="property">status</span> == <span class="number">401</span>)&#123;</span><br><span class="line">            router.<span class="title function_">push</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//一般错误 =&gt; 直接给提示</span></span><br><span class="line">        <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(err.<span class="property">response</span>.<span class="property">data</span>.<span class="property">message</span> || <span class="string">&#x27;服务异常&#x27;</span>)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> instance</span><br><span class="line"><span class="keyword">export</span> &#123; baseURL &#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="7-5-整体路由设计"><a href="#7-5-整体路由设计" class="headerlink" title="7-5 整体路由设计"></a>7-5 整体路由设计</h2><p>约定路由规则</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240325203217500.png"
                      alt="image-20240325203217500"
                ></li>
</ul>
<p>实现</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/login/LoginPage.vue&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/layout/LayoutContainer.vue&#x27;</span>),</span><br><span class="line"></span><br><span class="line">      <span class="comment">//访问&#x27;/&#x27;时，自动跳转&#x27;/article/manage&#x27;</span></span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&#x27;/article/manage&#x27;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">//二级路由</span></span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/article/manage&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/article/ArticleManage.vue&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/article/channel&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/article/ArticleChannel.vue&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/user/profile&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/user/UserProfile.vue&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/user/avatar&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/user/UserAvatar.vue&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/user/password&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/user/UserPassword.vue&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure></div>

<h2 id="7-6-登录注册页面-element-plus-表单-表单校验"><a href="#7-6-登录注册页面-element-plus-表单-表单校验" class="headerlink" title="7-6 登录注册页面 [ element-plus 表单 &amp; 表单校验 ]"></a>7-6 登录注册页面 [ element-plus 表单 &amp; 表单校验 ]</h2><h3 id="7-6-1-功能要求"><a href="#7-6-1-功能要求" class="headerlink" title="7-6-1 功能要求"></a>7-6-1 功能要求</h3><p>1.注册登录 静态结构 &amp; 基本切换</p>
<p>2.注册功能 ( 校验+注册 ) </p>
<p>3.登录功能 ( 校验 + 登录 + 存token )</p>
<h3 id="7-6-2-实现"><a href="#7-6-2-实现" class="headerlink" title="7-6-2 实现"></a>7-6-2 实现</h3><h4 id="7-6-2-1安装-element-plus-图标库"><a href="#7-6-2-1安装-element-plus-图标库" class="headerlink" title="7-6-2-1安装 element-plus 图标库"></a>7-6-2-1安装 element-plus 图标库</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm i @element-plus/icons-vue</span><br></pre></td></tr></table></figure></div>

<h4 id="7-6-2-2-views-login-LoginPage-vue"><a href="#7-6-2-2-views-login-LoginPage-vue" class="headerlink" title="7-6-2-2 views &#x2F; login &#x2F; LoginPage.vue"></a>7-6-2-2 views &#x2F; login &#x2F; LoginPage.vue</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; userRegisterService, userLoginService &#125; from &#x27;@/api/user.js&#x27;</span><br><span class="line">import &#123; User, Lock &#125; from &#x27;@element-plus/icons-vue&#x27;</span><br><span class="line">import &#123; ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useUserStore &#125; from &#x27;@/stores&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">const isRegister = ref(false) //控制是登录页面还是注册页面，false为登录，true为注册</span><br><span class="line">const form = ref()</span><br><span class="line"></span><br><span class="line">// 整个的用于提交的form数据对象</span><br><span class="line">const formModel = ref(&#123;</span><br><span class="line">  username: &#x27;&#x27;,</span><br><span class="line">  password: &#x27;&#x27;,</span><br><span class="line">  repassword: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">// 整个表单的校验规则</span><br><span class="line">// 1. 非空校验 required: true      message消息提示，  trigger触发校验的时机 blur change</span><br><span class="line">// 2. 长度校验 min:xx, max: xx</span><br><span class="line">// 3. 正则校验 pattern: 正则规则    \S 非空字符</span><br><span class="line">// 4. 自定义校验 =&gt; 自己写逻辑校验 (校验函数)</span><br><span class="line">//    validator: (rule, value, callback)</span><br><span class="line">//    (1) rule  当前校验规则相关的信息</span><br><span class="line">//    (2) value 所校验的表单元素目前的表单值</span><br><span class="line">//    (3) callback 无论成功还是失败，都需要 callback 回调</span><br><span class="line">//        - callback() 校验成功</span><br><span class="line">//        - callback(new Error(错误信息)) 校验失败</span><br><span class="line">const rules = &#123;</span><br><span class="line">  username: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入用户名&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; min: 5, max: 10, message: &#x27;用户名必须是 5-10位 的字符&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ],</span><br><span class="line">  password: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入密码&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      pattern: /^\S&#123;6,15&#125;$/,</span><br><span class="line">      message: &#x27;密码必须是 6-15位 的非空字符&#x27;,</span><br><span class="line">      trigger: &#x27;blur&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  repassword: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入密码&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      pattern: /^\S&#123;6,15&#125;$/,</span><br><span class="line">      message: &#x27;密码必须是 6-15位 的非空字符&#x27;,</span><br><span class="line">      trigger: &#x27;blur&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      validator: (rule, value, callback) =&gt; &#123;</span><br><span class="line">        // 判断 value 和 当前 form 中收集的 password 是否一致</span><br><span class="line">        if (value !== formModel.value.password) &#123;</span><br><span class="line">          callback(new Error(&#x27;两次输入密码不一致&#x27;))</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          callback() // 就算校验成功，也需要callback</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      trigger: &#x27;blur&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const register = async () =&gt; &#123;</span><br><span class="line">  // 注册成功之前，先进行校验，校验成功 → 请求，校验失败 → 自动提示</span><br><span class="line">  await form.value.validate() //validate:对整个表单的内容进行验证。接收一个回调函数，或返回 Promise。</span><br><span class="line">  await userRegisterService(formModel.value)</span><br><span class="line">  ElMessage.success(&#x27;注册成功&#x27;)</span><br><span class="line">  isRegister.value = false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const userStore = useUserStore()</span><br><span class="line">const router = useRouter()</span><br><span class="line"></span><br><span class="line">const login = async () =&gt; &#123;</span><br><span class="line">  await form.value.validate()</span><br><span class="line">  const res = await userLoginService(formModel.value)</span><br><span class="line">  userStore.setToken(res.data.token)</span><br><span class="line">  ElMessage.success(&#x27;登录成功&#x27;)</span><br><span class="line">  router.push(&#x27;/&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 切换的时候，重置表单内容</span><br><span class="line">watch(isRegister, () =&gt; &#123;</span><br><span class="line">  formModel.value = &#123;</span><br><span class="line">    username: &#x27;&#x27;,</span><br><span class="line">    password: &#x27;&#x27;,</span><br><span class="line">    repassword: &#x27;&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- </span><br><span class="line">    1. 结构相关</span><br><span class="line">      el-row表示一行，一行分成24份 </span><br><span class="line">       el-col表示列  </span><br><span class="line">       (1) :span=&quot;12&quot;  代表在一行中，占12份 (50%)</span><br><span class="line">       (2) :span=&quot;6&quot;   表示在一行中，占6份  (25%)</span><br><span class="line">       (3) :offset=&quot;3&quot; 代表在一行中，左侧margin份数</span><br><span class="line"></span><br><span class="line">       el-form 整个表单组件</span><br><span class="line">       el-form-item 表单的一行 （一个表单域）</span><br><span class="line">       el-input 表单元素（输入框）</span><br><span class="line">    2. 校验相关</span><br><span class="line">       (1) el-form =&gt; :model=&quot;ruleForm&quot;      绑定的整个form的数据对象 &#123; xxx, xxx, xxx &#125;</span><br><span class="line">       (2) el-form =&gt; :rules=&quot;rules&quot;         绑定的整个rules规则对象  &#123; xxx, xxx, xxx &#125;</span><br><span class="line">       (3) 表单元素 =&gt; v-model=&quot;ruleForm.xxx&quot; 给表单元素，绑定form的子属性</span><br><span class="line">       (4) el-form-item =&gt; prop配置生效的是哪个校验规则 (和rules中的字段要对应)</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;el-row class=&quot;login-page&quot;&gt;</span><br><span class="line">    &lt;el-col :span=&quot;12&quot; class=&quot;bg&quot;&gt;&lt;/el-col&gt;</span><br><span class="line">    &lt;el-col :span=&quot;6&quot; :offset=&quot;3&quot; class=&quot;form&quot;&gt;</span><br><span class="line">      &lt;!-- 注册相关表单 --&gt;</span><br><span class="line">      &lt;el-form</span><br><span class="line">        :model=&quot;formModel&quot;</span><br><span class="line">        :rules=&quot;rules&quot;</span><br><span class="line">        ref=&quot;form&quot;</span><br><span class="line">        size=&quot;large&quot;</span><br><span class="line">        autocomplete=&quot;off&quot;</span><br><span class="line">        v-if=&quot;isRegister&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;h1&gt;注册&lt;/h1&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item prop=&quot;username&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;formModel.username&quot;</span><br><span class="line">            :prefix-icon=&quot;User&quot; </span><br><span class="line">            placeholder=&quot;请输入用户名&quot; </span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item prop=&quot;password&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;formModel.password&quot;</span><br><span class="line">            :prefix-icon=&quot;Lock&quot; </span><br><span class="line">            type=&quot;password&quot;</span><br><span class="line">            placeholder=&quot;请输入密码&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item prop=&quot;repassword&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;formModel.repassword&quot;</span><br><span class="line">            :prefix-icon=&quot;Lock&quot;</span><br><span class="line">            type=&quot;password&quot;</span><br><span class="line">            placeholder=&quot;请输入再次密码&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;el-button @click=&quot;register&quot; class=&quot;button&quot; type=&quot;primary&quot; auto-insert-space&gt;</span><br><span class="line">            注册</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item class=&quot;flex&quot;&gt;</span><br><span class="line">          &lt;el-link type=&quot;info&quot; :underline=&quot;false&quot; @click=&quot;isRegister = false&quot;&gt; ← 返回 &lt;/el-link&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 登录相关表单 --&gt;</span><br><span class="line">      &lt;el-form :model=&quot;formModel&quot; :rules=&quot;rules&quot; ref=&quot;form&quot; size=&quot;large&quot; autocomplete=&quot;off&quot; v-else&gt;</span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;h1&gt;登录&lt;/h1&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item prop=&quot;username&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;formModel.username&quot;</span><br><span class="line">            :prefix-icon=&quot;User&quot;</span><br><span class="line">            placeholder=&quot;请输入用户名&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item prop=&quot;password&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;formModel.password&quot;</span><br><span class="line">            name=&quot;password&quot;</span><br><span class="line">            :prefix-icon=&quot;Lock&quot;</span><br><span class="line">            type=&quot;password&quot;</span><br><span class="line">            placeholder=&quot;请输入密码&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item class=&quot;flex&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;flex&quot;&gt;</span><br><span class="line">            &lt;el-checkbox&gt;记住我&lt;/el-checkbox&gt;</span><br><span class="line">            &lt;el-link type=&quot;primary&quot; :underline=&quot;false&quot;&gt;忘记密码？&lt;/el-link&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;el-button @click=&quot;login&quot; class=&quot;button&quot; type=&quot;primary&quot; auto-insert-space&gt;登录&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item class=&quot;flex&quot;&gt;</span><br><span class="line">          &lt;el-link type=&quot;info&quot; :underline=&quot;false&quot; @click=&quot;isRegister = true&quot;&gt; 注册 → &lt;/el-link&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">  &lt;/el-row&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="7-6-2-3-创建-api-user-js"><a href="#7-6-2-3-创建-api-user-js" class="headerlink" title="7-6-2-3 创建 api &#x2F; user.js"></a>7-6-2-3 创建 api &#x2F; user.js</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">userRegisterService</span> = (<span class="params">&#123; username, password, repassword &#125;</span>) =&gt;</span><br><span class="line">  request.<span class="title function_">post</span>(<span class="string">&#x27;/api/reg&#x27;</span>, &#123; username, password, repassword &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">userLoginService</span> = (<span class="params">&#123; username, password &#125;</span>) =&gt;</span><br><span class="line">  request.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, &#123; username, password &#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="7-6-2-4-stores-modules-user-js"><a href="#7-6-2-4-stores-modules-user-js" class="headerlink" title="7-6-2-4 stores &#x2F; modules &#x2F; user.js"></a>7-6-2-4 stores &#x2F; modules &#x2F; user.js</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户模块 token setToken removeToken</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;big-user&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setToken</span> = (<span class="params">newtoken</span>) =&gt; &#123;</span><br><span class="line">    token.<span class="property">value</span> = newtoken</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">removeToken</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    token.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &#123;</span><br><span class="line">      token,</span><br><span class="line">      setToken,</span><br><span class="line">      removeToken</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">persist</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="7-6-2-5-eslintrc-cjs-中声明全局变量名，解决-ElMessage-报错问题"><a href="#7-6-2-5-eslintrc-cjs-中声明全局变量名，解决-ElMessage-报错问题" class="headerlink" title="7-6-2-5 eslintrc.cjs 中声明全局变量名，解决 ElMessage 报错问题"></a>7-6-2-5 eslintrc.cjs 中声明全局变量名，解决 ElMessage 报错问题</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">globals</span>: &#123;</span><br><span class="line">    <span class="title class_">ElMessage</span>: <span class="string">&#x27;readonly&#x27;</span>,</span><br><span class="line">    <span class="title class_">ElMessageBox</span>: <span class="string">&#x27;readonly&#x27;</span>,</span><br><span class="line">    <span class="title class_">ElLoading</span>: <span class="string">&#x27;readonly&#x27;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="7-7-首页-layout-架子-element-plus-菜单组件"><a href="#7-7-首页-layout-架子-element-plus-菜单组件" class="headerlink" title="7-7 首页 layout 架子 [ element-plus 菜单组件 ]"></a>7-7 首页 layout 架子 [ element-plus 菜单组件 ]</h2><h3 id="7-7-1-功能要求"><a href="#7-7-1-功能要求" class="headerlink" title="7-7-1 功能要求"></a>7-7-1 功能要求</h3><p>1.基本架子拆解(菜单组件的使用)</p>
<p>2.登录访问拦截</p>
<p>3.用户基本信息 获取&amp;渲染</p>
<p>4.退出功能 [ element-plus 确认框 ]</p>
<h3 id="7-7-2-实现"><a href="#7-7-2-实现" class="headerlink" title="7-7-2 实现"></a>7-7-2 实现</h3><h4 id="7-7-2-1-views-layout-LayoutContainer-vue"><a href="#7-7-2-1-views-layout-LayoutContainer-vue" class="headerlink" title="7-7-2-1 views &#x2F; layout &#x2F; LayoutContainer.vue"></a>7-7-2-1 views &#x2F; layout &#x2F; LayoutContainer.vue</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;</span><br><span class="line">  Management,</span><br><span class="line">  Promotion,</span><br><span class="line">  UserFilled,</span><br><span class="line">  User,</span><br><span class="line">  Crop,</span><br><span class="line">  EditPen,</span><br><span class="line">  SwitchButton,</span><br><span class="line">  CaretBottom</span><br><span class="line">&#125; from &#x27;@element-plus/icons-vue&#x27;</span><br><span class="line">import avatar from &#x27;@/assets/default.png&#x27;</span><br><span class="line">import &#123; useUserStore &#125; from &#x27;@/stores&#x27;</span><br><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">const userStore = useUserStore()</span><br><span class="line">const router = useRouter()</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  userStore.getUser()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const handleCommand = async (key) =&gt; &#123;</span><br><span class="line">  if (key === &#x27;logout&#x27;) &#123;</span><br><span class="line">    // 退出操作</span><br><span class="line">    await ElMessageBox.confirm(&#x27;你确认要进行退出么&#x27;, &#x27;温馨提示&#x27;, &#123;</span><br><span class="line">      type: &#x27;warning&#x27;,</span><br><span class="line">      confirmButtonText: &#x27;确认&#x27;,</span><br><span class="line">      cancelButtonText: &#x27;取消&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 清除本地的数据 (token + user信息)</span><br><span class="line">    userStore.removeToken()</span><br><span class="line">    userStore.setUser(&#123;&#125;)</span><br><span class="line">    router.push(&#x27;/login&#x27;)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // 跳转操作</span><br><span class="line">    router.push(&#x27;/user/$&#123;key&#125;&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- </span><br><span class="line">    el-menu 整个菜单组件</span><br><span class="line">      :default-active=&quot;$route.path&quot;  配置默认高亮的菜单项</span><br><span class="line">      router  router选项开启，el-menu-item 的 index 就是点击跳转的路径</span><br><span class="line"></span><br><span class="line">    el-menu-item 菜单项</span><br><span class="line">      index=&quot;/article/channel&quot; 配置的是访问的跳转路径，配合default-active的值，实现高亮</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;el-container class=&quot;layout-container&quot;&gt;</span><br><span class="line">    &lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;el-aside__logo&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;el-menu</span><br><span class="line">        active-text-color=&quot;#ffd04b&quot;</span><br><span class="line">        background-color=&quot;#232323&quot;</span><br><span class="line">        :default-active=&quot;$route.path&quot;</span><br><span class="line">        text-color=&quot;#fff&quot;</span><br><span class="line">        router</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;el-menu-item index=&quot;/article/channel&quot;&gt;</span><br><span class="line">          &lt;el-icon&gt;&lt;Management /&gt;&lt;/el-icon&gt;</span><br><span class="line">          &lt;span&gt;文章分类&lt;/span&gt;</span><br><span class="line">        &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;el-menu-item index=&quot;/article/manage&quot;&gt;</span><br><span class="line">          &lt;el-icon&gt;&lt;Promotion /&gt;&lt;/el-icon&gt;</span><br><span class="line">          &lt;span&gt;文章管理&lt;/span&gt;</span><br><span class="line">        &lt;/el-menu-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-sub-menu index=&quot;/user&quot;&gt;</span><br><span class="line">          &lt;!-- 多级菜单的标题 - 具名插槽 title --&gt;</span><br><span class="line">          &lt;template #title&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;UserFilled /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;个人中心&lt;/span&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 展开的内容 - 默认插槽 --&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;/user/profile&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;User /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;基本资料&lt;/span&gt;</span><br><span class="line">          &lt;/el-menu-item&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;/user/avatar&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;Crop /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;更换头像&lt;/span&gt;</span><br><span class="line">          &lt;/el-menu-item&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;/user/password&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;EditPen /&gt;&lt;/el-icon&gt;</span><br><span class="line">            &lt;span&gt;重置密码&lt;/span&gt;</span><br><span class="line">          &lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-sub-menu&gt;</span><br><span class="line">      &lt;/el-menu&gt;</span><br><span class="line">    &lt;/el-aside&gt;</span><br><span class="line">    &lt;el-container&gt;</span><br><span class="line">      &lt;el-header&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          昵称：&lt;strong&gt;&#123;&#123; userStore.user.nickname || userStore.user.username &#125;&#125;&lt;/strong&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">          </span><br><span class="line">        &lt;!-- @command=&quot;handleCommand&quot; 对应下面的 command=&quot; &quot;，触发对应事件 --&gt; </span><br><span class="line">        &lt;el-dropdown placement=&quot;bottom-end&quot; @command=&quot;handleCommand&quot;&gt;</span><br><span class="line">          &lt;!-- 展示给用户，默认看到的 --&gt;</span><br><span class="line">          &lt;span class=&quot;el-dropdown__box&quot;&gt;</span><br><span class="line">            &lt;el-avatar :src=&quot;userStore.user.user_pic || avatar&quot; /&gt; </span><br><span class="line">            &lt;el-icon&gt;&lt;CaretBottom /&gt;&lt;/el-icon&gt;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 折叠的下拉部分 --&gt;</span><br><span class="line">          &lt;template #dropdown&gt;</span><br><span class="line">            &lt;el-dropdown-menu&gt;</span><br><span class="line">              &lt;el-dropdown-item command=&quot;profile&quot; :icon=&quot;User&quot;&gt;基本资料&lt;/el-dropdown-item&gt;</span><br><span class="line">              &lt;el-dropdown-item command=&quot;avatar&quot; :icon=&quot;Crop&quot;&gt;更换头像&lt;/el-dropdown-item&gt;</span><br><span class="line">              &lt;el-dropdown-item command=&quot;password&quot; :icon=&quot;EditPen&quot;&gt;重置密码&lt;/el-dropdown-item&gt;</span><br><span class="line">              &lt;el-dropdown-item command=&quot;logout&quot; :icon=&quot;SwitchButton&quot;&gt;退出登录&lt;/el-dropdown-item&gt;</span><br><span class="line">            &lt;/el-dropdown-menu&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-dropdown&gt;</span><br><span class="line">      &lt;/el-header&gt;</span><br><span class="line">      &lt;el-main&gt;</span><br><span class="line">        &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">      &lt;/el-main&gt;</span><br><span class="line">      &lt;el-footer&gt;大事件 ©2024 Created by 李瑞强&lt;/el-footer&gt;</span><br><span class="line">    &lt;/el-container&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="7-7-2-2-登录访问拦截"><a href="#7-7-2-2-登录访问拦截" class="headerlink" title="7-7-2-2 登录访问拦截"></a>7-7-2-2 登录访问拦截</h4><p>​	需求：只有登录页，可以未授权的时候访问，其他所有页面都需要先登录再访问</p>
<p>​	位置：router &#x2F; index.js</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@/stores&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录访问拦截 =&gt; 默认是直接放行的</span></span><br><span class="line"><span class="comment">// 根据返回值决定，是放行还是拦截</span></span><br><span class="line"><span class="comment">// 返回值：</span></span><br><span class="line"><span class="comment">// 1. undefined / true  直接放行</span></span><br><span class="line"><span class="comment">// 2. false 拦回from的地址页面</span></span><br><span class="line"><span class="comment">// 3. 具体路径 或 路径对象  拦截到对应的地址</span></span><br><span class="line"><span class="comment">//    &#x27;/login&#x27;   &#123; name: &#x27;login&#x27; &#125;</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 如果没有token, 且访问的是非登录页，拦截到登录，其他情况正常放行</span></span><br><span class="line">  <span class="keyword">const</span> useStore = <span class="title function_">useUserStore</span>()</span><br><span class="line">  <span class="keyword">if</span> (!useStore.<span class="property">token</span> &amp;&amp; to.<span class="property">path</span> !== <span class="string">&#x27;/login&#x27;</span>) <span class="keyword">return</span> <span class="string">&#x27;/login&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h4 id="7-7-2-3-api-user-js"><a href="#7-7-2-3-api-user-js" class="headerlink" title="7-7-2-3 api &#x2F; user.js"></a>7-7-2-3 api &#x2F; user.js</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取用户基本信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">userGetInfoService</span> = (<span class="params"></span>) =&gt; request.<span class="title function_">get</span>(<span class="string">&#x27;/my/userinfo&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<h4 id="7-7-2-4-stores-modules-user-js"><a href="#7-7-2-4-stores-modules-user-js" class="headerlink" title="7-7-2-4 stores &#x2F; modules &#x2F; user.js"></a>7-7-2-4 stores &#x2F; modules &#x2F; user.js</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; userGetInfoService &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line"></span><br><span class="line">  ......</span><br><span class="line">  <span class="keyword">const</span> user = <span class="title function_">ref</span>(&#123;&#125;)</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getUser</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">userGetInfoService</span>() <span class="comment">// 请求获取数据</span></span><br><span class="line">    user.<span class="property">value</span> = res.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setUser</span> = (<span class="params">obj</span>) =&gt; &#123;</span><br><span class="line">    user.<span class="property">value</span> = obj</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &#123;</span><br><span class="line">      ......</span><br><span class="line">      user,</span><br><span class="line">      getUser,</span><br><span class="line">      setUser</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">persist</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div>

<h2 id="7-8-文章分类页面-element-plus-表格"><a href="#7-8-文章分类页面-element-plus-表格" class="headerlink" title="7-8 文章分类页面 [ element-plus 表格 ]"></a>7-8 文章分类页面 [ element-plus 表格 ]</h2><h3 id="7-8-1-功能要求"><a href="#7-8-1-功能要求" class="headerlink" title="7-8-1 功能要求"></a>7-8-1 功能要求</h3><p>1.基本架子-Pagecontainer封装</p>
<p>2.文章分类渲染 &amp; loading 处理</p>
<p>3.文章分类添加编辑 [element-plus 弹层]</p>
<p>4.文章分类删除</p>
<h3 id="7-8-2-实现"><a href="#7-8-2-实现" class="headerlink" title="7-8-2 实现"></a>7-8-2 实现</h3><h4 id="7-8-2-1-创建-components-PageContainer-vue"><a href="#7-8-2-1-创建-components-PageContainer-vue" class="headerlink" title="7-8-2-1 创建 components &#x2F; PageContainer.vue"></a>7-8-2-1 创建 components &#x2F; PageContainer.vue</h4><p>1.基本结构样式，用到了 el-card 组件</p>
<p>2.考虑到多个页面复用，封装成组件</p>
<ul>
<li>props 定制标题</li>
<li>默认插槽 defaut 定制内容主体</li>
<li>具名插槽 extra 定制头部右侧额外的按钮</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">defineProps(&#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    required: true,</span><br><span class="line">    type: String</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-card class=&quot;page-container&quot;&gt;</span><br><span class="line">    &lt;template #header&gt;</span><br><span class="line">      &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">        &lt;!-- 标题 父传子内容 --&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; title &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;div class=&quot;extra&quot;&gt;</span><br><span class="line">          &lt;!-- 具名插槽 定制按钮 --&gt;</span><br><span class="line">          &lt;slot name=&quot;extra&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;!-- 默认插槽 定制内容 --&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/el-card&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.page-container &#123;</span><br><span class="line">  min-height: 100%;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">  .header &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h4 id="7-8-2-2-创建-views-article-components-ChannelEdit-vue"><a href="#7-8-2-2-创建-views-article-components-ChannelEdit-vue" class="headerlink" title="7-8-2-2 创建 views &#x2F; article &#x2F; components &#x2F; ChannelEdit.vue"></a>7-8-2-2 创建 views &#x2F; article &#x2F; components &#x2F; ChannelEdit.vue</h4><p>1.弹窗封装 </p>
<p>2.是子组件</p>
<ul>
<li>父组件中给子组件标签通过@绑定事件</li>
<li>子组件内部通过 emit 方法触发事件</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; artEditChannelService, artAddChannelService &#125; from &#x27;@/api/article.js&#x27;</span><br><span class="line">const dialogVisible = ref(false)</span><br><span class="line">const formRef = ref()</span><br><span class="line">const formModel = ref(&#123;</span><br><span class="line">  cate_name: &#x27;&#x27;,</span><br><span class="line">  cate_alias: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">const rules = &#123;</span><br><span class="line">  cate_name: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入分类名称&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      pattern: /^\S&#123;1,10&#125;$/,</span><br><span class="line">      message: &#x27;分类名必须是 1-10 位的非空字符&#x27;,</span><br><span class="line">      trigger: &#x27;blur&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  cate_alias: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入分类别名&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      pattern: /^[a-zA-Z0-9]&#123;1,15&#125;$/,</span><br><span class="line">      message: &#x27;分类名必须是 1-15 位的字母或数字&#x27;,</span><br><span class="line">      trigger: &#x27;blur&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const emit = defineEmits([&#x27;success&#x27;])</span><br><span class="line">const onSubmit = async () =&gt; &#123;</span><br><span class="line">  await formRef.value.validate()</span><br><span class="line">  const isEdit = formModel.value.id</span><br><span class="line">  if (isEdit) &#123;</span><br><span class="line">    await artEditChannelService(formModel.value)</span><br><span class="line">    ElMessage.success(&#x27;编辑成功&#x27;)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    await artAddChannelService(formModel.value)</span><br><span class="line">    ElMessage.success(&#x27;添加成功&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">  dialogVisible.value = false</span><br><span class="line">  // 子传父事件</span><br><span class="line">  emit(&#x27;success&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 组件对外暴露一个方法 open，基于open传来的参数，区分添加还是编辑</span><br><span class="line">// open(&#123;&#125;)  =&gt; 表单无需渲染，说明是添加</span><br><span class="line">// open(&#123; id, cate_name, ... &#125;)  =&gt; 表单需要渲染，说明是编辑</span><br><span class="line">// open调用后，可以打开弹窗</span><br><span class="line">const open = (row) =&gt; &#123;</span><br><span class="line">  dialogVisible.value = true</span><br><span class="line">  formModel.value = &#123; ...row &#125; // 添加 → 重置了表单内容，编辑 → 存储了需要回显的数据</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 向外暴露方法</span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  open</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-dialog v-model=&quot;dialogVisible&quot; :title=&quot;formModel.id ? &#x27;编辑分类&#x27; : &#x27;添加分类&#x27;&quot; width=&quot;30%&quot;&gt;</span><br><span class="line">    &lt;el-form</span><br><span class="line">      ref=&quot;formRef&quot;</span><br><span class="line">      :model=&quot;formModel&quot;</span><br><span class="line">      :rules=&quot;rules&quot;</span><br><span class="line">      label-width=&quot;100px&quot;</span><br><span class="line">      style=&quot;padding-right: 30px&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form-item label=&quot;分类名称&quot; prop=&quot;cate_name&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;formModel.cate_name&quot; placeholder=&quot;请输入分类名称&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;分类别名&quot; prop=&quot;cate_alias&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;formModel.cate_alias&quot; placeholder=&quot;请输入分类别名&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;template #footer&gt;</span><br><span class="line">      &lt;span class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;onSubmit&quot;&gt; 确认 &lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="7-8-2-3-创建-views-article-ArticleChannel-vue"><a href="#7-8-2-3-创建-views-article-ArticleChannel-vue" class="headerlink" title="7-8-2-3 创建 views &#x2F; article &#x2F; ArticleChannel.vue"></a>7-8-2-3 创建 views &#x2F; article &#x2F; ArticleChannel.vue</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; Edit, Delete &#125; from &#x27;@element-plus/icons-vue&#x27;</span><br><span class="line">import &#123; artGetChannelsService, artDelChannelService &#125; from &#x27;@/api/article&#x27;</span><br><span class="line">import ChannelEdit from &#x27;./components/ChannelEdit.vue&#x27;</span><br><span class="line">const channelList = ref([])</span><br><span class="line">const loading = ref(false)</span><br><span class="line">const dialog = ref()</span><br><span class="line"></span><br><span class="line">const getChannelList = async () =&gt; &#123;</span><br><span class="line">  loading.value = true</span><br><span class="line">  const res = await artGetChannelsService()</span><br><span class="line">  channelList.value = res.data.data</span><br><span class="line">  loading.value = false</span><br><span class="line">&#125;</span><br><span class="line">getChannelList()</span><br><span class="line"></span><br><span class="line">const onDelChannel = async (row) =&gt; &#123;</span><br><span class="line">  await ElMessageBox.confirm(&#x27;你确认要删除该分类么&#x27;, &#x27;温馨提示&#x27;, &#123;</span><br><span class="line">    type: &#x27;warning&#x27;,</span><br><span class="line">    confirmButtonText: &#x27;确认&#x27;,</span><br><span class="line">    cancelButtonText: &#x27;取消&#x27;</span><br><span class="line">  &#125;)</span><br><span class="line">  await artDelChannelService(row.id)</span><br><span class="line">  ElMessage.success(&#x27;删除成功&#x27;)</span><br><span class="line">  getChannelList()</span><br><span class="line">&#125;</span><br><span class="line">const onEditChannel = (row) =&gt; &#123;</span><br><span class="line">  dialog.value.open(row)</span><br><span class="line">&#125;</span><br><span class="line">const onAddChannel = () =&gt; &#123;</span><br><span class="line">  dialog.value.open(&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line">const onSuccess = () =&gt; &#123;</span><br><span class="line">  getChannelList()</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;page-container title=&quot;文章分类&quot;&gt;</span><br><span class="line">    &lt;template #extra&gt;</span><br><span class="line">      &lt;el-button @click=&quot;onAddChannel&quot;&gt;添加分类&lt;/el-button&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- v-loading=&quot;loading&quot; 对表格进行 加载动效 --&gt;</span><br><span class="line">    &lt;el-table v-loading=&quot;loading&quot; :data=&quot;channelList&quot; style=&quot;width: 100%&quot;&gt;</span><br><span class="line">      &lt;!-- 设置 type 属性为 index 即可显示从 1 开始的索引号。 --&gt;</span><br><span class="line">      &lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;100&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;cate_name&quot; label=&quot;分类名称&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;cate_alias&quot; label=&quot;分类别名&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;150&quot;&gt;</span><br><span class="line">        &lt;!-- row 就是 channelList 的一项， $index 下标 --&gt;</span><br><span class="line">        &lt;template #default=&quot;&#123; row, $index &#125;&quot;&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            :icon=&quot;Edit&quot;</span><br><span class="line">            circle</span><br><span class="line">            plain</span><br><span class="line">            type=&quot;primary&quot;</span><br><span class="line">            @click=&quot;onEditChannel(row, $index)&quot;</span><br><span class="line">          &gt;&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            :icon=&quot;Delete&quot;</span><br><span class="line">            circle</span><br><span class="line">            plain</span><br><span class="line">            type=&quot;danger&quot;</span><br><span class="line">            @click=&quot;onDelChannel(row, $index)&quot;</span><br><span class="line">          &gt;&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 没有数据时 用Empty空状态 --&gt;</span><br><span class="line">      &lt;template #empty&gt;</span><br><span class="line">        &lt;el-empty description=&quot;没有数据&quot;&gt;&lt;/el-empty&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 调用弹窗夹层 --&gt;</span><br><span class="line">    &lt;!-- @success事件是子传父事件 --&gt;</span><br><span class="line">    &lt;channel-edit ref=&quot;dialog&quot; @success=&quot;onSuccess&quot;&gt;&lt;/channel-edit&gt;</span><br><span class="line">  &lt;/page-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="7-8-2-4-创建-api-article-js"><a href="#7-8-2-4-创建-api-article-js" class="headerlink" title="7-8-2-4 创建 api &#x2F; article.js"></a>7-8-2-4 创建 api &#x2F; article.js</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="comment">// 分类：获取文章分类</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">artGetChannelsService</span> = (<span class="params"></span>) =&gt; request.<span class="title function_">get</span>(<span class="string">&#x27;/my/cate/list&#x27;</span>)</span><br><span class="line"><span class="comment">// 分类：添加文章分类</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">artAddChannelService</span> = (<span class="params">data</span>) =&gt; request.<span class="title function_">post</span>(<span class="string">&#x27;/my/cate/add&#x27;</span>, data)</span><br><span class="line"><span class="comment">// 分类：编辑文章分类</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">artEditChannelService</span> = (<span class="params">data</span>) =&gt; request.<span class="title function_">put</span>(<span class="string">&#x27;/my/cate/info&#x27;</span>, data)</span><br><span class="line"><span class="comment">// 分类：删除文章分类</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">artDelChannelService</span> = (<span class="params">id</span>) =&gt;</span><br><span class="line">  request.<span class="title function_">delete</span>(<span class="string">&#x27;/my/cate/del&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">params</span>: &#123; id &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure></div>

<h2 id="7-9-文章管理页面-element-plus-进阶"><a href="#7-9-文章管理页面-element-plus-进阶" class="headerlink" title="7-9 文章管理页面 [ element-plus 进阶 ]"></a>7-9 文章管理页面 [ element-plus 进阶 ]</h2><h3 id="7-9-1-功能要求"><a href="#7-9-1-功能要求" class="headerlink" title="7-9-1 功能要求"></a>7-9-1 功能要求</h3><p>1.文章列表渲染 (带搜索 &amp;带分页)</p>
<p>2.添加文章 (抽屉 &amp;文件上传 &amp;富文本)</p>
<p>3.编辑文章 (共用抽屉)</p>
<p>4.删除文章</p>
<h3 id="7-9-2-实现"><a href="#7-9-2-实现" class="headerlink" title="7-9-2 实现"></a>7-9-2 实现</h3><h4 id="7-9-2-1-创建-views-article-components-ChannelSelect-vue，封装文章分类动态下拉菜单"><a href="#7-9-2-1-创建-views-article-components-ChannelSelect-vue，封装文章分类动态下拉菜单" class="headerlink" title="7-9-2-1 创建 views &#x2F; article &#x2F; components &#x2F; ChannelSelect.vue，封装文章分类动态下拉菜单"></a>7-9-2-1 创建 views &#x2F; article &#x2F; components &#x2F; ChannelSelect.vue，封装文章分类动态下拉菜单</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; artGetChannelsService &#125; from &#x27;@/api/article.js&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">defineProps(&#123;</span><br><span class="line">  modelValue: &#123;</span><br><span class="line">    type: [Number, String]</span><br><span class="line">  &#125;,</span><br><span class="line">  width: &#123;</span><br><span class="line">    type: String</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">const emit = defineEmits([&#x27;update:modelValue&#x27;])</span><br><span class="line"></span><br><span class="line">const channelList = ref([])</span><br><span class="line">const getChannelList = async () =&gt; &#123;</span><br><span class="line">  const res = await artGetChannelsService()</span><br><span class="line">  channelList.value = res.data.data</span><br><span class="line">&#125;</span><br><span class="line">getChannelList()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- label 展示给用户看的，value 收集起来提交给后台的 --&gt;</span><br><span class="line">  &lt;el-select</span><br><span class="line">    :modelValue=&quot;modelValue&quot;</span><br><span class="line">    @update:modelValue=&quot;emit(&#x27;update:modelValue&#x27;, $event)&quot;</span><br><span class="line">    :style=&quot;&#123; width &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;el-option</span><br><span class="line">      v-for=&quot;channel in channelList&quot;</span><br><span class="line">      :key=&quot;channel.id&quot;</span><br><span class="line">      :label=&quot;channel.cate_name&quot;</span><br><span class="line">      :value=&quot;channel.id&quot;</span><br><span class="line">    &gt;&lt;/el-option&gt;</span><br><span class="line">  &lt;/el-select&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="7-9-2-2-创建-utils-format-js，封装时间函数"><a href="#7-9-2-2-创建-utils-format-js，封装时间函数" class="headerlink" title="7-9-2-2 创建 utils &#x2F; format.js，封装时间函数"></a>7-9-2-2 创建 utils &#x2F; format.js，封装时间函数</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; dayjs &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">formatTime</span> = (<span class="params">time</span>) =&gt; <span class="title function_">dayjs</span>(time).<span class="title function_">format</span>(<span class="string">&#x27;YYYY年MM月DD日&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<h4 id="7-9-2-3-富文本编辑器-vue-quill"><a href="#7-9-2-3-富文本编辑器-vue-quill" class="headerlink" title="7-9-2-3 富文本编辑器[ vue-quill ]"></a>7-9-2-3 富文本编辑器[ vue-quill ]</h4><p>官网：<a class="link"   href="https://vueup.github.io/vue-quill/" >https://vueup.github.io/vue-quill/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>1.安装包</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm add @vueup/vue-quill@latest</span><br></pre></td></tr></table></figure></div>

<p>2.注册成局部组件</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QuillEditor</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueup/vue-quill&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@vueup/vue-quill/dist/vue-quill.snow.css&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>3.页面中使用绑定</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;文章内容&quot; prop=&quot;content&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;editor&quot;&gt;</span><br><span class="line">        &lt;!-- v-model 双向绑定数据 --&gt;</span><br><span class="line">        &lt;!-- content-type 设置文本格式 --&gt;</span><br><span class="line">        &lt;quill-editor</span><br><span class="line">        ref=&quot;editorRef&quot;</span><br><span class="line">        v-model:content=&quot;formModel.content&quot;</span><br><span class="line">        content-type=&quot;html&quot;</span><br><span class="line">        theme=&quot;snow&quot;</span><br><span class="line">        &gt;&lt;/quill-editor&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure></div>

<p>4.样式美化</p>
<div class="highlight-container" data-rel="Css"><figure class="iseeu highlight css"><table><tr><td class="code"><pre><span class="line">// 富文本编辑器功能美化</span><br><span class="line"><span class="selector-class">.editor</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  :<span class="built_in">deep</span>(.ql-editor) &#123;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">200px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="7-9-2-4-创建-views-article-components-ArticleEdit-vue，封装抽屉"><a href="#7-9-2-4-创建-views-article-components-ArticleEdit-vue，封装抽屉" class="headerlink" title="7-9-2-4 创建 views &#x2F; article &#x2F; components &#x2F; ArticleEdit.vue，封装抽屉"></a>7-9-2-4 创建 views &#x2F; article &#x2F; components &#x2F; ArticleEdit.vue，封装抽屉</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import ChannelSelect from &#x27;./ChannelSelect.vue&#x27;</span><br><span class="line">import &#123; Plus &#125; from &#x27;@element-plus/icons-vue&#x27;</span><br><span class="line">import &#123; QuillEditor &#125; from &#x27;@vueup/vue-quill&#x27;</span><br><span class="line">import &#x27;@vueup/vue-quill/dist/vue-quill.snow.css&#x27;</span><br><span class="line">import &#123; artPublishService, artGetDetailService, artEditService &#125; from &#x27;@/api/article&#x27;</span><br><span class="line">import &#123; baseURL &#125; from &#x27;@/utils/request&#x27;</span><br><span class="line">import axios from &#x27;axios&#x27;</span><br><span class="line">// 控制抽屉显示隐藏</span><br><span class="line">const visibleDrawer = ref(false)</span><br><span class="line"></span><br><span class="line">// 默认数据</span><br><span class="line">const defaultForm = &#123;</span><br><span class="line">  title: &#x27;&#x27;, // 标题</span><br><span class="line">  cate_id: &#x27;&#x27;, // 分类id</span><br><span class="line">  cover_img: &#x27;&#x27;, // 封面图片 file 对象</span><br><span class="line">  content: &#x27;&#x27;, // string 内容</span><br><span class="line">  state: &#x27;&#x27; // 状态</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 准备数据</span><br><span class="line">const formModel = ref(&#123; ...defaultForm &#125;)</span><br><span class="line"></span><br><span class="line">// 图片上传相关逻辑</span><br><span class="line">const imgUrl = ref(&#x27;&#x27;)</span><br><span class="line">const onSelectFile = (uploadFile) =&gt; &#123;</span><br><span class="line">  imgUrl.value = URL.createObjectURL(uploadFile.raw) // 预览图片</span><br><span class="line">  // 立刻将图片对象，存入 formModel.value.cover_img 将来用于提交</span><br><span class="line">  formModel.value.cover_img = uploadFile.raw</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 提交</span><br><span class="line">const emit = defineEmits([&#x27;success&#x27;])</span><br><span class="line">const onPublish = async (state) =&gt; &#123;</span><br><span class="line">  // 将已发布还是草稿状态，存入 formModel</span><br><span class="line">  formModel.value.state = state</span><br><span class="line"></span><br><span class="line">  // 注意：当前接口，需要的是 formData 对象</span><br><span class="line">  // 将普通对象 =&gt; 转换成 =&gt; formData对象</span><br><span class="line">  const fd = new FormData()</span><br><span class="line">  for (let key in formModel.value) &#123;</span><br><span class="line">    fd.append(key, formModel.value[key])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 发请求</span><br><span class="line">  if (formModel.value.id) &#123;</span><br><span class="line">    // 编辑操作</span><br><span class="line">    await artEditService(fd)</span><br><span class="line">    ElMessage.success(&#x27;修改成功&#x27;)</span><br><span class="line">    visibleDrawer.value = false</span><br><span class="line">    emit(&#x27;success&#x27;, &#x27;edit&#x27;)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // 添加操作</span><br><span class="line">    await artPublishService(fd)</span><br><span class="line">    ElMessage.success(&#x27;添加成功&#x27;)</span><br><span class="line">    visibleDrawer.value = false</span><br><span class="line">    // 通知到父组件，添加成功了</span><br><span class="line">    emit(&#x27;success&#x27;, &#x27;add&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 组件对外暴露一个方法 open，基于open传来的参数，区分添加还是编辑</span><br><span class="line">// open(&#123;&#125;)  =&gt; 表单无需渲染，说明是添加</span><br><span class="line">// open(&#123; id, ..., ... &#125;)  =&gt; 表单需要渲染，说明是编辑</span><br><span class="line">// open调用后，可以打开抽屉</span><br><span class="line">const editorRef = ref()</span><br><span class="line">const open = async (row) =&gt; &#123;</span><br><span class="line">  visibleDrawer.value = true // 显示抽屉</span><br><span class="line"></span><br><span class="line">  if (row.id) &#123;</span><br><span class="line">    // 需要基于 row.id 发送请求，获取编辑对应的详情数据，进行回显</span><br><span class="line">    const res = await artGetDetailService(row.id)</span><br><span class="line">    formModel.value = res.data.data</span><br><span class="line">    // 图片需要单独处理回显</span><br><span class="line">    imgUrl.value = baseURL + formModel.value.cover_img</span><br><span class="line">    // 注意：提交给后台，需要的数据格式，是file对象格式</span><br><span class="line">    // 需要将网络图片地址 =&gt; 转换成 file对象，存储起来, 将来便于提交</span><br><span class="line">    const file = await imageUrlToFileObject(imgUrl.value, formModel.value.cover_img)</span><br><span class="line">    formModel.value.cover_img = file</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    formModel.value = &#123; ...defaultForm &#125; // 基于默认的数据，重置form数据</span><br><span class="line">    // 这里重置了表单的数据，但是图片上传img地址，富文本编辑器内容 =&gt; 需要手动重置</span><br><span class="line">    imgUrl.value = &#x27;&#x27;</span><br><span class="line">    editorRef.value.setHTML(&#x27;&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 将网络图片地址转换为 File 对象的函数</span><br><span class="line">async function imageUrlToFileObject(imageUrl, filename) &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    // 使用 Axios 下载图片数据</span><br><span class="line">    const response = await axios.get(imageUrl, &#123; responseType: &#x27;arraybuffer&#x27; &#125;)</span><br><span class="line"></span><br><span class="line">    // 将下载的数据转换成 Blob 对象</span><br><span class="line">    const blob = new Blob([response.data], &#123;</span><br><span class="line">      type: response.headers[&#x27;content-type&#x27;]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 创建 File 对象</span><br><span class="line">    const file = new File([blob], filename, &#123;</span><br><span class="line">      type: response.headers[&#x27;content-type&#x27;]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    return file</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(&#x27;Error converting image URL to File object:&#x27;, error)</span><br><span class="line">    return null</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  open</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-drawer</span><br><span class="line">    v-model=&quot;visibleDrawer&quot;</span><br><span class="line">    :title=&quot;formModel.id ? &#x27;编辑文章&#x27; : &#x27;添加文章&#x27;&quot;</span><br><span class="line">    direction=&quot;rtl&quot;</span><br><span class="line">    size=&quot;50%&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- 发表文章表单 --&gt;</span><br><span class="line">    &lt;el-form :model=&quot;formModel&quot; ref=&quot;formRef&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;文章标题&quot; prop=&quot;title&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;formModel.title&quot; placeholder=&quot;请输入标题&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;文章分类&quot; prop=&quot;cate_id&quot;&gt;</span><br><span class="line">        &lt;channel-select v-model=&quot;formModel.cate_id&quot; width=&quot;100%&quot;&gt;&lt;/channel-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;文章封面&quot; prop=&quot;cover_img&quot;&gt;</span><br><span class="line">        &lt;!-- 此处需要关闭 element-plus 的自动上传，不需要配置 action 等参数</span><br><span class="line">             只需要做前端的本地预览图片即可，无需在提交前上传图标</span><br><span class="line">             语法：URL.createObjectURL(...) 创建本地预览的地址，来预览</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;el-upload</span><br><span class="line">          class=&quot;avatar-uploader&quot;</span><br><span class="line">          :show-file-list=&quot;false&quot;</span><br><span class="line">          :auto-upload=&quot;false&quot;</span><br><span class="line">          :on-change=&quot;onSelectFile&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;img v-if=&quot;imgUrl&quot; :src=&quot;imgUrl&quot; class=&quot;avatar&quot; /&gt;</span><br><span class="line">          &lt;el-icon v-else class=&quot;avatar-uploader-icon&quot;&gt;&lt;Plus /&gt;&lt;/el-icon&gt;</span><br><span class="line">        &lt;/el-upload&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;文章内容&quot; prop=&quot;content&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;editor&quot;&gt;</span><br><span class="line">          &lt;!-- v-model 双向绑定数据 --&gt;</span><br><span class="line">          &lt;!-- content-type 设置文本格式 --&gt;</span><br><span class="line">          &lt;quill-editor</span><br><span class="line">            ref=&quot;editorRef&quot;</span><br><span class="line">            v-model:content=&quot;formModel.content&quot;</span><br><span class="line">            content-type=&quot;html&quot;</span><br><span class="line">            theme=&quot;snow&quot;</span><br><span class="line">          &gt;&lt;/quill-editor&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button @click=&quot;onPublish(&#x27;已发布&#x27;)&quot; type=&quot;primary&quot;&gt;发布&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button @click=&quot;onPublish(&#x27;草稿&#x27;)&quot; type=&quot;info&quot;&gt;草稿&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/el-drawer&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">// 图片上传功能美化</span><br><span class="line">.avatar-uploader &#123;</span><br><span class="line">  :deep() &#123;</span><br><span class="line">    .avatar &#123;</span><br><span class="line">      width: 178px;</span><br><span class="line">      height: 178px;</span><br><span class="line">      display: block;</span><br><span class="line">    &#125;</span><br><span class="line">    .el-upload &#123;</span><br><span class="line">      border: 1px dashed var(--el-border-color);</span><br><span class="line">      border-radius: 6px;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">      position: relative;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">      transition: var(--el-transition-duration-fast);</span><br><span class="line">    &#125;</span><br><span class="line">    .el-upload:hover &#123;</span><br><span class="line">      border-color: var(--el-color-primary);</span><br><span class="line">    &#125;</span><br><span class="line">    .el-icon.avatar-uploader-icon &#123;</span><br><span class="line">      font-size: 28px;</span><br><span class="line">      color: #8c939d;</span><br><span class="line">      width: 178px;</span><br><span class="line">      height: 178px;</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 富文本编辑器功能美化</span><br><span class="line">.editor &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  :deep(.ql-editor) &#123;</span><br><span class="line">    min-height: 200px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="7-9-2-5-创建-views-article-ArticleManage-vue"><a href="#7-9-2-5-创建-views-article-ArticleManage-vue" class="headerlink" title="7-9-2-5 创建 views &#x2F; article &#x2F; ArticleManage.vue"></a>7-9-2-5 创建 views &#x2F; article &#x2F; ArticleManage.vue</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; Delete, Edit &#125; from &#x27;@element-plus/icons-vue&#x27;</span><br><span class="line">import ChannelSelect from &#x27;./components/ChannelSelect.vue&#x27;</span><br><span class="line">import ArticleEdit from &#x27;./components/ArticleEdit.vue&#x27;</span><br><span class="line">import &#123; artGetListService, artDelService &#125; from &#x27;@/api/article.js&#x27;</span><br><span class="line">import &#123; formatTime &#125; from &#x27;@/utils/format.js&#x27;</span><br><span class="line">const articleList = ref([]) // 文章列表</span><br><span class="line">const total = ref(0) // 总条数</span><br><span class="line">const loading = ref(false) // loading状态</span><br><span class="line"></span><br><span class="line">// 定义请求参数对象</span><br><span class="line">const params = ref(&#123;</span><br><span class="line">  pagenum: 1, // 当前页</span><br><span class="line">  pagesize: 5, // 当前生效的每页条数</span><br><span class="line">  cate_id: &#x27;&#x27;,</span><br><span class="line">  state: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 基于params参数，获取文章列表</span><br><span class="line">const getArticleList = async () =&gt; &#123;</span><br><span class="line">  loading.value = true</span><br><span class="line"></span><br><span class="line">  const res = await artGetListService(params.value)</span><br><span class="line">  articleList.value = res.data.data</span><br><span class="line">  total.value = res.data.total</span><br><span class="line"></span><br><span class="line">  loading.value = false</span><br><span class="line">&#125;</span><br><span class="line">getArticleList()</span><br><span class="line"></span><br><span class="line">// 处理分页逻辑</span><br><span class="line">const onSizeChange = (size) =&gt; &#123;</span><br><span class="line">  // console.log(&#x27;当前每页条数&#x27;, size)</span><br><span class="line">  // 只要是每页条数变化了，那么原本正在访问的当前页意义不大了，数据大概率已经不在原来那一页了</span><br><span class="line">  // 重新从第一页渲染即可</span><br><span class="line">  params.value.pagenum = 1</span><br><span class="line">  params.value.pagesize = size</span><br><span class="line">  // 基于最新的当前页 和 每页条数，渲染数据</span><br><span class="line">  getArticleList()</span><br><span class="line">&#125;</span><br><span class="line">const onCurrentChange = (page) =&gt; &#123;</span><br><span class="line">  // 更新当前页</span><br><span class="line">  params.value.pagenum = page</span><br><span class="line">  // 基于最新的当前页，渲染数据</span><br><span class="line">  getArticleList()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 搜索逻辑 =&gt; 按照最新的条件，重新检索，从第一页开始展示</span><br><span class="line">const onSearch = () =&gt; &#123;</span><br><span class="line">  params.value.pagenum = 1 // 重置页面</span><br><span class="line">  getArticleList()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 重置逻辑 =&gt; 将筛选条件清空，重新检索，从第一页开始展示</span><br><span class="line">const onReset = () =&gt; &#123;</span><br><span class="line">  params.value.pagenum = 1 // 重置页面</span><br><span class="line">  params.value.cate_id = &#x27;&#x27;</span><br><span class="line">  params.value.state = &#x27;&#x27;</span><br><span class="line">  getArticleList()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const articleEditRef = ref()</span><br><span class="line">// 添加逻辑</span><br><span class="line">const onAddArticle = () =&gt; &#123;</span><br><span class="line">  articleEditRef.value.open(&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line">// 编辑逻辑</span><br><span class="line">const onEditArticle = (row) =&gt; &#123;</span><br><span class="line">  articleEditRef.value.open(row)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除逻辑</span><br><span class="line">const onDeleteArticle = async (row) =&gt; &#123;</span><br><span class="line">  // 提示用户是否要删除</span><br><span class="line">  await ElMessageBox.confirm(&#x27;此操作将永久删除该文件, 是否继续?&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">    confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">    cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">    type: &#x27;warning&#x27;</span><br><span class="line">  &#125;)</span><br><span class="line">  await artDelService(row.id)</span><br><span class="line">  ElMessage.success(&#x27;删除成功&#x27;)</span><br><span class="line">  // 重新渲染列表</span><br><span class="line">  getArticleList()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 添加或者编辑 成功的回调</span><br><span class="line">const onSuccess = (type) =&gt; &#123;</span><br><span class="line">  if (type === &#x27;add&#x27;) &#123;</span><br><span class="line">    // 如果是添加，最好渲染最后一页</span><br><span class="line">    // 向上取整</span><br><span class="line">    const lastPage = Math.ceil((total.value + 1) / params.value.pagesize)</span><br><span class="line">    // 更新成最大页码数，再渲染</span><br><span class="line">    params.value.pagenum = lastPage</span><br><span class="line">  &#125;</span><br><span class="line">  getArticleList()</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;page-container title=&quot;文章管理&quot;&gt;</span><br><span class="line">    &lt;template #extra&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;onAddArticle&quot;&gt;添加文章&lt;/el-button&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 表单区域 --&gt;</span><br><span class="line">    &lt;el-form inline&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;文章分类:&quot;&gt;</span><br><span class="line">        &lt;!-- Vue2 =&gt; v-model :value 和 @input 的简写 --&gt;</span><br><span class="line">        &lt;!-- Vue3 =&gt; v-model :modelValue 和 @update:modelValue 的简写 --&gt;</span><br><span class="line">        &lt;channel-select v-model=&quot;params.cate_id&quot;&gt;&lt;/channel-select&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- Vue3 =&gt; v-model:cid  :cid 和 @update:cid 的简写 --&gt;</span><br><span class="line">        &lt;!-- &lt;channel-select v-model:cid=&quot;params.cate_id&quot;&gt;&lt;/channel-select&gt; --&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;发布状态:&quot;&gt;</span><br><span class="line">        &lt;!-- 这里后台标记发布状态，就是通过中文标记的，已发布 / 草稿 --&gt;</span><br><span class="line">        &lt;el-select v-model=&quot;params.state&quot;&gt;</span><br><span class="line">          &lt;el-option label=&quot;已发布&quot; value=&quot;已发布&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">          &lt;el-option label=&quot;草稿&quot; value=&quot;草稿&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button @click=&quot;onSearch&quot; type=&quot;primary&quot;&gt;搜索&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button @click=&quot;onReset&quot;&gt;重置&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 表格区域 --&gt;</span><br><span class="line">    &lt;el-table :data=&quot;articleList&quot; v-loading=&quot;loading&quot;&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;文章标题&quot; prop=&quot;title&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;el-link type=&quot;primary&quot; :underline=&quot;false&quot;&gt;&#123;&#123; row.title &#125;&#125;&lt;/el-link&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;分类&quot; prop=&quot;cate_name&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;发表时间&quot; prop=&quot;pub_date&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &#123;&#123; formatTime(row.pub_date) &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;状态&quot; prop=&quot;state&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 利用作用域插槽 row 可以获取当前行的数据 =&gt; v-for 遍历 item --&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            circle</span><br><span class="line">            plain</span><br><span class="line">            type=&quot;primary&quot;</span><br><span class="line">            :icon=&quot;Edit&quot;</span><br><span class="line">            @click=&quot;onEditArticle(row)&quot;</span><br><span class="line">          &gt;&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            circle</span><br><span class="line">            plain</span><br><span class="line">            type=&quot;danger&quot;</span><br><span class="line">            :icon=&quot;Delete&quot;</span><br><span class="line">            @click=&quot;onDeleteArticle(row)&quot;</span><br><span class="line">          &gt;&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 分页区域 --&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      v-model:current-page=&quot;params.pagenum&quot;</span><br><span class="line">      v-model:page-size=&quot;params.pagesize&quot;</span><br><span class="line">      :page-sizes=&quot;[2, 3, 5, 10]&quot;</span><br><span class="line">      :background=&quot;true&quot;</span><br><span class="line">      layout=&quot;jumper, total, sizes, prev, pager, next&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">      @size-change=&quot;onSizeChange&quot;</span><br><span class="line">      @current-change=&quot;onCurrentChange&quot;</span><br><span class="line">      style=&quot;margin-top: 20px; justify-content: flex-end&quot;</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 添加编辑的抽屉 --&gt;</span><br><span class="line">    &lt;article-edit ref=&quot;articleEditRef&quot; @success=&quot;onSuccess&quot;&gt;&lt;/article-edit&gt;</span><br><span class="line">  &lt;/page-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h4 id="7-9-2-6-创建-api-article-js"><a href="#7-9-2-6-创建-api-article-js" class="headerlink" title="7-9-2-6 创建 api &#x2F; article.js"></a>7-9-2-6 创建 api &#x2F; article.js</h4><div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 文章：获取文章列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">artGetListService</span> = (<span class="params">params</span>) =&gt;</span><br><span class="line">  request.<span class="title function_">get</span>(<span class="string">&#x27;/my/article/list&#x27;</span>, &#123;</span><br><span class="line">    params</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文章：添加文章</span></span><br><span class="line"><span class="comment">// 注意：data需要是一个formData格式的对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">artPublishService</span> = (<span class="params">data</span>) =&gt; request.<span class="title function_">post</span>(<span class="string">&#x27;/my/article/add&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文章：获取文章详情</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">artGetDetailService</span> = (<span class="params">id</span>) =&gt;</span><br><span class="line">  request.<span class="title function_">get</span>(<span class="string">&#x27;/my/article/info&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">params</span>: &#123; id &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文章：编辑文章接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">artEditService</span> = (<span class="params">data</span>) =&gt; request.<span class="title function_">put</span>(<span class="string">&#x27;/my/article/info&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文章：删除文章接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">artDelService</span> = (<span class="params">id</span>) =&gt; request.<span class="title function_">delete</span>(<span class="string">&#x27;/my/article/info&#x27;</span>, &#123; <span class="attr">params</span>: &#123; id &#125; &#125;)</span><br></pre></td></tr></table></figure></div>

<h1 id="8-AI"><a href="#8-AI" class="headerlink" title="8- AI"></a>8- AI</h1><h2 id="8-1-ChatGPT-Copilot"><a href="#8-1-ChatGPT-Copilot" class="headerlink" title="8-1 ChatGPT &amp; Copilot"></a>8-1 ChatGPT &amp; Copilot</h2><h3 id="8-1-1-优化Prompt"><a href="#8-1-1-优化Prompt" class="headerlink" title="8-1-1 优化Prompt"></a>8-1-1 优化Prompt</h3><p>明确提问：</p>
<ul>
<li>确保问题表述清晰明确，关键字的准确度，决定了AI对于需求的理解。</li>
</ul>
<p>细化需求：</p>
<ul>
<li>将问题拆分成多个小问题，可以帮助AI更具针对性地回答，也利于即时纠错。</li>
</ul>
<p>添加背景信息：</p>
<ul>
<li>提供有关问题背景的详细信息，也可以给AI预设一个角色，将有助于AI生成更具深度和价值的回答。</li>
</ul>
<p>适当引导：</p>
<ul>
<li>比如：“例如”、“请注意”、“请使用“等，来告诉模型你期望它 做什么 或者 不做什么。</li>
</ul>
<p>限制范围：</p>
<ul>
<li>通过限定回答的范围和长度，可以引导AI生成更精炼的回答。</li>
</ul>
<h3 id="8-1-2-工具-Github-Copilot-智能生成代码的使用"><a href="#8-1-2-工具-Github-Copilot-智能生成代码的使用" class="headerlink" title="8-1-2 工具 Github Copilot 智能生成代码的使用"></a>8-1-2 工具 Github Copilot 智能生成代码的使用</h3><p>安装步骤：</p>
<ul>
<li>登录 github，试用 Copilot。</li>
<li>打开 vscode，搜索并安装插件Copilot。</li>
</ul>
<p>使用说明：</p>
<ul>
<li>删除键：不接受</li>
<li>Tab键：接收</li>
<li>Ctrl+ enter：查看更多方案</li>
</ul>
<h2 id="8-2-实战"><a href="#8-2-实战" class="headerlink" title="8-2 实战"></a>8-2 实战</h2><h3 id="8-2-1-个人中心-基本资料"><a href="#8-2-1-个人中心-基本资料" class="headerlink" title="8-2-1 个人中心 - 基本资料"></a>8-2-1 个人中心 - 基本资料</h3><p>chatgpt prompt 提示词参考</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">请基于elementPlus 和 Vue3 的语法，生成组件代码</span><br><span class="line">要求:</span><br><span class="line"></span><br><span class="line">一、表单结构要求</span><br><span class="line">1.组件中包含一个e1-form表单，有四行内容，前三行是输入框，第四行是按钮</span><br><span class="line">2.第一行 1abel 登录名称，输入框禁用不可输入状态</span><br><span class="line">3.第二行 1abel 用户呢称，输入框可输入</span><br><span class="line">4.第三行 1abel 用户邮箱，输入框可输入</span><br><span class="line">5.第四行按钮，提交修改</span><br><span class="line"></span><br><span class="line">二、校验需求</span><br><span class="line">给 昵称和邮箱 校验</span><br><span class="line">1. 昵称 nickname 必须是2-10位的非空字符串</span><br><span class="line">2.邮箱 email 符合邮箱格式即可，且不能为空</span><br></pre></td></tr></table></figure></div>

<p>项目代码</p>
<p>api &#x2F; user.js</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 更新用户基本信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">userUpdateInfoService</span> = (<span class="params">&#123; id, nickname, email &#125;</span>) =&gt;</span><br><span class="line">  request.<span class="title function_">put</span>(<span class="string">&#x27;/my/userinfo&#x27;</span>, &#123; id, nickname, email &#125;)</span><br></pre></td></tr></table></figure></div>

<p>views &#x2F; user &#x2F; UserProfile.vue</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import PageContainer from &#x27;@/components/PageContainer.vue&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useUserStore &#125; from &#x27;@/stores&#x27;</span><br><span class="line">import &#123; userUpdateInfoService &#125; from &#x27;@/api/user&#x27;</span><br><span class="line"></span><br><span class="line">const formRef = ref()</span><br><span class="line"></span><br><span class="line">// 是在使用仓库中数据的初始值 (无需响应式) 解构无问题</span><br><span class="line">const &#123;</span><br><span class="line">  user: &#123; email, id, nickname, username &#125;,</span><br><span class="line">  getUser</span><br><span class="line">&#125; = useUserStore()</span><br><span class="line"></span><br><span class="line">const form = ref(&#123;</span><br><span class="line">  id,</span><br><span class="line">  username,</span><br><span class="line">  nickname,</span><br><span class="line">  email</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const rules = ref(&#123;</span><br><span class="line">  nickname: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入用户昵称&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      pattern: /^\S&#123;2,10&#125;/,</span><br><span class="line">      message: &#x27;昵称长度在2-10个非空字符&#x27;,</span><br><span class="line">      trigger: &#x27;blur&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  email: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入用户邮箱&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      type: &#x27;email&#x27;,</span><br><span class="line">      message: &#x27;请输入正确的邮箱格式&#x27;,</span><br><span class="line">      trigger: [&#x27;blur&#x27;, &#x27;change&#x27;]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const submitForm = async () =&gt; &#123;</span><br><span class="line">  // 等待校验结果</span><br><span class="line">  await formRef.value.validate()</span><br><span class="line">  // 提交修改</span><br><span class="line">  await userUpdateInfoService(form.value)</span><br><span class="line">  // 通知 user 模块，进行数据的更新</span><br><span class="line">  getUser()</span><br><span class="line">  // 提示用户</span><br><span class="line">  ElMessage.success(&#x27;修改成功&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;page-container title=&quot;基本资料&quot;&gt;</span><br><span class="line">    &lt;!-- 表单部分 --&gt;</span><br><span class="line">    &lt;el-form ref=&quot;formRef&quot; :model=&quot;form&quot; :rules=&quot;rules&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;登录名称&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;form.username&quot; disabled&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;用户昵称&quot; prop=&quot;nickname&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;form.nickname&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;用户邮箱&quot; prop=&quot;email&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;form.email&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm&quot;&gt;提交修改&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/page-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="8-2-2-个人中心-更换头像"><a href="#8-2-2-个人中心-更换头像" class="headerlink" title="8-2-2 个人中心 - 更换头像"></a>8-2-2 个人中心 - 更换头像</h3><p>项目代码</p>
<p>api &#x2F; user.js</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 更新用户头像</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">userUpdateAvatarService</span> = (<span class="params">avatar</span>) =&gt; request.<span class="title function_">patch</span>(<span class="string">&#x27;/my/update/avatar&#x27;</span>, &#123; avatar &#125;)</span><br></pre></td></tr></table></figure></div>

<p>views &#x2F; user &#x2F; UserAvatar.vue</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; Plus, Upload &#125; from &#x27;@element-plus/icons-vue&#x27;</span><br><span class="line">import &#123; useUserStore &#125; from &#x27;@/stores&#x27;</span><br><span class="line">import &#123; userUpdateAvatarService &#125; from &#x27;@/api/user&#x27;</span><br><span class="line">const userStore = useUserStore()</span><br><span class="line">const imgUrl = ref(userStore.user.user_pic)</span><br><span class="line">const uploadRef = ref()</span><br><span class="line">const onSelectFile = (uploadFile) =&gt; &#123;</span><br><span class="line">  // 基于 FileReader 读取图片做预览</span><br><span class="line">  const reader = new FileReader()</span><br><span class="line">  reader.readAsDataURL(uploadFile.raw)</span><br><span class="line">  reader.onload = () =&gt; &#123;</span><br><span class="line">    imgUrl.value = reader.result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const onUpdateAvatar = async () =&gt; &#123;</span><br><span class="line">  // 发送请求更新头像</span><br><span class="line">  await userUpdateAvatarService(imgUrl.value)</span><br><span class="line">  // userStore 重新渲染</span><br><span class="line">  await userStore.getUser()</span><br><span class="line">  // 提示用户</span><br><span class="line">  ElMessage.success(&#x27;头像更新成功&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;page-container title=&quot;更换头像&quot;&gt;</span><br><span class="line">    &lt;el-upload</span><br><span class="line">      ref=&quot;uploadRef&quot;</span><br><span class="line">      :auto-upload=&quot;false&quot;</span><br><span class="line">      class=&quot;avatar-uploader&quot;</span><br><span class="line">      :show-file-list=&quot;false&quot;</span><br><span class="line">      :on-change=&quot;onSelectFile&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;img v-if=&quot;imgUrl&quot; :src=&quot;imgUrl&quot; class=&quot;avatar&quot; /&gt;</span><br><span class="line">      &lt;el-icon v-else class=&quot;avatar-uploader-icon&quot;&gt;&lt;Plus /&gt;&lt;/el-icon&gt;</span><br><span class="line">    &lt;/el-upload&gt;</span><br><span class="line"></span><br><span class="line">    &lt;br /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-button</span><br><span class="line">      @click=&quot;uploadRef.$el.querySelector(&#x27;input&#x27;).click()&quot;</span><br><span class="line">      type=&quot;primary&quot;</span><br><span class="line">      :icon=&quot;Plus&quot;</span><br><span class="line">      size=&quot;large&quot;</span><br><span class="line">      &gt;选择图片&lt;/el-button</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;el-button</span><br><span class="line">      @click=&quot;onUpdateAvatar&quot;</span><br><span class="line">      type=&quot;success&quot;</span><br><span class="line">      :icon=&quot;Upload&quot;</span><br><span class="line">      size=&quot;large&quot;</span><br><span class="line">      &gt;上传头像&lt;/el-button</span><br><span class="line">    &gt;</span><br><span class="line">  &lt;/page-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.avatar-uploader &#123;</span><br><span class="line">  :deep() &#123;</span><br><span class="line">    .avatar &#123;</span><br><span class="line">      width: 278px;</span><br><span class="line">      height: 278px;</span><br><span class="line">      display: block;</span><br><span class="line">    &#125;</span><br><span class="line">    .el-upload &#123;</span><br><span class="line">      border: 1px dashed var(--el-border-color);</span><br><span class="line">      border-radius: 6px;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">      position: relative;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">      transition: var(--el-transition-duration-fast);</span><br><span class="line">    &#125;</span><br><span class="line">    .el-upload:hover &#123;</span><br><span class="line">      border-color: var(--el-color-primary);</span><br><span class="line">    &#125;</span><br><span class="line">    .el-icon.avatar-uploader-icon &#123;</span><br><span class="line">      font-size: 28px;</span><br><span class="line">      color: #8c939d;</span><br><span class="line">      width: 278px;</span><br><span class="line">      height: 278px;</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="8-2-3-个人中心-重置密码"><a href="#8-2-3-个人中心-重置密码" class="headerlink" title="8-2-3 个人中心 - 重置密码"></a>8-2-3 个人中心 - 重置密码</h3><p>chatgpt prompt 提示词参考</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">请基于 elementPlus 和Vue3 的语法，生成组件代码要求:</span><br><span class="line">一、表单结构要求</span><br><span class="line">1.组件中包含一个e1-form表单，有四行内容，前三行是表单输入框，第四行是两个按钮</span><br><span class="line">2.第一行 1abel 原密码</span><br><span class="line">3.第二行 label 新密码</span><br><span class="line">4.第三行 1abel 确认密码</span><br><span class="line">5.第四行两个按钮，修改密码和重置</span><br><span class="line"></span><br><span class="line">二、form绑定字段如下:</span><br><span class="line">const pwdForm = ref(&#123;</span><br><span class="line">	old_pwd:&#x27;&#x27;,</span><br><span class="line">	new_pwd:&#x27;&#x27;,</span><br><span class="line">	re_pwd:&#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">三、校验需求</span><br><span class="line">所有字段，都是6-15位 非空</span><br><span class="line">自定义校验1:原密码和新密码不能一样</span><br><span class="line">自定义校验2:新密码和确认密码必须一样</span><br></pre></td></tr></table></figure></div>

<p>项目代码</p>
<p>api &#x2F; user.js</p>
<div class="highlight-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 更新用户密码</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">userUpdatePasswordService</span> = (<span class="params">&#123; old_pwd, new_pwd, re_pwd &#125;</span>) =&gt;</span><br><span class="line">  request.<span class="title function_">patch</span>(<span class="string">&#x27;/my/updatepwd&#x27;</span>, &#123; old_pwd, new_pwd, re_pwd &#125;)</span><br></pre></td></tr></table></figure></div>

<p>views &#x2F; user &#x2F; UserPassword.vue</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; userUpdatePasswordService &#125; from &#x27;@/api/user&#x27;</span><br><span class="line">import &#123; useUserStore &#125; from &#x27;@/stores&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line"></span><br><span class="line">const formRef = ref()</span><br><span class="line">const pwdForm = ref(&#123;</span><br><span class="line">  old_pwd: &#x27;&#x27;,</span><br><span class="line">  new_pwd: &#x27;&#x27;,</span><br><span class="line">  re_pwd: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const checkDifferent = (rule, value, callback) =&gt; &#123;</span><br><span class="line">  // 校验新密码和原密码不能一样</span><br><span class="line">  if (value === pwdForm.value.old_pwd) &#123;</span><br><span class="line">    callback(new Error(&#x27;新密码不能与原密码一样&#x27;))</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    callback()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const checkSameAsNewPwd = (rule, value, callback) =&gt; &#123;</span><br><span class="line">  // 校验确认密码必须和新密码一样</span><br><span class="line">  if (value !== pwdForm.value.new_pwd) &#123;</span><br><span class="line">    callback(new Error(&#x27;确认密码必须和新密码一样&#x27;))</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    callback()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const rules = ref(&#123;</span><br><span class="line">  old_pwd: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入原密码&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; min: 6, max: 15, message: &#x27;原密码长度在6-15位之间&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ],</span><br><span class="line">  new_pwd: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入新密码&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; min: 6, max: 15, message: &#x27;新密码长度在6-15位之间&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; validator: checkDifferent, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ],</span><br><span class="line">  re_pwd: [</span><br><span class="line">    &#123; required: true, message: &#x27;请再次输入新密码&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; min: 6, max: 15, message: &#x27;确认密码长度在6-15位之间&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; validator: checkSameAsNewPwd, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const userStore = useUserStore()</span><br><span class="line">const router = useRouter()</span><br><span class="line"></span><br><span class="line">const submitForm = async () =&gt; &#123;</span><br><span class="line">  await formRef.value.validate()</span><br><span class="line">  await userUpdatePasswordService(pwdForm.value)</span><br><span class="line">  ElMessage.success(&#x27;密码修改成功&#x27;)</span><br><span class="line"></span><br><span class="line">  // 密码修改成功后，退出重新登录</span><br><span class="line">  // 清空本地存储的 token 和 个人信息</span><br><span class="line">  userStore.setToken(&#x27;&#x27;)</span><br><span class="line">  userStore.setUser(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">  // 拦截登录</span><br><span class="line">  router.push(&#x27;/login&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const resetForm = () =&gt; &#123;</span><br><span class="line">  formRef.value.resetFields()</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;page-container title=&quot;修改密码&quot;&gt;</span><br><span class="line">    &lt;el-row&gt;</span><br><span class="line">      &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">        &lt;el-form</span><br><span class="line">          ref=&quot;formRef&quot;</span><br><span class="line">          :model=&quot;pwdForm&quot;</span><br><span class="line">          :rules=&quot;rules&quot;</span><br><span class="line">          label-width=&quot;100px&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;el-form-item label=&quot;原密码&quot; prop=&quot;old_pwd&quot;&gt;</span><br><span class="line">            &lt;el-input v-model=&quot;pwdForm.old_pwd&quot; show-password&gt;&lt;/el-input&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">          &lt;el-form-item label=&quot;新密码&quot; prop=&quot;new_pwd&quot;&gt;</span><br><span class="line">            &lt;el-input v-model=&quot;pwdForm.new_pwd&quot; show-password&gt;&lt;/el-input&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">          &lt;el-form-item label=&quot;确认密码&quot; prop=&quot;re_pwd&quot;&gt;</span><br><span class="line">            &lt;el-input v-model=&quot;pwdForm.re_pwd&quot; show-password&gt;&lt;/el-input&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">          &lt;el-form-item&gt;</span><br><span class="line">            &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm&quot;&gt;修改密码&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button @click=&quot;resetForm&quot;&gt;重置&lt;/el-button&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-form&gt;&lt;/el-col</span><br><span class="line">      &gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">  &lt;/page-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></div>

]]></content>
      <categories>
        <category>前端</category>
        <category>Vue3</category>
      </categories>
      <tags>
        <tag>自研笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Cloud 微服务开发与实战</title>
    <url>/2024/09/13/SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E4%B8%8E%E5%AE%9E%E6%88%98/</url>
    <content><![CDATA[<h1 id="1-微服务"><a href="#1-微服务" class="headerlink" title="1. 微服务"></a>1. 微服务</h1><p><strong>文档说明</strong>：</p>
<ul>
<li><p><a class="link"   href="https://b11et3un53m.feishu.cn/wiki/FYNkwb1i6i0qwCk7lF2caEq5nRe" >‍‍﻿‌﻿⁠‍‬‍﻿‌‬‌⁠‌﻿‍⁠‌‬‍⁠‍‌‍课程说明 - 飞书云文档 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240913204924813.png"
                      alt="image-20240913204924813"
                ></p>
</li>
</ul>
<h1 id="2-Mybatis-Plus"><a href="#2-Mybatis-Plus" class="headerlink" title="2. Mybatis Plus"></a>2. Mybatis Plus</h1><h2 id="2-1-快速入门"><a href="#2-1-快速入门" class="headerlink" title="2.1 快速入门"></a>2.1 快速入门</h2><h3 id="2-1-1-入门案例"><a href="#2-1-1-入门案例" class="headerlink" title="2.1.1 入门案例"></a>2.1.1 入门案例</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240913210018303.png"
                      alt="image-20240913210018303"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240913210038716.png"
                      alt="image-20240913210038716"
                ></p>
</li>
</ul>
<h3 id="2-1-2-常见注解"><a href="#2-1-2-常见注解" class="headerlink" title="2.1.2 常见注解"></a>2.1.2 常见注解</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240913211151164.png"
                      alt="image-20240913211151164"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240913211925185.png"
                      alt="image-20240913211925185"
                ></p>
</li>
</ul>
<h3 id="2-1-3-常见配置"><a href="#2-1-3-常见配置" class="headerlink" title="2.1.3 常见配置"></a>2.1.3 常见配置</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240913213251624.png"
                      alt="image-20240913213251624"
                ></li>
</ul>
<h2 id="2-2-核心功能"><a href="#2-2-核心功能" class="headerlink" title="2.2 核心功能"></a>2.2 核心功能</h2><h3 id="2-2-1-条件构造器"><a href="#2-2-1-条件构造器" class="headerlink" title="2.2.1 条件构造器"></a>2.2.1 条件构造器</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240914184030710.png"
                      alt="image-20240914184030710"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240914184106583.png"
                      alt="image-20240914184106583"
                ></p>
</li>
<li><p>使用</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//查询出名字中带o的，存款大于等于1000元的人的id、username、info、balance字段</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testQueryWrapper</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="comment">// 1.构建查询条件</span></span><br><span class="line">	QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;()</span><br><span class="line">		.select(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;info&quot;</span>, <span class="string">&quot;balance&quot;</span>)</span><br><span class="line">		.like(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;o&quot;</span>)</span><br><span class="line">		.ge(<span class="string">&quot;balance&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">	<span class="comment">// 2.查询</span></span><br><span class="line">	List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">	users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新用户名为jack的用户的余额为2000</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateByQueryWrapper</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="comment">//1.要更新的数据</span></span><br><span class="line">	<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">	user.setBalance(<span class="number">2000</span>);</span><br><span class="line">	<span class="comment">//2.更新的条件</span></span><br><span class="line">	QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;()</span><br><span class="line">		.eq(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;jack&quot;</span>);</span><br><span class="line">	<span class="comment">//3.执行更新</span></span><br><span class="line">	userMapper.update(user, wrapper); <span class="comment">//参数1：更新的内容；参数2：更新的条件</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新id为1,2,4的用户的余额，扣200</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateWrapper</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Long&gt; ids = List.of(<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">4L</span>);</span><br><span class="line">    UpdateWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;User&gt;()</span><br><span class="line">        .setSql(<span class="string">&quot;balance = balance-200&quot;</span>)</span><br><span class="line">        .in(<span class="string">&quot;id&quot;</span>, ids);</span><br><span class="line">	userMapper.update(<span class="literal">null</span>, wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//查询出名字中带o的，存款大于等于1000元的人的id、username、info、balance字段(使用lambda)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testLambdaQueryWrapper</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="comment">// 1.构建查询条件</span></span><br><span class="line">	LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;()</span><br><span class="line">       	.select(User::getId, User::getUsername, User::getInfo, User::getBalance)</span><br><span class="line">		.like(User::getUsername, <span class="string">&quot;o&quot;</span>)</span><br><span class="line">		.ge(User::getBalance, <span class="number">1000</span>);</span><br><span class="line">	<span class="comment">// 2.查询</span></span><br><span class="line">	List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">	users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>注意</li>
</ul>
<p>QueryWrapper 和 LambdaQueryWrapper 通常用来构建 select、delete、update 的 where 条件部分。</p>
<p>UpdateWrapper 和 LambdaUpdateWrapper 通常只有在 set 语句比较特殊才使用。</p>
<p>尽量使用 LambdaQueryWrapper 和 LambdaUpdateWrapper，避免硬编码。</p>
<h3 id="2-2-2-自定义SQL"><a href="#2-2-2-自定义SQL" class="headerlink" title="2.2.2 自定义SQL"></a>2.2.2 自定义SQL</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240914191852959.png"
                      alt="image-20240914191852959"
                ></li>
</ul>
<h3 id="2-2-3-IService接口基本用法"><a href="#2-2-3-IService接口基本用法" class="headerlink" title="2.2.3 IService接口基本用法"></a>2.2.3 IService接口基本用法</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240914194917862.png"
                      alt="image-20240914194917862"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240914194727182.png"
                      alt="image-20240914194727182"
                ></p>
</li>
<li><p>service &#x2F; IUserService</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>service &#x2F; Impl &#x2F; UserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>使用层</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSaveUser</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">	user.setUsername(<span class="string">&quot;LiLei&quot;</span>);</span><br><span class="line">	user.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">	user.setPhone(<span class="string">&quot;18688990013&quot;</span>);</span><br><span class="line">	user.setBalance(<span class="number">200</span>);</span><br><span class="line">	user.setInfo(<span class="string">&quot;&#123;\&quot;age\&quot;: 24,\&quot;intro\&quot;:\&quot;英文老师\&quot;,\&quot;gender\&quot;:\&quot;female\&quot;&#125;&quot;</span>);</span><br><span class="line">    user.setCreateTime(LocalDateTime.now());</span><br><span class="line">    user.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    </span><br><span class="line">	userService.save(user); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testQuery</span><span class="params">()</span>&#123;</span><br><span class="line">	List&lt;User&gt; users = userService.listByIds(List.of(<span class="number">1L</span>,<span class="number">2L</span>, <span class="number">4L</span>));</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-4-IService开发基础业务接口"><a href="#2-2-4-IService开发基础业务接口" class="headerlink" title="2.2.4 IService开发基础业务接口"></a>2.2.4 IService开发基础业务接口</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240914201510012.png"
                      alt="image-20240914201510012"
                ></p>
</li>
<li><p>UserController</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Api(tags =&quot;用户管理接口&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> IUserService userService;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@ApiOperation(&quot;新增用户接口&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(<span class="meta">@RequestBody</span> UserFormDTo userDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.把DTO拷贝到PO</span></span><br><span class="line">		<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> Beanutil.copyProperties(userDTo, User.class); <span class="comment">//单个对象拷贝</span></span><br><span class="line">		<span class="comment">// 2.新增</span></span><br><span class="line">		userService.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除用户接口&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteuserById</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id&quot;)</span> <span class="meta">@Pathvariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        userService.removeById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据id查询用户接口&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> UserVO <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id&quot;)</span> <span class="meta">@Pathvariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">        <span class="comment">// 1.查询用户PO</span></span><br><span class="line">		<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(id);</span><br><span class="line">        <span class="comment">// 2.把PO拷贝到VO</span></span><br><span class="line">		<span class="keyword">return</span> Beanutil.copyPrdperties(user, UserVO.class); <span class="comment">//单个对象拷贝</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据id批量查询用户接口&quot;)</span></span><br><span class="line">	<span class="meta">@GetMapping</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;UserVO&gt; <span class="title function_">queryuserByIds</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id集合&quot;)</span> <span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">        <span class="comment">// 1.查询用户PO</span></span><br><span class="line">		List&lt;User&gt; users = userService.listByIds(ids);</span><br><span class="line">		<span class="comment">// 2.把PO拷贝到VO</span></span><br><span class="line">		<span class="keyword">return</span> Beanutil.copyToList(users, UserVO.class); <span class="comment">//集合拷贝</span></span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-5-IService开发复杂业务接口"><a href="#2-2-5-IService开发复杂业务接口" class="headerlink" title="2.2.5 IService开发复杂业务接口"></a>2.2.5 IService开发复杂业务接口</h3><ul>
<li>UserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Api(tags =&quot;用户管理接口&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@ApiOperation(&quot;扣减用户余额接口&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;/deduction/&#123;money&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id&quot;)</span> <span class="meta">@Pathvariable(&quot;id&quot;)</span> Long id,</span></span><br><span class="line"><span class="params">                              <span class="meta">@ApiParam(&quot;扣减的金额&quot;)</span> <span class="meta">@Pathvariable(&quot;money&quot;)</span> Integer money)</span>&#123;</span><br><span class="line">        userservice.deductBalance(id, money); <span class="comment">//自定义接口</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>IUserService</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(Long id, Integer money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>UserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(Long id, Integer money)</span>&#123;</span><br><span class="line">		<span class="comment">//1.查询用户</span></span><br><span class="line">		<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(id); <span class="comment">//直接调用Mapper方法</span></span><br><span class="line">		<span class="comment">//2.校验用户状态</span></span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span> || user.getStatus() == <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户状态异常!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//3.校验余额是否充足</span></span><br><span class="line">        <span class="keyword">if</span>(user.getBalance() &lt; money)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户余额不足!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// 4.扣减余额</span></span><br><span class="line">        userMapper.deductBalance(id, money); <span class="comment">//自定义方法</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>UserMapper</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="meta">@Update(&quot;UPDATE tb_user SET balance = balance - #&#123;money&#125; WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id, <span class="meta">@Param(&quot;money&quot;)</span> Integer money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-6-IService的Lambda操作"><a href="#2-2-6-IService的Lambda操作" class="headerlink" title="2.2.6 IService的Lambda操作"></a>2.2.6 IService的Lambda操作</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240915201835931.png"
                      alt="image-20240915201835931"
                ></p>
</li>
<li><p>UserController</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据复杂条件查询用户接口&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;UserVO&gt; <span class="title function_">queryUsers</span><span class="params">(userQuery query)</span> &#123;</span><br><span class="line">	<span class="comment">// 1.查询用户PO</span></span><br><span class="line">	List&lt;User&gt; users = userservice.queryu <span class="title function_">sers</span><span class="params">(</span></span><br><span class="line"><span class="params">		query.getName()</span>, query.getstatus(), query.getMinBalance(), query.getMaxBalance()); <span class="comment">//自定义接口</span></span><br><span class="line">	<span class="comment">// 2.把PO拷贝到VO</span></span><br><span class="line">	<span class="keyword">return</span> Beanutil.copyToList(users, UserVO.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>IUserService</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">	List&lt;User&gt; <span class="title function_">queryUsers</span><span class="params">(String name, Integer status, Integer minBalance, Integer maxBalance)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>UserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryUsers</span><span class="params">(String name, Integer status, Integer minBalance, Integer maxBalance)</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = lambdaQuery()</span><br><span class="line">			.like(name != <span class="literal">null</span>, User::getUsername, name) <span class="comment">//模糊查询</span></span><br><span class="line">            .eq(status != <span class="literal">null</span>, User::getstatus, status) <span class="comment">//等于</span></span><br><span class="line">            .ge(minBalance != <span class="literal">null</span>, User::getBalance, minBalance) <span class="comment">//大于等于</span></span><br><span class="line">            .le(maxBalance != <span class="literal">null</span>, User::getBalance, maxBalance) <span class="comment">//小于等于</span></span><br><span class="line">			.list(); <span class="comment">//返回列表</span></span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240915204921315.png"
                      alt="image-20240915204921315"
                ></p>
</li>
<li><p>UserServiceImpl</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(Long id, Integer money)</span>&#123;</span><br><span class="line">		<span class="comment">//1.查询用户</span></span><br><span class="line">		<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(id); <span class="comment">//直接调用Mapper方法</span></span><br><span class="line">		<span class="comment">//2.校验用户状态</span></span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span> || user.getStatus() == <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户状态异常!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//3.校验余额是否充足</span></span><br><span class="line">        <span class="keyword">if</span>(user.getBalance() &lt; money)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户余额不足!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// 4.扣减余额</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">remainBalance</span> <span class="operator">=</span> user.getBalance() - money; <span class="comment">//账户余额</span></span><br><span class="line">        lambdaUpdate()</span><br><span class="line">			.set(User::getBalance, remainBalance)</span><br><span class="line">            .set(remainBalance == <span class="number">0</span>, User::getstatus, <span class="number">2</span>) <span class="comment">//第一个参数是条件(if)</span></span><br><span class="line">            .eq(user::getId, id)</span><br><span class="line">			.eq(User::getBalance, user.getBalance()) <span class="comment">//乐观锁，处理多线程</span></span><br><span class="line">			.update(); <span class="comment">//更新，必须加上</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-7-IService的批量新增"><a href="#2-2-7-IService的批量新增" class="headerlink" title="2.2.7 IService的批量新增"></a>2.2.7 IService的批量新增</h3><p>批处理方案：</p>
<ul>
<li>普通for循环逐条插入速度极差，不推荐。</li>
<li>MP的批量新增，基于预编译的批处理，性能不错。</li>
<li>配置jdbc参数，开启 <strong>rewriteBatchedStatements&#x3D;true</strong>，性能最好。</li>
</ul>
<p>配置jdbc参数，开启：</p>
<ul>
<li>在application.yaml文件中，找到MySQL参数，在url后加上 <strong>&amp;rewriteBatchedstatemments&#x3D;true</strong> 即可。</li>
</ul>
<h2 id="2-3-扩展功能"><a href="#2-3-扩展功能" class="headerlink" title="2.3 扩展功能"></a>2.3 扩展功能</h2><h3 id="2-3-1-代码生成器"><a href="#2-3-1-代码生成器" class="headerlink" title="2.3.1 代码生成器"></a>2.3.1 代码生成器</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240915213545136.png"
                      alt="image-20240915213545136"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240915213605981.png"
                      alt="image-20240915213605981"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240915213638852.png"
                      alt="image-20240915213638852"
                ></p>
</li>
</ul>
<h3 id="2-3-2-DB静态工具"><a href="#2-3-2-DB静态工具" class="headerlink" title="2.3.2 DB静态工具"></a>2.3.2 DB静态工具</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240915214623527.png"
                      alt="image-20240915214623527"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240915214658491.png"
                      alt="image-20240915214658491"
                ></p>
</li>
<li><p>UserVO</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description=&quot;用户VO实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserVO</span> &#123;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;用户id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;用户名&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;详细信息&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String info;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;使用状态(1正常 2冻结)&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer status;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;账户余额&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer balance;</span><br><span class="line">    <span class="meta">@ApiModelproperty(&quot;用户的收获地址&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;AddressVO&gt; addresses;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>UserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Apioperation(&quot;根据id查询用户接口&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> UserVO <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id&quot;)</span> <span class="meta">@Pathvariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> userService.queryUserAndAddressById(id); <span class="comment">//自定义方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Apioperation(&quot;根据id批量查询用户接口&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> List&lt;UserVO&gt; <span class="title function_">queryUserByIds</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id集合&quot;)</span> <span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.queryUserAndAddressByIds(ids);  <span class="comment">//自定义方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>IUserService</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">	UserVO <span class="title function_">queryUserAndAddressById</span><span class="params">(Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    List&lt;UserVO&gt; <span class="title function_">queryUserAndAddressByIds</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>UserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> UserVO <span class="title function_">queryUserAndAddressById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        <span class="comment">// 1.查询用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(id);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span> || user.getstatus() == <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户状态异常!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2.查询地址</span></span><br><span class="line">        List&lt;Address&gt; addresses = Db.lambdaQuery(Address.class)</span><br><span class="line">            .eq(Address::getUserId, id)</span><br><span class="line">            .list();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3.封装VO</span></span><br><span class="line">        <span class="comment">// 3.1.转User的PO为VO</span></span><br><span class="line">        <span class="type">UserVO</span> <span class="variable">userVO</span> <span class="operator">=</span> Beanutil.copyProperties(user, UserVO.class);</span><br><span class="line">        <span class="comment">// 3.2.转地址VO</span></span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(addresses))&#123; <span class="comment">//如果地址存在</span></span><br><span class="line">            List&lt;AddressVO&gt; addressVOS = BeanUtil.copyToList(addresses, AddressVO.class); </span><br><span class="line">            userVO.setAddresses(addressVOS);</span><br><span class="line">    	&#125;</span><br><span class="line">        </span><br><span class="line">		<span class="keyword">return</span> userVO;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UserVO&gt; <span class="title function_">queryUserByIds</span><span class="params">(List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">        <span class="comment">// 1.查询用户</span></span><br><span class="line">		List&lt;User&gt; users = listByIds(ids);</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isEmpty(users))&#123; <span class="comment">//判断用户是否为空</span></span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2.查询地址</span></span><br><span class="line">		<span class="comment">// 2.1.获取用户id集合</span></span><br><span class="line">		List&lt;Long&gt; userIds = users.stream().map(User::getId).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">// 2.2.根据用户id查谁地址</span></span><br><span class="line">		List&lt;Address&gt; addresses = Db.lambdaQuery(Address.class)</span><br><span class="line">            .in(Address::getUserId, userIds)</span><br><span class="line">            .list();</span><br><span class="line">        <span class="comment">// 2.3.转换地址VO</span></span><br><span class="line">		List&lt;AddressVO&gt; addressVOList = Beanutil.copyToList(addresses, AddressVO.class);</span><br><span class="line">		<span class="comment">// 2.4.用户地址集合分组处理，相同用户的放入一个集合(组)中</span></span><br><span class="line">        Map&lt;Long, List&lt;AddressVO&gt;&gt; addressMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(addressVOList))&#123; <span class="comment">//判断用户对应地址是否为空</span></span><br><span class="line">            addressMap = addressVOList.stream().collect(Collectors.groupingBy(AddressVO::getUserId));</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// 3.转换VO返回</span></span><br><span class="line">		List&lt;UserVO&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(users.size());</span><br><span class="line">        <span class="keyword">for</span>(User user : users)&#123;</span><br><span class="line">			<span class="comment">// 3.1.转换user的PO为VO</span></span><br><span class="line">            <span class="type">UserVO</span> <span class="variable">vo</span> <span class="operator">=</span> Beanutil.copyProperties(user, UserVO.class);</span><br><span class="line">            list.add(vo);</span><br><span class="line">            <span class="comment">// 3.2.转换地址VO</span></span><br><span class="line">           	vo.setAddressVO(addressMap.get(user.getId()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-3-3-逻辑删除"><a href="#2-3-3-逻辑删除" class="headerlink" title="2.3.3 逻辑删除"></a>2.3.3 逻辑删除</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240916174145051.png"
                      alt="image-20240916174145051"
                ></li>
</ul>
<h3 id="2-3-4-枚举处理器"><a href="#2-3-4-枚举处理器" class="headerlink" title="2.3.4 枚举处理器"></a>2.3.4 枚举处理器</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240916174837632.png"
                      alt="image-20240916174837632"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240916174854571.png"
                      alt="image-20240916174854571"
                ></p>
</li>
<li><p>在主包下创建 enums &#x2F; UserStatus，enums 和 controller 一级。</p>
</li>
<li><p>@JsonValue：该注解表示在返回到前端的数据是什么样的(加在谁上面返回什么；如果没有，返回像“NORMAL”的定义)。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">UserStatus</span>&#123;</span><br><span class="line">	NORMAL( <span class="number">1</span>, <span class="string">&quot;正常&quot;</span>),</span><br><span class="line">	FROZEN( <span class="number">2</span>, <span class="string">&quot;冻结&quot;</span>);</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@EnumValue</span></span><br><span class="line">	<span class="meta">@JsonValue</span> <span class="comment">//该注解表示在返回到前端的数据是什么样的(加在谁上面返回什么；如果没有，返回像“NORMAL”的定义)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String desc;</span><br><span class="line">    </span><br><span class="line">	UserStatus(<span class="type">int</span> value, String desc)&#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在application.yml中配置全局枚举处理器。</li>
<li>修改User类中对应的字段。</li>
<li>修改之后的用法：如UserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> UserVO <span class="title function_">queryUserAndAddressById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        <span class="comment">// 1.查询用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(id);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span> || user.getStatus() == UserStatus.FROZEN)&#123; <span class="comment">//修改的地方</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户状态异常!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2.查询地址</span></span><br><span class="line">        List&lt;Address&gt; addresses = Db.lambdaQuery(Address.class)</span><br><span class="line">            .eq(Address::getUserId, id)</span><br><span class="line">            .list();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3.封装VO</span></span><br><span class="line">        <span class="comment">// 3.1.转User的PO为VO</span></span><br><span class="line">        <span class="type">UserVO</span> <span class="variable">userVO</span> <span class="operator">=</span> Beanutil.copyProperties(user, UserVO.class);</span><br><span class="line">        <span class="comment">// 3.2.转地址VO</span></span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(addresses))&#123; <span class="comment">//如果地址存在</span></span><br><span class="line">            List&lt;AddressVO&gt; addressVOS = BeanUtil.copyToList(addresses, AddressVO.class); </span><br><span class="line">            userVO.setAddresses(addressVOS);</span><br><span class="line">    	&#125;</span><br><span class="line">        </span><br><span class="line">		<span class="keyword">return</span> userVO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-3-5-JSON处理器"><a href="#2-3-5-JSON处理器" class="headerlink" title="2.3.5 JSON处理器"></a>2.3.5 JSON处理器</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240916183450259.png"
                      alt="image-20240916183450259"
                ></p>
</li>
<li><p>修改之后的用法：如使用层</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSaveUser</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">	user.setUsername(<span class="string">&quot;LiLei&quot;</span>);</span><br><span class="line">	user.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">	user.setPhone(<span class="string">&quot;18688990013&quot;</span>);</span><br><span class="line">	user.setBalance(<span class="number">200</span>);</span><br><span class="line">	<span class="comment">//user.setInfo(&quot;&#123;\&quot;age\&quot;: 24,\&quot;intro\&quot;:\&quot;英文老师\&quot;,\&quot;gender\&quot;:\&quot;female\&quot;&#125;&quot;);</span></span><br><span class="line">	user.setInfo(UserInfo.of(<span class="number">24</span>, <span class="string">&quot;英文老师&quot;</span>, <span class="string">&quot;female&quot;</span>)); <span class="comment">//修改的地方</span></span><br><span class="line">    user.setCreateTime(LocalDateTime.now());</span><br><span class="line">    user.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    </span><br><span class="line">	userService.save(user); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="2-4-插件功能"><a href="#2-4-插件功能" class="headerlink" title="2.4 插件功能"></a>2.4 插件功能</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240916184441308.png"
                      alt="image-20240916184441308"
                ></li>
</ul>
<h3 id="2-4-1-分页插件的基本使用"><a href="#2-4-1-分页插件的基本使用" class="headerlink" title="2.4.1 分页插件的基本使用"></a>2.4.1 分页插件的基本使用</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240916200229189.png"
                      alt="image-20240916200229189"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240916200251951.png"
                      alt="image-20240916200251951"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240916200332123.png"
                      alt="image-20240916200332123"
                ></p>
</li>
<li><p>在主包下创建 config &#x2F; MyBatisConfig，config 和 controller 一级。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisConfig</span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 1.初始化核心插件</span></span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">// 2.添加分页插件</span></span><br><span class="line">		<span class="type">PaginationInnerInterceptor</span> <span class="variable">pageInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MySQL);</span><br><span class="line">        pageInterceptor.setMaxLimit(<span class="number">1000L</span>); <span class="comment">//设置分页上限</span></span><br><span class="line">        </span><br><span class="line">        interceptor.addInnerInterceptor(pageInterceptor);</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>使用层</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPageQuery</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">int</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 1.准备分页条件</span></span><br><span class="line">    <span class="comment">// 1.1.分页条件</span></span><br><span class="line">	Page&lt;User&gt; page = Page.of(pageNo, pagesize);</span><br><span class="line">    <span class="comment">// 1.2.排序条件</span></span><br><span class="line">	page.addOrder(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(<span class="string">&quot;balance&quot;</span>, <span class="literal">true</span>));</span><br><span class="line">    page.addOrder(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(<span class="string">&quot;id&quot;</span>, <span class="literal">true</span>));</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 2.分页查询</span></span><br><span class="line">	Page&lt;User&gt; p = userService.page(page);</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 3.解折</span></span><br><span class="line">	<span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> p.getTotal();</span><br><span class="line">    System.out.println(<span class="string">&quot;total =&quot;</span> + total);</span><br><span class="line">    <span class="type">long</span> <span class="variable">pages</span> <span class="operator">=</span> p.getPages();</span><br><span class="line">    System.out.println(<span class="string">&quot;pages =&quot;</span> + pages);</span><br><span class="line">    List&lt;User&gt; users = p.getRecords();</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-4-2-通用分页实体"><a href="#2-4-2-通用分页实体" class="headerlink" title="2.4.2 通用分页实体"></a>2.4.2 通用分页实体</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240916204629486.png"
                      alt="image-20240916204629486"
                ></p>
</li>
<li><p>在主包下创建 domain &#x2F; query &#x2F; PageQuery， domain  和 controller 一级。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;分页查询实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageQuery</span> &#123;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;页码&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer pageNo;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;页码&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer pageSize;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;排序字段&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String sortBy;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;是否升序&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Boolean isAsc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>query &#x2F; UserQuery 使用 PageQuery，继承。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callsuper= true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;用户查询条件实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserQuery</span> <span class="keyword">extends</span> <span class="title class_">PageQuery</span> &#123; </span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户名关键字&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户状态:1-正常，2-冻结&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;余额最小值&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer minBalance;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;余额最大值&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer maxBalance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在主包下创建 domain &#x2F; dto &#x2F; PageDTO， domain  和 controller 一级。用于返回数据的格式。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description=&quot;分页结果&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageDTO</span>&lt;T&gt;&#123;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;总条数&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer total;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;总页数&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer pages;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;集合&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;T&gt; list; <span class="comment">//可以返回不同类型的集合</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>UserController</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Apioperation(&quot;根据条件分页查询用户接口&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> PageDTO&lt;UserVO&gt; <span class="title function_">queryUsersPage</span><span class="params">(UserQuery query)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> userService.queryUsersPage(query); <span class="comment">//自定义方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>IUserService</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">	PageDTO&lt;UserVO&gt; <span class="title function_">queryUsersPage</span><span class="params">(UserQuery query)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>UserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> PageDTO&lt;UserVO&gt; <span class="title function_">queryUsersPage</span><span class="params">(UserQuery query)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> query.getName();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> query.getStatus();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1.构建分页条件</span></span><br><span class="line">        <span class="comment">// 1.1.分页条件</span></span><br><span class="line">        Page&lt;User&gt; page = Page.of(query.getPageNo(),query.getPagesize());</span><br><span class="line">        <span class="comment">// 1.2.排序条件</span></span><br><span class="line">		<span class="keyword">if</span>(strutil.isNotBlank(query.getSortBy()))&#123;</span><br><span class="line">            <span class="comment">// 不为空</span></span><br><span class="line">			page.addOrder(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(query.getSortBy(), query.getIsAsc()));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">// 为空，默认按照更新时间排序</span></span><br><span class="line">			page.addOrder(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(<span class="string">&quot;update_time&quot;</span>, <span class="literal">false</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2.分页查询</span></span><br><span class="line">		Page&lt;User&gt; p = lambdaQuery()</span><br><span class="line">			.like(name != <span class="literal">null</span>, User::getUsername, name)</span><br><span class="line">            .eq(status != <span class="literal">null</span>, User::getStatus, status)</span><br><span class="line">			.page(page);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3.封装VO结果</span></span><br><span class="line">        PageDTO&lt;UserVO&gt; dto = <span class="keyword">new</span> <span class="title class_">PageDTO</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 3.1.总条数</span></span><br><span class="line">		dto.setTotal(p.getTotal());</span><br><span class="line">        <span class="comment">// 3.2.总页数</span></span><br><span class="line">		dto.setPages(p.getPages());</span><br><span class="line">        <span class="comment">// 3.3.当前页数据</span></span><br><span class="line">		List&lt;User&gt; records = p.getRecords();</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isEmpty(records))&#123; <span class="comment">//如果为空，返回空集合</span></span><br><span class="line">            dto.setList(Collections.emptyList());</span><br><span class="line">            <span class="keyword">return</span> dto;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//3.4.拷贝user的VO</span></span><br><span class="line">        List&lt;UserVO&gt; vos = BeanUtil.copyToList(records, UserVO.class);</span><br><span class="line">        dto.setList(vos);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4.返回</span></span><br><span class="line">		<span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-4-3-通用分页实体与MP转换"><a href="#2-4-3-通用分页实体与MP转换" class="headerlink" title="2.4.3 通用分页实体与MP转换"></a>2.4.3 通用分页实体与MP转换</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240916210612535.png"
                      alt="image-20240916210612535"
                ></p>
</li>
<li><p>PageQuery</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;分页查询实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageQuery</span> &#123;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;页码&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;页码&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;排序字段&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String sortBy;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;是否升序&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">isAsc</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">toMpPage</span><span class="params">(OrderItem ... items)</span>&#123; <span class="comment">//可以传一堆参数</span></span><br><span class="line">        <span class="comment">// 分页条件</span></span><br><span class="line">    	Page&lt;T&gt; page = Page.of(pageNo, pageSize);</span><br><span class="line">        <span class="comment">// 排序条件</span></span><br><span class="line">		<span class="keyword">if</span>(strutil.isNotBlank(sortBy))&#123;</span><br><span class="line">            <span class="comment">// 不为空</span></span><br><span class="line">			page.addOrder(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(sortBy, isAsc));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(items != <span class="literal">null</span>)&#123;</span><br><span class="line">			<span class="comment">// 为空，默认排序</span></span><br><span class="line">			page.addOrder(items);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">toMpPage</span><span class="params">(String defaultSortBy, Boolean defaultAsc)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> toMpPage(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(defaultSortBy, defaultAsc));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">toMpPageDefaultSortByCreateTime</span><span class="params">()</span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> toMpPage(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(<span class="string">&quot;create_time&quot;</span>, <span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">toMpPageDefaultSortByUpdateTime</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> toMpPage(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(<span class="string">&quot;update_time&quot;</span>, <span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>PageDTO</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description=&quot;分页结果&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageDTO</span>&lt;T&gt;&#123;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;总条数&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer total;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;总页数&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer pages;</span><br><span class="line">	<span class="meta">@ApiModelProperty(&quot;集合&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;T&gt; list; <span class="comment">//可以返回不同类型的集合</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;PO, VO&gt; PageDTO&lt;VO&gt; <span class="title function_">of</span><span class="params">(Page&lt;PO&gt; p, Class&lt;VO&gt; clazz)</span>&#123;</span><br><span class="line">        PageDTO&lt;VO&gt; dto = <span class="keyword">new</span> <span class="title class_">PageDTO</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 1.总条数</span></span><br><span class="line">        dto.setTotal(p.getTotal());</span><br><span class="line">        <span class="comment">// 2.总页数</span></span><br><span class="line">		dto.setPages(p.getPages());</span><br><span class="line">        <span class="comment">// 3.当前页数据</span></span><br><span class="line">		List&lt;PO&gt; records = p.getRecords();</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isEmpty(records))&#123;</span><br><span class="line">            dto.setList(collections.emptyList());</span><br><span class="line">            <span class="keyword">return</span> dto;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// 4.拷贝VO</span></span><br><span class="line">        dto.setList(BeanUtil.copyToList(records, clazz));</span><br><span class="line">        <span class="comment">// 5.返回</span></span><br><span class="line">		<span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;PO, VO&gt; PageDTO&lt;VO&gt; <span class="title function_">of</span><span class="params">(Page&lt;PO&gt; p, Function&lt;PO, VO&gt; convertor)</span>&#123;</span><br><span class="line">        PageDTO&lt;VO&gt; dto = <span class="keyword">new</span> <span class="title class_">PageDTO</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 1.总条数</span></span><br><span class="line">        dto.setTotal(p.getTotal());</span><br><span class="line">        <span class="comment">// 2.总页数</span></span><br><span class="line">		dto.setPages(p.getPages());</span><br><span class="line">        <span class="comment">// 3.当前页数据</span></span><br><span class="line">		List&lt;PO&gt; records = p.getRecords();</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isEmpty(records))&#123;</span><br><span class="line">            dto.setList(collections.emptyList());</span><br><span class="line">            <span class="keyword">return</span> dto;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// 4.拷贝VO</span></span><br><span class="line">        dto.setList(records.stream().map(convertor).collect(Collectors.toList()));</span><br><span class="line">        <span class="comment">// 5.返回</span></span><br><span class="line">		<span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>UserServiceImpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> PageDTO&lt;UserVO&gt; <span class="title function_">queryUsersPage</span><span class="params">(UserQuery query)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> query.getName();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> query.getStatus();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1.构建分页条件</span></span><br><span class="line">        Page&lt;User&gt; page = query.toMpPageDefaultSortByUpdateTime()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2.分页查询</span></span><br><span class="line">		Page&lt;User&gt; p = lambdaQuery()</span><br><span class="line">			.like(name != <span class="literal">null</span>, User::getUsername, name)</span><br><span class="line">            .eq(status != <span class="literal">null</span>, User::getStatus, status)</span><br><span class="line">			.page(page);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3.封装VO结果</span></span><br><span class="line">       	<span class="keyword">return</span> PageDTO.of(p, UserVO.class);</span><br><span class="line">        <span class="comment">// 3.封装VO结果</span></span><br><span class="line">		<span class="keyword">return</span> PageDTO.of(p, user -&gt; &#123;</span><br><span class="line">            <span class="comment">// 1.拷贝基础属性</span></span><br><span class="line">			<span class="type">UserVO</span> <span class="variable">vo</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserVO.class);</span><br><span class="line">            <span class="comment">// 2.处理特殊逻辑</span></span><br><span class="line">            <span class="comment">// 对用户名字的后两位进行隐蔽化处理</span></span><br><span class="line">			vo.setUsername(vo.getUsername().substring(<span class="number">0</span>, vo.getUsername().length() - <span class="number">2</span>) + <span class="string">&quot;**&quot;</span>); </span><br><span class="line">            <span class="keyword">return</span> vo;</span><br><span class="line">		&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="3-Docker"><a href="#3-Docker" class="headerlink" title="3. Docker"></a>3. Docker</h1><h2 id="3-1-快速入门"><a href="#3-1-快速入门" class="headerlink" title="3.1 快速入门"></a>3.1 快速入门</h2><h3 id="3-1-1-Docker的安装"><a href="#3-1-1-Docker的安装" class="headerlink" title="3.1.1 Docker的安装"></a>3.1.1 Docker的安装</h3><ul>
<li><strong>1.卸载旧版</strong></li>
</ul>
<p>首先如果系统中已经存在旧的Docker，则先卸载：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">	docker-client \</span><br><span class="line">	docker-client-latest \</span><br><span class="line">	docker-common \</span><br><span class="line">	docker-latest \</span><br><span class="line">	docker-latest-logrotate \</span><br><span class="line">	docker-logrotate \</span><br><span class="line">	docker-engine</span><br></pre></td></tr></table></figure></div>

<ul>
<li><strong>2.配置Docker的yum库</strong></li>
</ul>
<p>首先要安装一个yum工具</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils</span><br></pre></td></tr></table></figure></div>

<p>安装成功后，执行命令，配置Docker的yum源：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></div>

<ul>
<li><strong>3.安装Docker</strong></li>
</ul>
<p>最后，执行命令，安装Docker</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure></div>

<ul>
<li><strong>4.启动和校验</strong></li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 启动Docker</span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line"># 停止Docker</span><br><span class="line">systemctl stop docker</span><br><span class="line"></span><br><span class="line"># 重启</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line"># 设置开机自启</span><br><span class="line">systemctl enable docker</span><br><span class="line"></span><br><span class="line">#执行docker ps命令，如果不报错，说明安装启动成功</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure></div>

<h3 id="3-1-2-部署MySQL"><a href="#3-1-2-部署MySQL" class="headerlink" title="3.1.2 部署MySQL"></a>3.1.2 部署MySQL</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917163636631.png"
                      alt="image-20240917163636631"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917163547148.png"
                      alt="image-20240917163547148"
                ></p>
</li>
</ul>
<h3 id="3-1-3-命令解读"><a href="#3-1-3-命令解读" class="headerlink" title="3.1.3 命令解读"></a>3.1.3 命令解读</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917164555220.png"
                      alt="image-20240917164555220"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917164640304.png"
                      alt="image-20240917164640304"
                ></p>
</li>
</ul>
<h2 id="3-2-Docker基础"><a href="#3-2-Docker基础" class="headerlink" title="3.2 Docker基础"></a>3.2 Docker基础</h2><h3 id="3-2-1-常见命令"><a href="#3-2-1-常见命令" class="headerlink" title="3.2.1 常见命令"></a>3.2.1 常见命令</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-17%20165301.png"
                      alt="屏幕截图 2024-09-17 165301"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917165705754.png"
                      alt="image-20240917165705754"
                ></p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 在DockerHub中搜索镜像</span><br><span class="line">2. 拉取镜像。 docker pull nginx</span><br><span class="line">3. 查看本地镜像列表，是否拉取成功。 docker images</span><br><span class="line">4. 打包保存到本地，nginx.tar是包名，nginx:latest是镜像。 docker save -o nginx.tar nginx:latest</span><br><span class="line">5. 删除镜像。 docker rmi nginx:latest</span><br><span class="line">6. 从本地重新得到镜像。 docker load -i nginx.tar</span><br><span class="line">7. 创建并运行容器。 docker run -d --name nginx -p 80:80 nginx</span><br><span class="line">8. 查看容器。 docker ps</span><br><span class="line">9. 停止容器。 docker stop nginx</span><br><span class="line">10. 再次启动容器。 docker start nginx</span><br><span class="line">11. 查看日志。 docker logs nginx</span><br><span class="line">12. 实时查看日志。 docker logs -f nginx</span><br><span class="line">13. 进入容器。 docker exec -it nginx bash</span><br><span class="line">14. 退出容器。 exit</span><br><span class="line">15. 删除容器（运行中的不能删除）。 docker rm nginx</span><br><span class="line">16. 强制删除容器。 docker rm nginx -f</span><br></pre></td></tr></table></figure></div>

<h3 id="3-2-2-命令别名"><a href="#3-2-2-命令别名" class="headerlink" title="3.2.2 命令别名"></a>3.2.2 命令别名</h3><ul>
<li>使用命令：vi ~&#x2F;.bashrc，进入配置。</li>
<li>配置完成，保存。</li>
<li>使用命令：source ~&#x2F;.bashrc，使配置生效。</li>
</ul>
<h3 id="3-2-3-数据卷挂载"><a href="#3-2-3-数据卷挂载" class="headerlink" title="3.2.3 数据卷挂载"></a>3.2.3 数据卷挂载</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917173330206.png"
                      alt="image-20240917173330206"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917173359921.png"
                      alt="image-20240917173359921"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917173619192.png"
                      alt="image-20240917173619192"
                ></p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 数据卷挂载</span><br><span class="line">docker run -d --name nginx -p 80:80 -v html:/usr/share/nginx/html nginx</span><br><span class="line"></span><br><span class="line"># 查看数据卷</span><br><span class="line">docker volume ls</span><br><span class="line"></span><br><span class="line"># 查看数据卷的详细信息</span><br><span class="line">docker volume inspect html</span><br></pre></td></tr></table></figure></div>

<ul>
<li>可直接修改文件内容。</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917174456513.png"
                      alt="image-20240917174456513"
                ></li>
</ul>
<h3 id="3-2-4-本地目录挂载"><a href="#3-2-4-本地目录挂载" class="headerlink" title="3.2.4 本地目录挂载"></a>3.2.4 本地目录挂载</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917175801119.png"
                      alt="image-20240917175801119"
                ></li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">	--name mysql \</span><br><span class="line">	-p 3306:3306 \</span><br><span class="line">	-e TZ=Asia/Shanghai\</span><br><span class="line">	-e MYSOL_ROOT PASSWORD=123 \</span><br><span class="line">	-v /root/mysql/data:/var/lib/mysql \</span><br><span class="line">	-v /root/mysql/init:/docker-entrypoint-initdb.d \</span><br><span class="line">	-v /root/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">	mysql</span><br></pre></td></tr></table></figure></div>

<h3 id="3-2-5-自定义镜像"><a href="#3-2-5-自定义镜像" class="headerlink" title="3.2.5 自定义镜像"></a>3.2.5 自定义镜像</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917182811525.png"
                      alt="image-20240917182811525"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917182837827.png"
                      alt="image-20240917182837827"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917182452054.png"
                      alt="image-20240917182452054"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917182745395.png"
                      alt="image-20240917182745395"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917183102655.png"
                      alt="image-20240917183102655"
                ></p>
</li>
<li><p>demo 目录下有 docker-demo.jar 与 Dockerfile文件。Dockerfile文件内容如下。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240917215424863.png"
                      alt="image-20240917215424863"
                ></p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.因为本地有包，所以是从本地得到镜像</span><br><span class="line">docker load -i jdk.tar</span><br><span class="line"></span><br><span class="line">2.进入目录</span><br><span class="line">cd demo/</span><br><span class="line"></span><br><span class="line">3.构建镜像</span><br><span class="line">docker build -t docker-demo .</span><br><span class="line"></span><br><span class="line">4.运行</span><br><span class="line">docker run -d --name dd -p 8080:8080 docker-demo</span><br></pre></td></tr></table></figure></div>

<h3 id="3-2-6-容器网络互连"><a href="#3-2-6-容器网络互连" class="headerlink" title="3.2.6 容器网络互连"></a>3.2.6 容器网络互连</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918112128718.png"
                      alt="image-20240918112128718"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918112300959.png"
                      alt="image-20240918112300959"
                ></p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">#创建一个网络（网络名）</span><br><span class="line">docker network create heima</span><br><span class="line"></span><br><span class="line">#查看所有网络</span><br><span class="line">docker network ls</span><br><span class="line"></span><br><span class="line">#使指定容器连接加入某网络（网络名，容器名）</span><br><span class="line">docker network connect heima mysql</span><br><span class="line"></span><br><span class="line">#使指定容器创建后直接连接加入某网络</span><br><span class="line">docker run -d --name dd -p 8080:8080 --network heima docker-demo</span><br></pre></td></tr></table></figure></div>

<h2 id="3-3-项目部署"><a href="#3-3-项目部署" class="headerlink" title="3.3 项目部署"></a>3.3 项目部署</h2><h3 id="3-3-1-部署Java应用"><a href="#3-3-1-部署Java应用" class="headerlink" title="3.3.1 部署Java应用"></a>3.3.1 部署Java应用</h3><ul>
<li><p>hmal 父工程，下面有 hm-common 公共模块与 hm-service 业务模块。</p>
</li>
<li><p>hm-service 下有 Dockerfile 文件。</p>
</li>
<li><p>1.对父工程打包。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918143138984.png"
                      alt="image-20240918143138984"
                ></p>
</li>
<li><p>打包的 hm-service.jar 会包含 hm-common 公共模块与 hm-service 业务模块。</p>
</li>
<li><p>2.把 hm-service.jar 与 Dockerfile 移到 Docker 中。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918144029982.png"
                      alt="image-20240918144029982"
                ></p>
</li>
<li><p>3.使用命令。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker build -t hmall .</span><br><span class="line"></span><br><span class="line">docker run -d --name hm -p 8080:8080 --network heima hmall</span><br></pre></td></tr></table></figure></div>

<h3 id="3-3-2-部署前端"><a href="#3-3-2-部署前端" class="headerlink" title="3.3.2 部署前端"></a>3.3.2 部署前端</h3><ul>
<li><p>nginx.conf 文件</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918144438293.png"
                      alt="image-20240918144438293"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918144457037.png"
                      alt="image-20240918144457037"
                ></p>
</li>
<li><p>1.将 nginx 文件移到 Docker 中。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918145324929.png"
                      alt="image-20240918145324929"
                ></p>
</li>
<li><p>2.使用命令</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">	--name nginx \</span><br><span class="line">	-p 18080:18080 \</span><br><span class="line">	-p 18081:18081 \</span><br><span class="line">	-v /root/nginx/html:/usr/share/nginx/html \</span><br><span class="line">	-v /root/nginx/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">	--network heima \</span><br><span class="line">	nginx</span><br></pre></td></tr></table></figure></div>

<h3 id="3-3-3-DockerCompose"><a href="#3-3-3-DockerCompose" class="headerlink" title="3.3.3 DockerCompose"></a>3.3.3 DockerCompose</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918150540015.png"
                      alt="image-20240918150540015"
                ></p>
</li>
<li><p>完整写法</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918150613792.png"
                      alt="image-20240918150613792"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918150715140.png"
                      alt="image-20240918150715140"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918150843555.png"
                      alt="image-20240918150843555"
                ></p>
</li>
<li><p>1.将 docker-compose.yml 移到 Docker 中。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918151248992.png"
                      alt="image-20240918151248992"
                ></p>
</li>
<li><p>2.使用命令</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 创建并启动</span><br><span class="line">docker compose up -d</span><br><span class="line"></span><br><span class="line"># 停止并移除</span><br><span class="line">docker compose down</span><br></pre></td></tr></table></figure></div>

<h1 id="4-认识微服务"><a href="#4-认识微服务" class="headerlink" title="4.认识微服务"></a>4.认识微服务</h1><h2 id="4-1-单体架构"><a href="#4-1-单体架构" class="headerlink" title="4.1 单体架构"></a>4.1 单体架构</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918181108939.png"
                      alt="image-20240918181108939"
                ></li>
</ul>
<h2 id="4-2-微服务架构"><a href="#4-2-微服务架构" class="headerlink" title="4.2 微服务架构"></a>4.2 微服务架构</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918181600130.png"
                      alt="image-20240918181600130"
                ></li>
</ul>
<h2 id="4-3-SpringCloud"><a href="#4-3-SpringCloud" class="headerlink" title="4.3 SpringCloud"></a>4.3 SpringCloud</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918192641971.png"
                      alt="image-20240918192641971"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918192704137.png"
                      alt="image-20240918192704137"
                ></p>
</li>
</ul>
<h1 id="5-微服务拆分"><a href="#5-微服务拆分" class="headerlink" title="5.微服务拆分"></a>5.微服务拆分</h1><h2 id="5-1-熟悉黑马商城"><a href="#5-1-熟悉黑马商城" class="headerlink" title="5.1 熟悉黑马商城"></a>5.1 熟悉黑马商城</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918212240136.png"
                      alt="image-20240918212240136"
                ></p>
</li>
<li><p>用户 - user、商品 - item、购物车 - cart、订单 - trade、支付 - pay</p>
</li>
<li><p>登录</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918205138765.png"
                      alt="image-20240918205138765"
                ></p>
</li>
<li><p>购物车</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241031164906290.png"
                      alt="image-20241031164906290"
                ></p>
</li>
</ul>
<h2 id="5-2-微服务拆分原则"><a href="#5-2-微服务拆分原则" class="headerlink" title="5.2 微服务拆分原则"></a>5.2 微服务拆分原则</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918213642177.png"
                      alt="image-20240918213642177"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918213603873.png"
                      alt="image-20240918213603873"
                ></p>
</li>
</ul>
<h2 id="5-3-微服务项目结构"><a href="#5-3-微服务项目结构" class="headerlink" title="5.3 微服务项目结构"></a>5.3 微服务项目结构</h2><p>工程结构有两种：</p>
<ul>
<li><p>独立Project</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918214855863.png"
                      alt="image-20240918214855863"
                ></p>
</li>
<li><p>Maven聚合</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240918214833980.png"
                      alt="image-20240918214833980"
                ></p>
</li>
</ul>
<h2 id="5-4-拆分商品服务"><a href="#5-4-拆分商品服务" class="headerlink" title="5.4 拆分商品服务"></a>5.4 拆分商品服务</h2><ul>
<li><p>1.新建模块。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240919104513971.png"
                      alt="image-20240919104513971"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240919104639020.png"
                      alt="image-20240919104639020"
                ></p>
</li>
<li><p>2.在 pom.xml 文件添加依赖。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.heima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hmall<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>item-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--common--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.heima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hm-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据库--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>3.创建包和启动类</p>
</li>
<li><p>在 java 目录下创建 com.hmall.item 包，在  com.hmall.item 包下创建 controller、domain、mapper、service 包。</p>
</li>
<li><p>在  com.hmall.item 包创建启动类 itemApplication。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.hmall.item.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">itemApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(itemApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>4.添加配置文件。</p>
</li>
<li><p>将 hm-service 下的 resources 下的三个 yaml 文件拷贝到 item-service 下的 resources。</p>
</li>
<li><p>修改除 application.yaml 文件的其他两个文件为自己的地址与密码。</p>
</li>
<li><p>修改 application.yaml 文件。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span> <span class="comment">#端口号 修改</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">item-service</span> <span class="comment">#微服务名称 修改</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span> <span class="comment">#数据库连接信息 修改</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://$&#123;hm.db.host&#125;:3306/hm-item?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;hm.db.pw&#125;</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">default-enum-type-handler:</span> <span class="string">com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">update-strategy:</span> <span class="string">not_null</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.hmall:</span> <span class="string">debug</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">dateformat:</span> <span class="string">HH:mm:ss:SSS</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&quot;logs/$&#123;spring.application.name&#125;&quot;</span></span><br><span class="line"><span class="attr">knife4j:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">openapi:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">宏茂商城商品管理接口文档</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">&quot;宏茂商城商品管理接口文档&quot;</span></span><br><span class="line">    <span class="attr">email:</span> <span class="number">3151805288</span><span class="string">@qq.com</span></span><br><span class="line">    <span class="attr">concat:</span> <span class="string">lrq</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">v1.0.0</span></span><br><span class="line">    <span class="attr">group:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">group-name:</span> <span class="string">default</span></span><br><span class="line">        <span class="attr">api-rule:</span> <span class="string">package</span></span><br><span class="line">        <span class="attr">api-rule-resources:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">com.hmall.item.controller</span> <span class="comment"># 扫描的包名 修改</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>5.将 hm-service 下的 controller、domain、mapper、service 包下的 item 对应的包迁移过来。</p>
</li>
<li><p>对里面的依赖进行修改。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240919155822776.png"
                      alt="image-20240919155822776"
                ></p>
</li>
<li><p>6.启动拆分项。</p>
</li>
</ul>
<h2 id="5-5-拆分购物车服务"><a href="#5-5-拆分购物车服务" class="headerlink" title="5.5 拆分购物车服务"></a>5.5 拆分购物车服务</h2><ul>
<li><p>1.新建模块。</p>
</li>
<li><p>2.在 pom.xml 文件添加依赖。</p>
</li>
<li><p>3.创建包和启动类。</p>
</li>
<li><p>4.添加配置文件。</p>
</li>
<li><p>5.将 hm-service 下的 controller、domain、mapper、service 包下的 cart 对应的包迁移过来。</p>
</li>
<li><p>对里面的依赖进行修改。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240919201909322.png"
                      alt="image-20240919201909322"
                ></p>
</li>
<li><p>6.启动拆分项。</p>
</li>
</ul>
<h2 id="5-6-远程调用"><a href="#5-6-远程调用" class="headerlink" title="5.6 远程调用"></a>5.6 远程调用</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240919172734559.png"
                      alt="image-20240919172734559"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240919165641434.png"
                      alt="image-20240919165641434"
                ></p>
</li>
<li><p>购物车服务 会调用 商品服务</p>
</li>
<li><p>cartApplication 启动类</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.hmall.cart.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cartApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(cartApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入RestTemplate到Spring容器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>CartServicelmpl</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleCartItems</span><span class="params">(List&lt;CartVO&gt; vos)</span> &#123;</span><br><span class="line">	<span class="comment">// 1.获取商品id</span></span><br><span class="line">    Set&lt;Long&gt; itemIds = vos.stream().map(CartVO::getItemId).collect(Collectors.toSet());</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 2.查询商品</span></span><br><span class="line">    <span class="comment">// 2.1.利用RestTemplate发起http请求，得到http的响应</span></span><br><span class="line">    ResponseEntity&lt;List&lt;ItemDTO&gt;&gt; response = restTemplate.exchange(</span><br><span class="line">    	<span class="string">&quot;http://localhost:8081/items?ids=&#123;ids&#125;&quot;</span>,  			<span class="comment">//请求地址</span></span><br><span class="line">         HttpMethod.GET,                           			<span class="comment">//get请求</span></span><br><span class="line">         <span class="literal">null</span>,                                     			<span class="comment">//请求实体</span></span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">ParameterizedTypeReference</span>&lt;List&lt;ItemDTO&gt;&gt;()&#123;&#125;, <span class="comment">//返回值类型，List&lt;ItemDTO&gt;</span></span><br><span class="line">         Map.of(<span class="string">&quot;ids&quot;</span>, CollUtil.join(itemIds, <span class="string">&quot;,&quot;</span>))         <span class="comment">//请求参数，将集合转换为字符串，并用逗号连接</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 2.2.解析响应</span></span><br><span class="line">    <span class="keyword">if</span>(!response.getStatusCode().is2xxSuccessful())&#123; <span class="comment">//判断请求是否成功</span></span><br><span class="line">    	<span class="comment">//查询失败，直接结束</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;ItemDTO&gt; items = response.getBody(); <span class="comment">//获取返回值</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (CollUtils.isEmpty(items)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.转为 id 到 item的map</span></span><br><span class="line">    Map&lt;Long, ItemDTO&gt; itemMap = </span><br><span class="line">     items.stream().collect(Collectors.toMap(ItemDTO::getId, Function.identity()));</span><br><span class="line">    <span class="comment">// 4.写入vo</span></span><br><span class="line">    <span class="keyword">for</span> (CartVO v : vos) &#123;</span><br><span class="line">        <span class="type">ItemDTO</span> <span class="variable">item</span> <span class="operator">=</span> itemMap.get(v.getItemId());</span><br><span class="line">        <span class="keyword">if</span> (item == <span class="literal">null</span>) &#123;</span><br><span class="line">             <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v.setNewPrice(item.getPrice());</span><br><span class="line">        v.setStatus(item.getStatus());</span><br><span class="line">        v.setStock(item.getStock());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="6-服务治理"><a href="#6-服务治理" class="headerlink" title="6.服务治理"></a>6.服务治理</h1><h2 id="6-1-注册中心原理"><a href="#6-1-注册中心原理" class="headerlink" title="6.1 注册中心原理"></a>6.1 注册中心原理</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240919204438386.png"
                      alt="image-20240919204438386"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240919204515506.png"
                      alt="image-20240919204515506"
                ></p>
</li>
</ul>
<h2 id="6-2-搭建Nacos注册中心"><a href="#6-2-搭建Nacos注册中心" class="headerlink" title="6.2 搭建Nacos注册中心"></a>6.2 搭建Nacos注册中心</h2><ul>
<li><p>目前开源的注册中心框架有很多，国内比较常见的有：</p>
<ul>
<li>Eureka：Netflix公司出品，目前被集成在SpringCloud当中，般用于Java应用。</li>
<li>Nacos：Alibaba公司出品，目前被集成在SpringCloudAlibaba中，一般用于Java应用。</li>
<li>Consul：HashiCorp公司出品，目前集成在SPringCloud中，不限制微服务语言。</li>
</ul>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240919211012447.png"
                      alt="image-20240919211012447"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240919211157384.png"
                      alt="image-20240919211157384"
                ></p>
</li>
<li><p>nacos &#x2F; custom.env 文件。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">PREFER HOST MODE=hostname</span><br><span class="line">MODE=standalone</span><br><span class="line">SPRING_DATASOURCE_PLATFORM=mysql //数据源</span><br><span class="line">MYSQL_SERVICE_HOST=192.168.150.101 //虚拟机地址</span><br><span class="line">MYSQL_SERVICE_DB_NAME=nacos //数据库名</span><br><span class="line">MYSQL_SERVICE_PORT=3306 //端口</span><br><span class="line">MYSQL_SERVICE_USER=root //用户名</span><br><span class="line">MYSQL_SERVICE_PASSWORD=123 //用户密码</span><br><span class="line">MYSQL_SERVICE_DB_PARAM=...... //基本上不用改</span><br></pre></td></tr></table></figure></div>

<ul>
<li>然后，将 nacos 目录上传至虚拟机的 &#x2F;root 目录。</li>
<li>然后，将 nacos.tar 上传至虚拟机的 &#x2F;root 目录。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker load -i nacos.tar</span><br></pre></td></tr></table></figure></div>

<ul>
<li>进入 root 目录，然后执行下面的 docker 命令：</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">	--name nacos2 \</span><br><span class="line">	--env-file ./nacos/custom.env \</span><br><span class="line">    -p 8848:8848 \ </span><br><span class="line">    -p 9848:9848 \</span><br><span class="line">    -p 9849:9849 \</span><br><span class="line">    --restart=always \</span><br><span class="line">    nacos/nacos-server:v2.1.0-slim</span><br></pre></td></tr></table></figure></div>

<ul>
<li>启动完成后，访问下面地址：<a class="link"   href="http://192.168.150.101:8848/nacos/%EF%BC%8C%E6%B3%A8%E6%84%8F%E5%B0%86" >http://192.168.150.101:8848/nacos/，注意将 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 192.168.150.101 替换为你自己的虚拟机IP地址。首次访问会跳转到登录页，账号密码都是 nacos。</li>
</ul>
<h2 id="6-3-服务注册"><a href="#6-3-服务注册" class="headerlink" title="6.3 服务注册"></a>6.3 服务注册</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240920161014020.png"
                      alt="image-20240920161014020"
                ></p>
</li>
<li><p>1.在 pom.xml 文件注入依赖。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos 服务注册发现--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.在 application.yaml 文件配置地址。</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span> <span class="comment">#端口号 修改</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">item-service</span> <span class="comment">#微服务名称 修改</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span> <span class="comment">#数据库连接信息 修改</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://$&#123;hm.db.host&#125;:3306/hm-item?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;hm.db.pw&#125;</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">      <span class="attr">nacos:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#配置Nacos地址</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>一个服务模块请求多份实例。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240920163406284.png"
                      alt="image-20240920163406284"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240920163443447.png"
                      alt="image-20240920163443447"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240920163622718.png"
                      alt="image-20240920163622718"
                ></p>
</li>
</ul>
<h2 id="6-4-服务发现与负载均衡"><a href="#6-4-服务发现与负载均衡" class="headerlink" title="6.4 服务发现与负载均衡"></a>6.4 服务发现与负载均衡</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240920164205812.png"
                      alt="image-20240920164205812"
                ></p>
</li>
<li><p>1.在 pom.xml 文件注入依赖。（与服务注册一样）</p>
</li>
<li><p>2.在 application.yaml 文件配置地址。（与服务注册一样）</p>
</li>
<li><p>3.服务发现，在 CartServicelmpl 文件。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> DiscoveryClient discoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleCartItems</span><span class="params">(List&lt;CartVO&gt; vos)</span> &#123;</span><br><span class="line">	<span class="comment">// 1.获取商品id</span></span><br><span class="line">    Set&lt;Long&gt; itemIds = vos.stream().map(CartVO::getItemId).collect(Collectors.toSet());</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 2.查询商品</span></span><br><span class="line">    <span class="comment">// 2.1.根据服务名称获取服务的实例列表</span></span><br><span class="line">    List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;item-service&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(CollUtil.isEmpty(instances))&#123; <span class="comment">//判断服务列表是否为空</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.2.手写负载均衡，从实例列表中挑选一个实例（随机获取）</span></span><br><span class="line">    <span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> instances.get(RandomUtil.randomInt(instances.size()));</span><br><span class="line">    <span class="comment">// 2.3.利用RestTemplate发起http请求，得到http的响应</span></span><br><span class="line">    ResponseEntity&lt;List&lt;ItemDTO&gt;&gt;  response = restTemplate.exchange(</span><br><span class="line">            instance.getUri() + <span class="string">&quot;/items?ids=&#123;ids&#125;&quot;</span>,</span><br><span class="line">            HttpMethod.GET,</span><br><span class="line">            <span class="literal">null</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ParameterizedTypeReference</span>&lt;List&lt;ItemDTO&gt;&gt;()&#123;&#125;,</span><br><span class="line">            Map.of(<span class="string">&quot;ids&quot;</span>, CollUtil.join(itemIds, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 2.4.解析响应</span></span><br><span class="line">    <span class="keyword">if</span>(!response.getStatusCode().is2xxSuccessful())&#123; <span class="comment">//判断请求是否成功</span></span><br><span class="line">    	<span class="comment">//查询失败，直接结束</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;ItemDTO&gt; items = response.getBody(); <span class="comment">//获取返回值</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (CollUtils.isEmpty(items)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.转为 id 到 item的map</span></span><br><span class="line">    Map&lt;Long, ItemDTO&gt; itemMap = </span><br><span class="line">     items.stream().collect(Collectors.toMap(ItemDTO::getId, Function.identity()));</span><br><span class="line">    <span class="comment">// 4.写入vo</span></span><br><span class="line">    <span class="keyword">for</span> (CartVO v : vos) &#123;</span><br><span class="line">        <span class="type">ItemDTO</span> <span class="variable">item</span> <span class="operator">=</span> itemMap.get(v.getItemId());</span><br><span class="line">        <span class="keyword">if</span> (item == <span class="literal">null</span>) &#123;</span><br><span class="line">             <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v.setNewPrice(item.getPrice());</span><br><span class="line">        v.setStatus(item.getStatus());</span><br><span class="line">        v.setStock(item.getStock());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="7-OpenFeign"><a href="#7-OpenFeign" class="headerlink" title="7.OpenFeign"></a>7.OpenFeign</h1><h2 id="7-1-快速入门"><a href="#7-1-快速入门" class="headerlink" title="7.1 快速入门"></a>7.1 快速入门</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240920172449471.png"
                      alt="image-20240920172449471"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240920200639030.png"
                      alt="image-20240920200639030"
                ></p>
</li>
<li><p>1.在 pom.xml 文件注入依赖。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--openFeign--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--负载均衡器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.在 cartApplication 启动类添加注解。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span> <span class="comment">//添加注解</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.hmall.cart.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cartApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(cartApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>3.在 com.hmall.cart 目录下创建 client &#x2F; ltemClient。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;item-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ItemClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/items&quot;)</span></span><br><span class="line">    List&lt;ItemDTO&gt; <span class="title function_">queryItemByIds</span><span class="params">(<span class="meta">@RequestParam</span> (<span class="string">&quot;ids&quot;</span>)</span> Collection&lt;Long&gt; ids);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>4.在 CartServicelmpl 文件调用。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ItemClient itemClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleCartItems</span><span class="params">(List&lt;CartVO&gt; vos)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.获取商品id</span></span><br><span class="line">    Set&lt;Long&gt; itemIds = vos.stream().map(CartVO::getItemId).collect(Collectors.toSet());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.查询商品</span></span><br><span class="line">    List&lt;ItemDTO&gt; items = itemClient.queryItemByIds(itemIds);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (CollUtils.isEmpty(items)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.转为 id 到 item的map</span></span><br><span class="line">    Map&lt;Long, ItemDTO&gt; itemMap = </span><br><span class="line">        items.stream().collect(Collectors.toMap(ItemDTO::getId, Function.identity()));</span><br><span class="line">    <span class="comment">// 4.写入vo</span></span><br><span class="line">    <span class="keyword">for</span> (CartVO v : vos) &#123;</span><br><span class="line">        <span class="type">ItemDTO</span> <span class="variable">item</span> <span class="operator">=</span> itemMap.get(v.getItemId());</span><br><span class="line">        <span class="keyword">if</span> (item == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v.setNewPrice(item.getPrice());</span><br><span class="line">        v.setStatus(item.getStatus());</span><br><span class="line">        v.setStock(item.getStock());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="7-2-连接池"><a href="#7-2-连接池" class="headerlink" title="7.2 连接池"></a>7.2 连接池</h2><ul>
<li><p>目的：默认的是使用 HttpURLconnection 发请求，每次调用需要创建与销毁，效率低。为提高效率，使用连接池。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240920221228207.png"
                      alt="image-20240920221228207"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240920221243821.png"
                      alt="image-20240920221243821"
                ></p>
</li>
<li><p>在 cart-service 的 pom.xml 中注入依赖。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--ok-http--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>在 application.yaml 文件配置（是顶格一级的）。</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">okhttp:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></div>

<h2 id="7-3-最佳实践"><a href="#7-3-最佳实践" class="headerlink" title="7.3 最佳实践"></a>7.3 最佳实践</h2><ul>
<li><p>最佳实践1</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240921113602098.png"
                      alt="image-20240921113602098"
                ></p>
</li>
<li><p>最佳实践2</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240921113629043.png"
                      alt="image-20240921113629043"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240921122935068.png"
                      alt="image-20240921122935068"
                ></p>
</li>
<li><p>1.在 hmall 根目录下创建模块 hm-api。</p>
</li>
<li><p>2.在 hm-api 的 pom.xml 中注入依赖。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--openFeign--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--负载均衡器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>3.在 hm-api 模块下的 java 目录创建包 com.hmall.api &#x2F;client与dto。</p>
</li>
<li><p>4.将 cart-service 模块下 的 itemClient 与 itemDTO 迁移到  hm-api 模块并修改引入。</p>
</li>
<li><p>5.删除cart-service 模块下 的 itemClient 、 itemDTO 、 pom.xml 中的 openFeign 与 负载均衡器 的依赖。</p>
</li>
<li><p>6.在 cart-service 的 pom.xml 中注入依赖。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--hm-api--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hm-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>7.修改 CartServicelmpl 的引入。</p>
</li>
<li><p>8.修改 cartApplication 文件。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;com.hmall.api.client&quot;)</span> <span class="comment">//添加扫描包</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.hmall.cart.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cartApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(cartApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="7-4-日志输出"><a href="#7-4-日志输出" class="headerlink" title="7.4 日志输出"></a>7.4 日志输出</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240921153406777.png"
                      alt="image-20240921153406777"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240921154130030.png"
                      alt="image-20240921154130030"
                ></p>
</li>
<li><p>1.在 hm-api 模块下的 java 目录创建 com.hmall.config.DefaultFeignConfig。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultFeignConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> feign.Logger.Level <span class="title function_">feignLoggerLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.在 cartApplication 配置。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//全局配置</span></span><br><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;com.hmall.api.client&quot;, defaultConfiguration = DefaultFeignConfig.class)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.hmall.cart.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cartApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(cartApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="8-网关路由"><a href="#8-网关路由" class="headerlink" title="8.网关路由"></a>8.网关路由</h1><h2 id="8-1-网关"><a href="#8-1-网关" class="headerlink" title="8.1 网关"></a>8.1 网关</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240921212055003.png"
                      alt="image-20240921212055003"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240921212126221.png"
                      alt="image-20240921212126221"
                ></p>
</li>
</ul>
<h2 id="8-2-快速入门"><a href="#8-2-快速入门" class="headerlink" title="8.2 快速入门"></a>8.2 快速入门</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240922202238462.png"
                      alt="image-20240922202238462"
                ></p>
</li>
<li><p>1.在 hmall 根目录下创建 hm-gateway 模块。</p>
</li>
<li><p>2.在 pom.xml 文件引入依赖。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--网关--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--nacos discovery--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--负载均衡器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>3.在 hm-gateway 模块下的 java 目录下创建 com.hmall.gateway 包。</li>
<li>4.在 com.hmall.gateway 创建 GatewayApplication 启动类。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GatewayApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GatewayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在 resources 目录下创建 application.yaml 文件并配置。</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span> <span class="comment">#端口号 修改</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment">#微服务名称 修改</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">item-service</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://item-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/items/**,/search/**</span>	<span class="comment">#多个端口</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://user-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/users/**,/addresses/**</span></span><br></pre></td></tr></table></figure></div>

<h2 id="8-3-路由属性"><a href="#8-3-路由属性" class="headerlink" title="8.3 路由属性"></a>8.3 路由属性</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240922210129285.png"
                      alt="image-20240922210129285"
                ></li>
</ul>
<h3 id="8-3-1-路由断言"><a href="#8-3-1-路由断言" class="headerlink" title="8.3.1 路由断言"></a>8.3.1 路由断言</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240922210433718.png"
                      alt="image-20240922210433718"
                ></li>
</ul>
<h3 id="8-3-2-路由过滤器"><a href="#8-3-2-路由过滤器" class="headerlink" title="8.3.2 路由过滤器"></a>8.3.2 路由过滤器</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240922213350465.png"
                      alt="image-20240922213350465"
                ></p>
</li>
<li><p>为单个路由配置过滤器</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240922214035255.png"
                      alt="image-20240922214035255"
                ></p>
</li>
<li><p>为所有路由配置过滤器</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240922214218310.png"
                      alt="image-20240922214218310"
                ></p>
</li>
<li><p>使用</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240922214139860.png"
                      alt="image-20240922214139860"
                ></p>
</li>
</ul>
<h1 id="9-网关登录校验"><a href="#9-网关登录校验" class="headerlink" title="9.网关登录校验"></a>9.网关登录校验</h1><h2 id="9-1-思路分析"><a href="#9-1-思路分析" class="headerlink" title="9.1 思路分析"></a>9.1 思路分析</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240922215205960.png"
                      alt="image-20240922215205960"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240922215130002.png"
                      alt="image-20240922215130002"
                ></p>
</li>
</ul>
<h2 id="9-2-自定义过滤器"><a href="#9-2-自定义过滤器" class="headerlink" title="9.2 自定义过滤器"></a>9.2 自定义过滤器</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240922220048796.png"
                      alt="image-20240922220048796"
                ></li>
</ul>
<h3 id="9-2-1-GlobalFilter-过滤器"><a href="#9-2-1-GlobalFilter-过滤器" class="headerlink" title="9.2.1 GlobalFilter 过滤器"></a>9.2.1 GlobalFilter 过滤器</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240922220145841.png"
                      alt="image-20240922220145841"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240923164325142.png"
                      alt="image-20240923164325142"
                ></p>
</li>
</ul>
<h3 id="9-2-2-GatewayFilter-过滤器"><a href="#9-2-2-GatewayFilter-过滤器" class="headerlink" title="9.2.2 GatewayFilter 过滤器"></a>9.2.2 GatewayFilter 过滤器</h3><ul>
<li>GlobalFilter 过滤器是大部分情况使用的。</li>
<li>GatewayFilter 过滤器等有需求再学习。</li>
</ul>
<h2 id="9-3-实现登录校验"><a href="#9-3-实现登录校验" class="headerlink" title="9.3 实现登录校验"></a>9.3 实现登录校验</h2><ul>
<li>1.将 config 下的 AuthProperties、JwtProperties、SecurityConfig，utils 下的 JwtTool，resources 下的 hmall.jks 全部复制下来。</li>
<li>2.修改 application.yaml 文件。</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span> <span class="comment">#端口号 修改</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment">#微服务名称 修改</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">item-service</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://item-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/items/**,/search/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://user-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/users/**,/addresses/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">cart-service</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cart-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/carts/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">trade-service</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://trade-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/orders/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">pay-service</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://pay-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/pay-orders/**</span></span><br><span class="line"><span class="attr">hm:</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="attr">location:</span> <span class="string">classpath:hmall.jks</span></span><br><span class="line">    <span class="attr">alias:</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">hmall123</span></span><br><span class="line">    <span class="attr">tokenTTL:</span> <span class="string">30m</span></span><br><span class="line">  <span class="attr">auth:</span></span><br><span class="line">    <span class="attr">excludePaths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/search/**</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/users/login</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/items/**</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/hi</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>3.在 filters 下创建 AuthGlobalFilter。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthGlobalFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AuthProperties authProperties; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtTool jwtTool; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">autPathMatcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="comment">//1.获取request</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="comment">//2.判断是否需要做登录拦截</span></span><br><span class="line">        <span class="keyword">if</span>(isExclude(request.getPath().toString()))&#123; <span class="comment">//调用自定义的isExclude方法</span></span><br><span class="line">            <span class="comment">// 放行</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.获取token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// jwt令牌默认保存到 key 为 authorization 的请求头中</span></span><br><span class="line">        List&lt;String&gt; headers = request.getHeaders().get(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(headers != <span class="literal">null</span> &amp;&amp; !headers.isEmpty())&#123;</span><br><span class="line">            token = headers.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.校验并解析token</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> jwtTool.parseToken(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnauthorizedException e) &#123;</span><br><span class="line">           <span class="comment">// 拦载，设置响应状态码为401</span></span><br><span class="line">            <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">            response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">            <span class="keyword">return</span> response.setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5.传递用户信息</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.放行</span></span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isExclude</span><span class="params">(String path)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String pathPattern : authProperties.getExcludePaths())&#123; <span class="comment">//遍历application.yaml文件下的额外放行路径</span></span><br><span class="line">            <span class="keyword">if</span>(autPathMatcher.match(pathPattern, path))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="9-4-网关传递用户"><a href="#9-4-网关传递用户" class="headerlink" title="9.4 网关传递用户"></a>9.4 网关传递用户</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240923204538188.png"
                      alt="image-20240923204538188"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240923204559417.png"
                      alt="image-20240923204559417"
                ></p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">    <span class="comment">//1.获取request</span></span><br><span class="line">    <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">    <span class="comment">//2.判断是否需要做登录拦截</span></span><br><span class="line">    <span class="keyword">if</span>(isExclude(request.getPath().toString()))&#123;</span><br><span class="line">        <span class="comment">// 放行</span></span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.获取token</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// jwt令牌默认保存到 key 为 authorization 的请求头中</span></span><br><span class="line">    List&lt;String&gt; headers = request.getHeaders().get(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(headers != <span class="literal">null</span> &amp;&amp; !headers.isEmpty())&#123;</span><br><span class="line">        token = headers.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.校验并解析token</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        userId = jwtTool.parseToken(token);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnauthorizedException e) &#123;</span><br><span class="line">        <span class="comment">// 拦载，设置响应状态码为401</span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.传递用户信息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userInfo</span> <span class="operator">=</span> userId.toString();</span><br><span class="line">    <span class="type">ServerWebExchange</span> <span class="variable">swe</span> <span class="operator">=</span> exchange.mutate()</span><br><span class="line">        .request(builder -&gt; builder.header(<span class="string">&quot;user-info&quot;</span>, userInfo)) <span class="comment">//key，值</span></span><br><span class="line">        .build();</span><br><span class="line">    <span class="comment">//6.放行</span></span><br><span class="line">    <span class="keyword">return</span> chain.filter(swe);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240923205130294.png"
                      alt="image-20240923205130294"
                ></p>
</li>
<li><p>1.在 hm-common 模块下的 com.hmall.common 目录下创建 interceptors &#x2F; Userinfolnterceptor。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Userinfolnterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.获取登录用户信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userInfo</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;user-info&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.判断是否获取了用户，如果有，存入ThreadLocal</span></span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isNotBlank(userInfo))&#123;</span><br><span class="line">            UserContext.setUser(Long.valueOf(userInfo));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.放行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 清理用户</span></span><br><span class="line">        UserContext.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.在 hm-common 模块下的 com.hmall.common 目录下的 config 目录下创建 MvcConfig。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 判断是否是springmvc项目，网关里面没有mvc，拦截器不起作用，微服务里面有mvc，拦截器起作用。</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(DispatcherServlet.class)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">Userinfolnterceptor</span>()); <span class="comment">// 添加拦截器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>3.在 hm-common 模块下的 resources &#x2F; META-INF &#x2F; spring.factories 修改。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">  com.hmall.common.config.MyBatisConfig,\</span><br><span class="line">  com.hmall.common.config.MvcConfig,\</span><br><span class="line">  com.hmall.common.config.JsonConfig</span><br></pre></td></tr></table></figure></div>

<h2 id="9-5-OpenFeign传递用户"><a href="#9-5-OpenFeign传递用户" class="headerlink" title="9.5 OpenFeign传递用户"></a>9.5 OpenFeign传递用户</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240923215956264.png"
                      alt="image-20240923215956264"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240923214010350.png"
                      alt="image-20240923214010350"
                ></p>
</li>
<li><p>在 hm-api 模块下的 config &#x2F; DefaultFeignConfig 添加。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RequestInterceptor <span class="title function_">userInfoRequestInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RequestInterceptor</span>()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(RequestTemplate template)</span>&#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserContext.getUser();</span><br><span class="line">            <span class="keyword">if</span>(userId != <span class="literal">null</span>)&#123;</span><br><span class="line">            	template.header(<span class="string">&quot;user-info&quot;</span>, userId.toString());</span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>注入到其他微服务的启动类上。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//扫描包，拦截器</span></span><br><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;com.hmall.api.client&quot;, defaultConfiguration = DefaultFeignConfig.class)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.hmall.trade.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">tradeApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(tradeApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="10-配置管理"><a href="#10-配置管理" class="headerlink" title="10.配置管理"></a>10.配置管理</h1><h2 id="10-1-概念"><a href="#10-1-概念" class="headerlink" title="10.1 概念"></a>10.1 概念</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924112122101.png"
                      alt="image-20240924112122101"
                ></li>
</ul>
<h2 id="10-2-配置共享"><a href="#10-2-配置共享" class="headerlink" title="10.2 配置共享"></a>10.2 配置共享</h2><h3 id="10-2-1-概念"><a href="#10-2-1-概念" class="headerlink" title="10.2.1 概念"></a>10.2.1 概念</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924112812616.png"
                      alt="image-20240924112812616"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924113755748.png"
                      alt="image-20240924113755748"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924144300225.png"
                      alt="image-20240924144300225"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924144431686.png"
                      alt="image-20240924144431686"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924144454316.png"
                      alt="image-20240924144454316"
                ></p>
</li>
</ul>
<h3 id="10-2-2-实例"><a href="#10-2-2-实例" class="headerlink" title="10.2.2 实例"></a>10.2.2 实例</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924150033991.png"
                      alt="image-20240924150033991"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924150056458.png"
                      alt="image-20240924150056458"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924150120436.png"
                      alt="image-20240924150120436"
                ></p>
</li>
<li><p>在 pom.xml 文件注入依赖。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos配置管理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--读取bootstrap文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>新建 bootstrap.yaml 文件。</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cart-service</span> <span class="comment">#微服务名称 修改</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">        <span class="attr">shared-configs:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">data-id:</span> <span class="string">shared-jdbc.yaml</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">data-id:</span> <span class="string">shared-log.yaml</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">data-id:</span> <span class="string">shared-swagger.yaml</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>修改 application.yaml 文件。</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span> <span class="comment">#端口号 修改</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">okhttp:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">hm:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">hm-cart</span></span><br><span class="line">  <span class="attr">swagger:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">&quot;黑马商城购物车服务接口文档&quot;</span></span><br><span class="line">    <span class="attr">desc:</span> <span class="string">&quot;黑马商城购物车服务接口文档&quot;</span></span><br><span class="line">    <span class="attr">package:</span> <span class="string">com.hmall.cart.controller</span></span><br></pre></td></tr></table></figure></div>

<h2 id="10-3-配置热更新"><a href="#10-3-配置热更新" class="headerlink" title="10.3 配置热更新"></a>10.3 配置热更新</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924150634241.png"
                      alt="image-20240924150634241"
                ></p>
</li>
<li><p>1.在 com.hmall.cart 目录下创建 config &#x2F; CartProperties 文件。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;hm.cart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer maxItems;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.其他文件使用。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> CartProperties cartProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkCartsFull</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> Math.toIntExact(lambdaQuery().eq(Cart::getUserId, userId).count());</span><br><span class="line">        <span class="keyword">if</span> (count &gt;= cartProperties.getMaxItems()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BizIllegalException</span>(StrUtil.format(<span class="string">&quot;用户购物车商品数量不能超过&#123;&#125;&quot;</span>, cartProperties.getMaxItems()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>3.在 nacos 里面配置。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924152050574.png"
                      alt="image-20240924152050574"
                ></p>
</li>
</ul>
<h2 id="10-4-动态路由"><a href="#10-4-动态路由" class="headerlink" title="10.4 动态路由"></a>10.4 动态路由</h2><h3 id="10-4-1-概念"><a href="#10-4-1-概念" class="headerlink" title="10.4.1 概念"></a>10.4.1 概念</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924172706248.png"
                      alt="image-20240924172706248"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924210205325.png"
                      alt="image-20240924210205325"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924210437831.png"
                      alt="image-20240924210437831"
                ></p>
</li>
</ul>
<h3 id="10-4-2-实例"><a href="#10-4-2-实例" class="headerlink" title="10.4.2 实例"></a>10.4.2 实例</h3><ul>
<li>1.在 hm-gateway 模块下的 pom.xml 文件引入依赖。</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos配置管理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--读取bootstrap文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.在 hm-gateway 模块下的 resources 目录下创建 bootstrap.yaml。</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment">#微服务名称 修改</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">        <span class="attr">shared-configs:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">data-id:</span> <span class="string">shared-log.yaml</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>3.在 hm-gateway 模块下的 resources 目录下修改 application.yaml。</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span> <span class="comment">#端口号 修改</span></span><br><span class="line"><span class="attr">hm:</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="attr">location:</span> <span class="string">classpath:hmall.jks</span></span><br><span class="line">    <span class="attr">alias:</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">hmall123</span></span><br><span class="line">    <span class="attr">tokenTTL:</span> <span class="string">30m</span></span><br><span class="line">  <span class="attr">auth:</span></span><br><span class="line">    <span class="attr">excludePaths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/search/**</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/users/login</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/items/**</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/hi</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>4.在 hm-gateway 模块下的 com.hmall.gateway 目录下创建 routers &#x2F; DynamicRouteLoader。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicRouteLoader</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NacosConfigManager nacosConfigManager;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RouteDefinitionWriter writer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 路由配置文件的id和分组</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">dataId</span> <span class="operator">=</span> <span class="string">&quot;gateway-routes.json&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String group= <span class="string">&quot;DEFAULT_GROUP&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存更新过的路由id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; routeIds = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initRouteConfigListener</span><span class="params">()</span> <span class="keyword">throws</span> NacosException &#123;</span><br><span class="line">        <span class="comment">// 1.项目启动时，先拉取一次配置，并且添加配置监听器</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">configInfo</span> <span class="operator">=</span> nacosConfigManager.getConfigService()</span><br><span class="line">                .getConfigAndSignListener(dataId, group, <span class="number">5000</span>, <span class="keyword">new</span> <span class="title class_">Listener</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Executor <span class="title function_">getExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">                        <span class="comment">// 定义线程池</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveConfigInfo</span><span class="params">(String configInfo)</span> &#123;</span><br><span class="line">                        <span class="comment">// 2.监听到配置变更，需要去更新路由表</span></span><br><span class="line">                        updateConfigInfo(configInfo); <span class="comment">//自定义方法</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="comment">// 3.第一次读取到配置，也需要更新到路由表</span></span><br><span class="line">        updateConfigInfo(configInfo); <span class="comment">//自定义方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateConfigInfo</span><span class="params">(String configInfo)</span>&#123;</span><br><span class="line">        log.debug(<span class="string">&quot;监听到路由配置变更，&#123;&#125;&quot;</span>, configInfo);</span><br><span class="line">        <span class="comment">// 1.反序列化，解析配置信息，转为RouteDefinition</span></span><br><span class="line">        List&lt;RouteDefinition&gt; routeDefinitions = JSONUtil.toList(configInfo, RouteDefinition.class);</span><br><span class="line">        <span class="comment">// 2.更新前先清空旧路由</span></span><br><span class="line">        <span class="comment">// 2.1.清除旧路由</span></span><br><span class="line">        <span class="keyword">for</span> (String routeId : routeIds) &#123;</span><br><span class="line">            writer.delete(Mono.just(routeId)).subscribe();</span><br><span class="line">        &#125;</span><br><span class="line">        routeIds.clear();</span><br><span class="line">        <span class="comment">// 2.2.判断是否有新的路由要更新</span></span><br><span class="line">        <span class="keyword">if</span> (CollUtils.isEmpty(routeDefinitions)) &#123;</span><br><span class="line">            <span class="comment">// 无新路由配置，直接结束</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.更新路由(遍历)</span></span><br><span class="line">        routeDefinitions.forEach(routeDefinition -&gt; &#123;</span><br><span class="line">            <span class="comment">// 3.1.更新路由</span></span><br><span class="line">            writer.save(Mono.just(routeDefinition)).subscribe();</span><br><span class="line">            <span class="comment">// 3.2.记录路由id，方便将来删除</span></span><br><span class="line">            routeIds.add(routeDefinition.getId());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>5.在 Nacos 控制台添加路由，路由文件名为 gateway-routes.json，类型为json。</li>
<li>内容如下：</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;item&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;predicates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Path&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;_genkey_0&quot;</span><span class="punctuation">:</span><span class="string">&quot;/items/**&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;_genkey_1&quot;</span><span class="punctuation">:</span><span class="string">&quot;/search/**&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;filters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lb://item-service&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cart&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;predicates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Path&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;_genkey_0&quot;</span><span class="punctuation">:</span><span class="string">&quot;/carts/**&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;filters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lb://cart-service&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;predicates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Path&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;_genkey_0&quot;</span><span class="punctuation">:</span><span class="string">&quot;/users/**&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;_genkey_1&quot;</span><span class="punctuation">:</span><span class="string">&quot;/addresses/**&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;filters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lb://user-service&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;trade&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;predicates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Path&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;_genkey_0&quot;</span><span class="punctuation">:</span><span class="string">&quot;/orders/**&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;filters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lb://trade-service&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pay&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;predicates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Path&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;_genkey_0&quot;</span><span class="punctuation">:</span><span class="string">&quot;/pay-orders/**&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;filters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lb://pay-service&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>6.无需重启网关，稍等几秒钟后，再次访问地址。</li>
</ul>
<h1 id="11-雪崩问题（微服务保护）"><a href="#11-雪崩问题（微服务保护）" class="headerlink" title="11.雪崩问题（微服务保护）"></a>11.雪崩问题（微服务保护）</h1><h2 id="11-1-原因分析"><a href="#11-1-原因分析" class="headerlink" title="11.1 原因分析"></a>11.1 原因分析</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924163851925.png"
                      alt="image-20240924163851925"
                ></li>
</ul>
<h2 id="11-2-解决方案"><a href="#11-2-解决方案" class="headerlink" title="11.2 解决方案"></a>11.2 解决方案</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924170052125.png"
                      alt="image-20240924170052125"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924170148205.png"
                      alt="image-20240924170148205"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924170309007.png"
                      alt="image-20240924170309007"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240924170457569.png"
                      alt="image-20240924170457569"
                ></p>
</li>
</ul>
<h1 id="12-Sentinel（微服务保护）"><a href="#12-Sentinel（微服务保护）" class="headerlink" title="12.Sentinel（微服务保护）"></a>12.Sentinel（微服务保护）</h1><h2 id="12-1-快速入门"><a href="#12-1-快速入门" class="headerlink" title="12.1 快速入门"></a>12.1 快速入门</h2><h3 id="12-1-1-介绍和安装"><a href="#12-1-1-介绍和安装" class="headerlink" title="12.1.1 介绍和安装"></a>12.1.1 介绍和安装</h3><ul>
<li><p>Sentinel 的使用可以分为两个部分：</p>
<ul>
<li>核心库（Jar包）：不依赖任何框架&#x2F;库，能够运行于 Java 8 及以上的版本的运行时环境，同时对 Dubbo &#x2F; Spring Cloud 等框架也有较好的支持。在项目中引入依赖即可实现服务限流、隔离、熔断等功能。</li>
<li>控制台（Dashboard）：Dashboard 主要负责管理推送规则、监控、管理机器信息等。</li>
</ul>
</li>
<li><p>1.下载jar包。</p>
</li>
<li><p>下载地址：<a class="link"   href="https://github.com/alibaba/Sentinel/releases" >https://github.com/alibaba/Sentinel/releases <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p>2.运行如下命令启动控制台。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -Dserver.port=8090 -Dcsp.sentinel.dashboard.server=localhost:8090 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard.jar</span><br></pre></td></tr></table></figure></div>

<ul>
<li>3.访问<a class="link"   href="http://localhost:8080/" >http://localhost:8090 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>页面，就可以看到 sentinel 的控制台。</li>
<li>需要输入账号和密码，默认都是：sentinel。</li>
<li>登录后，即可看到控制台，默认会监控 sentinel-dashboard 服务本身。</li>
</ul>
<h3 id="12-1-2-微服务整合"><a href="#12-1-2-微服务整合" class="headerlink" title="12.1.2 微服务整合"></a>12.1.2 微服务整合</h3><ul>
<li><p>我们在 cart-service 模块中整合 sentinel，连接 sentinel-dashboard 控制台，步骤如下：</p>
</li>
<li><p>1.在 pom.xml 文件引入 sentinel 依赖。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--sentinel--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.修改 application.yaml 文件，添加。</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span> <span class="comment">#端口号 修改</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">okhttp:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">hm:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">hm-cart</span></span><br><span class="line">  <span class="attr">swagger:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">&quot;黑马商城购物车服务接口文档&quot;</span></span><br><span class="line">    <span class="attr">desc:</span> <span class="string">&quot;黑马商城购物车服务接口文档&quot;</span></span><br><span class="line">    <span class="attr">package:</span> <span class="string">com.hmall.cart.controller</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8090</span> <span class="comment"># sentinel的控制台地址</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>3.重启 cart-service 模块，然后访问查询购物车接口，sentinel 的客户端就会将服务访问的信息提交到  sentinel-dashboard 控制台。并展示出统计信息。</li>
</ul>
<h3 id="12-1-3-簇点链路"><a href="#12-1-3-簇点链路" class="headerlink" title="12.1.3 簇点链路"></a>12.1.3 簇点链路</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925190305701.png"
                      alt="image-20240925190305701"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925190424779.png"
                      alt="image-20240925190424779"
                ></p>
</li>
<li><p>所以我们可以选择打开 Sentinel 的请求方式前缀，把 请求方式 +请求路径 作为簇点资源名。</p>
</li>
<li><p>修改 application.yaml 文件，添加。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span> <span class="comment">#端口号 修改</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">okhttp:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">hm:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">hm-cart</span></span><br><span class="line">  <span class="attr">swagger:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">&quot;黑马商城购物车服务接口文档&quot;</span></span><br><span class="line">    <span class="attr">desc:</span> <span class="string">&quot;黑马商城购物车服务接口文档&quot;</span></span><br><span class="line">    <span class="attr">package:</span> <span class="string">com.hmall.cart.controller</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8090</span> <span class="comment"># sentinel的控制台地址</span></span><br><span class="line">      <span class="attr">http-method-specify:</span> <span class="literal">true</span> <span class="comment"># 开启请求方式前缀</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>然后，重启服务，通过页面访问购物车的相关接口，可以看到 sentinel 控制台的簇点链路发生了变化。</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925190639402.png"
                      alt="image-20240925190639402"
                ></li>
</ul>
<h2 id="12-2-请求限流"><a href="#12-2-请求限流" class="headerlink" title="12.2 请求限流"></a>12.2 请求限流</h2><ul>
<li><p>在簇点链路后面点击流控按钮，即可对其做限流配置。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925201251915.png"
                      alt="image-20240925201251915"
                ></p>
</li>
<li><p>在弹出的菜单中这样填写，这样就把查询购物车列表这个簇点资源的流量限制在了每秒6个，也就是最大QPS为6。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925201347960.png"
                      alt="image-20240925201347960"
                ></p>
</li>
</ul>
<h2 id="12-3-线程隔离"><a href="#12-3-线程隔离" class="headerlink" title="12.3 线程隔离"></a>12.3 线程隔离</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925203119020.png"
                      alt="image-20240925203119020"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925203222475.png"
                      alt="image-20240925203222475"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925203348311.png"
                      alt="image-20240925203348311"
                ></p>
</li>
</ul>
<h2 id="12-4-Fallback（降级）"><a href="#12-4-Fallback（降级）" class="headerlink" title="12.4 Fallback（降级）"></a>12.4 Fallback（降级）</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925204029163.png"
                      alt="image-20240925204029163"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925204649214.png"
                      alt="image-20240925204649214"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925204707956.png"
                      alt="image-20240925204707956"
                ></p>
</li>
<li><p>1.在 cart-service 模块的 application.yaml 文件将 FeignClient 作为 Sentinel 的簇点资源。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span> <span class="comment">#端口号 修改</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">okhttp:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启feign对sentinel的支持</span></span><br><span class="line"><span class="attr">hm:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">hm-cart</span></span><br><span class="line">  <span class="attr">swagger:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">&quot;黑马商城购物车服务接口文档&quot;</span></span><br><span class="line">    <span class="attr">desc:</span> <span class="string">&quot;黑马商城购物车服务接口文档&quot;</span></span><br><span class="line">    <span class="attr">package:</span> <span class="string">com.hmall.cart.controller</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">       	<span class="attr">dashboard:</span> <span class="string">localhost:8090</span> <span class="comment"># sentinel的控制台地址</span></span><br><span class="line">      <span class="attr">http-method-specify:</span> <span class="literal">true</span> <span class="comment"># 开启请求方式前缀</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.在 hm-api 模块中定义 fallback &#x2F; ItemClientFallbackFactory。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemClientFallbackFactory</span> <span class="keyword">implements</span> <span class="title class_">FallbackFactory</span>&lt;ItemClient&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ItemClient <span class="title function_">create</span><span class="params">(Throwable cause)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ItemClient</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> List&lt;ItemDTO&gt; <span class="title function_">queryItemByIds</span><span class="params">(Collection&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">                log.error(<span class="string">&quot;远程调用ItemClient#queryItemByIds方法出现异常，参数：&#123;&#125;&quot;</span>, ids, cause);</span><br><span class="line">                <span class="comment">// 查询购物车允许失败，查询失败，返回空集合</span></span><br><span class="line">                <span class="keyword">return</span> CollUtils.emptyList();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductStock</span><span class="params">(List&lt;OrderDetailDTO&gt; items)</span> &#123;</span><br><span class="line">                log.error(<span class="string">&quot;扣减商品库存失败!&quot;</span>, cause);</span><br><span class="line">                <span class="comment">// 库存扣减业务需要触发事务回滚，查询失败，抛出异常</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BizIllegalException</span>(cause);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>3.在 hm-api 模块中的 config &#x2F; DefaultFeignConfig  将 ItemClientFallbackFactory 注册为一个 Bean。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ItemClientFallbackFactory <span class="title function_">itemClientFallbackFactory</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ItemClientFallbackFactory</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>4.在 hm-api 模块中的 ItemClient 接囗中使用 ItemClientFallbackFactory。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;item-service&quot;, fallbackFactory = ItemClientFallbackFactory.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ItemClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/items&quot;)</span></span><br><span class="line">    List&lt;ItemDTO&gt; <span class="title function_">queryItemByIds</span><span class="params">(<span class="meta">@RequestParam</span> (<span class="string">&quot;ids&quot;</span>)</span> Collection&lt;Long&gt; ids);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/items/stock/deduct&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductStock</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;OrderDetailDTO&gt; items)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="12-5-服务熔断"><a href="#12-5-服务熔断" class="headerlink" title="12.5 服务熔断"></a>12.5 服务熔断</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925214048978.png"
                      alt="image-20240925214048978"
                ></li>
<li>状态机包括三个状态：<ul>
<li>closed：关闭状态，断路器放行所有请求，并开始统计异常比例、慢请求比例。超过阈值则切换到open状态。</li>
<li>open：打开状态，服务调用被熔断，访问被熔断服务的请求会被拒绝，快速失败，直接走降级逻辑。Open状态持续一段时间后会进入half-open状态。</li>
<li>half-open：半开状态，放行一次请求，根据执行结果来判断接下来的操作。请求成功：则切换到closed状态。请求失败：则切换到open状态。</li>
</ul>
</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925214952666.png"
                      alt="image-20240925214952666"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240925215009656.png"
                      alt="image-20240925215009656"
                ></li>
<li>RT超过200毫秒的请求调用就是慢调用。</li>
<li>统计最近1000ms内的最少5次请求，如果慢调用比例不低于0.5，则触发熔断。</li>
<li>熔断持续时长20s。</li>
</ul>
<h1 id="13-分布式事务"><a href="#13-分布式事务" class="headerlink" title="13.分布式事务"></a>13.分布式事务</h1><h2 id="13-1-概念"><a href="#13-1-概念" class="headerlink" title="13.1 概念"></a>13.1 概念</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926160657279.png"
                      alt="image-20240926160657279"
                ></li>
</ul>
<h2 id="13-2-初识Seata"><a href="#13-2-初识Seata" class="headerlink" title="13.2 初识Seata"></a>13.2 初识Seata</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926163533605.png"
                      alt="image-20240926163533605"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926164316285.png"
                      alt="image-20240926164316285"
                ></p>
</li>
</ul>
<h2 id="13-3-部署TC服务"><a href="#13-3-部署TC服务" class="headerlink" title="13.3 部署TC服务"></a>13.3 部署TC服务</h2><h3 id="13-3-1-准备数据库表"><a href="#13-3-1-准备数据库表" class="headerlink" title="13.3.1 准备数据库表"></a>13.3.1 准备数据库表</h3><ul>
<li>Seata支持多种存储模式，但考虑到持久化的需要，我们一般选择基于数据库存储。</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926165439794.png"
                      alt="image-20240926165439794"
                ></li>
</ul>
<h3 id="13-3-2-准备配置文件"><a href="#13-3-2-准备配置文件" class="headerlink" title="13.3.2 准备配置文件"></a>13.3.2 准备配置文件</h3><ul>
<li><p>seata目录，其中包含了seata运行时所需要的配置文件：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926165543145.png"
                      alt="image-20240926165543145"
                ></p>
</li>
<li><p>将seata目录与seata-1.5.2.tar包一起拷贝到虚拟机的 &#x2F;root 目录。</p>
</li>
</ul>
<h3 id="13-3-3-Docker部署"><a href="#13-3-3-Docker部署" class="headerlink" title="13.3.3 Docker部署"></a>13.3.3 Docker部署</h3><ul>
<li>加载seata镜像。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker load -i seata-1.5.2.tar</span><br></pre></td></tr></table></figure></div>

<ul>
<li>需要注意，要确保nacos、mysql都在hm-net网络中。如果某个容器不再hm-net网络，可以参考下面的命令将某容器加入指定网络。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker network connect [网络名] [容器名]</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在虚拟机的 &#x2F;root 目录执行下面的命令。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --name seata \</span><br><span class="line">-p 8099:8099 \</span><br><span class="line">-p 7099:7099 \</span><br><span class="line">-e SEATA_IP=192.168.150.101 \</span><br><span class="line">-v ./seata:/seata-server/resources \</span><br><span class="line">--privileged=true \</span><br><span class="line">--network hm-net \</span><br><span class="line">-d \</span><br><span class="line">seataio/seata-server:1.5.2</span><br></pre></td></tr></table></figure></div>

<ul>
<li>部署成功，NACOS可以看到seata-server注册成功，SEATA的用户和密码都是 admin。</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926170856370.png"
                      alt="image-20240926170856370"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926170144545.png"
                      alt="image-20240926170144545"
                ></li>
</ul>
<h2 id="13-4-微服务集成Seata"><a href="#13-4-微服务集成Seata" class="headerlink" title="13.4 微服务集成Seata"></a>13.4 微服务集成Seata</h2><h3 id="13-4-1-概念"><a href="#13-4-1-概念" class="headerlink" title="13.4.1 概念"></a>13.4.1 概念</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926171416205.png"
                      alt="image-20240926171416205"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926171438417.png"
                      alt="image-20240926171438417"
                ></p>
</li>
</ul>
<h3 id="13-4-2-实例"><a href="#13-4-2-实例" class="headerlink" title="13.4.2 实例"></a>13.4.2 实例</h3><ul>
<li>为了方便各个微服务集成seata，我们需要把seata配置共享到nacos，因此 trade-service 模块不仅仅要引入seata依赖，还要引入nacos依赖。</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--统一配置管理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--读取bootstrap文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--seata--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>在nacos上添加一个共享的seata配置，命名为 shared-seata.yaml，配置内容。</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="attr">registry:</span> <span class="comment"># TC服务注册中心的配置，微服务根据这些信息去注册中心获取tc服务地址</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span> <span class="comment"># 注册中心类型 nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">&quot;&quot;</span> <span class="comment"># namespace，默认为空</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">DEFAULT_GROUP</span> <span class="comment"># 分组，默认是DEFAULT_GROUP</span></span><br><span class="line">      <span class="attr">application:</span> <span class="string">seata-server</span> <span class="comment"># seata服务名称</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">tx-service-group:</span> <span class="string">hmall</span> <span class="comment"># 事务组名称</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">vgroup-mapping:</span> <span class="comment"># 事务组与tc集群的映射关系</span></span><br><span class="line">      <span class="attr">hmall:</span> <span class="string">&quot;default&quot;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>改造trade-service模块，添加bootstrap.yaml文件，内容如下。</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">trade-service</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># nacos地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># 文件后缀名</span></span><br><span class="line">        <span class="attr">shared-configs:</span> <span class="comment"># 共享配置</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">dataId:</span> <span class="string">shared-jdbc.yaml</span> <span class="comment"># 共享mybatis配置</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">dataId:</span> <span class="string">shared-log.yaml</span> <span class="comment"># 共享日志配置</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">dataId:</span> <span class="string">shared-swagger.yaml</span> <span class="comment"># 共享日志配置</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">dataId:</span> <span class="string">shared-seata.yaml</span> <span class="comment"># 共享seata配置</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>改造application.yaml文件，内容如下：</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8085</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">okhttp:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启OKHttp连接池支持</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启Feign对Sentinel的整合</span></span><br><span class="line"><span class="attr">hm:</span></span><br><span class="line">  <span class="attr">swagger:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">&quot;黑马商城交易服务接口文档&quot;</span></span><br><span class="line">    <span class="attr">desc:</span> <span class="string">&quot;黑马商城交易服务接口文档&quot;</span></span><br><span class="line">    <span class="attr">package:</span> <span class="string">com.hmall.trade.controller</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">hm-trade</span>   </span><br></pre></td></tr></table></figure></div>

<ul>
<li>参考上述办法分别改造 cart-service和 item-service 两个微服务模块。</li>
</ul>
<h2 id="13-5-XA模式"><a href="#13-5-XA模式" class="headerlink" title="13.5 XA模式"></a>13.5 XA模式</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926175043737.png"
                      alt="image-20240926175043737"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926174820156.png"
                      alt="image-20240926174820156"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926180636124.png"
                      alt="image-20240926180636124"
                ></p>
</li>
<li><p>在Nacos中的共享shared-seata.yaml配置文件中设置。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="attr">registry:</span> <span class="comment"># TC服务注册中心的配置，微服务根据这些信息去注册中心获取tc服务地址</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span> <span class="comment"># 注册中心类型 nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">&quot;&quot;</span> <span class="comment"># namespace，默认为空</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">DEFAULT_GROUP</span> <span class="comment"># 分组，默认是DEFAULT_GROUP</span></span><br><span class="line">      <span class="attr">application:</span> <span class="string">seata-server</span> <span class="comment"># seata服务名称</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">tx-service-group:</span> <span class="string">hmall</span> <span class="comment"># 事务组名称</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">vgroup-mapping:</span> <span class="comment"># 事务组与tc集群的映射关系</span></span><br><span class="line">      <span class="attr">hmall:</span> <span class="string">&quot;default&quot;</span></span><br><span class="line"><span class="attr">data-source-proxy-mode:</span> <span class="string">XA</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>用 @GlobalTransactional 标记分布式事务的入口方法。</li>
<li>用 @Transactional 标记分布式事务的分支事务。</li>
</ul>
<h2 id="13-6-AT模式（默认）"><a href="#13-6-AT模式（默认）" class="headerlink" title="13.6 AT模式（默认）"></a>13.6 AT模式（默认）</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926193452994.png"
                      alt="image-20240926193452994"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926194607165.png"
                      alt="image-20240926194607165"
                ></p>
</li>
</ul>
<h2 id="13-7-AT模式与XA模式的区别"><a href="#13-7-AT模式与XA模式的区别" class="headerlink" title="13.7 AT模式与XA模式的区别"></a>13.7 AT模式与XA模式的区别</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926193540756.png"
                      alt="image-20240926193540756"
                ></li>
</ul>
<h1 id="14-初识MQ"><a href="#14-初识MQ" class="headerlink" title="14.初识MQ"></a>14.初识MQ</h1><h2 id="14-1-MQ基础"><a href="#14-1-MQ基础" class="headerlink" title="14.1 MQ基础"></a>14.1 MQ基础</h2><ul>
<li>同步通讯：就如同打视频电话，双方的交互都是实时的。因此同一时刻你只能跟一个人打视频电话。</li>
<li>异步通讯：就如同发微信聊天，双方的交互不是实时的，你不需要立刻给对方回应。因此你可以多线操作，同时跟多人聊天。</li>
</ul>
<h2 id="14-2-同步调用"><a href="#14-2-同步调用" class="headerlink" title="14.2 同步调用"></a>14.2 同步调用</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926211921264.png"
                      alt="image-20240926211921264"
                ></li>
</ul>
<h2 id="14-3-异步调用"><a href="#14-3-异步调用" class="headerlink" title="14.3 异步调用"></a>14.3 异步调用</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926213326824.png"
                      alt="image-20240926213326824"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926213304002.png"
                      alt="image-20240926213304002"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926212958598.png"
                      alt="image-20240926212958598"
                ></p>
</li>
</ul>
<h2 id="14-4-技术选型"><a href="#14-4-技术选型" class="headerlink" title="14.4 技术选型"></a>14.4 技术选型</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240926214705013.png"
                      alt="image-20240926214705013"
                ></li>
</ul>
<h1 id="15-RabbitMQ"><a href="#15-RabbitMQ" class="headerlink" title="15.RabbitMQ"></a>15.RabbitMQ</h1><h2 id="15-1-安装部署"><a href="#15-1-安装部署" class="headerlink" title="15.1 安装部署"></a>15.1 安装部署</h2><ul>
<li><p>RabbitMQ是基于Erlang语言开发的开源消息通信中间件，官网地址：<a class="link"   href="https://www.rabbitmq.com/%E3%80%82" >https://www.rabbitmq.com/。 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p>将资料的 mq.tar 包移入到 Docker 的 \root 目录。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker load -i mq.tar</span><br></pre></td></tr></table></figure></div>

<ul>
<li>基于Docker来安装RabbitMQ，使用下面的命令。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run \</span><br><span class="line"> -e RABBITMQ_DEFAULT_USER=itheima \</span><br><span class="line"> -e RABBITMQ_DEFAULT_PASS=123321 \</span><br><span class="line"> -v mq-plugins:/plugins \</span><br><span class="line"> --name mq \</span><br><span class="line"> --hostname mq \</span><br><span class="line"> -p 15672:15672 \</span><br><span class="line"> -p 5672:5672 \</span><br><span class="line"> --network hm-net\</span><br><span class="line"> -d \</span><br><span class="line"> rabbitmq:3.8-management</span><br></pre></td></tr></table></figure></div>

<ul>
<li>可以看到在安装命令中有两个映射的端口：<ul>
<li>15672：RabbitMQ提供的管理控制台的端口。</li>
<li>5672：RabbitMQ的消息发送处理接口。</li>
</ul>
</li>
<li>安装完成后，我们访问15672端口 即可看到管理控制台。首次访问需要登录，默认的用户名和密码在配置文件中已经指定了。</li>
</ul>
<h2 id="15-2-基本介绍"><a href="#15-2-基本介绍" class="headerlink" title="15.2 基本介绍"></a>15.2 基本介绍</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927180132077.png"
                      alt="image-20240927180132077"
                ></li>
</ul>
<h2 id="15-3-快速入门"><a href="#15-3-快速入门" class="headerlink" title="15.3 快速入门"></a>15.3 快速入门</h2><h3 id="15-3-1-交换机"><a href="#15-3-1-交换机" class="headerlink" title="15.3.1 交换机"></a>15.3.1 交换机</h3><ul>
<li>我们打开 Exchanges 选项卡，可以看到已经存在很多交换机，这是系统自带的。</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927193526290.png"
                      alt="image-20240927193526290"
                ></li>
</ul>
<h3 id="15-3-2-队列"><a href="#15-3-2-队列" class="headerlink" title="15.3.2 队列"></a>15.3.2 队列</h3><ul>
<li><p>我们打开 queues 选项卡，新建一个队列。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927193641175.png"
                      alt="image-20240927193641175"
                ></p>
</li>
<li><p>创建两个队列，命名为 hello.queue1 与 hello.queue2。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927193753711.png"
                      alt="image-20240927193753711"
                ></p>
</li>
<li><p>最终队列列表如下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927194137791.png"
                      alt="image-20240927194137791"
                ></p>
</li>
</ul>
<h3 id="15-3-3-绑定关系"><a href="#15-3-3-绑定关系" class="headerlink" title="15.3.3 绑定关系"></a>15.3.3 绑定关系</h3><ul>
<li><p>点击 Exchanges 选项卡，点击 amg.fanout 交换机，进入交换机详情页，然后点击 Bindings 菜单，在表单中填写要绑定的队列名称。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927193932402.png"
                      alt="image-20240927193932402"
                ></p>
</li>
<li><p>最终绑定结果如下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927194217913.png"
                      alt="image-20240927194217913"
                ></p>
</li>
</ul>
<h3 id="15-3-4-发送消息"><a href="#15-3-4-发送消息" class="headerlink" title="15.3.4 发送消息"></a>15.3.4 发送消息</h3><ul>
<li><p>回到 exchange 页面，找到刚刚绑定的 amq.fanout ，点击进入详情页，发送一条消息。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927194310779.png"
                      alt="image-20240927194310779"
                ></p>
</li>
<li><p>回到 queues 页面，可以发现 hello.queue 中已经有一条消息了。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927194522473.png"
                      alt="image-20240927194522473"
                ></p>
</li>
<li><p>点击队列名称，进入详情页，点击 get message，查看队列详情。</p>
</li>
</ul>
<h3 id="15-3-5-注意事项"><a href="#15-3-5-注意事项" class="headerlink" title="15.3.5 注意事项"></a>15.3.5 注意事项</h3><ul>
<li>交换机只能路由消息，无法存储消息。</li>
<li>交换机只会路由消息给与其绑定的队列，因此队列必须与交换机绑定。</li>
</ul>
<h2 id="15-4-数据隔离"><a href="#15-4-数据隔离" class="headerlink" title="15.4 数据隔离"></a>15.4 数据隔离</h2><h3 id="15-4-1-用户管理"><a href="#15-4-1-用户管理" class="headerlink" title="15.4.1 用户管理"></a>15.4.1 用户管理</h3><ul>
<li><p>点击 Admin 选项卡，首先会看到 RabbitMQ 控制台的用户管理界面。</p>
</li>
<li><p>这里的用户都是 RabbitMQ 的管理或运维人员。目前只有安装 RabbitMQ 时添加的 itheima 这个用户。</p>
</li>
<li><p>仔细观察用户表格中的字段，如下：</p>
<ul>
<li><p>Name：也就是用户名 itheima。</p>
</li>
<li><p>Tags ：administrator，说明 itheima 用户是超级管理员，拥有所有权限。</p>
</li>
<li><p>Can access virtual host： &#x2F;，可以访问的 virtual host，这里的 &#x2F; 是默认的 virtual host。</p>
</li>
</ul>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927200413644.png"
                      alt="image-20240927200413644"
                ></p>
</li>
<li><p>对于小型企业而言，出于成本考虑，我们通常只会搭建一套 MQ 集群，公司内的多个不同项目同时使用。这个时候为了避免互相干扰， 我们会利用 virtual host 的隔离特性，将不同项目隔离。一般会做两件事情：</p>
<ul>
<li><p>给每个项目创建独立的运维账号，将管理权限分离。</p>
</li>
<li><p>给每个项目创建不同的 virtual host ，将每个项目的数据隔离。</p>
</li>
</ul>
</li>
<li><p>我们给黑马商城创建一个新的用户，命名为 hmall。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927200652202.png"
                      alt="image-20240927200652202"
                ></p>
</li>
<li><p>此时 hmall 用户没有任何 virtual host 的访问权限。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927201536284.png"
                      alt="image-20240927201536284"
                ></p>
</li>
</ul>
<h3 id="15-4-2-virtual-host"><a href="#15-4-2-virtual-host" class="headerlink" title="15.4.2 virtual host"></a>15.4.2 virtual host</h3><ul>
<li><p>我们先退出登录。</p>
</li>
<li><p>切换到刚刚创建的 hmall 用户登录，然后点击 Virtual Hosts 菜单，进入 virtual host 管理页。</p>
</li>
<li><p>可以看到目前只有一个默认的 virtual host ，名字为  &#x2F; 。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927201033203.png"
                      alt="image-20240927201033203"
                ></p>
</li>
<li><p>我们给黑马商城项目创建一个单独的 virtual host ，而不是使用默认的 &#x2F; 。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927201132113.png"
                      alt="image-20240927201132113"
                ></p>
</li>
<li><p>创建完成后如图。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927201257828.png"
                      alt="image-20240927201257828"
                ></p>
</li>
<li><p>由于我们是登录 hmall 账户后创建的 virtual host，因此回到 users 菜单，你会发现当前用户已经具备了对 &#x2F;hmall 这个 virtual host的访问权限了。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927201520243.png"
                      alt="image-20240927201520243"
                ></p>
</li>
<li><p>此时，点击页面右上角的 virtual host 下拉菜单，切换 virtual host 为  &#x2F;hmall。然后再次查看 queues 选项卡，会发现之前的队列已经看不到了。这就是基于 virtual host 的隔离效果。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927201654530.png"
                      alt="image-20240927201654530"
                ></p>
</li>
</ul>
<h1 id="16-Java客户端"><a href="#16-Java客户端" class="headerlink" title="16.Java客户端"></a>16.Java客户端</h1><h2 id="16-1-快速入门"><a href="#16-1-快速入门" class="headerlink" title="16.1 快速入门"></a>16.1 快速入门</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927205022352.png"
                      alt="image-20240927205022352"
                ></p>
</li>
<li><p>在控制台新建一个队列：simple.queue。</p>
</li>
</ul>
<h3 id="16-1-1-消息发送"><a href="#16-1-1-消息发送" class="headerlink" title="16.1.1 消息发送"></a>16.1.1 消息发送</h3><ul>
<li>首先配置MQ地址，在 publisher 服务的 application.yml 中添加配置。</li>
</ul>
<div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># 你的虚拟机IP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/hmall</span> <span class="comment"># 虚拟主机</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">hmall</span> <span class="comment"># 用户名</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span> <span class="comment"># 密码</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>然后在 publisher 服务中编写测试类 SpringAmqpTest ，并利用 RabbitTemplate 实现消息发送。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.publisher.amqp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringAmqpTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 队列名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        <span class="comment">// 消息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, spring amqp!&quot;</span>;</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>打开控制台，可以看到消息已经发送到队列中。</li>
</ul>
<h3 id="16-1-2-消息接收"><a href="#16-1-2-消息接收" class="headerlink" title="16.1.2 消息接收"></a>16.1.2 消息接收</h3><ul>
<li>首先配置MQ地址，在 consumer 服务的 application.yml 中添加配置。</li>
</ul>
<div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># 你的虚拟机IP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/hmall</span> <span class="comment"># 虚拟主机</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">hmall</span> <span class="comment"># 用户名</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span> <span class="comment"># 密码</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>然后在 consumer 服务的 com.itheima.consumer.listener 包中新建一个类 SpringRabbitListener。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRabbitListener</span> &#123;</span><br><span class="line">    <span class="comment">// 利用RabbitListener来声明要监听的队列信息</span></span><br><span class="line">    <span class="comment">// 将来一旦监听的队列中有了消息，就会推送给当前服务，调用当前方法，处理消息。</span></span><br><span class="line">    <span class="comment">// 可以看到方法体中接收的就是消息体的内容。</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;spring 消费者接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="16-2-Work-Queues"><a href="#16-2-Work-Queues" class="headerlink" title="16.2 Work Queues"></a>16.2 Work Queues</h2><h3 id="16-2-1-WorkQueues模型"><a href="#16-2-1-WorkQueues模型" class="headerlink" title="16.2.1 WorkQueues模型"></a>16.2.1 WorkQueues模型</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240927211909285.png"
                      alt="image-20240927211909285"
                ></p>
</li>
<li><p>在控制台创建一个新的队列，命名为 work.queue。</p>
</li>
<li><p>在 publisher 服务中的 SpringAmqpTest 类中添加一个测试方法。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * workQueue</span></span><br><span class="line"><span class="comment">  * 向队列中不停发送消息，模拟消息堆积。</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// 队列名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;work.queue&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, message_&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 发送消息，每20毫秒发送一次，相当于每秒发送50条消息</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message + i);</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在 consumer 服务的 SpringRabbitListener 中添加2个新的方法。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;work.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者1接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;work.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;消费者2........接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>运行，看到消费者1和消费者2竟然每人消费了25条消息：</p>
</li>
<li><p>消费者1很快完成了自己的25条消息</p>
</li>
<li><p>消费者2却在缓慢的处理自己的25条消息。</p>
</li>
<li><p>也就是说消息是平均分配给每个消费者，并没有考虑到消费者的处理能力。导致1个消费者空闲，另一个消费者忙的不可开交。没有充分利用每一个消费者的能力，最终消息处理的耗时远远超过了1秒。这样显然是有问题的。</p>
</li>
</ul>
<h3 id="16-2-2-能者多劳"><a href="#16-2-2-能者多劳" class="headerlink" title="16.2.2 能者多劳"></a>16.2.2 能者多劳</h3><ul>
<li>在 spring 中有一个简单的配置，可以解决这个问题。我们修改 consumer 服务的 application.yml 文件，添加配置。</li>
</ul>
<div class="highlight-container" data-rel="Yml"><figure class="iseeu highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span> <span class="comment"># 每次只能获取一条消息，处理完成才能获取下一个消息</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>运行，可以发现，由于消费者1处理速度较快，所以处理了更多的消息；消费者2处理速度较慢，只处理了6条消息。而最终总的执行耗时也在1秒左右，大大提升。</li>
<li>正所谓能者多劳，这样充分利用了每一个消费者的处理能力，可以有效避免消息积压问题。</li>
</ul>
<h3 id="16-2-3-总结"><a href="#16-2-3-总结" class="headerlink" title="16.2.3 总结"></a>16.2.3 总结</h3><ul>
<li>多个消费者绑定到一个队列，可以加快消息处理速度。</li>
<li>同一条消息只会被一个消费者处理。</li>
<li>默认情况下为平均分取消息。</li>
<li>通过设置prefetch来控制消费者预取的消息数量，处理完一条再处理下一条，实现能者多劳。</li>
</ul>
<h2 id="16-3-交换机类型"><a href="#16-3-交换机类型" class="headerlink" title="16.3 交换机类型"></a>16.3 交换机类型</h2><ul>
<li><p>Exchange（交换机）只负责转发消息，不具备存储消息的能力，因此如果没有任何队列与 Exchange 绑定，或者没有符合路由规则的队列，那么消息会丢失！</p>
</li>
<li><p>交换机的类型有四种：</p>
</li>
<li><p>Fanout：广播，将消息交给所有绑定到交换机的队列。</p>
</li>
<li><p>Direct：订阅，基于 RoutingKey（路由key）发送给订阅了消息的队列。</p>
</li>
<li><p>Topic：通配符订阅，与 Direct 类似，只不过 RoutingKey 可以使用通配符。</p>
</li>
<li><p>Headers：头匹配，基于 MQ 的消息头匹配，用的较少。</p>
</li>
</ul>
<h2 id="16-4-Fanout交换机"><a href="#16-4-Fanout交换机" class="headerlink" title="16.4 Fanout交换机"></a>16.4 Fanout交换机</h2><h3 id="16-4-1-概念"><a href="#16-4-1-概念" class="headerlink" title="16.4.1 概念"></a>16.4.1 概念</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240928192756357.png"
                      alt="image-20240928192756357"
                ></li>
</ul>
<h3 id="16-4-2-声明队列和交换机"><a href="#16-4-2-声明队列和交换机" class="headerlink" title="16.4.2 声明队列和交换机"></a>16.4.2 声明队列和交换机</h3><ul>
<li>创建一个名为  hmall.fanout 的交换机，类型是 Fanout。</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240928193957782.png"
                      alt="image-20240928193957782"
                ></li>
<li>创建两个队列 fanout.queue1 和 fanout.queue2，绑定到交换机 hmall.fanout。</li>
</ul>
<h3 id="16-4-3-消息的发送与接收"><a href="#16-4-3-消息的发送与接收" class="headerlink" title="16.4.3 消息的发送与接收"></a>16.4.3 消息的发送与接收</h3><ul>
<li>在 publisher 服务的 SpringAmqpTest 类中添加测试方法。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFanoutExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 交换机名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.fanout&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, everyone!&quot;</span>;</span><br><span class="line">    <span class="comment">// 发送消息，参数分别是：交互机名称、RoutingKey(暂时为空)、消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在 consumer 服务的 SpringRabbitListener 中添加两个方法，作为消费者。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue1</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者1接收到Fanout消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue2</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者2接收到Fanout消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="16-4-4-总结"><a href="#16-4-4-总结" class="headerlink" title="16.4.4 总结"></a>16.4.4 总结</h3><ul>
<li><p>交换机的作用是什么？</p>
</li>
<li><p>接收 publisher 发送的消息。</p>
</li>
<li><p>将消息按照规则路由到与之绑定的队列。</p>
</li>
<li><p>不能缓存消息，路由失败，消息丢失。</p>
</li>
<li><p>FanoutExchange 的会将消息路由到每个绑定的队列。</p>
</li>
</ul>
<h2 id="16-5-Direct交换机"><a href="#16-5-Direct交换机" class="headerlink" title="16.5 Direct交换机"></a>16.5 Direct交换机</h2><h3 id="16-5-1-概念"><a href="#16-5-1-概念" class="headerlink" title="16.5.1 概念"></a>16.5.1 概念</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240928193019596.png"
                      alt="image-20240928193019596"
                ></li>
</ul>
<h3 id="16-5-2-声明队列和交换机"><a href="#16-5-2-声明队列和交换机" class="headerlink" title="16.5.2 声明队列和交换机"></a>16.5.2 声明队列和交换机</h3><ul>
<li><p>声明一个 direct 类型的交换机，命名为 hmall.direct。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240928194113037.png"
                      alt="image-20240928194113037"
                ></p>
</li>
<li><p>在控制台声明两个队列 direct.queue1 和 direct.queue2。</p>
</li>
<li><p>使用 red 和 blue 作为 key，绑定 direct.queue1 到 hmall.direct。</p>
</li>
<li><p>使用 red 和 yellow 作为 key，绑定 direct.queue2 到 hmall.direct。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240928194251983.png"
                      alt="image-20240928194251983"
                ></p>
</li>
</ul>
<h3 id="16-5-3-消息的发送与接收"><a href="#16-5-3-消息的发送与接收" class="headerlink" title="16.5.3 消息的发送与接收"></a>16.5.3 消息的发送与接收</h3><ul>
<li>在 publisher 服务的 SpringAmqpTest 类中添加测试方法。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 交换机名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.direct&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;红色警报！日本乱排核废水，导致海洋生物变异，惊现哥斯拉！&quot;</span>;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;red&quot;</span>, message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 交换机名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.direct&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;最新报道，哥斯拉是居民自治巨型气球，虚惊一场！&quot;</span>;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;blue&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在 consumer 服务的 SpringRabbitListener 中添加方法。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;direct.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者1接收到direct.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;direct.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者2接收到direct.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="16-5-4-总结"><a href="#16-5-4-总结" class="headerlink" title="16.5.4 总结"></a>16.5.4 总结</h3><ul>
<li><p>描述下 Direct 交换机与 Fanout 交换机的差异？</p>
</li>
<li><p>Fanout 交换机将消息路由给每一个与之绑定的队列。</p>
</li>
<li><p>Direct 交换机根据 RoutingKey 判断路由给哪个队列。</p>
</li>
<li><p>如果多个队列具有相同的 RoutingKey，则与 Fanout 功能类似。</p>
</li>
</ul>
<h2 id="16-6-Topic交换机"><a href="#16-6-Topic交换机" class="headerlink" title="16.6 Topic交换机"></a>16.6 Topic交换机</h2><h3 id="16-6-1-概念"><a href="#16-6-1-概念" class="headerlink" title="16.6.1 概念"></a>16.6.1 概念</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240928195312056.png"
                      alt="image-20240928195312056"
                ></li>
</ul>
<h3 id="16-6-2-声明队列和交换机"><a href="#16-6-2-声明队列和交换机" class="headerlink" title="16.6.2 声明队列和交换机"></a>16.6.2 声明队列和交换机</h3><ul>
<li><p>声明交换机。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240928201110456.png"
                      alt="image-20240928201110456"
                ></p>
</li>
<li><p>在控制台声明两个队列 topic.queue1 和 topic.queue2。</p>
</li>
<li><p>topic.queue1：绑定的是 china.# ，凡是以 china. 开头的 routing key 都会被匹配到。</p>
</li>
<li><p>topic.queue2：绑定的是 #.news ，凡是以 .news 结尾的  routing key 都会被匹配到。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240928201453029.png"
                      alt="image-20240928201453029"
                ></p>
</li>
</ul>
<h3 id="16-6-3-消息的发送与接收"><a href="#16-6-3-消息的发送与接收" class="headerlink" title="16.6.3 消息的发送与接收"></a>16.6.3 消息的发送与接收</h3><ul>
<li>在 publisher 服务的 SpringAmqpTest 类中添加测试方法。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * topicExchange</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendTopicExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 交换机名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.topic&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;喜报！孙悟空大战哥斯拉，胜!&quot;</span>;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.news&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在 consumer 服务的 SpringRabbitListener 中添加方法。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;topic.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者1接收到topic.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;topic.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者2接收到topic.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="16-6-4-总结"><a href="#16-6-4-总结" class="headerlink" title="16.6.4 总结"></a>16.6.4 总结</h3><ul>
<li><p>描述下 Direct 交换机与 Topic 交换机的差异？</p>
</li>
<li><p>Topic 交换机接收的消息 RoutingKey 必须是多个单词，以 . 分割。</p>
</li>
<li><p>Topic 交换机与队列绑定时的 bindingKey 可以指定通配符。</p>
</li>
<li><p>#：代表0个或多个词。</p>
</li>
<li><p>*：代表1个词。</p>
</li>
</ul>
<h2 id="16-7-基于Bean声明队列交换机"><a href="#16-7-基于Bean声明队列交换机" class="headerlink" title="16.7 基于Bean声明队列交换机"></a>16.7 基于Bean声明队列交换机</h2><h3 id="16-7-1-fanout示例"><a href="#16-7-1-fanout示例" class="headerlink" title="16.7.1 fanout示例"></a>16.7.1 fanout示例</h3><ul>
<li>在 consumer 中创建一个类，声明队列和交换机。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.FanoutExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FanoutConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 声明交换机</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Fanout类型交换机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">fanoutExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(<span class="string">&quot;hmall.fanout&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第1个队列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定队列和交换机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1</span><span class="params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第2个队列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定队列和交换机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2</span><span class="params">(Queue fanoutQueue2, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue2).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="16-7-2-direct示例"><a href="#16-7-2-direct示例" class="headerlink" title="16.7.2 direct示例"></a>16.7.2 direct示例</h3><ul>
<li>direct 模式由于要绑定多个 KEY，会非常麻烦，每一个 Key 都要编写一个 binding。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirectConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 声明交换机</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Direct类型交换机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">directExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.directExchange(<span class="string">&quot;hmall.direct&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第1个队列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">directQueue1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;direct.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定队列和交换机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1WithRed</span><span class="params">(Queue directQueue1, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue1).to(directExchange).with(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定队列和交换机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1WithBlue</span><span class="params">(Queue directQueue1, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue1).to(directExchange).with(<span class="string">&quot;blue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第2个队列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">directQueue2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;direct.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定队列和交换机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2WithRed</span><span class="params">(Queue directQueue2, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue2).to(directExchange).with(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定队列和交换机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2WithYellow</span><span class="params">(Queue directQueue2, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue2).to(directExchange).with(<span class="string">&quot;yellow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="16-8-基于注解声明队列交换机"><a href="#16-8-基于注解声明队列交换机" class="headerlink" title="16.8 基于注解声明队列交换机"></a>16.8 基于注解声明队列交换机</h2><h3 id="16-8-1-声明Direct模式"><a href="#16-8-1-声明Direct模式" class="headerlink" title="16.8.1 声明Direct模式"></a>16.8.1 声明Direct模式</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者1接收到direct.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者2接收到direct.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="16-8-2-声明Topic模式"><a href="#16-8-2-声明Topic模式" class="headerlink" title="16.8.2 声明Topic模式"></a>16.8.2 声明Topic模式</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;china.#&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者1接收到topic.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;#.news&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者2接收到topic.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="16-9-消息转换器"><a href="#16-9-消息转换器" class="headerlink" title="16.9 消息转换器"></a>16.9 消息转换器</h2><h3 id="16-9-1-缺点"><a href="#16-9-1-缺点" class="headerlink" title="16.9.1 缺点"></a>16.9.1 缺点</h3><ul>
<li>Spring 的消息发送代码接收的消息体是一个 Object。而在数据传输时，它会把你发送的消息序列化为字节发送给 MQ，接收消息的时候，还会把字节反序列化为 Java 对象。只不过，默认情况下 Spring 采用的序列化方式是 JDK 序列化。</li>
<li>众所周知，JDK序列化存在下列问题：<ul>
<li>数据体积过大</li>
<li>有安全漏洞</li>
<li>可读性差</li>
</ul>
</li>
</ul>
<h3 id="16-9-2-配置JSON转换器"><a href="#16-9-2-配置JSON转换器" class="headerlink" title="16.9.2 配置JSON转换器"></a>16.9.2 配置JSON转换器</h3><ul>
<li>在 publisher 和 consumer 两个服务中都引入依赖。</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>配置消息转换器，在 publisher 和 consumer 两个服务的启动类中添加一个 Bean。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageConverter <span class="title function_">messageConverter</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 1.定义消息转换器</span></span><br><span class="line">    <span class="type">Jackson2JsonMessageConverter</span> <span class="variable">jackson2JsonMessageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">    <span class="comment">// 2.配置自动创建消息id，用于识别不同消息，也可以在业务中基于ID判断是否是重复消息</span></span><br><span class="line">    jackson2JsonMessageConverter.setCreateMessageIds(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> jackson2JsonMessageConverter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="16-9-3-消息的发送与接收"><a href="#16-9-3-消息的发送与接收" class="headerlink" title="16.9.3 消息的发送与接收"></a>16.9.3 消息的发送与接收</h3><ul>
<li>发送</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendMap</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// 准备消息</span></span><br><span class="line">    Map&lt;String,Object&gt; msg = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    msg.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;柳岩&quot;</span>);</span><br><span class="line">    msg.put(<span class="string">&quot;age&quot;</span>, <span class="number">21</span>);</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;object.queue&quot;</span>, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>接收</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;object.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(Map&lt;String, Object&gt; msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接收到object.queue消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="16-10-业务改造"><a href="#16-10-业务改造" class="headerlink" title="16.10 业务改造"></a>16.10 业务改造</h2><h3 id="16-10-1-业务需求"><a href="#16-10-1-业务需求" class="headerlink" title="16.10.1 业务需求"></a>16.10.1 业务需求</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009160724539.png"
                      alt="image-20241009160724539"
                ></p>
</li>
<li><p>说明：目前没有通知服务和积分服务，因此我们只关注交易服务，步骤如下：</p>
</li>
<li><p>定义direct类型交换机，命名为 pay.direct。</p>
</li>
<li><p>定义消息队列，命名为 trade.pay.success.queue。</p>
</li>
<li><p>将 trade.pay.success.queue 与 pay.direct 绑定， BindingKey 为 pay.success。</p>
</li>
<li><p>支付成功时不再调用交易服务更新订单状态的接口，而是发送一条消息到 pay.direct，发送消息的 RoutingKey 为 pay.success，消息内容是订单id。</p>
</li>
<li><p>交易服务监听 trade.pay.success.queue 队列，接收到消息后更新订单状态为已支付。</p>
</li>
</ul>
<h3 id="16-10-2-配置MQ"><a href="#16-10-2-配置MQ" class="headerlink" title="16.10.2 配置MQ"></a>16.10.2 配置MQ</h3><ul>
<li>不管是生产者还是消费者，都需要配置MQ的基本信息。分为两步：</li>
<li>1.添加依赖：</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--消息发送--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.配置MQ地址：</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># 你的虚拟机IP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/hmall</span> <span class="comment"># 虚拟主机</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">hmall</span> <span class="comment"># 用户名</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span> <span class="comment"># 密码</span></span><br></pre></td></tr></table></figure></div>

<h3 id="16-10-3-配置消息转换器"><a href="#16-10-3-配置消息转换器" class="headerlink" title="16.10.3 配置消息转换器"></a>16.10.3 配置消息转换器</h3><ul>
<li>1.在 hm-common 模块的 com.hmall.common 包下的 config 包里创建 MqConfig。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MqConfig</span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> MessageConverter <span class="title function_">messageConverter</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.在 hm-common 模块的 resources 包下的 spring.factories 添加。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoconfiguration=\</span><br><span class="line">	com.hmall.common.config.MyBatisConfig,\</span><br><span class="line">	com.hmall.common.config.MvcConfig,\</span><br><span class="line">	com.hmall.common.config.MqConfig,\</span><br><span class="line">	com.hmall.common.config.JsonConfig</span><br></pre></td></tr></table></figure></div>

<h3 id="16-10-4-接收消息"><a href="#16-10-4-接收消息" class="headerlink" title="16.10.4 接收消息"></a>16.10.4 接收消息</h3><ul>
<li>在trade-service服务中定义一个消息监听类：com.hmall.trade &#x2F; listener &#x2F; PayStatusListener。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.trade.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmall.trade.service.IOrderService;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.ExchangeTypes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Exchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.QueueBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayStatusListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IOrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(name = &quot;trade.pay.success.queue&quot;, durable = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = &quot;pay.topic&quot;),</span></span><br><span class="line"><span class="meta">            key = &quot;pay.success&quot;</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenPaySuccess</span><span class="params">(Long orderId)</span>&#123;</span><br><span class="line">        orderService.markOrderPaySuccess(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="16-10-5-发送消息"><a href="#16-10-5-发送消息" class="headerlink" title="16.10.5 发送消息"></a>16.10.5 发送消息</h3><ul>
<li>修改 pay-service 服务下的 com.hmall.pay &#x2F; service.impl &#x2F; PayOrderServiceImpl 类中的 tryPayOrderByBalance 方法。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tryPayOrderByBalance</span><span class="params">(PayOrderDTO payOrderDTO)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.查询支付单</span></span><br><span class="line">    <span class="type">PayOrder</span> <span class="variable">po</span> <span class="operator">=</span> getById(payOrderDTO.getId());</span><br><span class="line">    <span class="comment">// 2.判断状态</span></span><br><span class="line">    <span class="keyword">if</span>(!PayStatus.WAIT_BUYER_PAY.equalsValue(po.getStatus()))&#123;</span><br><span class="line">        <span class="comment">// 订单不是未支付，状态异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BizIllegalException</span>(<span class="string">&quot;交易已支付或关闭！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.尝试扣减余额</span></span><br><span class="line">    userClient.deductMoney(payOrderDTO.getPw(), po.getAmount());</span><br><span class="line">    <span class="comment">// 4.修改支付单状态</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> markPayOrderSuccess(payOrderDTO.getId(), LocalDateTime.now());</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BizIllegalException</span>(<span class="string">&quot;交易已支付或关闭！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.修改订单状态</span></span><br><span class="line">    <span class="comment">// tradeClient.markOrderPaySuccess(po.getBizOrderNo());</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;pay.direct&quot;</span>, <span class="string">&quot;pay.success&quot;</span>, po.getBizOrderNo());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;支付成功的消息发送失败，支付单id：&#123;&#125;， 交易单id：&#123;&#125;&quot;</span>, po.getId(), po.getBizOrderNo(), e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="17-发送者的可靠性"><a href="#17-发送者的可靠性" class="headerlink" title="17.发送者的可靠性"></a>17.发送者的可靠性</h1><h2 id="17-1-发送者重连"><a href="#17-1-发送者重连" class="headerlink" title="17.1 发送者重连"></a>17.1 发送者重连</h2><ul>
<li>修改 publisher 模块的 application.yaml 文件，添加下面的内容：</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">connection-timeout:</span> <span class="string">1s</span> <span class="comment"># 设置MQ的连接超时时间</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="attr">retry:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启超时重试机制</span></span><br><span class="line">        <span class="attr">initial-interval:</span> <span class="string">1000ms</span> <span class="comment"># 失败后的初始等待时间</span></span><br><span class="line">        <span class="attr">multiplier:</span> <span class="number">1</span> <span class="comment"># 失败后下次的等待时长倍数，下次等待时长 = initial-interval * multiplier</span></span><br><span class="line">        <span class="attr">max-attempts:</span> <span class="number">3</span> <span class="comment"># 最大重试次数</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>注意：</li>
<li>当网络不稳定的时候，利用重试机制可以有效提高消息发送的成功率。不过 SpringAMQP 提供的重试机制是阻塞式的重试，也就是说多次重试等待的过程中，当前线程是被阻塞的。</li>
<li>如果对于业务性能有要求，建议禁用重试机制。如果一定要使用，请合理配置等待时长和重试次数，当然也可以考虑使用异步线程来执行发送消息的代码。</li>
</ul>
<h2 id="17-2-发送者确认机制"><a href="#17-2-发送者确认机制" class="headerlink" title="17.2 发送者确认机制"></a>17.2 发送者确认机制</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-09%20160718.png"
                      alt="屏幕截图 2024-10-09 160718"
                ></li>
</ul>
<h2 id="17-3-发送者确认实现"><a href="#17-3-发送者确认实现" class="headerlink" title="17.3 发送者确认实现"></a>17.3 发送者确认实现</h2><h3 id="17-3-1-概念"><a href="#17-3-1-概念" class="headerlink" title="17.3.1 概念"></a>17.3.1 概念</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009190051862.png"
                      alt="image-20241009190051862"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009190616864.png"
                      alt="image-20241009190616864"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009190643499.png"
                      alt="image-20241009190643499"
                ></p>
</li>
</ul>
<h3 id="17-3-2-实现"><a href="#17-3-2-实现" class="headerlink" title="17.3.2 实现"></a>17.3.2 实现</h3><ul>
<li>1.在publisher模块的 application.yaml 中添加配置：</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span> <span class="comment"># 开启publisher confirm机制，并设置confirm类型</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span> <span class="comment"># 开启publisher return机制</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.每个 RabbitTemplate 只能配置一个 ReturnCallback，因此我们可以在配置类中统一设置。我们在 publisher 模块定义一个配置类：config &#x2F; MqConfig。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.publisher.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.ReturnedMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MqConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        rabbitTemplate.setReturnsCallback(<span class="keyword">new</span> <span class="title class_">RabbitTemplate</span>.ReturnsCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(ReturnedMessage returned)</span> &#123;</span><br><span class="line">                log.error(<span class="string">&quot;触发return callback,&quot;</span>);</span><br><span class="line">                log.debug(<span class="string">&quot;exchange: &#123;&#125;&quot;</span>, returned.getExchange());</span><br><span class="line">                log.debug(<span class="string">&quot;routingKey: &#123;&#125;&quot;</span>, returned.getRoutingKey());</span><br><span class="line">                log.debug(<span class="string">&quot;message: &#123;&#125;&quot;</span>, returned.getMessage());</span><br><span class="line">                log.debug(<span class="string">&quot;replyCode: &#123;&#125;&quot;</span>, returned.getReplyCode());</span><br><span class="line">                log.debug(<span class="string">&quot;replyText: &#123;&#125;&quot;</span>, returned.getReplyText());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>3.由于每个消息发送时的处理逻辑不一定相同，因此 ConfirmCallback 需要在每次发消息时定义。cd：代表唯一ID。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPublisherConfirm</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.创建CorrelationData</span></span><br><span class="line">    <span class="type">CorrelationData</span> <span class="variable">cd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(UUID.randomUUID().toString()); <span class="comment">//使用UUID生成id</span></span><br><span class="line">    <span class="comment">// 2.给Future添加ConfirmCallback</span></span><br><span class="line">    cd.getFuture().addCallback(<span class="keyword">new</span> <span class="title class_">ListenableFutureCallback</span>&lt;CorrelationData.Confirm&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Throwable ex)</span> &#123;</span><br><span class="line">            <span class="comment">// 2.1.Future发生异常时的处理逻辑，基本不会触发</span></span><br><span class="line">            log.error(<span class="string">&quot;send message fail&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(CorrelationData.Confirm result)</span> &#123;</span><br><span class="line">            <span class="comment">// 2.2.Future接收到回执的处理逻辑，参数中的result就是回执内容</span></span><br><span class="line">            <span class="keyword">if</span>(result.isAck())&#123; <span class="comment">// result.isAck()，boolean类型，true代表ack回执，false 代表 nack回执</span></span><br><span class="line">                log.debug(<span class="string">&quot;发送消息成功，收到 ack!&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123; <span class="comment">// result.getReason()，String类型，返回nack时的异常描述</span></span><br><span class="line">                log.error(<span class="string">&quot;发送消息失败，收到 nack, reason : &#123;&#125;&quot;</span>, result.getReason());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 3.发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;hmall.direct&quot;</span>, <span class="string">&quot;red1&quot;</span>, <span class="string">&quot;hello&quot;</span>, cd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="18-MQ的可靠性"><a href="#18-MQ的可靠性" class="headerlink" title="18.MQ的可靠性"></a>18.MQ的可靠性</h1><h2 id="18-1-问题产生"><a href="#18-1-问题产生" class="headerlink" title="18.1 问题产生"></a>18.1 问题产生</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009192049742.png"
                      alt="image-20241009192049742"
                ></li>
</ul>
<h2 id="18-2-数据持久化"><a href="#18-2-数据持久化" class="headerlink" title="18.2 数据持久化"></a>18.2 数据持久化</h2><h3 id="18-2-1-交换机持久化"><a href="#18-2-1-交换机持久化" class="headerlink" title="18.2.1 交换机持久化"></a>18.2.1 交换机持久化</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009192435910.png"
                      alt="image-20241009192435910"
                ></li>
</ul>
<h3 id="18-2-2-队列持久化"><a href="#18-2-2-队列持久化" class="headerlink" title="18.2.2 队列持久化"></a>18.2.2 队列持久化</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009192542193.png"
                      alt="image-20241009192542193"
                ></li>
</ul>
<h3 id="18-2-3-消息持久化"><a href="#18-2-3-消息持久化" class="headerlink" title="18.2.3 消息持久化"></a>18.2.3 消息持久化</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009192624501.png"
                      alt="image-20241009192624501"
                ></li>
</ul>
<h2 id="18-3-Lazy-Queue"><a href="#18-3-Lazy-Queue" class="headerlink" title="18.3 Lazy Queue"></a>18.3 Lazy Queue</h2><h3 id="18-3-1-介绍"><a href="#18-3-1-介绍" class="headerlink" title="18.3.1 介绍"></a>18.3.1 介绍</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009193657588.png"
                      alt="image-20241009193657588"
                ></li>
</ul>
<h3 id="18-3-2-控制台配置Lazy模式"><a href="#18-3-2-控制台配置Lazy模式" class="headerlink" title="18.3.2 控制台配置Lazy模式"></a>18.3.2 控制台配置Lazy模式</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009193727913.png"
                      alt="image-20241009193727913"
                ></li>
</ul>
<h3 id="18-3-3-代码配置Lazy模式"><a href="#18-3-3-代码配置Lazy模式" class="headerlink" title="18.3.3 代码配置Lazy模式"></a>18.3.3 代码配置Lazy模式</h3><ul>
<li>有两种方法：</li>
<li>1.在利用 SpringAMQP 声明队列的时候，添加 x-queue-mod&#x3D;lazy 参数也可设置队列为 Lazy 模式。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">lazyQueue</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> QueueBuilder</span><br><span class="line">            .durable(<span class="string">&quot;lazy.queue&quot;</span>)</span><br><span class="line">            .lazy() <span class="comment">// 开启Lazy模式</span></span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>2.基于注解来声明队列并设置为 Lazy 模式。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queuesToDeclare = @Queue(</span></span><br><span class="line"><span class="meta">        name = &quot;lazy.queue&quot;,</span></span><br><span class="line"><span class="meta">        durable = &quot;true&quot;,</span></span><br><span class="line"><span class="meta">        arguments = @Argument(name = &quot;x-queue-mode&quot;, value = &quot;lazy&quot;)</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenLazyQueue</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;接收到 lazy.queue的消息：&#123;&#125;&quot;</span>, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="19-消费者的可靠性"><a href="#19-消费者的可靠性" class="headerlink" title="19.消费者的可靠性"></a>19.消费者的可靠性</h1><h2 id="19-1-消费者确认机制"><a href="#19-1-消费者确认机制" class="headerlink" title="19.1 消费者确认机制"></a>19.1 消费者确认机制</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009195243904.png"
                      alt="image-20241009195243904"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009195300959.png"
                      alt="image-20241009195300959"
                ></p>
</li>
</ul>
<h2 id="19-2-消费者失败重试与处理"><a href="#19-2-消费者失败重试与处理" class="headerlink" title="19.2 消费者失败重试与处理"></a>19.2 消费者失败重试与处理</h2><h3 id="19-2-1-消费者失败重试"><a href="#19-2-1-消费者失败重试" class="headerlink" title="19.2.1 消费者失败重试"></a>19.2.1 消费者失败重试</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009200550784.png"
                      alt="image-20241009200550784"
                ></li>
</ul>
<h3 id="19-2-2-消费者失败处理"><a href="#19-2-2-消费者失败处理" class="headerlink" title="19.2.2 消费者失败处理"></a>19.2.2 消费者失败处理</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009200634459.png"
                      alt="image-20241009200634459"
                ></p>
</li>
<li><p>比较优雅的一种处理方案是 RepublishMessageRecoverer，失败后将消息投递到一个指定的，专门存放异常消息的队列，后续由人工集中处理。</p>
</li>
<li><p>1.在 consumer 服务中定义处理失败消息的交换机和队列。</p>
</li>
<li><p>2.定义一个 RepublishMessageRecoverer，关联队列和交换机。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.DirectExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.retry.MessageRecoverer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.retry.RepublishMessageRecoverer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;spring.rabbitmq.listener.simple.retry.enabled&quot;, havingValue = &quot;true&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ErrorMessageConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">errorMessageExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(<span class="string">&quot;error.direct&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">errorQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;error.queue&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">errorBinding</span><span class="params">(Queue errorQueue, DirectExchange errorMessageExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(errorQueue).to(errorMessageExchange).with(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MessageRecoverer <span class="title function_">republishMessageRecoverer</span><span class="params">(RabbitTemplate rabbitTemplate)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RepublishMessageRecoverer</span>(rabbitTemplate, <span class="string">&quot;error.direct&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="19-3-业务幂等性"><a href="#19-3-业务幂等性" class="headerlink" title="19.3 业务幂等性"></a>19.3 业务幂等性</h2><h3 id="19-3-1-介绍"><a href="#19-3-1-介绍" class="headerlink" title="19.3.1 介绍"></a>19.3.1 介绍</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009203548795.png"
                      alt="image-20241009203548795"
                ></li>
</ul>
<h3 id="19-3-2-唯一消息id"><a href="#19-3-2-唯一消息id" class="headerlink" title="19.3.2 唯一消息id"></a>19.3.2 唯一消息id</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241009203727871.png"
                      alt="image-20241009203727871"
                ></li>
</ul>
<h3 id="19-3-3-业务判断"><a href="#19-3-3-业务判断" class="headerlink" title="19.3.3 业务判断"></a>19.3.3 业务判断</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241010113840769.png"
                      alt="image-20241010113840769"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241010190719818.png"
                      alt="image-20241010190719818"
                ></p>
</li>
</ul>
<h2 id="19-4-可靠性总结"><a href="#19-4-可靠性总结" class="headerlink" title="19.4 可靠性总结"></a>19.4 可靠性总结</h2><p>综上，支付服务与交易服务之间的订单状态一致性是如何保证的？</p>
<ul>
<li>首先，支付服务会正在用户支付成功以后利用MQ消息通知交易服务，完成订单状态同步。</li>
<li>其次，为了保证MQ消息的可靠性，我们采用了生产者确认机制、消费者确认、消费者失败重试等策略，确保消息投递的可靠性</li>
<li>最后，我们还在交易服务设置了定时任务，定期查询订单支付状态。这样即便MQ通知失败，还可以利用定时任务作为兜底方案，确保订单支付状态的最终一致性</li>
</ul>
<h1 id="20-延迟消息"><a href="#20-延迟消息" class="headerlink" title="20.延迟消息"></a>20.延迟消息</h1><h2 id="20-1-介绍"><a href="#20-1-介绍" class="headerlink" title="20.1 介绍"></a>20.1 介绍</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241010192202174.png"
                      alt="image-20241010192202174"
                ></li>
</ul>
<h2 id="20-2-延迟消息插件-DelayExchange"><a href="#20-2-延迟消息插件-DelayExchange" class="headerlink" title="20.2 延迟消息插件 - DelayExchange"></a>20.2 延迟消息插件 - DelayExchange</h2><h3 id="20-2-1-下载"><a href="#20-2-1-下载" class="headerlink" title="20.2.1 下载"></a>20.2.1 下载</h3><ul>
<li><p>官方文档说明：<a class="link"   href="https://blog.rabbitmq.com/posts/2015/04/scheduling-messages-with-rabbitmq" >https://blog.rabbitmq.com/posts/2015/04/scheduling-messages-with-rabbitmq <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p>插件下载地址：<a class="link"   href="https://github.com/rabbitmq/rabbitmq-delayed-message-exchange" >https://github.com/rabbitmq/rabbitmq-delayed-message-exchange <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
</ul>
<h3 id="20-2-2-安装"><a href="#20-2-2-安装" class="headerlink" title="20.2.2 安装"></a>20.2.2 安装</h3><ul>
<li>因为我们是基于Docker安装，所以需要先查看RabbitMQ的插件目录对应的数据卷。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker volume inspect mq-plugins</span><br></pre></td></tr></table></figure></div>

<ul>
<li>结果如下：</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2024-06-19T09:22:59+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/mq-plugins/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;mq-plugins&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

<ul>
<li>插件目录被挂载到了<code>/var/lib/docker/volumes/mq-plugins/_data</code>这个目录，我们上传插件到该目录下。</li>
<li>接下来执行命令，安装插件：</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker exec -it mq rabbitmq-plugins enable rabbitmq_delayed_message_exchange</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>运行结果如下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241010193602564.png"
                      alt="image-20241010193602564"
                ></p>
</li>
</ul>
<h3 id="20-2-3-声明延迟交换机"><a href="#20-2-3-声明延迟交换机" class="headerlink" title="20.2.3 声明延迟交换机"></a>20.2.3 声明延迟交换机</h3><ul>
<li>基于注解方式：</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">        value = @Queue(name = &quot;delay.queue&quot;, durable = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">        exchange = @Exchange(name = &quot;delay.direct&quot;, delayed = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">        key = &quot;delay&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDelayMessage</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;接收到delay.queue的延迟消息：&#123;&#125;&quot;</span>, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>基于 @Bean 的方式：</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayExchangeConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">delayExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder</span><br><span class="line">                .directExchange(<span class="string">&quot;delay.direct&quot;</span>) <span class="comment">// 指定交换机类型和名称</span></span><br><span class="line">                .delayed() <span class="comment">// 设置delay的属性为true</span></span><br><span class="line">                .durable(<span class="literal">true</span>) <span class="comment">// 持久化</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">delayedQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;delay.queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">delayQueueBinding</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(delayedQueue()).to(delayExchange()).with(<span class="string">&quot;delay&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="20-2-4-发送延迟消息"><a href="#20-2-4-发送延迟消息" class="headerlink" title="20.2.4 发送延迟消息"></a>20.2.4 发送延迟消息</h3><ul>
<li>发送消息时，必须通过x-delay属性设定延迟时间。</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPublisherDelayMessage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.创建消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, delayed message&quot;</span>;</span><br><span class="line">    <span class="comment">// 2.发送消息，利用消息后置处理器添加消息头</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;delay.direct&quot;</span>, <span class="string">&quot;delay&quot;</span>, message, <span class="keyword">new</span> <span class="title class_">MessagePostProcessor</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Message <span class="title function_">postProcessMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> AmqpException &#123;</span><br><span class="line">            <span class="comment">// 添加延迟消息属性</span></span><br><span class="line">            message.getMessageProperties().setDelay(<span class="number">5000</span>);</span><br><span class="line">            <span class="keyword">return</span> message;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="20-3-实战-取消超时订单"><a href="#20-3-实战-取消超时订单" class="headerlink" title="20.3 实战 - 取消超时订单"></a>20.3 实战 - 取消超时订单</h2><h3 id="20-3-1-需求"><a href="#20-3-1-需求" class="headerlink" title="20.3.1 需求"></a>20.3.1 需求</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241010195407551.png"
                      alt="image-20241010195407551"
                ></li>
</ul>
<h3 id="20-3-2-定义常量"><a href="#20-3-2-定义常量" class="headerlink" title="20.3.2 定义常量"></a>20.3.2 定义常量</h3><ul>
<li><p>无论是消息发送还是接收都是在交易服务完成，因此我们在<code>trade-service</code>中定义一个常量类，用于记录交换机、队列、RoutingKey等常量：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241010204551270.png"
                      alt="image-20241010204551270"
                ></p>
</li>
<li><p>内容如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.trade.constants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MQConstants</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">DELAY_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;trade.delay.direct&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">DELAY_ORDER_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;trade.delay.order.queue&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">DELAY_ORDER_KEY</span> <span class="operator">=</span> <span class="string">&quot;delay.order.query&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="20-3-3-配置MQ"><a href="#20-3-3-配置MQ" class="headerlink" title="20.3.3 配置MQ"></a>20.3.3 配置MQ</h3><ul>
<li>在<code>trade-service</code>模块的<code>pom.xml</code>中引入amqp的依赖：</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--amqp--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>在<code>trade-service</code>的<code>application.yaml</code>中添加MQ的配置：</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/hmall</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span></span><br></pre></td></tr></table></figure></div>

<h3 id="20-3-4-改造下单业务，发送延迟消息"><a href="#20-3-4-改造下单业务，发送延迟消息" class="headerlink" title="20.3.4 改造下单业务，发送延迟消息"></a>20.3.4 改造下单业务，发送延迟消息</h3><ul>
<li><p>接下来，我们改造下单业务，在下单完成后，发送延迟消息，查询支付状态。</p>
</li>
<li><p>修改<code>trade-service</code>模块的<code>com.hmall.trade.service.impl.OrderServiceImpl</code>类的<code>createOrder</code>方法，添加消息发送的代码：</p>
</li>
<li><p>这里延迟消息的时间应该是15分钟，不过我们为了测试方便，改成10秒。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//5.发送延迟消息，检测订单支付状态</span></span><br><span class="line">rabbitTemplate.convertAndSend(</span><br><span class="line">    MQConstants.DELAY_EXCHANGE_NAME,</span><br><span class="line">    MQConstants.DELAY_ORDER_KEY,</span><br><span class="line">    order.getId(),</span><br><span class="line">    message -&gt; &#123;</span><br><span class="line">        message.getMessageProperties().setDelay(<span class="number">10000</span>);</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure></div>

<h3 id="20-3-5-编写查询支付状态接口"><a href="#20-3-5-编写查询支付状态接口" class="headerlink" title="20.3.5 编写查询支付状态接口"></a>20.3.5 编写查询支付状态接口</h3><ul>
<li><p>由于MQ消息处理时需要查询支付状态，因此我们要在<code>pay-service</code>模块定义一个这样的接口，并提供对应的<code>FeignClient</code>.</p>
</li>
<li><p>首先，在<code>hm-api</code>模块定义三个类：</p>
</li>
<li><p>说明：</p>
<ul>
<li>PayOrderDTO：支付单的数据传输实体</li>
<li>PayClient：支付系统的Feign客户端</li>
<li>PayClientFallback：支付系统的fallback逻辑</li>
</ul>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241010210650753.png"
                      alt="image-20241010210650753"
                ></p>
</li>
<li><p><code>PayOrderDTO</code>代码如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.api.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 支付订单</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;支付单数据传输实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayOrderDTO</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;业务订单号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long bizOrderNo;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;支付单号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long payOrderNo;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;支付用户id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long bizUserId;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;支付渠道编码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String payChannelCode;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;支付金额，单位分&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer amount;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;付类型，1：h5,2:小程序，3：公众号，4：扫码，5：余额支付&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer payType;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;付状态，0：待提交，1:待支付，2：支付超时或取消，3：支付成功&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;拓展字段，用于传递不同渠道单独处理的字段&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String expandJson;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;第三方返回业务码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String resultCode;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;第三方返回提示信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String resultMsg;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;支付成功时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime paySuccessTime;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;支付超时时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime payOverTime;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;支付二维码链接&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qrCodeUrl;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;创建时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;更新时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>PayClient</code>代码如下：</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.api.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmall.api.client.fallback.PayClientFallback;</span><br><span class="line"><span class="keyword">import</span> com.hmall.api.dto.PayOrderDTO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;pay-service&quot;, fallbackFactory = PayClientFallback.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PayClient</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据交易订单id查询支付单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 业务订单id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 支付单信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/pay-orders/biz/&#123;id&#125;&quot;)</span></span><br><span class="line">    PayOrderDTO <span class="title function_">queryPayOrderByBizOrderNo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>PayClientFallback</code>代码如下：</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.api.client.fallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmall.api.client.PayClient;</span><br><span class="line"><span class="keyword">import</span> com.hmall.api.dto.PayOrderDTO;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FallbackFactory;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayClientFallback</span> <span class="keyword">implements</span> <span class="title class_">FallbackFactory</span>&lt;PayClient&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PayClient <span class="title function_">create</span><span class="params">(Throwable cause)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PayClient</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> PayOrderDTO <span class="title function_">queryPayOrderByBizOrderNo</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>最后，在<code>pay-service</code>模块的<code>PayController</code>中实现该接口：</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据id查询支付单&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/biz/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> PayOrderDTO <span class="title function_">queryPayOrderByBizOrderNo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">    <span class="type">PayOrder</span> <span class="variable">payOrder</span> <span class="operator">=</span> payOrderService.lambdaQuery().eq(PayOrder::getBizOrderNo, id).one();</span><br><span class="line">    <span class="keyword">return</span> BeanUtils.copyBean(payOrder, PayOrderDTO.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="20-3-6-监听消息，查询支付状态"><a href="#20-3-6-监听消息，查询支付状态" class="headerlink" title="20.3.6 监听消息，查询支付状态"></a>20.3.6 监听消息，查询支付状态</h3><ul>
<li><p>接下来，我们在<code>trader-service</code>编写一个监听器，监听延迟消息，查询订单支付状态：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-10%20210909.png"
                      alt="屏幕截图 2024-10-10 210909"
                ></p>
</li>
<li><p>代码如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.trade.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmall.api.client.PayClient;</span><br><span class="line"><span class="keyword">import</span> com.hmall.api.dto.PayOrderDTO;</span><br><span class="line"><span class="keyword">import</span> com.hmall.trade.constants.MQConstants;</span><br><span class="line"><span class="keyword">import</span> com.hmall.trade.domain.po.Order;</span><br><span class="line"><span class="keyword">import</span> com.hmall.trade.service.IOrderService;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Exchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.QueueBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDelayMessageListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IOrderService orderService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PayClient payClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(name = MQConstants.DELAY_ORDER_QUEUE_NAME),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = MQConstants.DELAY_EXCHANGE_NAME, delayed = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">            key = MQConstants.DELAY_ORDER_KEY</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenOrderDelayMessage</span><span class="params">(Long orderId)</span>&#123;</span><br><span class="line">        <span class="comment">// 1.查询订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.getById(orderId);</span><br><span class="line">        <span class="comment">// 2.检测订单状态，判断是否已支付</span></span><br><span class="line">        <span class="keyword">if</span>(order == <span class="literal">null</span> || order.getStatus() != <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">// 订单不存在或者已经支付</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.未支付，需要查询支付流水状态</span></span><br><span class="line">        <span class="type">PayOrderDTO</span> <span class="variable">payOrder</span> <span class="operator">=</span> payClient.queryPayOrderByBizOrderNo(orderId);</span><br><span class="line">        <span class="comment">// 4.判断是否支付</span></span><br><span class="line">        <span class="keyword">if</span>(payOrder != <span class="literal">null</span> &amp;&amp; payOrder.getStatus() == <span class="number">3</span>)&#123;</span><br><span class="line">            <span class="comment">// 4.1.已支付，标记订单状态为已支付</span></span><br><span class="line">            orderService.markOrderPaySuccess(orderId);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// TODO 4.2.未支付，取消订单，回复库存</span></span><br><span class="line">            orderService.cancelOrder(orderId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="21-初识elasticsearch"><a href="#21-初识elasticsearch" class="headerlink" title="21.初识elasticsearch"></a>21.初识elasticsearch</h1><h2 id="21-1-介绍"><a href="#21-1-介绍" class="headerlink" title="21.1 介绍"></a>21.1 介绍</h2><ul>
<li>高性能分布式搜索引擎</li>
</ul>
<h2 id="21-2-认识"><a href="#21-2-认识" class="headerlink" title="21.2 认识"></a>21.2 认识</h2><ul>
<li><p>2004年Shay Banon基于Lucene开发了Compass。</p>
</li>
<li><p>2010年Shay Banon重写了Compass，取名为Elasticsearch。</p>
</li>
<li><p>官网地址: <a class="link"   href="https://www.elastic.co/cn/%E3%80%82" >https://www.elastic.co/cn/。 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p>elasticsearch具备下列优势：</p>
<ul>
<li>支持分布式，可水平扩展。</li>
<li>提供Restful接口，可被任何语言调用。</li>
</ul>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241012183226496.png"
                      alt="image-20241012183226496"
                ></p>
</li>
</ul>
<h2 id="21-3-下载"><a href="#21-3-下载" class="headerlink" title="21.3 下载"></a>21.3 下载</h2><h3 id="21-3-1-安装elasticsearch"><a href="#21-3-1-安装elasticsearch" class="headerlink" title="21.3.1 安装elasticsearch"></a>21.3.1 安装elasticsearch</h3><ul>
<li>通过下面的 Docker 命令即可安装单机版本的 elasticsearch：</li>
<li>由于 8 以上版本的 JavaAPI 变化很大，在企业中应用并不广泛，企业中应用较多的还是 8 以下的版本。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name es \   #名字</span><br><span class="line">  -e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; \   #配置内存，默认1个G，最低为512</span><br><span class="line">  -e &quot;discovery.type=single-node&quot; \   #运行模式</span><br><span class="line">  -v es-data:/usr/share/elasticsearch/data \   #数据挂载</span><br><span class="line">  -v es-plugins:/usr/share/elasticsearch/plugins \   #数据挂载</span><br><span class="line">  --privileged \</span><br><span class="line">  --network hm-net \   #网络</span><br><span class="line">  -p 9200:9200 \   #端口  </span><br><span class="line">  -p 9300:9300 \</span><br><span class="line">  elasticsearch:7.12.1</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>安装完成后，访问 9200 端口，即可看到响应的 Elasticsearch 服务的基本信息：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241012210900243.png"
                      alt="image-20241012210900243"
                ></p>
</li>
</ul>
<h3 id="21-3-2-安装Kibana"><a href="#21-3-2-安装Kibana" class="headerlink" title="21.3.2 安装Kibana"></a>21.3.2 安装Kibana</h3><ul>
<li>通过下面的 Docker 命令，即可部署 Kibana：</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name kibana \   #名字</span><br><span class="line">-e ELASTICSEARCH_HOSTS=http://es:9200 \   #链接elasticsearch</span><br><span class="line">--network=hm-net \   #网络</span><br><span class="line">-p 5601:5601  \   #端口</span><br><span class="line">kibana:7.12.1</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>安装完成后，直接访问5601端口，即可看到控制台页面：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241012211734712.png"
                      alt="image-20241012211734712"
                ></p>
</li>
<li><p>选择<code>Explore on my own</code>之后，进入主页面：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-12%20211756.png"
                      alt="屏幕截图 2024-10-12 211756"
                ></p>
</li>
<li><p>然后选中<code>Dev tools</code>，进入开发工具页面：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241012211839215.png"
                      alt="image-20241012211839215"
                ></p>
</li>
</ul>
<h2 id="21-4-倒排索引"><a href="#21-4-倒排索引" class="headerlink" title="21.4 倒排索引"></a>21.4 倒排索引</h2><h3 id="21-4-1-正向索引"><a href="#21-4-1-正向索引" class="headerlink" title="21.4.1 正向索引"></a>21.4.1 正向索引</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241012213304727.png"
                      alt="image-20241012213304727"
                ></li>
</ul>
<h3 id="21-4-2-倒排索引"><a href="#21-4-2-倒排索引" class="headerlink" title="21.4.2 倒排索引"></a>21.4.2 倒排索引</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241012213541322.png"
                      alt="image-20241012213541322"
                ></li>
</ul>
<h3 id="21-4-3-正向和倒排"><a href="#21-4-3-正向和倒排" class="headerlink" title="21.4.3 正向和倒排"></a>21.4.3 正向和倒排</h3><p><strong>正向索引</strong>：</p>
<ul>
<li>优点： <ul>
<li>可以给多个字段创建索引</li>
<li>根据索引字段搜索、排序速度非常快</li>
</ul>
</li>
<li>缺点： <ul>
<li>根据非索引字段，或者索引字段中的部分词条查找时，只能全表扫描</li>
</ul>
</li>
</ul>
<p><strong>倒排索引</strong>：</p>
<ul>
<li>优点： <ul>
<li>根据词条搜索、模糊搜索时，速度非常快</li>
</ul>
</li>
<li>缺点： <ul>
<li>只能给词条创建索引，而不是字段</li>
<li>无法根据字段做排序</li>
</ul>
</li>
</ul>
<h2 id="21-5-IK分词器"><a href="#21-5-IK分词器" class="headerlink" title="21.5 IK分词器"></a>21.5 IK分词器</h2><h3 id="21-5-1-介绍"><a href="#21-5-1-介绍" class="headerlink" title="21.5.1 介绍"></a>21.5.1 介绍</h3><ul>
<li>Elasticsearch的关键就是倒排索引，而倒排索引依赖于对文档内容的分词，而分词则需要高效、精准的分词算法，IK分词器就是这样一个中文分词算法。</li>
</ul>
<h3 id="21-5-2-安装IK分词器"><a href="#21-5-2-安装IK分词器" class="headerlink" title="21.5.2 安装IK分词器"></a>21.5.2 安装IK分词器</h3><p><strong>方案一</strong>：在线安装</p>
<ul>
<li>运行一个命令即可：</li>
</ul>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it es ./bin/elasticsearch-plugin  install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip</span><br></pre></td></tr></table></figure></div>

<ul>
<li>然后重启es容器：</li>
</ul>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">docker restart es</span><br></pre></td></tr></table></figure></div>

<p><strong>方案二</strong>：离线安装</p>
<ul>
<li>首先，查看之前安装的Elasticsearch容器的plugins数据卷目录：</li>
</ul>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume inspect es-plugins</span><br></pre></td></tr></table></figure></div>

<ul>
<li>结果如下：</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;CreatedAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-11-06T10:06:34+08:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Driver&quot;</span><span class="punctuation">:</span> <span class="string">&quot;local&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Labels&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Mountpoint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/docker/volumes/es-plugins/_data&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;es-plugins&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Options&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Scope&quot;</span><span class="punctuation">:</span> <span class="string">&quot;local&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>可以看到elasticsearch的插件挂载到了<code>/var/lib/docker/volumes/es-plugins/_data</code>这个目录。我们需要把IK分词器上传至这个目录。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241012215212817.png"
                      alt="image-20241012215212817"
                ></p>
</li>
<li><p>最后，重启es容器：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">docker restart es</span><br></pre></td></tr></table></figure></div>

<h3 id="21-5-3-使用IK分词器"><a href="#21-5-3-使用IK分词器" class="headerlink" title="21.5.3 使用IK分词器"></a>21.5.3 使用IK分词器</h3><ul>
<li><p>使用语法：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241012220000585.png"
                      alt="image-20241012220000585"
                ></p>
</li>
<li><p>IK分词器包含两种模式：</p>
<ul>
<li><code>ik_smart</code>：智能语义切分 </li>
<li><code>ik_max_word</code>：最细粒度切分</li>
</ul>
</li>
</ul>
<h3 id="21-5-4-拓展词典"><a href="#21-5-4-拓展词典" class="headerlink" title="21.5.4 拓展词典"></a>21.5.4 拓展词典</h3><ul>
<li><p>所以要想正确分词，IK分词器的词库也需要不断的更新，IK分词器提供了扩展词汇的功能。</p>
</li>
<li><p>1）打开IK分词器config目录：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241012220906296.png"
                      alt="image-20241012220906296"
                ></p>
</li>
<li><p>2）在IKAnalyzer.cfg.xml配置文件内容添加：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">properties</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">comment</span>&gt;</span>IK Analyzer 扩展配置<span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--用户可以在这里配置自己的扩展字典 *** 添加扩展词典--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_dict&quot;</span>&gt;</span>ext.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_stopwords&quot;</span>&gt;</span>stopword.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!--用户可以在这里配置远程扩展字典--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;remote_ext_dict&quot;</span>&gt;</span>words_location<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;remote_ext_stopwords&quot;</span>&gt;</span>words_location<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>3）在IK分词器的config目录新建一个 <code>ext.dic</code>，可以参考config目录下复制一个配置文件进行修改。</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">传智播客</span><br><span class="line">泰裤辣</span><br></pre></td></tr></table></figure></div>

<ul>
<li>4）重启elasticsearch。</li>
</ul>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">docker restart es</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看 日志</span></span><br><span class="line">docker logs -f elasticsearch</span><br></pre></td></tr></table></figure></div>

<ul>
<li>再次测试，可以发现<code>传智播客</code>和<code>泰裤辣</code>都正确分词了。</li>
</ul>
<h3 id="21-5-5-总结"><a href="#21-5-5-总结" class="headerlink" title="21.5.5 总结"></a>21.5.5 总结</h3><p>分词器的作用是什么？</p>
<ul>
<li>创建倒排索引时，对文档分词</li>
<li>用户搜索时，对输入的内容分词</li>
</ul>
<p>IK分词器有几种模式？</p>
<ul>
<li><code>ik_smart</code>：智能切分，粗粒度</li>
<li><code>ik_max_word</code>：最细切分，细粒度</li>
</ul>
<p>IK分词器如何拓展词条？如何停用词条？</p>
<ul>
<li>利用config目录的<code>IkAnalyzer.cfg.xml</code>文件添加拓展词典和停用词典</li>
<li>在词典中添加拓展词条或者停用词条</li>
</ul>
<h2 id="21-6-基础概念"><a href="#21-6-基础概念" class="headerlink" title="21.6 基础概念"></a>21.6 基础概念</h2><ul>
<li><p>索引 (index)：相同类型的文档的集合。</p>
</li>
<li><p>映射 (mapping)：索引中文档的字段约束信息，类似表的结构约束。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241013201555831.png"
                      alt="image-20241013201555831"
                ></p>
</li>
</ul>
<h1 id="22-索引库操作"><a href="#22-索引库操作" class="headerlink" title="22.索引库操作"></a>22.索引库操作</h1><h2 id="22-1-Mapping映射属性"><a href="#22-1-Mapping映射属性" class="headerlink" title="22.1 Mapping映射属性"></a>22.1 Mapping映射属性</h2><h3 id="22-1-1-Mapping属性"><a href="#22-1-1-Mapping属性" class="headerlink" title="22.1.1 Mapping属性"></a>22.1.1 Mapping属性</h3><p>Mapping 是对索引库中文档的约束，常见的 Mapping 属性包括：</p>
<ul>
<li><code>type</code>：字段数据类型，常见的简单类型有： <ul>
<li>字符串：<code>text</code>（可分词的文本）、<code>keyword</code>（精确值，例如：品牌、国家、ip地址）</li>
<li>数值：<code>long</code>、<code>integer</code>、<code>short</code>、<code>byte</code>、<code>double</code>、<code>float</code>、</li>
<li>布尔：<code>boolean</code></li>
<li>日期：<code>date</code></li>
<li>对象：<code>object</code></li>
</ul>
</li>
<li><code>index</code>：是否创建索引，默认为<code>true</code></li>
<li><code>analyzer</code>：使用哪种分词器</li>
<li><code>properties</code>：该字段的子字段</li>
</ul>
<h3 id="22-1-2-实例"><a href="#22-1-2-实例" class="headerlink" title="22.1.2 实例"></a>22.1.2 实例</h3><ul>
<li>例如下面的 json 文档：</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">21</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span> <span class="number">52.1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isMarried&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span> <span class="string">&quot;黑马程序员Java讲师&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zy@itcast.cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">99.1</span><span class="punctuation">,</span> <span class="number">99.5</span><span class="punctuation">,</span> <span class="number">98.9</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;firstName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;云&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lastName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;赵&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>对应的每个字段映射（Mapping）：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241014103037428.png"
                      alt="image-20241014103037428"
                ></p>
</li>
</ul>
<h2 id="22-2-索引库的CRUD"><a href="#22-2-索引库的CRUD" class="headerlink" title="22.2 索引库的CRUD"></a>22.2 索引库的CRUD</h2><h3 id="22-2-1-Restful基本规范"><a href="#22-2-1-Restful基本规范" class="headerlink" title="22.2.1 Restful基本规范"></a>22.2.1 Restful基本规范</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241014104122623.png"
                      alt="image-20241014104122623"
                ></li>
</ul>
<h3 id="22-2-2-创建索引库和映射"><a href="#22-2-2-创建索引库和映射" class="headerlink" title="22.2.2 创建索引库和映射"></a>22.2.2 创建索引库和映射</h3><p><strong>基本语法</strong>：</p>
<ul>
<li>请求方式：<code>PUT</code></li>
<li>请求路径：<code>/索引库名</code>，可以自定义</li>
<li>请求参数：<code>mapping</code>映射</li>
</ul>
<p><strong>格式</strong>：</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">PUT /索引库名称</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;字段名&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;字段名2&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;字段名3&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;子字段&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// ...略</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p><strong>示例</strong>：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"># PUT /heima</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;info&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;email&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">        &quot;index&quot;: &quot;false&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;name&quot;:&#123;</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">          &quot;firstName&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="22-2-3-查询索引库"><a href="#22-2-3-查询索引库" class="headerlink" title="22.2.3 查询索引库"></a>22.2.3 查询索引库</h3><p><strong>基本语法</strong>：</p>
<ul>
<li>请求方式：GET </li>
<li>请求路径：&#x2F;索引库名 </li>
<li>请求参数：无</li>
</ul>
<p><strong>格式</strong>：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /索引库名</span><br></pre></td></tr></table></figure></div>

<p><strong>示例</strong>：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /heima</span><br></pre></td></tr></table></figure></div>

<h3 id="22-2-4-修改索引库"><a href="#22-2-4-修改索引库" class="headerlink" title="22.2.4 修改索引库"></a>22.2.4 修改索引库</h3><ul>
<li><p>倒排索引结构虽然不复杂，但是一旦数据结构改变（比如改变了分词器），就需要重新创建倒排索引，这简直是灾难。因此索引库<strong>一旦创建，无法修改mapping</strong>。</p>
</li>
<li><p>虽然无法修改 mapping 中已有的字段，但是却允许添加新的字段到 mapping 中，因为不会对倒排索引产生影响。因此修改索引库能做的就是向索引库中添加新字段，或者更新索引库的基础属性。</p>
</li>
</ul>
<p><strong>语法说明</strong>：</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">PUT /索引库名/_mapping</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;新字段名&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p><strong>示例</strong>：</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">PUT /heima/_mapping</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<h3 id="22-2-5-删除索引库"><a href="#22-2-5-删除索引库" class="headerlink" title="22.2.5 删除索引库"></a>22.2.5 删除索引库</h3><p><strong>语法：</strong></p>
<ul>
<li>请求方式：DELETE </li>
<li>请求路径：&#x2F;索引库名 </li>
<li>请求参数：无</li>
</ul>
<p><strong>格式：</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">DELETE /索引库名</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">DELETE /heima</span><br></pre></td></tr></table></figure></div>

<h3 id="22-2-6-总结"><a href="#22-2-6-总结" class="headerlink" title="22.2.6 总结"></a>22.2.6 总结</h3><p>索引库操作有哪些？</p>
<ul>
<li>创建索引库：PUT &#x2F;索引库名</li>
<li>查询索引库：GET &#x2F;索引库名</li>
<li>删除索引库：DELETE &#x2F;索引库名</li>
<li>修改索引库，添加字段：PUT &#x2F;索引库名&#x2F;_mapping</li>
</ul>
<h1 id="23-文档操作"><a href="#23-文档操作" class="headerlink" title="23.文档操作"></a>23.文档操作</h1><h2 id="23-1-新增文档"><a href="#23-1-新增文档" class="headerlink" title="23.1 新增文档"></a>23.1 新增文档</h2><p><strong>语法：</strong></p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">POST /索引库名/_doc/文档id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;字段1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;值1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;字段2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;值2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;字段3&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;子属性1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;值3&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;子属性2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;值4&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p><strong>示例：</strong></p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">POST /heima/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span> <span class="string">&quot;黑马程序员Java讲师&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zy@itcast.cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;firstName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;云&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lastName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;赵&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p><strong>响应：</strong></p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241014111601335.png"
                      alt="image-20241014111601335"
                ></li>
</ul>
<h2 id="23-2-查询文档"><a href="#23-2-查询文档" class="headerlink" title="23.2 查询文档"></a>23.2 查询文档</h2><ul>
<li>根据 rest 风格，新增是 post，查询应该是 get，不过查询一般都需要条件，这里我们把文档 id 带上。</li>
</ul>
<p><strong>语法：</strong></p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /<span class="punctuation">&#123;</span>索引库名称<span class="punctuation">&#125;</span>/_doc/<span class="punctuation">&#123;</span>id<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p><strong>示例：</strong></p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> /heima/_doc/<span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<p><strong>查看结果：</strong></p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-14%20112031.png"
                      alt="屏幕截图 2024-10-14 112031"
                ></li>
</ul>
<h2 id="23-3-删除文档"><a href="#23-3-删除文档" class="headerlink" title="23.3 删除文档"></a>23.3 删除文档</h2><ul>
<li>删除使用 DELETE 请求，同样，需要根据 id 进行删除：</li>
</ul>
<p><strong>语法：</strong></p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">DELETE</span> /&#123;索引库名&#125;/_doc/id值</span><br></pre></td></tr></table></figure></div>

<p><strong>示例：</strong></p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">DELETE /heima/_doc/<span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<p><strong>结果：</strong></p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241014112219270.png"
                      alt="image-20241014112219270"
                ></li>
</ul>
<h2 id="23-4-修改文档"><a href="#23-4-修改文档" class="headerlink" title="23.4 修改文档"></a>23.4 修改文档</h2><h3 id="23-4-1-全量修改"><a href="#23-4-1-全量修改" class="headerlink" title="23.4.1.全量修改"></a>23.4.1.全量修改</h3><p>全量修改是覆盖原来的文档，其本质是两步操作：</p>
<ul>
<li>根据指定的 id 删除文档</li>
<li>新增一个相同 id 的文档</li>
</ul>
<p><strong>注意</strong>：</p>
<ul>
<li>如果根据 id 删除时，id 不存在，第二步的新增也会执行，也就从修改变成了新增操作了。</li>
</ul>
<p><strong>语法：</strong></p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">PUT /<span class="punctuation">&#123;</span>索引库名<span class="punctuation">&#125;</span>/_doc/文档id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;字段1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;值1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;字段2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;值2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// ... 略</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p><strong>示例：</strong></p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">PUT /heima/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span> <span class="string">&quot;黑马程序员高级Java讲师&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zy@itcast.cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;firstName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;云&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lastName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;赵&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>由于<code>id</code>为<code>1</code>的文档已经被删除，所以第一次执行时，得到的反馈是<code>created</code>：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241014115217915.png"
                      alt="image-20241014115217915"
                ></p>
</li>
<li><p>所以如果执行第2次时，得到的反馈则是<code>updated</code>：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241014115308583.png"
                      alt="image-20241014115308583"
                ></p>
</li>
</ul>
<h3 id="23-4-2-局部修改"><a href="#23-4-2-局部修改" class="headerlink" title="23.4.2 局部修改"></a>23.4.2 局部修改</h3><ul>
<li>局部修改是只修改指定 id 匹配的文档中的部分字段。</li>
</ul>
<p><strong>语法：</strong></p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">POST /<span class="punctuation">&#123;</span>索引库名<span class="punctuation">&#125;</span>/_update/文档id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;字段名&quot;</span><span class="punctuation">:</span> <span class="string">&quot;新的值&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p><strong>示例：</strong></p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">POST /heima/_update/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ZhaoYun@itcast.cn&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="23-5-总结"><a href="#23-5-总结" class="headerlink" title="23.5 总结"></a>23.5 总结</h2><p>文档操作有哪些？</p>
<ul>
<li>创建文档：<code>POST /&#123;索引库名&#125;/_doc/文档id   &#123; json文档 &#125;</code></li>
<li>查询文档：<code>GET /&#123;索引库名&#125;/_doc/文档id</code></li>
<li>删除文档：<code>DELETE /&#123;索引库名&#125;/_doc/文档id</code></li>
<li>修改文档： <ul>
<li>全量修改：<code>PUT /&#123;索引库名&#125;/_doc/文档id &#123; json文档 &#125;</code></li>
<li>局部修改：<code>POST /&#123;索引库名&#125;/_update/文档id &#123; &quot;doc&quot;: &#123;字段&#125;&#125;</code></li>
</ul>
</li>
</ul>
<h2 id="23-6-批处理"><a href="#23-6-批处理" class="headerlink" title="23.6 批处理"></a>23.6 批处理</h2><ul>
<li>批处理采用POST请求，基本语法如下：</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line">&#123; <span class="string">&quot;index&quot;</span> : &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span> &#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;field1&quot;</span> : <span class="string">&quot;value1&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;create&quot;</span> : &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span> &#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;field1&quot;</span> : <span class="string">&quot;value2&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;delete&quot;</span> : &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;3&quot;</span> &#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;update&quot;</span> : &#123;<span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>, <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>&#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;doc&quot;</span> : &#123;<span class="string">&quot;field1&quot;</span> : <span class="string">&quot;value3&quot;</span>&#125; &#125;</span><br></pre></td></tr></table></figure></div>

<p>其中：</p>
<ul>
<li><code>index</code>代表新增操作<ul>
<li><code>_index</code>：指定索引库名</li>
<li><code>_id</code>指定要操作的文档id</li>
<li><code>&#123; &quot;field1&quot; : &quot;value1&quot; &#125;</code>：则是要新增的文档内容</li>
</ul>
</li>
<li><code>delete</code>代表删除操作<ul>
<li><code>_index</code>：指定索引库名</li>
<li><code>_id</code>指定要操作的文档id</li>
</ul>
</li>
<li><code>update</code>代表更新操作<ul>
<li><code>_index</code>：指定索引库名</li>
<li><code>_id</code>指定要操作的文档id</li>
<li><code>&#123; &quot;doc&quot; : &#123;&quot;field2&quot; : &quot;value2&quot;&#125; &#125;</code>：要更新的文档字段</li>
</ul>
</li>
<li>index如果已存在修改，不存在创建；create已存在报异常，不存在创建。</li>
</ul>
<p>批量新增：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">POST /_bulk</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>:<span class="string">&quot;heima&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;3&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;info&quot;</span>: <span class="string">&quot;黑马程序员C++讲师&quot;</span>, <span class="string">&quot;email&quot;</span>: <span class="string">&quot;ww@itcast.cn&quot;</span>, <span class="string">&quot;name&quot;</span>:&#123;<span class="string">&quot;firstName&quot;</span>: <span class="string">&quot;五&quot;</span>, <span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;王&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>:<span class="string">&quot;heima&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;4&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;info&quot;</span>: <span class="string">&quot;黑马程序员前端讲师&quot;</span>, <span class="string">&quot;email&quot;</span>: <span class="string">&quot;zhangsan@itcast.cn&quot;</span>, <span class="string">&quot;name&quot;</span>:&#123;<span class="string">&quot;firstName&quot;</span>: <span class="string">&quot;三&quot;</span>, <span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;张&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>批量删除：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">POST /_bulk</span><br><span class="line">&#123;<span class="string">&quot;delete&quot;</span>:&#123;<span class="string">&quot;_index&quot;</span>:<span class="string">&quot;heima&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;3&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;delete&quot;</span>:&#123;<span class="string">&quot;_index&quot;</span>:<span class="string">&quot;heima&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;4&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="24-JavaRestClient"><a href="#24-JavaRestClient" class="headerlink" title="24.JavaRestClient"></a>24.JavaRestClient</h1><h2 id="24-1-客户端初始化"><a href="#24-1-客户端初始化" class="headerlink" title="24.1 客户端初始化"></a>24.1 客户端初始化</h2><ul>
<li><p>在 elasticsearch 提供的 API 中，与 elasticsearch 一切交互都封装在一个名为<code>RestHighLevelClient</code>的类中，必须先完成这个对象的初始化，建立与 elasticsearch 的连接。</p>
</li>
<li><p>分为三步：</p>
</li>
<li><p>1）在<code>item-service</code>模块中引入<code>es</code>的<code>RestHighLevelClient</code>依赖：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>2）因为SpringBoot默认的ES版本是<code>7.17.10</code>，所以我们需要覆盖默认的ES版本：</li>
</ul>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.12.1<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>3）初始化RestHighLevelClient：</p>
</li>
<li><p>初始化的代码如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">        HttpHost.create(<span class="string">&quot;http://192.168.150.101:9200&quot;</span>)</span><br><span class="line">));</span><br></pre></td></tr></table></figure></div>

<ul>
<li>这里为了单元测试方便，我们创建一个测试类<code>IndexTest</code>，然后将初始化的代码编写在<code>@BeforeEach</code>方法中：</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.item.es;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.AfterEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.client = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">                HttpHost.create(<span class="string">&quot;http://192.168.150.101:9200&quot;</span>)</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testConnect</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(client);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.client.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="24-2-商品Mapping映射"><a href="#24-2-商品Mapping映射" class="headerlink" title="24.2 商品Mapping映射"></a>24.2 商品Mapping映射</h2><p>实现搜索功能需要的字段包括三大部分：</p>
<ul>
<li>搜索过滤字段<ul>
<li>分类</li>
<li>品牌</li>
<li>价格</li>
</ul>
</li>
<li>排序字段<ul>
<li>默认：按照更新时间降序排序</li>
<li>销量</li>
<li>价格</li>
</ul>
</li>
<li>展示字段<ul>
<li>商品id：用于点击后跳转</li>
<li>图片地址</li>
<li>是否是广告推广商品</li>
<li>名称</li>
<li>价格</li>
<li>评价数量</li>
<li>销量</li>
</ul>
</li>
</ul>
<p>对应的商品表结构如下，索引库无关字段已经划掉：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241015192857802.png"
                      alt="image-20241015192857802"
                ></li>
</ul>
<p>结合数据库表结构，以上字段对应的mapping映射属性如下：</p>
<table>
<thead>
<tr>
<th><strong>字段名</strong></th>
<th><strong>字段类型</strong></th>
<th><strong>类型说明</strong></th>
<th><strong>是否</strong>参与搜索</th>
<th><strong>是否</strong>参与分词</th>
<th><strong>分词器</strong></th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td><code>long</code></td>
<td>长整数</td>
<td>是</td>
<td></td>
<td>——</td>
</tr>
<tr>
<td>name</td>
<td><code>text</code></td>
<td>字符串，参与分词搜索</td>
<td>是</td>
<td>是</td>
<td>IK</td>
</tr>
<tr>
<td>price</td>
<td><code>integer</code></td>
<td>以分为单位，所以是整数</td>
<td>是</td>
<td></td>
<td>——</td>
</tr>
<tr>
<td>stock</td>
<td><code>integer</code></td>
<td>字符串，但需要分词</td>
<td>是</td>
<td></td>
<td>——</td>
</tr>
<tr>
<td>image</td>
<td><code>keyword</code></td>
<td>字符串，但是不分词</td>
<td></td>
<td></td>
<td>——</td>
</tr>
<tr>
<td>category</td>
<td><code>keyword</code></td>
<td>字符串，但是不分词</td>
<td>是</td>
<td></td>
<td>——</td>
</tr>
<tr>
<td>brand</td>
<td><code>keyword</code></td>
<td>字符串，但是不分词</td>
<td>是</td>
<td></td>
<td>——</td>
</tr>
<tr>
<td>sold</td>
<td><code>integer</code></td>
<td>销量，整数</td>
<td>是</td>
<td></td>
<td>——</td>
</tr>
<tr>
<td>commentCount</td>
<td><code>integer</code></td>
<td>评价，整数</td>
<td></td>
<td></td>
<td>——</td>
</tr>
<tr>
<td>isAD</td>
<td><code>boolean</code></td>
<td>布尔类型</td>
<td>是</td>
<td></td>
<td>——</td>
</tr>
<tr>
<td>updateTime</td>
<td><code>Date</code></td>
<td>更新时间</td>
<td>是</td>
<td></td>
<td>——</td>
</tr>
</tbody></table>
<p>因此，最终我们的索引库文档结构应该是这样：</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">PUT /items</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;stock&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sold&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;commentCount&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;boolean&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="24-3-索引库操作"><a href="#24-3-索引库操作" class="headerlink" title="24.3 索引库操作"></a>24.3 索引库操作</h2><h3 id="24-3-1-创建索引库"><a href="#24-3-1-创建索引库" class="headerlink" title="24.3.1 创建索引库"></a>24.3.1 创建索引库</h3><ul>
<li><p>创建索引库的API如下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241014174939177.png"
                      alt="image-20241014174939177"
                ></p>
</li>
<li><p>代码分为三步：</p>
</li>
<li><p>1）创建Request对象。</p>
<ul>
<li>因为是创建索引库的操作，因此Request是<code>CreateIndexRequest</code>。</li>
</ul>
</li>
<li><p>2）添加请求参数</p>
<ul>
<li>其实就是Json格式的Mapping映射参数。因为json字符串很长，这里是定义了静态字符串常量<code>MAPPING_TEMPLATE</code>，让代码看起来更加优雅。</li>
</ul>
</li>
<li><p>3）发送请求</p>
<ul>
<li><code>client.indices()</code>方法的返回值是<code>IndicesClient</code>类型，封装了所有与索引库操作有关的方法。例如创建索引、删除索引、判断索引是否存在等</li>
</ul>
</li>
<li><p>在<code>item-service</code>中的<code>IndexTest</code>测试类中，具体代码如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testCreateIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request对象</span></span><br><span class="line">    <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.准备请求参数</span></span><br><span class="line">    request.source(MAPPING_TEMPLATE, XContentType.JSON);</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MAPPING_TEMPLATE</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;  \&quot;mappings\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    \&quot;properties\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;id\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;name\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;price\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;stock\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;image\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;index\&quot;: false\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;category\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;brand\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;sold\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;commentCount\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;isAD\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;boolean\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;updateTime\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;date\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;  &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure></div>

<h3 id="24-3-2-删除索引库"><a href="#24-3-2-删除索引库" class="headerlink" title="24.3.2 删除索引库"></a>24.3.2 删除索引库</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDeleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request对象</span></span><br><span class="line">    <span class="type">DeleteIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.发送请求</span></span><br><span class="line">    client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="24-3-3-查询索引库信息"><a href="#24-3-3-查询索引库信息" class="headerlink" title="24.3.3 查询索引库信息"></a>24.3.3 查询索引库信息</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testExistsHotelIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request对象</span></span><br><span class="line">    <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.发送请求</span></span><br><span class="line">    client.indices().get(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="24-3-4-查询索引库信息"><a href="#24-3-4-查询索引库信息" class="headerlink" title="24.3.4  查询索引库信息"></a>24.3.4  查询索引库信息</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testExistsIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request对象</span></span><br><span class="line">    <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.发送请求</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 3.输出</span></span><br><span class="line">    System.err.println(exists ? <span class="string">&quot;索引库已经存在！&quot;</span> : <span class="string">&quot;索引库不存在！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="24-4-文档操作"><a href="#24-4-文档操作" class="headerlink" title="24.4 文档操作"></a>24.4 文档操作</h2><h3 id="24-4-1-新增文档"><a href="#24-4-1-新增文档" class="headerlink" title="24.4.1 新增文档"></a>24.4.1 新增文档</h3><ul>
<li><p>实体类</p>
</li>
<li><p>在<code>hm-service</code>模块的<code>com.hmall.item.domain.dto</code>包中定义一个新的DTO：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.item.domain.po;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;索引库实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemDoc</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;商品id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;商品名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;价格（分）&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;商品图片&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;类目名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String category;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;品牌名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;销量&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer sold;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;评论数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer commentCount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;是否是推广广告，true/false&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isAD;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;更新时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>API语法</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241014193539075.png"
                      alt="image-20241014193539075"
                ></p>
</li>
<li><p>完整代码</p>
</li>
<li><p>在<code>item-service</code>的<code>DocumentTest</code>测试类中，编写单元测试：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testAddDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.根据id查询商品数据</span></span><br><span class="line">    <span class="type">Item</span> <span class="variable">item</span> <span class="operator">=</span> itemService.getById(<span class="number">100002644680L</span>);</span><br><span class="line">    <span class="comment">// 2.转换为文档类型</span></span><br><span class="line">    <span class="type">ItemDoc</span> <span class="variable">itemDoc</span> <span class="operator">=</span> BeanUtil.copyProperties(item, ItemDoc.class);</span><br><span class="line">    <span class="comment">// 3.将ItemDTO转json</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">doc</span> <span class="operator">=</span> JSONUtil.toJsonStr(itemDoc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.准备Request对象</span></span><br><span class="line">    <span class="type">IndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;items&quot;</span>).id(itemDoc.getId());</span><br><span class="line">    <span class="comment">// 2.准备Json文档</span></span><br><span class="line">    request.source(doc, XContentType.JSON);</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    client.index(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="24-4-2-删除文档"><a href="#24-4-2-删除文档" class="headerlink" title="24.4.2 删除文档"></a>24.4.2 删除文档</h3><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDeleteDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.准备Request，两个参数，第一个是索引库名，第二个是文档id</span></span><br><span class="line">    <span class="type">DeleteRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">&quot;item&quot;</span>, <span class="string">&quot;100002644680&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.发送请求</span></span><br><span class="line">    client.delete(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="24-4-3-查询文档"><a href="#24-4-3-查询文档" class="headerlink" title="24.4.3 查询文档"></a>24.4.3 查询文档</h3><ul>
<li><p>API语法</p>
</li>
<li><p>响应结果是一个JSON，其中文档放在一个<code>_source</code>属性中，因此解析就是拿到<code>_source</code>，反序列化为Java对象即可。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241014194601160.png"
                      alt="image-20241014194601160"
                ></p>
</li>
<li><p>完整代码</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetDocumentById</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.准备Request对象</span></span><br><span class="line">    <span class="type">GetRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;items&quot;</span>).id(<span class="string">&quot;100002644680&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.发送请求</span></span><br><span class="line">    <span class="type">GetResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.get(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 3.获取响应结果中的source</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> response.getSourceAsString();</span><br><span class="line">    </span><br><span class="line">    <span class="type">ItemDoc</span> <span class="variable">itemDoc</span> <span class="operator">=</span> JSONUtil.toBean(json, ItemDoc.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;itemDoc= &quot;</span> + ItemDoc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="24-4-4-全局修改文档"><a href="#24-4-4-全局修改文档" class="headerlink" title="24.4.4 全局修改文档"></a>24.4.4 全局修改文档</h3><ul>
<li>语法与新增文档的语法一样。没有是新增，有是修改。</li>
</ul>
<h3 id="24-4-5-局部修改文档"><a href="#24-4-5-局部修改文档" class="headerlink" title="24.4.5 局部修改文档"></a>24.4.5 局部修改文档</h3><ul>
<li><p>API语法</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241014200019864.png"
                      alt="image-20241014200019864"
                ></p>
</li>
<li><p>完整代码</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.准备Request</span></span><br><span class="line">    <span class="type">UpdateRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;items&quot;</span>, <span class="string">&quot;100002644680&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.准备请求参数</span></span><br><span class="line">    request.doc(</span><br><span class="line">            <span class="string">&quot;price&quot;</span>, <span class="number">58800</span>,</span><br><span class="line">            <span class="string">&quot;commentCount&quot;</span>, <span class="number">1</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    client.update(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="24-4-6-批量操作"><a href="#24-4-6-批量操作" class="headerlink" title="24.4.6 批量操作"></a>24.4.6 批量操作</h3><p><code>BulkRequest</code>本身其实并没有请求参数，其本质就是将多个普通的CRUD请求组合在一起发送。例如：</p>
<ul>
<li>批量新增文档，就是给每个文档创建一个<code>IndexRequest</code>请求，然后封装到<code>BulkRequest</code>中，一起发出。</li>
<li>批量删除，就是创建N个<code>DeleteRequest</code>请求，然后封装到<code>BulkRequest</code>，一起发出。</li>
</ul>
<p>因此<code>BulkRequest</code>中提供了<code>add</code>方法，用以添加其它CRUD的请求：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241014204245737.png"
                      alt="image-20241014204245737"
                ></li>
</ul>
<p>因此Bulk中添加了多个<code>IndexRequest</code>，就是批量新增功能了。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBulk</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request</span></span><br><span class="line">    <span class="type">BulkRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">    <span class="comment">// 2.准备请求参数</span></span><br><span class="line">    request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;items&quot;</span>).id(<span class="string">&quot;1&quot;</span>).source(<span class="string">&quot;json doc1&quot;</span>, XContentType.JSON));</span><br><span class="line">    request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;items&quot;</span>).id(<span class="string">&quot;2&quot;</span>).source(<span class="string">&quot;json doc2&quot;</span>, XContentType.JSON));</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>当我们要导入商品数据时，由于商品数量达到数十万，因此不可能一次性全部导入。建议采用循环遍历方式，每次导入1000条左右的数据。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testLoadItemDocs</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 分页查询商品数据</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        Page&lt;Item&gt; page = itemService.lambdaQuery().eq(Item::getStatus, <span class="number">1</span>).page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;Item&gt;(pageNo, size));</span><br><span class="line">        <span class="comment">// 非空校验</span></span><br><span class="line">        List&lt;Item&gt; items = page.getRecords();</span><br><span class="line">        <span class="keyword">if</span> (CollUtils.isEmpty(items)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;加载第&#123;&#125;页数据，共&#123;&#125;条&quot;</span>, pageNo, items.size());</span><br><span class="line">        <span class="comment">// 1.创建Request</span></span><br><span class="line">        <span class="type">BulkRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.准备参数，添加多个新增的Request</span></span><br><span class="line">        <span class="keyword">for</span> (Item item : items) &#123;</span><br><span class="line">            <span class="comment">// 2.1.转换为文档类型ItemDTO</span></span><br><span class="line">            <span class="type">ItemDoc</span> <span class="variable">itemDoc</span> <span class="operator">=</span> BeanUtil.copyProperties(item, ItemDoc.class);</span><br><span class="line">            <span class="comment">// 2.2.创建新增文档的Request对象</span></span><br><span class="line">            request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>()</span><br><span class="line">                            .id(itemDoc.getId())</span><br><span class="line">                            .source(JSONUtil.toJsonStr(itemDoc), XContentType.JSON));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.发送请求</span></span><br><span class="line">        client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 翻页</span></span><br><span class="line">        pageNo++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="24-4-7-总结"><a href="#24-4-7-总结" class="headerlink" title="24.4.7 总结"></a>24.4.7 总结</h3><p>文档操作的基本步骤：</p>
<ul>
<li>初始化<code>RestHighLevelClient</code></li>
<li>创建xxxRequest。<ul>
<li>xxx是<code>Index</code>、<code>Get</code>、<code>Update</code>、<code>Delete</code>、<code>Bulk</code></li>
</ul>
</li>
<li>准备参数（<code>Index</code>、<code>Update</code>、<code>Bulk</code>时需要）</li>
<li>发送请求。<ul>
<li>调用<code>RestHighLevelClient#.xxx()</code>方法，xxx是<code>index</code>、<code>get</code>、<code>update</code>、<code>delete</code>、<code>bulk</code></li>
</ul>
</li>
<li>解析结果（<code>Get</code>时需要）</li>
</ul>
<h1 id="25-DSL查询"><a href="#25-DSL查询" class="headerlink" title="25.DSL查询"></a>25.DSL查询</h1><h2 id="25-1-快速入门"><a href="#25-1-快速入门" class="headerlink" title="25.1 快速入门"></a>25.1 快速入门</h2><p>Elasticsearch 的查询可以分为两大类：</p>
<ul>
<li><strong>叶子查询（Leaf</strong> <strong>query</strong> <strong>clauses）</strong>：一般是在特定的字段里查询特定值，属于简单查询，很少单独使用。</li>
<li><strong>复合查询（Compound</strong> <strong>query</strong> <strong>clauses）</strong>：以逻辑方式组合多个叶子查询或者更改叶子查询的行为方式。</li>
</ul>
<p>查询的语法结构：</p>
<ul>
<li><code>GET /&#123;索引库名&#125;/_search</code>：其中的<code>_search</code>是固定路径，不能修改</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /<span class="punctuation">&#123;</span>索引库名<span class="punctuation">&#125;</span>/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;查询类型&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// .. 查询条件</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>最简单的无条件查询为例，其查询语句如下：</p>
<ul>
<li><p>无条件查询的类型是：match_all</p>
</li>
<li><p>由于match_all无条件，所以条件位置不写即可</p>
</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /items/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      </span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>执行结果如下：</p>
<ul>
<li><p>发现虽然是match_all，但是响应结果中并不会包含索引库中的所有文档，而是仅有10条。这是因为处于安全考虑，elasticsearch设置了默认的查询页数。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241015204036806.png"
                      alt="image-20241015204036806"
                ></p>
</li>
</ul>
<h2 id="25-2-叶子查询"><a href="#25-2-叶子查询" class="headerlink" title="25.2 叶子查询"></a>25.2 叶子查询</h2><h3 id="25-2-1-介绍"><a href="#25-2-1-介绍" class="headerlink" title="25.2.1 介绍"></a>25.2.1 介绍</h3><ul>
<li><strong>全文检索查询（Full Text Queries）</strong>：利用分词器对用户输入搜索条件先分词，得到词条，然后再利用倒排索引搜索词条。例如：<ul>
<li><code>match</code>：</li>
<li><code>multi_match</code></li>
</ul>
</li>
<li><strong>精确查询（Term-level queries）</strong>：不对用户输入搜索条件分词，根据字段内容精确值匹配。但只能查找keyword、数值、日期、boolean类型的字段。例如：<ul>
<li><code>ids</code></li>
<li><code>term</code></li>
<li><code>range</code></li>
</ul>
</li>
<li><strong>地理坐标查询：</strong>用于搜索地理位置，搜索方式很多，例如：<ul>
<li><code>geo_bounding_box</code>：按矩形搜索</li>
<li><code>geo_distance</code>：按点和半径搜索</li>
</ul>
</li>
</ul>
<h3 id="25-2-2-全文检索查询"><a href="#25-2-2-全文检索查询" class="headerlink" title="25.2.2 全文检索查询"></a>25.2.2 全文检索查询</h3><ul>
<li><code>match</code>，语法如下：</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /<span class="punctuation">&#123;</span>索引库名<span class="punctuation">&#125;</span>/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;字段名&quot;</span><span class="punctuation">:</span> <span class="string">&quot;搜索条件&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>示例：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241015205524556.png"
                      alt="image-20241015205524556"
                ></p>
</li>
<li><p><code>multi_match</code>，区别在于可以同时对多个字段搜索，而且多个字段都要满足，语法示例：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /<span class="punctuation">&#123;</span>索引库名<span class="punctuation">&#125;</span>/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;搜索条件&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;字段1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;字段2&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>示例：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241015205659600.png"
                      alt="image-20241015205659600"
                ></p>
</li>
</ul>
<h3 id="25-2-3-精确查询"><a href="#25-2-3-精确查询" class="headerlink" title="25.2.3 精确查询"></a>25.2.3 精确查询</h3><ul>
<li><p>精确查询，英文是<code>Term-level query</code>，顾名思义，词条级别的查询。也就是说不会对用户输入的搜索条件再分词，而是作为一个词条，与搜索的字段内容精确值匹配。因此推荐查找<code>keyword</code>、数值、日期、<code>boolean</code>类型的字段。例如：id、price、城市、地名、人名 等等，作为一个整体才有含义的字段。</p>
</li>
<li><p><code>term</code>查询，其语法如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /<span class="punctuation">&#123;</span>索引库名<span class="punctuation">&#125;</span>/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;字段名&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;搜索条件&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>示例：</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241015210907518.png"
                      alt="image-20241015210907518"
                ></li>
<li><code>range</code>查询，语法如下：</li>
<li><code>range</code>是范围查询，对于范围筛选的关键字有：<ul>
<li><code>gte</code>：大于等于</li>
<li><code>gt</code>：大于</li>
<li><code>lte</code>：小于等于</li>
<li><code>lt</code>：小于</li>
</ul>
</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /<span class="punctuation">&#123;</span>索引库名<span class="punctuation">&#125;</span>/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;字段名&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>最小值<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>最大值<span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>示例：</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241015211102365.png"
                      alt="image-20241015211102365"
                ></li>
</ul>
<h2 id="25-3-复合查询"><a href="#25-3-复合查询" class="headerlink" title="25.3 复合查询"></a>25.3 复合查询</h2><h3 id="25-3-1-bool查询"><a href="#25-3-1-bool查询" class="headerlink" title="25.3.1 bool查询"></a>25.3.1 bool查询</h3><ul>
<li><p>bool查询，即布尔查询。就是利用逻辑运算来组合一个或多个查询子句的组合。bool查询支持的逻辑运算有：</p>
<ul>
<li>must：必须匹配每个子查询，类似“与”</li>
<li>should：选择性匹配子查询，类似“或”</li>
<li>must_not：必须不匹配，<strong>不参与算分</strong>，类似“非”</li>
<li>filter：必须匹配，<strong>不参与算分</strong></li>
</ul>
</li>
<li><p>bool查询的语法如下：</p>
</li>
<li><p>出于性能考虑，与搜索关键字无关的查询尽量采用must_not或filter逻辑运算，避免参与相关性算分。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /items/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vivo&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小米&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">2500</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>比如，我们要搜索<code>手机</code>，但品牌必须是<code>华为</code>，价格必须是<code>900~1599</code>，那么可以这样写：</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /items/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华为&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">90000</span><span class="punctuation">,</span> <span class="attr">&quot;lt&quot;</span><span class="punctuation">:</span> <span class="number">159900</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<h3 id="25-3-2-算分函数查询"><a href="#25-3-2-算分函数查询" class="headerlink" title="25.3.2 算分函数查询"></a>25.3.2 算分函数查询</h3><ul>
<li><p>当我们利用match查询时，文档结果会根据与搜索词条的<strong>关联度打分</strong>（**_score**），返回结果时按照分值降序排列。如：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016105511234.png"
                      alt="image-20241016105511234"
                ></p>
</li>
<li><p>从elasticsearch5.1开始，采用的相关性打分算法是BM25算法，公式如下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016105555086.png"
                      alt="image-20241016105555086"
                ></p>
</li>
<li><p>基于这套公式，就可以判断出某个文档与用户搜索的关键字之间的关联度，还是比较准确的。但是，在实际业务需求中，常常会有竞价排名的功能。不是相关度越高排名越靠前，而是掏的钱多的排名靠前。</p>
</li>
<li><p>要想认为控制相关性算分，就需要利用elasticsearch中的function score 查询了。</p>
</li>
</ul>
<p><strong>基本语法</strong>：</p>
<p>function score 查询中包含四部分内容：</p>
<ul>
<li><strong>原始查询</strong>条件：query部分，基于这个条件搜索文档，并且基于BM25算法给文档打分，<strong>原始算分</strong>（query score)</li>
<li><strong>过滤条件</strong>：filter部分，符合该条件的文档才会重新算分</li>
<li><strong>算分函数</strong>：符合filter条件的文档要根据这个函数做运算，得到的<strong>函数算分</strong>（function score），有四种函数 <ul>
<li>weight：函数结果是常量</li>
<li>field_value_factor：以文档中的某个字段值作为函数结果</li>
<li>random_score：以随机数作为函数结果</li>
<li>script_score：自定义算分函数算法</li>
</ul>
</li>
<li><strong>运算模式</strong>：算分函数的结果、原始查询的相关性算分，两者之间的运算方式，包括： <ul>
<li>multiply：相乘</li>
<li>replace：用function score替换query score</li>
<li>其它，例如：sum、avg、max、min</li>
</ul>
</li>
</ul>
<p>function score的运行流程如下：</p>
<ul>
<li>1）根据<strong>原始条件</strong>查询搜索文档，并且计算相关性算分，称为<strong>原始算分</strong>（query score）</li>
<li>2）根据<strong>过滤条件</strong>，过滤文档</li>
<li>3）符合<strong>过滤条件</strong>的文档，基于<strong>算分函数</strong>运算，得到<strong>函数算分</strong>（function score）</li>
<li>4）将<strong>原始算分</strong>（query score）和<strong>函数算分</strong>（function score）基于<strong>运算模式</strong>做运算，得到最终结果，作为相关性算分。</li>
</ul>
<p>因此，其中的关键点是：</p>
<ul>
<li>过滤条件：决定哪些文档的算分被修改</li>
<li>算分函数：决定函数算分的算法</li>
<li>运算模式：决定最终算分结果</li>
</ul>
<p>示例：给IPhone这个品牌的手机算分提高十倍，分析如下：</p>
<ul>
<li>过滤条件：品牌必须为IPhone</li>
<li>算分函数：常量weight，值为10</li>
<li>算分模式：相乘multiply</li>
</ul>
<p>对应代码如下：</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;function_score&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>  .... <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="comment">// 原始查询，可以是任意条件</span></span><br><span class="line">      <span class="attr">&quot;functions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">// 算分函数</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// 满足的条件，品牌必须是Iphone</span></span><br><span class="line">            <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Iphone&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span> <span class="number">10</span> <span class="comment">// 算分权重为2</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;boost_mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;multipy&quot;</span> <span class="comment">// 加权模式，求乘积</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="25-4-排序"><a href="#25-4-排序" class="headerlink" title="25.4 排序"></a>25.4 排序</h2><ul>
<li><p>elasticsearch默认是根据相关度算分（<code>_score</code>）来排序，但是也支持自定义方式对搜索结果排序。不过分词字段无法排序，能参与排序字段类型有：<code>keyword</code>类型、数值类型、地理坐标类型、日期类型等。</p>
</li>
<li><p>排序方式：asc - 升序；desc - 降序</p>
</li>
<li><p>使用排序后，关联度打分（_score）将为 null。</p>
</li>
<li><p>语法说明：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;排序字段&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;排序方式asc和desc&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>示例，我们按照商品销量（降序）与价格（升序）排序：</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /items/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;sold&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<h2 id="25-5-分页"><a href="#25-5-分页" class="headerlink" title="25.5 分页"></a>25.5 分页</h2><ul>
<li>elasticsearch 默认情况下只返回top10的数据。而如果要查询更多数据就需要修改分页参数了。</li>
</ul>
<h3 id="25-5-1-基础分页"><a href="#25-5-1-基础分页" class="headerlink" title="25.5.1 基础分页"></a>25.5.1 基础分页</h3><ul>
<li><p>elasticsearch中通过修改<code>from</code>、<code>size</code>参数来控制要返回的分页结果：</p>
<ul>
<li><code>from</code>：从第几个文档开始</li>
<li><code>size</code>：总共查询几个文档</li>
</ul>
</li>
<li><p>类似于mysql中的<code>limit ?, ?</code></p>
</li>
<li><p>语法如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /items/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="comment">// 分页开始的位置，默认为0</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span>  <span class="comment">// 每页文档数量，默认10</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<h3 id="25-5-2-深度分页"><a href="#25-5-2-深度分页" class="headerlink" title="25.5.2 深度分页"></a>25.5.2 深度分页</h3><ul>
<li><p>elasticsearch的数据一般会采用分片存储，也就是把一个索引中的数据分成N份，存储到不同节点上。这种存储方式比较有利于数据扩展，但给分页带来了一些麻烦。</p>
</li>
<li><p>比如一个索引库中有100000条数据，分别存储到4个分片，每个分片25000条数据。</p>
</li>
<li><p>现在每页查询10条，查询第99页。那么分页查询的条件如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /items/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">990</span><span class="punctuation">,</span> <span class="comment">// 从第990条开始查询</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> <span class="comment">// 每页查询10条</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>从语句来分析，要查询第990~1000名的数据。</p>
</li>
<li><p>从实现思路来分析，肯定是将所有数据排序，找出前1000名，截取其中的990~1000的部分。但问题来了，我们如何才能找到所有数据中的前1000名呢？</p>
</li>
<li><p>要知道每一片的数据都不一样，第1片上的第900<del>1000，在另1个节点上并不一定依然是900</del>1000名。所以我们只能在每一个分片上都找出排名前1000的数据，然后汇总到一起，重新排序，才能找出整个索引库中真正的前1000名，此时截取990~1000的数据即可。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016151154730.png"
                      alt="image-20241016151154730"
                ></p>
</li>
<li><p>试想一下，假如我们现在要查询的是第999页数据呢，是不是要找第9990~10000的数据，那岂不是需要把每个分片中的前10000名数据都查询出来，汇总在一起，在内存中排序？如果查询的分页深度更深呢，需要一次检索的数据岂不是更多？</p>
</li>
<li><p>由此可知，当查询分页深度较大时，汇总数据过多，对内存和CPU会产生非常大的压力。</p>
</li>
<li><p>因此elasticsearch会禁止<code>from + size </code>超过10000的请求。</p>
</li>
</ul>
<p>针对深度分页，elasticsearch提供了两种解决方案：</p>
<ul>
<li><code>search after</code>：分页时需要排序，原理是从上一次的排序值开始，查询下一页数据。官方推荐使用的方式。</li>
<li><code>scroll</code>：原理将排序后的文档id形成快照，保存下来，基于快照做分页。官方已经不推荐使用。</li>
</ul>
<p>search after模式:</p>
<ul>
<li>优点：没有查询上限，支持深度分页</li>
<li>缺点：只能向后逐页查询，不能随机翻页</li>
<li>场景：数据迁移、手机滚动查询</li>
</ul>
<p>总结：</p>
<ul>
<li><p>大多数情况下，我们采用普通分页就可以了。查看百度、京东等网站，会发现其分页都有限制。例如百度最多支持77页，每页不足20条。京东最多100页，每页最多60条。</p>
</li>
<li><p>因此，一般我们采用限制分页深度的方式即可，无需实现深度分页。</p>
</li>
</ul>
<h2 id="25-6-高亮显示"><a href="#25-6-高亮显示" class="headerlink" title="25.6 高亮显示"></a>25.6 高亮显示</h2><h3 id="25-6-1-高亮原理"><a href="#25-6-1-高亮原理" class="headerlink" title="25.6.1 高亮原理"></a>25.6.1 高亮原理</h3><p>我们在百度，京东搜索时，关键字会变成红色，比较醒目，这叫高亮显示。</p>
<p>观察页面源码，你会发现两件事情：</p>
<ul>
<li>高亮词条都被加了<code>&lt;em&gt;</code>标签</li>
<li><code>&lt;em&gt;</code>标签都添加了红色样式</li>
</ul>
<p>词条的<strong>高亮标签肯定是由服务端提供数据的时候已经加上的</strong>。</p>
<p>实现高亮的思路就是：</p>
<ul>
<li>用户输入搜索关键字搜索数据</li>
<li>服务端根据搜索关键字到elasticsearch搜索，并给搜索结果中的关键字词条添加<code>html</code>标签</li>
<li>前端提前给约定好的<code>html</code>标签添加<code>CSS</code>样式</li>
</ul>
<h3 id="25-6-2-实现高亮"><a href="#25-6-2-实现高亮" class="headerlink" title="25.6.2 实现高亮"></a>25.6.2 实现高亮</h3><ul>
<li>基本语法如下：</li>
</ul>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /<span class="punctuation">&#123;</span>索引库名<span class="punctuation">&#125;</span>/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;搜索字段&quot;</span><span class="punctuation">:</span> <span class="string">&quot;搜索关键字&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;highlight&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;高亮字段名称&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;pre_tags&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;em&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_tags&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;/em&gt;&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>注意：</p>
<ul>
<li>搜索必须有查询条件，而且是全文检索类型的查询条件，例如<code>match</code></li>
<li>参与高亮的字段必须是<code>text</code>类型的字段</li>
<li>默认情况下参与高亮的字段要与搜索字段一致，除非添加：<code>required_field_match=false</code></li>
</ul>
<p>示例：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016152539350.png"
                      alt="image-20241016152539350"
                ></li>
</ul>
<h1 id="26-JavaRestClient查询"><a href="#26-JavaRestClient查询" class="headerlink" title="26.JavaRestClient查询"></a>26.JavaRestClient查询</h1><h2 id="26-1-快速入门"><a href="#26-1-快速入门" class="headerlink" title="26.1 快速入门"></a>26.1 快速入门</h2><h3 id="26-1-1-发送请求"><a href="#26-1-1-发送请求" class="headerlink" title="26.1.1 发送请求"></a>26.1.1 发送请求</h3><p>以<code>match_all</code>查询为例，其DSL和JavaAPI的对比如图：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016174846654.png"
                      alt="image-20241016174846654"
                ></li>
</ul>
<p>代码解读：</p>
<ul>
<li>第一步，创建<code>SearchRequest</code>对象，指定索引库名 </li>
<li>第二步，利用<code>request.source()</code>构建DSL，DSL中可以包含查询、分页、排序、高亮等 </li>
<li><code>query()</code>：代表查询条件，利用<code>QueryBuilders.matchAllQuery()</code>构建一个<code>match_all</code>查询的DSL</li>
<li>第三步，利用<code>client.search()</code>发送请求，得到响应</li>
</ul>
<p>这里关键的API有两个，一个是<code>request.source()</code>，它构建的就是DSL中的完整JSON参数。其中包含了<code>query</code>、<code>sort</code>、<code>from</code>、<code>size</code>、<code>highlight</code>等所有功能：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016175001743.png"
                      alt="image-20241016175001743"
                ></li>
</ul>
<p>另一个是<code>QueryBuilders</code>，其中包含了我们学习过的各种<strong>叶子查询</strong>、<strong>复合查询</strong>等：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016175026443.png"
                      alt="image-20241016175026443"
                ></li>
</ul>
<h3 id="26-1-2-解析响应结果"><a href="#26-1-2-解析响应结果" class="headerlink" title="26.1.2 解析响应结果"></a>26.1.2 解析响应结果</h3><p>在发送请求以后，得到了响应结果<code>SearchResponse</code>，这个类的结构与我们在kibana中看到的响应结果JSON结构完全一致：</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;took&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timed_out&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;relation&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;eq&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;max_score&quot;</span> <span class="punctuation">:</span> <span class="number">1.0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;heima&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">1.0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;info&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Java讲师&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;赵云&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>因此，我们解析<code>SearchResponse</code>的代码就是在解析这个JSON结果，对比如下：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016175252754.png"
                      alt="image-20241016175252754"
                ></li>
</ul>
<p><strong>代码解读</strong>：</p>
<p>elasticsearch返回的结果是一个JSON字符串，结构包含：</p>
<ul>
<li><code>hits</code>：命中的结果 <ul>
<li><code>total</code>：总条数，其中的value是具体的总条数值</li>
<li><code>max_score</code>：所有结果中得分最高的文档的相关性算分</li>
<li><code>hits</code>：搜索结果的文档数组，其中的每个文档都是一个json对象 <ul>
<li><code>_source</code>：文档中的原始数据，也是json对象</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>因此，我们解析响应结果，就是逐层解析JSON字符串，流程如下：</p>
<ul>
<li><code>SearchHits</code>：通过<code>response.getHits()</code>获取，就是JSON中的最外层的<code>hits</code>，代表命中的结果 <ul>
<li><code>SearchHits.getTotalHits().value</code>：获取总条数信息</li>
<li><code>SearchHits.getHits()</code>：获取<code>SearchHit</code>数组，也就是文档数组 <ul>
<li><code>SearchHit.getSourceAsString()</code>：获取文档结果中的<code>_source</code>，也就是原始的<code>json</code>文档数据</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="26-1-3-总结"><a href="#26-1-3-总结" class="headerlink" title="26.1.3 总结"></a>26.1.3 总结</h3><ul>
<li>文档搜索的基本步骤是：</li>
</ul>
<ol>
<li>创建<code>SearchRequest</code>对象</li>
<li>准备<code>request.source()</code>，也就是DSL。<ol>
<li><code>QueryBuilders</code>来构建查询条件</li>
<li>传入<code>request.source()</code> 的<code>query()</code>方法</li>
</ol>
</li>
<li>发送请求，得到结果</li>
<li>解析结果（参考JSON结果，从外到内，逐层解析）</li>
</ol>
<ul>
<li>完整代码如下：</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatchAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.组织请求参数</span></span><br><span class="line">    request.source().query(QueryBuilders.matchAllQuery());</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.解析响应</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 1.获取总条数</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    System.out.println(<span class="string">&quot;共搜索到&quot;</span> + total + <span class="string">&quot;条数据&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.遍历结果数组</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        <span class="comment">// 3.得到_source，也就是原始json文档</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">source</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// 4.反序列化并打印</span></span><br><span class="line">        <span class="type">ItemDoc</span> <span class="variable">item</span> <span class="operator">=</span> JSONUtil.toBean(source, ItemDoc.class);</span><br><span class="line">        System.out.println(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="26-2-叶子查询"><a href="#26-2-叶子查询" class="headerlink" title="26.2 叶子查询"></a>26.2 叶子查询</h2><ul>
<li><p>所有的查询条件都是由QueryBuilders来构建的，叶子查询也不例外。因此整套代码中变化的部分仅仅是query条件构造的方式，其它不动。</p>
</li>
<li><p><code>match</code>查询：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.组织请求参数</span></span><br><span class="line">    request.source().query(QueryBuilders.matchQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;脱脂牛奶&quot;</span>));</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.解析响应</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>multi_match</code>查询：</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMultiMatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.组织请求参数</span></span><br><span class="line">    request.source().query(QueryBuilders.multiMatchQuery(<span class="string">&quot;脱脂牛奶&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;category&quot;</span>));</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.解析响应</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>range</code>查询：</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testRange</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.组织请求参数</span></span><br><span class="line">    request.source().query(QueryBuilders.rangeQuery(<span class="string">&quot;price&quot;</span>).gte(<span class="number">10000</span>).lte(<span class="number">30000</span>));</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.解析响应</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>term</code>查询：</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testTerm</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.组织请求参数</span></span><br><span class="line">    request.source().query(QueryBuilders.termQuery(<span class="string">&quot;brand&quot;</span>, <span class="string">&quot;华为&quot;</span>));</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.解析响应</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="26-3-复合查询"><a href="#26-3-复合查询" class="headerlink" title="26.3 复合查询"></a>26.3 复合查询</h2><ul>
<li><p>复合查询也是由<code>QueryBuilders</code>来构建，我们以<code>bool</code>查询为例，DSL和JavaAPI的对比如图：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016191556256.png"
                      alt="image-20241016191556256"
                ></p>
</li>
<li><p>完整代码如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBool</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.组织请求参数</span></span><br><span class="line">    <span class="comment">// 2.1.准备bool查询</span></span><br><span class="line">    <span class="type">BoolQueryBuilder</span> <span class="variable">bool</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">    <span class="comment">// 2.2.关键字搜索</span></span><br><span class="line">    bool.must(QueryBuilders.matchQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;脱脂牛奶&quot;</span>)); <span class="comment">//搜索关键字为脱脂牛奶</span></span><br><span class="line">    <span class="comment">// 2.3.品牌过滤</span></span><br><span class="line">    bool.filter(QueryBuilders.termQuery(<span class="string">&quot;brand&quot;</span>, <span class="string">&quot;德亚&quot;</span>)); <span class="comment">//品牌必须为德亚</span></span><br><span class="line">    <span class="comment">// 2.4.价格过滤</span></span><br><span class="line">    bool.filter(QueryBuilders.rangeQuery(<span class="string">&quot;price&quot;</span>).lte(<span class="number">30000</span>)); <span class="comment">//价格必须低于300</span></span><br><span class="line">    request.source().query(bool);</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.解析响应</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="26-4-排序和分页"><a href="#26-4-排序和分页" class="headerlink" title="26.4 排序和分页"></a>26.4 排序和分页</h2><ul>
<li><p><code>requeset.source()</code>就是整个请求JSON参数，所以排序、分页都是基于这个来设置，其DSL和JavaAPI的对比如下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016192641427.png"
                      alt="image-20241016192641427"
                ></p>
</li>
<li><p>完整示例代码：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPageAndSort</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span>, pageSize = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.创建Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.组织请求参数</span></span><br><span class="line">    <span class="comment">// 2.1.搜索条件参数</span></span><br><span class="line">    request.source().query(QueryBuilders.matchQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;脱脂牛奶&quot;</span>));</span><br><span class="line">    <span class="comment">// 2.2.排序参数</span></span><br><span class="line">    request.source().sort(<span class="string">&quot;price&quot;</span>, SortOrder.ASC); <span class="comment">//价格 升序</span></span><br><span class="line">    <span class="comment">// 2.3.分页参数</span></span><br><span class="line">    request.source().from((pageNo - <span class="number">1</span>) * pageSize).size(pageSize);</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.解析响应</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="26-5-高亮显示"><a href="#26-5-高亮显示" class="headerlink" title="26.5 高亮显示"></a>26.5 高亮显示</h2><h3 id="26-5-1-发送请求"><a href="#26-5-1-发送请求" class="headerlink" title="26.5.1 发送请求"></a>26.5.1 发送请求</h3><ul>
<li><p>来看高亮条件构造，其DSL和JavaAPI的对比如图：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016201400895.png"
                      alt="image-20241016201400895"
                ></p>
</li>
<li><p>示例代码如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHighlight</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.组织请求参数</span></span><br><span class="line">    <span class="comment">// 2.1.query条件</span></span><br><span class="line">    request.source().query(QueryBuilders.matchQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;脱脂牛奶&quot;</span>));</span><br><span class="line">    <span class="comment">// 2.2.高亮条件</span></span><br><span class="line">    request.source().highlighter(</span><br><span class="line">            SearchSourceBuilder.highlight()</span><br><span class="line">                    .field(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                    .preTags(<span class="string">&quot;&lt;em&gt;&quot;</span>)</span><br><span class="line">                    .postTags(<span class="string">&quot;&lt;/em&gt;&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.解析响应</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="26-5-2-解析响应结果"><a href="#26-5-2-解析响应结果" class="headerlink" title="26.5.2 解析响应结果"></a>26.5.2 解析响应结果</h3><p>结果解析，文档解析的部分不变，主要是高亮内容需要单独解析出来，其DSL和JavaAPI的对比如图：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016201543217.png"
                      alt="image-20241016201543217"
                ></li>
</ul>
<p>代码解读：</p>
<ul>
<li>第<code>3、4</code>步：从结果中获取<code>_source</code>。<code>hit.getSourceAsString()</code>，这部分是非高亮结果，json字符串。还需要反序列为<code>ItemDoc</code>对象</li>
<li>第<code>5</code>步：获取高亮结果。<code>hit.getHighlightFields()</code>，返回值是一个<code>Map</code>，key是高亮字段名称，值是<code>HighlightField</code>对象，代表高亮值</li>
<li>第<code>5.1</code>步：从<code>Map</code>中根据高亮字段名称，获取高亮字段值对象<code>HighlightField</code></li>
<li>第<code>5.2</code>步：从<code>HighlightField</code>中获取<code>Fragments</code>，并且转为字符串。这部分就是真正的高亮字符串了</li>
<li>最后：用高亮的结果替换<code>ItemDoc</code>中的非高亮结果</li>
</ul>
<p>完整代码如下：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 1.获取总条数</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    System.out.println(<span class="string">&quot;共搜索到&quot;</span> + total + <span class="string">&quot;条数据&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.遍历结果数组</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        <span class="comment">// 3.得到_source，也就是原始json文档</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">source</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// 4.反序列化</span></span><br><span class="line">        <span class="type">ItemDoc</span> <span class="variable">item</span> <span class="operator">=</span> JSONUtil.toBean(source, ItemDoc.class);</span><br><span class="line">        <span class="comment">// 5.获取高亮结果</span></span><br><span class="line">        Map&lt;String, HighlightField&gt; hfs = hit.getHighlightFields();</span><br><span class="line">        <span class="keyword">if</span> (CollUtils.isNotEmpty(hfs)) &#123;</span><br><span class="line">            <span class="comment">// 5.1.有高亮结果，获取name的高亮结果</span></span><br><span class="line">            <span class="type">HighlightField</span> <span class="variable">hf</span> <span class="operator">=</span> hfs.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (hf != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 5.2.获取第一个高亮结果片段，就是商品名称的高亮值</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">hfName</span> <span class="operator">=</span> hf.getFragments()[<span class="number">0</span>].string();</span><br><span class="line">                item.setName(hfName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="27-数据聚合"><a href="#27-数据聚合" class="headerlink" title="27.数据聚合"></a>27.数据聚合</h1><h2 id="27-1-聚合的分类"><a href="#27-1-聚合的分类" class="headerlink" title="27.1 聚合的分类"></a>27.1 聚合的分类</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016205616315.png"
                      alt="image-20241016205616315"
                ></li>
</ul>
<h2 id="27-2-DSL实现聚合"><a href="#27-2-DSL实现聚合" class="headerlink" title="27.2 DSL实现聚合"></a>27.2 DSL实现聚合</h2><h3 id="27-2-1-Bucket聚合"><a href="#27-2-1-Bucket聚合" class="headerlink" title="27.2.1 Bucket聚合"></a>27.2.1 Bucket聚合</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016211925033.png"
                      alt="image-20241016211925033"
                ></li>
</ul>
<p>基本语法如下：</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /items/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;category_agg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;category&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>语法说明：</p>
<ul>
<li><code>size</code>：设置<code>size</code>为0，就是每页查0条，则结果中就不包含文档，只包含聚合</li>
<li><code>aggs</code>：定义聚合<ul>
<li><code>category_agg</code>：聚合名称，自定义，但不能重复<ul>
<li><code>terms</code>：聚合的类型，按分类聚合，所以用<code>term</code><ul>
<li><code>field</code>：参与聚合的字段名称</li>
<li><code>size</code>：希望返回的聚合结果的最大数量</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>来看查询的结果：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016211049409.png"
                      alt="image-20241016211049409"
                ></li>
</ul>
<h3 id="27-2-2-带条件聚合"><a href="#27-2-2-带条件聚合" class="headerlink" title="27.2.2 带条件聚合"></a>27.2.2 带条件聚合</h3><p>我们需要从需求中分析出搜索查询的条件和聚合的目标：</p>
<ul>
<li>搜索查询条件：<ul>
<li>价格高于3000</li>
<li>必须是手机</li>
</ul>
</li>
<li>聚合目标：统计的是品牌，肯定是对brand字段做term聚合</li>
</ul>
<p>语法如下：</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /items/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">300000</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;brand_agg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;brand&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>聚合结果如下：</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;took&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;eq&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;brand_agg&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;doc_count_error_upper_bound&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sum_other_doc_count&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;buckets&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;华为&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span> <span class="punctuation">:</span> <span class="number">7</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Apple&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span> <span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;小米&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<h3 id="27-2-3-Metric聚合"><a href="#27-2-3-Metric聚合" class="headerlink" title="27.2.3 Metric聚合"></a>27.2.3 Metric聚合</h3><p>现在我们需要对桶内的商品做运算，获取每个品牌价格的最小值、最大值、平均值。</p>
<p>这就要用到<code>Metric</code>聚合了，例如<code>stat</code>聚合，就可以同时获取<code>min</code>、<code>max</code>、<code>avg</code>等结果。</p>
<p>语法如下：</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line">GET /items/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">300000</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;brand_agg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;brand&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;stats_meric&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;stats&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>可以看到我们在<code>brand_agg</code>聚合的内部，我们新加了一个<code>aggs</code>参数。这个聚合就是<code>brand_agg</code>的子聚合，会对<code>brand_agg</code>形成的每个桶中的文档分别统计。</p>
<ul>
<li><code>stats_meric</code>：聚合名称<ul>
<li><code>stats</code>：聚合类型，stats是<code>metric</code>聚合的一种<ul>
<li><code>field</code>：聚合字段，这里选择<code>price</code>，统计价格</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>由于stats是对brand_agg形成的每个品牌桶内文档分别做统计，因此每个品牌都会统计出自己的价格最小、最大、平均值。</p>
<p>结果如下：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016213551120.png"
                      alt="image-20241016213551120"
                ></li>
</ul>
<p>另外，我们还可以让聚合按照每个品牌的价格平均值排序：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016213759337.png"
                      alt="image-20241016213759337"
                ></li>
</ul>
<h3 id="27-2-4-总结"><a href="#27-2-4-总结" class="headerlink" title="27.2.4 总结"></a>27.2.4 总结</h3><p>aggs代表聚合，与query同级，此时query的作用是？</p>
<ul>
<li>限定聚合的的文档范围</li>
</ul>
<p>聚合必须的三要素：</p>
<ul>
<li>聚合名称</li>
<li>聚合类型</li>
<li>聚合字段</li>
</ul>
<p>聚合可配置属性有：</p>
<ul>
<li>size：指定聚合结果数量</li>
<li>order：指定聚合结果排序方式</li>
<li>field：指定聚合字段</li>
</ul>
<h2 id="27-3-RestClient实现聚合"><a href="#27-3-RestClient实现聚合" class="headerlink" title="27.3 RestClient实现聚合"></a>27.3 RestClient实现聚合</h2><p>可以看到在DSL中，<code>aggs</code>聚合条件与<code>query</code>条件是同一级别，都属于查询JSON参数。因此依然是利用<code>request.source()</code>方法来设置。</p>
<p>不过聚合条件的要利用<code>AggregationBuilders</code>这个工具类来构造。DSL与JavaAPI的语法对比如下：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016214524757.png"
                      alt="image-20241016214524757"
                ></li>
</ul>
<p>聚合结果与搜索文档同一级别，因此需要单独获取和解析。具体解析语法如下：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241016215213421.png"
                      alt="image-20241016215213421"
                ></li>
</ul>
<p>完整代码如下：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testAgg</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.创建Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;items&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.准备请求参数</span></span><br><span class="line">    <span class="type">BoolQueryBuilder</span> <span class="variable">bool</span> <span class="operator">=</span> QueryBuilders.boolQuery()</span><br><span class="line">            .filter(QueryBuilders.termQuery(<span class="string">&quot;category&quot;</span>, <span class="string">&quot;手机&quot;</span>))</span><br><span class="line">            .filter(QueryBuilders.rangeQuery(<span class="string">&quot;price&quot;</span>).gte(<span class="number">300000</span>));</span><br><span class="line">    request.source().query(bool).size(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 3.聚合参数</span></span><br><span class="line">    request.source().aggregation(</span><br><span class="line">            AggregationBuilders.terms(<span class="string">&quot;brand_agg&quot;</span>).field(<span class="string">&quot;brand&quot;</span>).size(<span class="number">5</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 4.发送请求</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 5.解析聚合结果</span></span><br><span class="line">    <span class="type">Aggregations</span> <span class="variable">aggregations</span> <span class="operator">=</span> response.getAggregations();</span><br><span class="line">    <span class="comment">// 5.1.获取品牌聚合</span></span><br><span class="line">    <span class="type">Terms</span> <span class="variable">brandTerms</span> <span class="operator">=</span> aggregations.get(<span class="string">&quot;brand_agg&quot;</span>);</span><br><span class="line">    <span class="comment">// 5.2.获取聚合中的桶</span></span><br><span class="line">    List&lt;? <span class="keyword">extends</span> <span class="title class_">Terms</span>.Bucket&gt; buckets = brandTerms.getBuckets();</span><br><span class="line">    <span class="comment">// 5.3.遍历桶内数据</span></span><br><span class="line">    <span class="keyword">for</span> (Terms.Bucket bucket : buckets) &#123;</span><br><span class="line">        <span class="comment">// 5.4.获取桶内key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">brand</span> <span class="operator">=</span> bucket.getKeyAsString();</span><br><span class="line">        System.out.print(<span class="string">&quot;brand = &quot;</span> + brand);</span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> bucket.getDocCount();</span><br><span class="line">        System.out.println(<span class="string">&quot;; count = &quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="28-Redis主从"><a href="#28-Redis主从" class="headerlink" title="28.Redis主从"></a>28.Redis主从</h1><h2 id="28-1-主从集群结构"><a href="#28-1-主从集群结构" class="headerlink" title="28.1 主从集群结构"></a>28.1 主从集群结构</h2><ul>
<li><p>集群中有一个master节点、两个slave节点（现在叫replica）。当我们通过Redis的Java客户端访问主从集群时，应该做好路由：</p>
<ul>
<li>如果是写操作，应该访问master节点，master会自动将数据同步给两个slave节点。</li>
<li>如果是读操作，建议访问各个slave节点，从而分担并发压力。</li>
</ul>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241021165740684.png"
                      alt="image-20241021165740684"
                ></p>
</li>
</ul>
<h2 id="28-2-搭建主从集群"><a href="#28-2-搭建主从集群" class="headerlink" title="28.2 搭建主从集群"></a>28.2 搭建主从集群</h2><ul>
<li>我们会在同一个虚拟机中利用3个Docker容器来搭建主从集群，容器信息如下：</li>
</ul>
<table>
<thead>
<tr>
<th align="left"><strong>容器名</strong></th>
<th align="left"><strong>角色</strong></th>
<th align="left"><strong>IP</strong></th>
<th align="left"><strong>映射</strong>端口</th>
</tr>
</thead>
<tbody><tr>
<td align="left">r1</td>
<td align="left">master</td>
<td align="left">192.168.150.101</td>
<td align="left">7001</td>
</tr>
<tr>
<td align="left">r2</td>
<td align="left">slave</td>
<td align="left">192.168.150.101</td>
<td align="left">7002</td>
</tr>
<tr>
<td align="left">r3</td>
<td align="left">slave</td>
<td align="left">192.168.150.101</td>
<td align="left">7003</td>
</tr>
</tbody></table>
<h3 id="28-2-1-启动多个Redis实例"><a href="#28-2-1-启动多个Redis实例" class="headerlink" title="28.2.1 启动多个Redis实例"></a>28.2.1 启动多个Redis实例</h3><ul>
<li>我们利用课前资料提供的 docker-compose.yaml 文件来构建主从集群。</li>
<li>文件内容如下：</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">r1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r1</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7001&quot;</span>]</span><br><span class="line">  <span class="attr">r2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r2</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7002&quot;</span>]</span><br><span class="line">  <span class="attr">r3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r3</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7003&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<ul>
<li>将其上传至虚拟机的<code>/root/redis</code>目录下。</li>
<li>执行命令，运行集群：</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd redis</span><br><span class="line"></span><br><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure></div>

<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241021172015478.png"
                      alt="image-20241021172015478"
                ></li>
</ul>
<h3 id="28-2-2-建立集群"><a href="#28-2-2-建立集群" class="headerlink" title="28.2.2 建立集群"></a>28.2.2 建立集群</h3><ul>
<li>虽然我们启动了3个Redis实例，但是它们并没有形成主从关系。我们需要通过命令来配置主从关系：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Redis5.0以前</span></span><br><span class="line">slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line"><span class="comment"># Redis5.0以后</span></span><br><span class="line">replicaof &lt;masterip&gt; &lt;masterport&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>有临时和永久两种模式：</p>
<ul>
<li>永久生效：在redis.conf文件中利用<code>slaveof</code>命令指定<code>master</code>节点</li>
<li>临时生效：直接利用redis-cli控制台输入<code>slaveof</code>命令，指定<code>master</code>节点</li>
</ul>
</li>
<li><p>我们测试临时模式，首先连接<code>r2</code>，让其以<code>r1</code>为master</p>
</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 连接r2</span></span><br><span class="line">docker <span class="built_in">exec</span> -it r2 redis-cli -p 7002</span><br><span class="line"><span class="comment"># 认r1主，也就是7001</span></span><br><span class="line">slaveof 192.168.150.101 7001</span><br></pre></td></tr></table></figure></div>

<ul>
<li>然后连接<code>r3</code>，让其以<code>r1</code>为master</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 连接r3</span></span><br><span class="line">docker <span class="built_in">exec</span> -it r3 redis-cli -p 7003</span><br><span class="line"><span class="comment"># 认r1主，也就是7001</span></span><br><span class="line">slaveof 192.168.150.101 7001</span><br></pre></td></tr></table></figure></div>

<ul>
<li>然后连接<code>r1</code>，查看集群状态：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 连接r1</span></span><br><span class="line">docker <span class="built_in">exec</span> -it r1 redis-cli -p 7001</span><br><span class="line"><span class="comment"># 查看集群状态</span></span><br><span class="line">info replication</span><br></pre></td></tr></table></figure></div>

<ul>
<li>结果如下：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:7001&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=192.168.150.101,port=7002,state=online,offset=140,lag=1</span><br><span class="line">slave1:ip=192.168.150.101,port=7003,state=online,offset=140,lag=1</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:16d90568498908b322178ca12078114e6c518b86</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:140</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:140</span><br></pre></td></tr></table></figure></div>

<ul>
<li>可以看到，当前节点<code>r1:7001</code>的角色是<code>master</code>，有两个slave与其连接：<ul>
<li><code>slave0</code>：<code>port</code>是<code>7002</code>，也就是<code>r2</code>节点</li>
<li><code>slave1</code>：<code>port</code>是<code>7003</code>，也就是<code>r3</code>节点</li>
</ul>
</li>
</ul>
<h3 id="28-2-3-测试"><a href="#28-2-3-测试" class="headerlink" title="28.2.3 测试"></a>28.2.3 测试</h3><ul>
<li>依次在<code>r1</code>、<code>r2</code>、<code>r3</code>节点上执行下面命令：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> num 123</span><br><span class="line"></span><br><span class="line">get num</span><br></pre></td></tr></table></figure></div>

<ul>
<li>发现，只有在<code>r1</code>这个节点上可以执行<code>set</code>命令（<strong>写操作</strong>），其它两个节点只能执行<code>get</code>命令（<strong>读操作</strong>）。</li>
<li>也就是说读写操作已经分离了。</li>
</ul>
<h2 id="28-3-主从同步原理"><a href="#28-3-主从同步原理" class="headerlink" title="28.3 主从同步原理"></a>28.3 主从同步原理</h2><h3 id="28-3-1-介绍"><a href="#28-3-1-介绍" class="headerlink" title="28.3.1 介绍"></a>28.3.1 介绍</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241021174229607.png"
                      alt="image-20241021174229607"
                ></li>
</ul>
<p>简述全量同步和增量同步区别？</p>
<ul>
<li>全量同步：master将完整内存数据生成RDB，发送RDB到slave。后续命令则记录在repl_baklog，逐个发送给slave。</li>
<li>增量同步：slave提交自己的offset到master，master获取repl_baklog中从offset之后的命令给slave。</li>
</ul>
<p>什么时候执行全量同步？</p>
<ul>
<li>slave节点第一次连接master节点时</li>
<li>slave节点断开时间太久，repl_baklog中的offset已经被覆盖时</li>
</ul>
<p>什么时候执行增量同步？</p>
<ul>
<li>slave节点断开又恢复，并且在repl_baklog中能找到offset时</li>
</ul>
<h3 id="28-3-2-全量同步"><a href="#28-3-2-全量同步" class="headerlink" title="28.3.2 全量同步"></a>28.3.2 全量同步</h3><ul>
<li><p>主从第一次建立连接时，会执行<strong>全量同步</strong>，将master节点的所有数据都拷贝给slave节点，流程：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/asynccode"
                      alt="img"
                ></p>
</li>
</ul>
<p><strong>完整流程描述：</strong></p>
<ul>
<li><p><code>slave</code>节点请求增量同步</p>
</li>
<li><p><code>master</code>节点判断<code>replid</code>，发现不一致，拒绝增量同步</p>
</li>
<li><p><code>master</code>将完整内存数据生成<code>RDB</code>，发送<code>RDB</code>到<code>slave</code></p>
</li>
<li><p><code>slave</code>清空本地数据，加载<code>master</code>的<code>RDB</code></p>
</li>
<li><p><code>master</code>将<code>RDB</code>期间的命令记录在<code>repl_baklog</code>，并持续将log中的命令发送给<code>slave</code></p>
</li>
<li><p><code>slave</code>执行接收到的命令，保持与<code>master</code>之间的同步</p>
</li>
</ul>
<p><strong><code>master</code>如何得知<code>salve</code>是否是第一次来同步呢？</strong></p>
<p>有几个概念，可以作为判断依据：</p>
<ul>
<li>**<code>Replication Id</code>**：简称<code>replid</code>，是数据集的标记，replid一致则是同一数据集。每个<code>master</code>都有唯一的<code>replid</code>，<code>slave</code>则会继承<code>master</code>节点的<code>replid</code>。</li>
<li>**<code>offset</code>**：偏移量，随着记录在<code>repl_baklog</code>中的数据增多而逐渐增大。<code>slave</code>完成同步时也会记录当前同步的<code>offset</code>。如果<code>slave</code>的<code>offset</code>小于<code>master</code>的<code>offset</code>，说明<code>slave</code>数据落后于<code>master</code>，需要更新。</li>
</ul>
<p>因此<code>slave</code>做数据同步，必须向<code>master</code>声明自己的<code>replication id </code>和<code>offset</code>，<code>master</code>才可以判断到底需要同步哪些数据。</p>
<p>由于我们在执行<code>slaveof</code>命令之前，所有redis节点都是<code>master</code>，有自己的<code>replid</code>和<code>offset</code>。</p>
<p>当我们第一次执行<code>slaveof</code>命令，与<code>master</code>建立主从关系时，发送的<code>replid</code>和<code>offset</code>是自己的，与<code>master</code>肯定不一致。</p>
<p><code>master</code>判断发现<code>slave</code>发送来的<code>replid</code>与自己的不一致，说明这是一个全新的slave，就知道要做全量同步了。</p>
<p><code>master</code>会将自己的<code>replid</code>和<code>offset</code>都发送给这个<code>slave</code>，<code>slave</code>保存这些信息到本地。自此以后<code>slave</code>的<code>replid</code>就与<code>master</code>一致了。以后就是增量同步了。</p>
<h3 id="28-3-3-增量同步"><a href="#28-3-3-增量同步" class="headerlink" title="28.3.3 增量同步"></a>28.3.3 增量同步</h3><ul>
<li><p>全量同步需要先做RDB，然后将RDB文件通过网络传输个slave，成本太高了。因此除了第一次做全量同步，其它大多数时候slave与master都是做<strong>增量同步</strong>。</p>
</li>
<li><p>什么是增量同步？就是只更新slave与master存在差异的部分数据。如图：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241021202308614.png"
                      alt="image-20241021202308614"
                ></p>
</li>
</ul>
<h3 id="28-3-4-repl-baklog原理"><a href="#28-3-4-repl-baklog原理" class="headerlink" title="28.3.4 repl_baklog原理"></a>28.3.4 repl_baklog原理</h3><p><strong>master怎么知道slave与自己的数据差异在哪里呢?</strong></p>
<ul>
<li><p>这就要说到全量同步时的<code>repl_baklog</code>文件了。这个文件是一个固定大小的数组，只不过数组是环形，也就是说<strong>角标到达数组末尾后，会再次从0开始读写</strong>，这样数组头部的数据就会被覆盖。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241021203840980.png"
                      alt="image-20241021203840980"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241021203922002.png"
                      alt="image-20241021203922002"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241021204039841.png"
                      alt="image-20241021204039841"
                ></p>
</li>
<li><p>棕色框中的红色部分，就是尚未同步，但是却已经被覆盖的数据。此时如果slave恢复，需要同步，却发现自己的<code>offset</code>都没有了，无法完成增量同步了。只能做<strong>全量同步</strong>。</p>
</li>
<li><p><code>repl_baklog</code>大小有上限，写满后会覆盖最早的数据。如果slave断开时间过久，导致尚未备份的数据被覆盖，则无法基于<code>repl_baklog</code>做增量同步，只能再次全量同步。</p>
</li>
</ul>
<h2 id="28-4-主从同步优化"><a href="#28-4-主从同步优化" class="headerlink" title="28.4 主从同步优化"></a>28.4 主从同步优化</h2><p>可以从以下几个方面来优化Redis主从就集群：</p>
<ul>
<li>在master中配置<code>repl-diskless-sync  yes</code>启用无磁盘复制，避免全量同步时的磁盘IO</li>
<li>Redis单节点上的内存占用不要太大，减少RDB导致的过多磁盘IO</li>
<li>适当提高<code>repl_baklog</code>的大小，发现slave宕机时尽快实现故障恢复，尽可能避免全量同步</li>
<li>限制一个master上的slave节点数量，如果实在是太多slave，则可以采用<code>主-从-从</code>链式结构，减少master压力</li>
</ul>
<h1 id="29-Redis哨兵"><a href="#29-Redis哨兵" class="headerlink" title="29.Redis哨兵"></a>29.Redis哨兵</h1><h2 id="29-1-哨兵工作原理"><a href="#29-1-哨兵工作原理" class="headerlink" title="29.1 哨兵工作原理"></a>29.1 哨兵工作原理</h2><h3 id="29-1-1-哨兵作用"><a href="#29-1-1-哨兵作用" class="headerlink" title="29.1.1 哨兵作用"></a>29.1.1 哨兵作用</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241021205942229.png"
                      alt="image-20241021205942229"
                ></li>
</ul>
<h3 id="29-1-2-状态监控"><a href="#29-1-2-状态监控" class="headerlink" title="29.1.2 状态监控"></a>29.1.2 状态监控</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241021210433943.png"
                      alt="image-20241021210433943"
                ></li>
</ul>
<h3 id="29-1-3-选举新的master"><a href="#29-1-3-选举新的master" class="headerlink" title="29.1.3 选举新的master"></a>29.1.3 选举新的master</h3><p>一旦发现master故障，sentinel需要在salve中选择一个作为新的master，选择依据是这样的：</p>
<ul>
<li>首先会判断slave节点与master节点断开时间长短，如果超过<code>down-after-milliseconds * 10</code>则会排除该slave节点。</li>
<li>然后判断slave节点的<code>slave-priority</code>值，越小优先级越高，如果是0则永不参与选举（默认都是1）。</li>
<li>如果<code>slave-prority</code>一样，则判断slave节点的<code>offset</code>值，越大说明数据越新，优先级越高。</li>
<li>最后是判断slave节点的<code>run_id</code>大小，越小优先级越高（<code>通过info server可以查看run_id</code>）。</li>
</ul>
<p><strong>实现故障转移：</strong></p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241021210847031.png"
                      alt="image-20241021210847031"
                ></li>
</ul>
<h2 id="29-2-搭建哨兵集群"><a href="#29-2-搭建哨兵集群" class="headerlink" title="29.2 搭建哨兵集群"></a>29.2 搭建哨兵集群</h2><ul>
<li>1、首先，我们停掉之前的redis集群：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 老版本DockerCompose</span></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新版本Docker</span></span><br><span class="line">docker compose down</span><br></pre></td></tr></table></figure></div>

<ul>
<li>2、然后，我们找到课前资料提供的 sentinel.conf 文件。</li>
<li>其内容如下：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">sentinel announce-ip <span class="string">&quot;192.168.150.101&quot;</span>   </span><br><span class="line">sentinel monitor hmaster 192.168.150.101 7001 2</span><br><span class="line">sentinel down-after-milliseconds hmaster 5000</span><br><span class="line">sentinel failover-timeout hmaster 60000</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>说明：</p>
<ul>
<li><code>sentinel announce-ip &quot;192.168.150.101&quot;</code>：声明当前sentinel的ip</li>
<li><code>sentinel monitor hmaster 192.168.150.101 7001 2</code>：指定集群的主节点信息 <ul>
<li><code>hmaster</code>：主节点名称，自定义，任意写</li>
<li><code>192.168.150.101 7001</code>：主节点的ip和端口</li>
<li><code>2</code>：认定<code>master</code>下线时的<code>quorum</code>值</li>
</ul>
</li>
<li><code>sentinel down-after-milliseconds hmaster 5000</code>：声明master节点超时多久后被标记下线</li>
<li><code>sentinel failover-timeout hmaster 60000</code>：在第一次故障转移失败后多久再次重试</li>
</ul>
</li>
<li><p>3、我们在虚拟机的<code>/root/redis</code>目录下新建3个文件夹：<code>s1</code>、<code>s2</code>、<code>s3</code>:</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241023175622512.png"
                      alt="image-20241023175622512"
                ></p>
</li>
<li><p>4、将课前资料提供的<code>sentinel.conf</code>文件分别拷贝一份到3个文件夹中。</p>
</li>
<li><p>5、接着修改<code>docker-compose.yaml</code>文件，内容如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">r1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r1</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7001&quot;</span>]</span><br><span class="line">  <span class="attr">r2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r2</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7002&quot;</span>, <span class="string">&quot;--slaveof&quot;</span>, <span class="string">&quot;192.168.150.101&quot;</span>, <span class="string">&quot;7001&quot;</span>]</span><br><span class="line">  <span class="attr">r3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r3</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7003&quot;</span>, <span class="string">&quot;--slaveof&quot;</span>, <span class="string">&quot;192.168.150.101&quot;</span>, <span class="string">&quot;7001&quot;</span>]</span><br><span class="line">  <span class="attr">s1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">s1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/redis/s1:/etc/redis</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-sentinel&quot;</span>, <span class="string">&quot;/etc/redis/sentinel.conf&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;27001&quot;</span>]</span><br><span class="line">  <span class="attr">s2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">s2</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/redis/s2:/etc/redis</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-sentinel&quot;</span>, <span class="string">&quot;/etc/redis/sentinel.conf&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;27002&quot;</span>]</span><br><span class="line">  <span class="attr">s3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">s3</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/redis/s3:/etc/redis</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-sentinel&quot;</span>, <span class="string">&quot;/etc/redis/sentinel.conf&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;27003&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<ul>
<li>6、直接运行命令，启动集群：</li>
</ul>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir s1 s2 s3 #创建 s1 s2 s3</span><br><span class="line"></span><br><span class="line">cp s1/sentinel.conf s2</span><br><span class="line">cp s1/sentinel.conf s3</span><br><span class="line"></span><br><span class="line">docker-compose up -d #启动集群</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>7、运行结果：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241023180627036.png"
                      alt="image-20241023180627036"
                ></p>
</li>
</ul>
<h2 id="29-3-演示failover"><a href="#29-3-演示failover" class="headerlink" title="29.3 演示failover"></a>29.3 演示failover</h2><ul>
<li>我们演示一下当主节点故障时，哨兵是如何完成集群故障恢复（failover）的。</li>
<li>我们连接<code>7001</code>这个<code>master</code>节点，然后通过命令让其休眠60秒，模拟宕机：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 连接7001这个master节点，通过sleep模拟服务宕机，60秒后自动恢复</span></span><br><span class="line">docker <span class="built_in">exec</span> -it r1 redis-cli -p 7001 DEBUG <span class="built_in">sleep</span> 60</span><br></pre></td></tr></table></figure></div>

<ul>
<li>稍微等待一段时间后，会发现sentinel节点触发了<code>failover</code>：</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241023181852878.png"
                      alt="image-20241023181852878"
                ></li>
</ul>
<h1 id="30-Redis分片集群"><a href="#30-Redis分片集群" class="headerlink" title="30.Redis分片集群"></a>30.Redis分片集群</h1><h2 id="30-1-介绍"><a href="#30-1-介绍" class="headerlink" title="30.1 介绍"></a>30.1 介绍</h2><p>主从模式可以解决高可用、高并发读的问题。但依然有两个问题没有解决：</p>
<ul>
<li>海量数据存储</li>
<li>高并发写</li>
</ul>
<p>要解决这两个问题就需要用到分片集群了。</p>
<p>分片的意思，就是把数据拆分存储到不同节点，这样整个集群的存储数据量就更大了。</p>
<p>Redis分片集群的结构如图：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241023193102518.png"
                      alt="image-20241023193102518"
                ></li>
</ul>
<p>分片集群特征：</p>
<ul>
<li>集群中有多个master，每个master保存不同分片数据 ，解决海量数据存储问题</li>
<li>每个master都可以有多个slave节点 ，确保高可用</li>
<li>master之间通过ping监测彼此健康状态 ，类似哨兵作用</li>
<li>客户端请求可以访问集群任意节点，最终都会被转发到数据所在节点</li>
</ul>
<h2 id="30-2-搭建分片集群"><a href="#30-2-搭建分片集群" class="headerlink" title="30.2 搭建分片集群"></a>30.2 搭建分片集群</h2><ul>
<li><p>Redis分片集群最少也需要3个master节点，由于我们的机器性能有限，我们只给每个master配置1个slave，形成最小的分片集群：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241023194915981.png"
                      alt="image-20241023194915981"
                ></p>
</li>
<li><p>计划部署的节点信息如下：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left"><strong>容器名</strong></th>
<th align="left"><strong>角色</strong></th>
<th align="left"><strong>IP</strong></th>
<th align="left"><strong>映射</strong>端口</th>
</tr>
</thead>
<tbody><tr>
<td align="left">r1</td>
<td align="left">master</td>
<td align="left">192.168.150.101</td>
<td align="left">7001</td>
</tr>
<tr>
<td align="left">r2</td>
<td align="left">master</td>
<td align="left">192.168.150.101</td>
<td align="left">7002</td>
</tr>
<tr>
<td align="left">r3</td>
<td align="left">master</td>
<td align="left">192.168.150.101</td>
<td align="left">7003</td>
</tr>
<tr>
<td align="left">r4</td>
<td align="left">slave</td>
<td align="left">192.168.150.101</td>
<td align="left">7004</td>
</tr>
<tr>
<td align="left">r5</td>
<td align="left">slave</td>
<td align="left">192.168.150.101</td>
<td align="left">7005</td>
</tr>
<tr>
<td align="left">r6</td>
<td align="left">slave</td>
<td align="left">192.168.150.101</td>
<td align="left">7006</td>
</tr>
</tbody></table>
<h3 id="30-2-1-集群配置"><a href="#30-2-1-集群配置" class="headerlink" title="30.2.1 集群配置"></a>30.2.1 集群配置</h3><ul>
<li>分片集群中的Redis节点必须开启集群模式，一般在配置文件中添加下面参数：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">port 7000</span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>其中有3个我们没见过的参数：</p>
<ul>
<li><code>cluster-enabled</code>：是否开启集群模式</li>
<li><code>cluster-config-file</code>：集群模式的配置文件名称，无需手动创建，由集群自动维护</li>
<li><code>cluster-node-timeout</code>：集群中节点之间心跳超时时间</li>
</ul>
</li>
<li><p>在虚拟机的<code>/root</code>目录下新建一个<code>redis-cluster</code>目录，然后在其中新建一个<code>docker-compose.yaml</code>文件，内容如下：</p>
</li>
<li><p><strong>注意</strong>：使用Docker部署Redis集群，network模式必须采用host</p>
</li>
</ul>
<div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">r1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r1</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7001&quot;</span>, <span class="string">&quot;--cluster-enabled&quot;</span>, <span class="string">&quot;yes&quot;</span>, <span class="string">&quot;--cluster-config-file&quot;</span>, <span class="string">&quot;node.conf&quot;</span>]</span><br><span class="line">  <span class="attr">r2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r2</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7002&quot;</span>, <span class="string">&quot;--cluster-enabled&quot;</span>, <span class="string">&quot;yes&quot;</span>, <span class="string">&quot;--cluster-config-file&quot;</span>, <span class="string">&quot;node.conf&quot;</span>]</span><br><span class="line">  <span class="attr">r3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r3</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7003&quot;</span>, <span class="string">&quot;--cluster-enabled&quot;</span>, <span class="string">&quot;yes&quot;</span>, <span class="string">&quot;--cluster-config-file&quot;</span>, <span class="string">&quot;node.conf&quot;</span>]</span><br><span class="line">  <span class="attr">r4:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r4</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7004&quot;</span>, <span class="string">&quot;--cluster-enabled&quot;</span>, <span class="string">&quot;yes&quot;</span>, <span class="string">&quot;--cluster-config-file&quot;</span>, <span class="string">&quot;node.conf&quot;</span>]</span><br><span class="line">  <span class="attr">r5:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r5</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7005&quot;</span>, <span class="string">&quot;--cluster-enabled&quot;</span>, <span class="string">&quot;yes&quot;</span>, <span class="string">&quot;--cluster-config-file&quot;</span>, <span class="string">&quot;node.conf&quot;</span>]</span><br><span class="line">  <span class="attr">r6:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r6</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7006&quot;</span>, <span class="string">&quot;--cluster-enabled&quot;</span>, <span class="string">&quot;yes&quot;</span>, <span class="string">&quot;--cluster-config-file&quot;</span>, <span class="string">&quot;node.conf&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<h3 id="30-2-2-启动集群"><a href="#30-2-2-启动集群" class="headerlink" title="30.2.2 启动集群"></a>30.2.2 启动集群</h3><ul>
<li>进入<code>/root/redis-cluster</code>目录，使用命令启动redis：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> redis-cluster</span><br><span class="line"></span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure></div>

<ul>
<li>启动成功，可以通过命令查看启动进程：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | grep redis</span><br><span class="line"><span class="comment"># 结果：</span></span><br><span class="line">root       4822   4743  0 14:29 ?        00:00:02 redis-server *:7002 [cluster]</span><br><span class="line">root       4827   4745  0 14:29 ?        00:00:01 redis-server *:7005 [cluster]</span><br><span class="line">root       4897   4778  0 14:29 ?        00:00:01 redis-server *:7004 [cluster]</span><br><span class="line">root       4903   4759  0 14:29 ?        00:00:01 redis-server *:7006 [cluster]</span><br><span class="line">root       4905   4775  0 14:29 ?        00:00:02 redis-server *:7001 [cluster]</span><br><span class="line">root       4912   4732  0 14:29 ?        00:00:01 redis-server *:7003 [cluster]</span><br></pre></td></tr></table></figure></div>

<ul>
<li>可以发现每个redis节点都以cluster模式运行。不过节点与节点之间并未建立连接。</li>
<li>接下来，我们使用命令创建集群：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入任意节点容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it r1 bash</span><br><span class="line"><span class="comment"># 然后，执行命令</span></span><br><span class="line">redis-cli --cluster create --cluster-replicas 1 \</span><br><span class="line">192.168.150.101:7001 192.168.150.101:7002 192.168.150.101:7003 \</span><br><span class="line">192.168.150.101:7004 192.168.150.101:7005 192.168.150.101:7006</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>命令说明：</p>
<ul>
<li><code>redis-cli --cluster</code>：代表集群操作命令</li>
<li><code>create</code>：代表是创建集群</li>
<li><code>--cluster-replicas 1</code> ：指定集群中每个<code>master</code>的副本个数为1<ul>
<li>此时<code>节点总数 ÷ (replicas + 1)</code> 得到的就是<code>master</code>的数量<code>n</code>。因此节点列表中的前<code>n</code>个节点就是<code>master</code>，其它节点都是<code>slave</code>节点，随机分配到不同<code>master</code></li>
</ul>
</li>
</ul>
</li>
<li><p>输入命令后控制台会弹出下面的信息：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241023201523484.png"
                      alt="image-20241023201523484"
                ></p>
</li>
<li><p>这里展示了集群中<code>master</code>与<code>slave</code>节点分配情况，并询问你是否同意。节点信息如下：</p>
<ul>
<li><code>7001</code>是<code>master</code>，节点<code>id</code>后6位是<code>da134f</code></li>
<li><code>7002</code>是<code>master</code>，节点<code>id</code>后6位是<code>862fa0</code></li>
<li><code>7003</code>是<code>master</code>，节点<code>id</code>后6位是<code>ad5083</code></li>
<li><code>7004</code>是<code>slave</code>，节点<code>id</code>后6位是<code>391f8b</code>，认<code>ad5083</code>（7003）为<code>master</code></li>
<li><code>7005</code>是<code>slave</code>，节点<code>id</code>后6位是<code>e152cd</code>，认<code>da134f</code>（7001）为<code>master</code></li>
<li><code>7006</code>是<code>slave</code>，节点<code>id</code>后6位是<code>4a018a</code>，认<code>862fa0</code>（7002）为<code>master</code></li>
</ul>
</li>
<li><p>输入<code>yes</code>然后回车。会发现集群开始创建，并输出下列信息：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241023201834028.png"
                      alt="image-20241023201834028"
                ></p>
</li>
<li><p>接着，我们可以通过命令查看集群状态：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">redis-cli -p 7001 cluster nodes</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>结果：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241023202107177.png"
                      alt="image-20241023202107177"
                ></p>
</li>
</ul>
<h2 id="30-3-散列插槽"><a href="#30-3-散列插槽" class="headerlink" title="30.3 散列插槽"></a>30.3 散列插槽</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241023205307877.png"
                      alt="image-20241023205307877"
                ></p>
</li>
<li><p>测试一下，先于<code>7001</code>建立连接：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 进入容器</span><br><span class="line">docker exec -it r1 bash</span><br><span class="line"># 进入redis-cli</span><br><span class="line">redis-cli -p 7001</span><br><span class="line"># 测试</span><br><span class="line">set user jack</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>会发现报错了。提示我们<code>MOVED 5474</code>，其实就是经过计算，得出<code>user</code>这个<code>key</code>的<code>hash slot</code> 是<code>5474</code>，而<code>5474</code>是在<code>7002</code>节点，不能在<code>7001</code>上写入！！</p>
</li>
<li><p>这是因为我们连接的方式有问题，连接集群时，要加<code>-c</code>参数：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 通过7001连接集群</span><br><span class="line">redis-cli -c -p 7001</span><br><span class="line"># 存入数据</span><br><span class="line">set user jack</span><br></pre></td></tr></table></figure></div>

<ul>
<li>可以看到，客户端自动跳转到了<code>5474</code>这个<code>slot</code>所在的<code>7002</code>节点。</li>
</ul>
<h1 id="31-Redis数据结构"><a href="#31-Redis数据结构" class="headerlink" title="31.Redis数据结构"></a>31.Redis数据结构</h1><p>我们常用的Redis数据类型有5种，分别是：</p>
<ul>
<li>String</li>
<li>List</li>
<li>Set</li>
<li>SortedSet</li>
<li>Hash</li>
</ul>
<p>还有一些高级数据类型，比如Bitmap、HyperLogLog、GEO等，其底层都是基于上述5种基本数据类型。因此在Redis的源码中，其实只有5种数据类型。</p>
<h2 id="31-1-RedisObject"><a href="#31-1-RedisObject" class="headerlink" title="31.1 RedisObject"></a>31.1 RedisObject</h2><ul>
<li><p>不管是任何一种数据类型，最终都会封装为RedisObject格式，它是一种结构体，C语言中的一种结构，可以理解为Java中的类。</p>
</li>
<li><p>结构大概是这样的：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241024163720278.png"
                      alt="image-20241024163720278"
                ></p>
</li>
<li><p>可以看到整个结构体中并不包含真实的数据，仅仅是对象头信息，内存占用的大小为4+4+24+32+64 &#x3D; 128bit</p>
<p>也就是16字节，然后指针<code>ptr</code>指针指向的才是真实数据存储的内存地址。所以RedisObject的内存开销是很大的。</p>
</li>
<li><p>属性中的<code>encoding</code>就是当前对象底层采用的<strong>数据结构</strong>或<strong>编码方式</strong>，可选的有12种之多：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left"><strong>编号</strong></th>
<th align="left"><strong>编码方式</strong></th>
<th align="left"><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">OBJ_ENCODING_RAW</td>
<td align="left">raw编码动态字符串</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">OBJ_ENCODING_INT</td>
<td align="left">long类型的整数的字符串</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">OBJ_ENCODING_HT</td>
<td align="left">hash表（也叫dict）</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">OBJ_ENCODING_ZIPMAP</td>
<td align="left">已废弃</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">OBJ_ENCODING_LINKEDLIST</td>
<td align="left">双端链表</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">OBJ_ENCODING_ZIPLIST</td>
<td align="left">压缩列表</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">OBJ_ENCODING_INTSET</td>
<td align="left">整数集合</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">OBJ_ENCODING_SKIPLIST</td>
<td align="left">跳表</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">OBJ_ENCODING_EMBSTR</td>
<td align="left">embstr编码的动态字符串</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">OBJ_ENCODING_QUICKLIST</td>
<td align="left">快速列表</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">OBJ_ENCODING_STREAM</td>
<td align="left">Stream流</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">OBJ_ENCODING_LISTPACK</td>
<td align="left">紧凑列表</td>
</tr>
</tbody></table>
<ul>
<li>Redis中的5种不同的数据类型采用的底层数据结构和编码方式如下：</li>
</ul>
<table>
<thead>
<tr>
<th align="left"><strong>数据类型</strong></th>
<th align="left"><strong>编码方式</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">STRING</td>
<td align="left"><code>int</code>、<code>embstr</code>、<code>raw</code></td>
</tr>
<tr>
<td align="left">LIST</td>
<td align="left"><code>LinkedList和ZipList</code>(3.2以前)、<code>QuickList</code>（3.2以后）</td>
</tr>
<tr>
<td align="left">SET</td>
<td align="left"><code>intset</code>、<code>HT</code></td>
</tr>
<tr>
<td align="left">ZSET</td>
<td align="left"><code>ZipList</code>（7.0以前）、<code>Listpack</code>（7.0以后）、<code>HT</code>、<code>SkipList</code></td>
</tr>
<tr>
<td align="left">HASH</td>
<td align="left"><code>ZipList</code>（7.0以前）、<code>Listpack</code>（7.0以后）、<code>HT</code></td>
</tr>
</tbody></table>
<h2 id="31-2-SkipList"><a href="#31-2-SkipList" class="headerlink" title="31.2 SkipList"></a>31.2 SkipList</h2><ul>
<li><p>SkipList（跳表）首先是链表，但与传统链表相比有几点差异：</p>
<ul>
<li>元素按照升序排列存储</li>
<li>节点可能包含多个指针，指针跨度不同。</li>
</ul>
</li>
<li><p><strong>重点：</strong></p>
<ul>
<li>传统链表只有指向前后元素的指针，因此只能顺序依次访问。如果查找的元素在链表中间，查询的效率会比较低。</li>
<li>而SkipList则不同，它内部包含跨度不同的多级指针，可以让我们跳跃查找链表中间的元素，效率非常高。</li>
</ul>
</li>
<li><p>其结构如图：</p>
<ul>
<li>可以看到1号元素就有指向3、5、10的多个指针，查询时就可以跳跃查找。例如要找大小为14的元素，查找的流程是这样的：</li>
</ul>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241024170559402.png"
                      alt="image-20241024170559402"
                ></p>
<ul>
<li>首先找元素1节点最高级指针，也就是4级指针，起始元素大小为1，指针跨度为9，可以判断出目标元素大小为10。由于14比10大，肯定要从10这个元素向下接着找。</li>
<li>找到10这个元素，发现10这个元素的最高级指针跨度为5，判断出目标元素大小为15，大于14，需要判断下级指针。</li>
<li>10这个元素的2级指针跨度为3，判断出目标元素为13，小于14，因此要基于元素13接着找。</li>
<li>13这个元素最高级级指针跨度为2，判断出目标元素为15，比14大，需要判断下级指针。</li>
<li>13的下级指针跨度为1，因此目标元素是14，刚好于目标一致，找到。</li>
</ul>
</li>
<li><p>这种多级指针的查询方式就避免了传统链表的逐个遍历导致的查询效率下降问题。在对有序数据做随机查询和排序时效率非常高。</p>
</li>
<li><p><strong>特点：</strong></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241024172009501.png"
                      alt="image-20241024172009501"
                ></p>
</li>
<li><p>跳表的结构体如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplist</span> &#123;</span></span><br><span class="line">    <span class="comment">// 头尾节点指针</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">header</span>, *<span class="title">tail</span>;</span></span><br><span class="line">    <span class="comment">// 节点数量</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> length;</span><br><span class="line">    <span class="comment">// 最大的索引层级</span></span><br><span class="line">    <span class="type">int</span> level;</span><br><span class="line">&#125; zskiplist;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>可以看到SkipList主要属性是header和tail，也就是头尾指针，因此它是支持双向遍历的。</p>
</li>
<li><p>跳表中节点的结构体如下：</p>
</li>
</ul>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> &#123;</span></span><br><span class="line">    sds ele; <span class="comment">// 节点存储的字符串</span></span><br><span class="line">    <span class="type">double</span> score;<span class="comment">// 节点分数，排序、查找用</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">backward</span>;</span> <span class="comment">// 前一个节点指针</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistLevel</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">forward</span>;</span> <span class="comment">// 下一个节点指针</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> span; <span class="comment">// 索引跨度</span></span><br><span class="line">    &#125; level[]; <span class="comment">// 多级索引数组</span></span><br><span class="line">&#125; zskiplistNode;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>每个节点中都包含ele和score两个属性，其中score是得分，也就是节点排序的依据。ele则是节点存储的字符串数据指针。</p>
</li>
<li><p>其内存结构如下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241024171802835.png"
                      alt="image-20241024171802835"
                ></p>
</li>
</ul>
<h2 id="31-3-SortedSet"><a href="#31-3-SortedSet" class="headerlink" title="31.3 SortedSet"></a>31.3 SortedSet</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241024174240388.png"
                      alt="image-20241024174240388"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241024174208565.png"
                      alt="image-20241024174208565"
                ></p>
</li>
</ul>
<p><strong>面试题</strong>：</p>
<p>Redis的<code>SortedSet</code>底层的数据结构是怎样的？</p>
<p><strong>答</strong>：</p>
<p>SortedSet是有序集合，底层的存储的每个数据都包含element和score两个值。score是得分，element则是字符串值。SortedSet会根据每个element的score值排序，形成有序集合。</p>
<p>它支持的操作很多，比如：</p>
<ul>
<li>根据element查询score值</li>
<li>按照score值升序或降序查询element</li>
</ul>
<p>要实现根据element查询对应的score值，就必须实现element与score之间的键值映射。SortedSet底层是基于<strong>HashTable</strong>来实现的。</p>
<p>要实现对score值排序，并且查询效率还高，就需要有一种高效的有序数据结构，SortedSet是基于<strong>跳表</strong>实现的。</p>
<p>加分项：因为SortedSet底层需要用到两种数据结构，对内存占用比较高。因此Redis底层会对SortedSet中的元素大小做判断。如果<strong>元素大小小于128</strong>且<strong>每个元素都小于64字节</strong>，SortedSet底层会采用<strong>ZipList</strong>，也就是<strong>压缩列</strong>表来代替<strong>HashTable</strong>和<strong>SkipList</strong>。</p>
<p>不过，<code>ZipList</code>存在连锁更新问题，因此而在Redis7.0版本以后，<code>ZipList</code>又被替换为<strong>Listpack</strong>（紧凑列表）。</p>
<h1 id="32-Redis内存回收"><a href="#32-Redis内存回收" class="headerlink" title="32.Redis内存回收"></a>32.Redis内存回收</h1><h2 id="32-1-内存过期处理"><a href="#32-1-内存过期处理" class="headerlink" title="32.1 内存过期处理"></a>32.1 内存过期处理</h2><h3 id="32-1-1-过期命令"><a href="#32-1-1-过期命令" class="headerlink" title="32.1.1 过期命令"></a>32.1.1 过期命令</h3><ul>
<li>Redis中通过<code>expire</code>命令可以给KEY设置<code>TTL</code>（过期时间），例如：</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 写入一条数据</span></span><br><span class="line"><span class="built_in">set</span> num 123</span><br><span class="line"><span class="comment"># 设置20秒过期时间</span></span><br><span class="line">expire num 20</span><br></pre></td></tr></table></figure></div>

<ul>
<li>不过set命令本身也可以支持过期时间的设置：</li>
</ul>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入一条数据并设置20s过期时间</span></span><br><span class="line">set num EX 20</span><br></pre></td></tr></table></figure></div>

<ul>
<li>当过期时间到了以后，再去查询数据，会发现数据已经不存在。</li>
</ul>
<h3 id="32-1-2-过期策略"><a href="#32-1-2-过期策略" class="headerlink" title="32.1.2 过期策略"></a>32.1.2 过期策略</h3><p><strong>Redis如何判断KEY是否过期呢？</strong></p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241024204808890.png"
                      alt="image-20241024204808890"
                ></li>
</ul>
<p><strong>Redis是何时删除过期KEY的呢？</strong></p>
<ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241024205821882.png"
                      alt="image-20241024205821882"
                ></p>
</li>
<li><p><strong>SLOW</strong>模式规则：</p>
<ul>
<li>① 执行频率受<code>server.hz</code>影响，默认为10，即每秒执行10次，每个执行周期100ms。</li>
<li>② 执行清理耗时不超过一次执行周期的25%，即25ms.</li>
<li>③ 逐个遍历db，逐个遍历db中的bucket，抽取20个key判断是否过期</li>
<li>④ 如果没达到时间上限（25ms）并且过期key比例大于10%，再进行一次抽样，否则结束</li>
</ul>
</li>
<li><p><strong>FAST</strong>模式规则（过期key比例小于10%不执行）：</p>
<ul>
<li>① 执行频率受<code>beforeSleep()</code>调用频率影响，但两次FAST模式间隔不低于2ms</li>
<li>② 执行清理耗时不超过1ms</li>
<li>③ 逐个遍历db，逐个遍历db中的bucket，抽取20个key判断是否过期</li>
<li>④ 如果没达到时间上限（1ms）并且过期key比例大于10%，再进行一次抽样，否则结束</li>
</ul>
</li>
</ul>
<h2 id="32-2-内存淘汰策略"><a href="#32-2-内存淘汰策略" class="headerlink" title="32.2 内存淘汰策略"></a>32.2 内存淘汰策略</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241024212348926.png"
                      alt="image-20241024212348926"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241024212330661.png"
                      alt="image-20241024212330661"
                ></p>
</li>
</ul>
<h2 id="32-3-总结"><a href="#32-3-总结" class="headerlink" title="32.3 总结"></a>32.3 总结</h2><p><strong>面试题</strong>：</p>
<p><strong>Redis如何判断KEY是否过期呢？</strong></p>
<p><strong>答</strong>：</p>
<p>在Redis中会有两个Dict，也就是HashTable，其中一个记录KEY-VALUE键值对，另一个记录KEY和过期时间。要判断一个KEY是否过期，只需要到记录过期时间的Dict中根据KEY查询即可。</p>
<p><strong>面试题</strong>：</p>
<p><strong>Redis何时删除过期KEY？如何删除？</strong></p>
<p><strong>答</strong>：</p>
<p>Redis的过期KEY处理有两种策略，分别是惰性删除和周期删除。</p>
<p><strong>惰性删除</strong>是指在每次用户访问某个KEY时，判断KEY的过期时间：如果过期则删除；如果未过期则忽略。</p>
<p><strong>周期删除</strong>有两种模式：</p>
<ul>
<li><strong>SLOW</strong>模式：通过一个定时任务，定期的抽样部分带有TTL的KEY，判断其是否过期。默认情况下定时任务的执行频率是每秒10次，但每次执行不能超过25毫秒。如果执行抽样后发现时间还有剩余，并且过期KEY的比例较高，则会多次抽样。</li>
<li><strong>FAST</strong>模式：在Redis每次处理NIO事件之前，都会抽样部分带有TTL的KEY，判断是否过期，因此执行频率较高。但是每次执行时长不能超过1ms，如果时间充足并且过期KEY比例过高，也会多次抽样</li>
</ul>
<p><strong>面试题</strong>：</p>
<p><strong>当Redis内存不足时会怎么做</strong>？</p>
<p><strong>答</strong>：</p>
<p>这取决于配置的内存淘汰策略，Redis支持很多种内存淘汰策略，例如LRU、LFU、Random. 但默认的策略是直接拒绝新的写入请求。而如果设置了其它策略，则会在每次执行命令后判断占用内存是否达到阈值。如果达到阈值则会基于配置的淘汰策略尝试进行内存淘汰，直到占用内存小于阈值为止。</p>
<p><strong>面试题</strong>：</p>
<p><strong>那你能聊聊LRU和LFU吗</strong>？</p>
<p><strong>答</strong>：</p>
<p><code>LRU</code>是最近最久未使用。Redis的Key都是RedisObject，当启用LRU算法后，Redis会在Key的头信息中使用24个bit记录每个key的最近一次使用的时间<code>lru</code>。每次需要内存淘汰时，就会抽样一部分KEY，找出其中空闲时间最长的，也就是<code>now - lru</code>结果最大的，然后将其删除。如果内存依然不足，就重复这个过程。</p>
<p>由于采用了抽样来计算，这种算法只能说是一种近似LRU算法。因此在Redis4.0以后又引入了<code>LFU</code>算法，这种算法是统计最近最少使用，也就是按key的访问频率来统计。当启用LFU算法后，Redis会在key的头信息中使用24bit记录最近一次使用时间和逻辑访问频率。其中高16位是以分钟为单位的最近访问时间，后8位是逻辑访问次数。与LFU类似，每次需要内存淘汰时，就会抽样一部分KEY，找出其中逻辑访问次数最小的，将其淘汰。</p>
<p><strong>面试题</strong>：</p>
<p><strong>逻辑访问次数是如何计算的</strong>？</p>
<p><strong>答</strong>：</p>
<p>由于记录访问次数的只有<code>8bit</code>，即便是无符号数，最大值只有255，不可能记录真实的访问次数。因此Redis统计的其实是逻辑访问次数。这其中有一个计算公式，会根据当前的访问次数做计算，结果要么是次数<code>+1</code>，要么是次数不变。但随着当前访问次数越大，<code>+1</code>的概率也会越低，并且最大值不超过255.</p>
<p>除此以外，逻辑访问次数还有一个衰减周期，默认为1分钟，即每隔1分钟逻辑访问次数会<code>-1</code>。这样逻辑访问次数就能基本反映出一个<code>key</code>的访问热度了。</p>
<h1 id="33-缓存问题"><a href="#33-缓存问题" class="headerlink" title="33.缓存问题"></a>33.缓存问题</h1><h2 id="33-1-缓存一致性"><a href="#33-1-缓存一致性" class="headerlink" title="33.1 缓存一致性"></a>33.1 缓存一致性</h2><h3 id="33-1-1-缓存模型"><a href="#33-1-1-缓存模型" class="headerlink" title="33.1.1 缓存模型"></a>33.1.1 缓存模型</h3><p>我们先看下目前企业用的最多的缓存模型。缓存的通用模型有三种：</p>
<ul>
<li><code>Cache Aside</code>：有缓存调用者自己维护数据库与缓存的一致性。即：<ul>
<li>查询时：命中则直接返回，未命中则查询数据库并写入缓存</li>
<li>更新时：更新数据库并删除缓存，查询时自然会更新缓存</li>
</ul>
</li>
<li><code>Read/Write Through</code>：数据库自己维护一份缓存，底层实现对调用者透明。底层实现：<ul>
<li>查询时：命中则直接返回，未命中则查询数据库并写入缓存</li>
<li>更新时：判断缓存是否存在，不存在直接更新数据库。存在则更新缓存，同步更新数据库</li>
</ul>
</li>
<li><code>Write Behind Cahing</code>：读写操作都直接操作缓存，由线程异步的将缓存数据同步到数据库。</li>
</ul>
<p>目前企业中使用最多的就是<code>Cache Aside</code>模式，因为实现起来非常简单。但缺点也很明显，就是无法保证数据库与缓存的强一致性。</p>
<h3 id="33-1-2-两种更新策略"><a href="#33-1-2-两种更新策略" class="headerlink" title="33.1.2 两种更新策略"></a>33.1.2 两种更新策略</h3><p><code>Cache Aside</code>的写操作是要在更新数据库的同时删除缓存，那为什么不选择更新数据库的同时更新缓存，而是删除呢？</p>
<p>原因很简单，假如一段时间内无人查询，但是有多次更新，那这些更新都属于无效更新。采用删除方案也就是延迟更新，什么时候有人查询了，什么时候更新。</p>
<ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241026200204972.png"
                      alt="image-20241026200204972"
                ></p>
</li>
<li><p>先更新数据库再删除缓存（<strong>不推荐</strong>）</p>
</li>
<li><p><strong>正常情况</strong></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241026192830817.png"
                      alt="image-20241026192830817"
                ></p>
</li>
<li><p><strong>异常情况</strong></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241026192949107.png"
                      alt="image-20241026192949107"
                ></p>
</li>
<li><p>异常情况说明：</p>
<ul>
<li>线程1删除缓存后，还没来得及更新数据库，</li>
<li>此时线程2来查询，发现缓存未命中，于是查询数据库，写入缓存。由于此时数据库尚未更新，查询的是旧数据。也就是说刚才的删除白删了，缓存又变成旧数据了。</li>
<li>然后线程1更新数据库，此时数据库是新数据，缓存是旧数据</li>
</ul>
</li>
<li><p>由于更新数据库的操作本身比较耗时，在期间有线程来查询数据库并更新缓存的概率非常高。因此不推荐这种方案。</p>
</li>
<li><p>先更新数据库再删除缓存（<strong>推荐</strong>）</p>
</li>
<li><p><strong>正常情况</strong></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241026193302879.png"
                      alt="image-20241026193302879"
                ></p>
</li>
<li><p><strong>异常情况</strong></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241026193414709.png"
                      alt="image-20241026193414709"
                ></p>
</li>
<li><p>异常情况说明：</p>
<ul>
<li>线程1查询缓存未命中，于是去查询数据库，查询到旧数据</li>
<li>线程1将数据写入缓存之前，线程2来了，更新数据库，删除缓存</li>
<li>线程1执行写入缓存的操作，写入旧数据</li>
</ul>
</li>
<li><p>可以发现，异常状态发生的概率极为苛刻，线程1必须是查询数据库已经完成，但是缓存尚未写入之前。线程2要完成更新数据库同时删除缓存的两个操作。要知道线程1执行写缓存的速度在毫秒之间，速度非常快，在这么短的时间要完成数据库和缓存的操作，概率非常之低。</p>
</li>
</ul>
<h3 id="33-1-3-总结"><a href="#33-1-3-总结" class="headerlink" title="33.1.3 总结"></a>33.1.3 总结</h3><p><strong>综上</strong>，添加缓存的目的是为了提高系统性能，而你要付出的代价就是缓存与数据库的强一致性。如果你要求数据库与缓存的强一致，那就需要加锁避免并行读写。但这就降低了性能，与缓存的目标背道而驰。</p>
<p>因此不管任何缓存同步方案最终的目的都是尽可能保证最终一致性，降低发生不一致的概率。我们采用先更新数据库再删除缓存的方案，已经将这种概率降到足够低，目的已经达到了。</p>
<p>同时我们还要给缓存加上过期时间，一旦发生缓存不一致，当缓存过期后会重新加载，数据最终还是能保证一致。这就可以作为一个兜底方案。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241026195605278.png"
                      alt="image-20241026195605278"
                ></li>
</ul>
<h2 id="33-2-缓存穿透"><a href="#33-2-缓存穿透" class="headerlink" title="33.2 缓存穿透"></a>33.2 缓存穿透</h2><ul>
<li>缓存穿透：是指客户端请求的数据在数据库中根本不存在，从而导致请求穿透缓存，直接打到数据库的问题。</li>
</ul>
<h3 id="33-2-1-缓存空值"><a href="#33-2-1-缓存空值" class="headerlink" title="33.2.1 缓存空值"></a>33.2.1 缓存空值</h3><ul>
<li><p>简单来说，就是当我们发现请求的数据即不存在与缓存，也不存在与数据库时，将空值缓存到Redis，避免频繁查询数据库。</p>
</li>
<li><p>优点：</p>
<ul>
<li>实现简单，维护方便</li>
</ul>
<p>缺点：</p>
<ul>
<li>额外的内存消耗</li>
</ul>
</li>
<li><p>实现思路如下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241026203516973.png"
                      alt="image-20241026203516973"
                ></p>
</li>
</ul>
<h3 id="33-2-2-布隆过滤器"><a href="#33-2-2-布隆过滤器" class="headerlink" title="33.2.2 布隆过滤器"></a>33.2.2 布隆过滤器</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241026203908368.png"
                      alt="image-20241026203908368"
                ></p>
</li>
<li><p>优点：</p>
<ul>
<li>实现简单，维护方便</li>
</ul>
<p>缺点：</p>
<ul>
<li>实现复杂</li>
<li>存在误判可能</li>
</ul>
</li>
<li><p>实现思路如下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241026204242716.png"
                      alt="image-20241026204242716"
                ></p>
</li>
</ul>
<h2 id="33-3-缓存雪崩"><a href="#33-3-缓存雪崩" class="headerlink" title="33.3 缓存雪崩"></a>33.3 缓存雪崩</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241026215437494.png"
                      alt="image-20241026215437494"
                ></li>
</ul>
<h2 id="33-4-缓存击穿"><a href="#33-4-缓存击穿" class="headerlink" title="33.4 缓存击穿"></a>33.4 缓存击穿</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027104807898.png"
                      alt="image-20241027104807898"
                ></p>
</li>
<li><p>常见的解决方案有两种：</p>
<ul>
<li>互斥锁：给重建缓存逻辑加锁，避免多线程同时指向</li>
<li>逻辑过期：热点key不要设置过期时间，在活动结束后手动删除。</li>
</ul>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027105758594.png"
                      alt="image-20241027105758594"
                ></p>
</li>
</ul>
<h3 id="33-4-1-互斥锁"><a href="#33-4-1-互斥锁" class="headerlink" title="33.4.1 互斥锁"></a>33.4.1 互斥锁</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027105630704.png"
                      alt="image-20241027105630704"
                ></li>
</ul>
<h3 id="33-4-2-逻辑过期"><a href="#33-4-2-逻辑过期" class="headerlink" title="33.4.2 逻辑过期"></a>33.4.2 逻辑过期</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027105659211.png"
                      alt="image-20241027105659211"
                ></li>
</ul>
<h2 id="33-5-面试总结"><a href="#33-5-面试总结" class="headerlink" title="33.5 面试总结"></a>33.5 面试总结</h2><p><strong>面试题</strong>：<strong>如何保证缓存的双写一致性</strong>？</p>
<p><strong>答</strong>：缓存的双写一致性很难保证强一致，只能尽可能降低不一致的概率，确保最终一致。我们项目中采用的是<code>Cache Aside</code>模式。简单来说，就是在更新数据库之后删除缓存；在查询时先查询缓存，如果未命中则查询数据库并写入缓存。同时我们会给缓存设置过期时间作为兜底方案，如果真的出现了不一致的情况，也可以通过缓存过期来保证最终一致。</p>
<p><strong>追问</strong>：<strong>为什么不采用延迟双删机制</strong>？</p>
<p><strong>答</strong>：延迟双删的第一次删除并没有实际意义，第二次采用延迟删除主要是解决数据库主从同步的延迟问题，我认为这是数据库主从的一致性问题，与缓存同步无关。既然主节点数据已经更新，Redis的缓存理应更新。而且延迟双删会增加缓存业务复杂度，也没能完全避免缓存一致性问题，投入回报比太低。</p>
<p><strong>面试题</strong>：<strong>如何解决缓存穿透问题</strong>？</p>
<p><strong>答</strong>：缓存穿透也可以说是穿透攻击，具体来说是因为请求访问到了数据库不存在的值，这样缓存无法命中，必然访问数据库。如果高并发的访问这样的接口，会给数据库带来巨大压力。</p>
<p>我们项目中都是基于布隆过滤器来解决缓存穿透问题的，当缓存未命中时基于布隆过滤器判断数据是否存在。如果不存在则不去访问数据库。</p>
<p>当然，也可以使用缓存空值的方式解决，不过这种方案比较浪费内存。</p>
<p><strong>面试题</strong>：<strong>如何解决缓存雪崩问题</strong>？</p>
<p><strong>答</strong>：缓存雪崩的常见原因有两个，第一是因为大量key同时过期。针对问这个题我们可以可以给缓存key设置不同的TTL值，避免key同时过期。</p>
<p>第二个原因是Redis宕机导致缓存不可用。针对这个问题我们可以利用集群提高Redis的可用性。也可以添加多级缓存，当Redis宕机时还有本地缓存可用。</p>
<p><strong>面试题</strong>：<strong>如何解决缓存击穿问题</strong>？</p>
<p><strong>答</strong>：缓存击穿往往是由热点Key引起的，当热点Key过期时，大量请求涌入同时查询，发现缓存未命中都会去访问数据库，导致数据库压力激增。解决这个问题的主要思路就是避免多线程并发去重建缓存，因此方案有两种。</p>
<p>第一种是基于互斥锁，当发现缓存未命中时需要先获取互斥锁，再重建缓存，缓存重建完成释放锁。这样就可以保证缓存重建同一时刻只会有一个线程执行。不过这种做法会导致缓存重建时性能下降严重。</p>
<p>第二种是基于逻辑过期，也就是不给热点Key设置过期时间，而是给数据添加一个过期时间的字段。这样热点Key就不会过期，缓存中永远有数据。</p>
<p>查询到数据时基于其中的过期时间判断key是否过期，如果过期开启独立新线程异步的重建缓存，而查询请求先返回旧数据即可。当然，这个过程也要加互斥锁，但由于重建缓存是异步的，而且获取锁失败也无需等待，而是返回旧数据，这样性能几乎不受影响。</p>
<p>需要注意的是，无论是采用哪种方式，在获取互斥锁后一定要再次判断缓存是否命中，做dubbo check. 因为当你获取锁成功时，可能是在你之前有其它线程已经重建缓存了。</p>
<h1 id="34-分布式事务"><a href="#34-分布式事务" class="headerlink" title="34.分布式事务"></a>34.分布式事务</h1><p><strong>分布式</strong>事务，就是指不是在单个服务或单个数据库架构下，产生的事务，例如：</p>
<ul>
<li>跨数据源的分布式事务</li>
<li>跨服务的分布式事务</li>
<li>综合情况</li>
</ul>
<h2 id="34-1-CAP定理"><a href="#34-1-CAP定理" class="headerlink" title="34.1 CAP定理"></a>34.1 CAP定理</h2><ul>
<li>1998年，加州大学的计算机科学家 Eric Brewer 提出，分布式系统有三个指标：<ul>
<li><strong>C</strong>onsistency（一致性）</li>
<li><strong>A</strong>vailability（可用性）</li>
<li><strong>P</strong>artition tolerance （分区容错性）</li>
</ul>
</li>
<li>它们的第一个字母分别是 <code>C</code>、<code>A</code>、<code>P</code>。Eric Brewer认为任何分布式系统架构方案都不可能同时满足这3个目标，这个结论就叫做 CAP 定理。</li>
</ul>
<h3 id="34-1-1-一致性"><a href="#34-1-1-一致性" class="headerlink" title="34.1.1 一致性"></a>34.1.1 一致性</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027113939591.png"
                      alt="image-20241027113939591"
                ></li>
</ul>
<h3 id="34-1-2-可用性"><a href="#34-1-2-可用性" class="headerlink" title="34.1.2 可用性"></a>34.1.2 可用性</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027114118862.png"
                      alt="image-20241027114118862"
                ></li>
</ul>
<h3 id="34-1-3-分区容错"><a href="#34-1-3-分区容错" class="headerlink" title="34.1.3 分区容错"></a>34.1.3 分区容错</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027114422550.png"
                      alt="image-20241027114422550"
                ></li>
</ul>
<h3 id="34-1-4-矛盾"><a href="#34-1-4-矛盾" class="headerlink" title="34.1.4 矛盾"></a>34.1.4 矛盾</h3><ul>
<li><p>在分布式系统中，网络不能100%保证畅通，也就是说网络分区的情况一定会存在。而我们的系统必须要持续运行，对外提供服务。所以分区容错性（<code>P</code>）是硬性指标，所有分布式系统都要满足。而在设计分布式系统时要取舍的就是一致性（<code>C</code>）和可用性（<code>A</code>）了。</p>
</li>
<li><p>如果此时不允许写，只允许读，直到网络恢复，分区消失。这样就确保了一致性，但牺牲了可用性。满足CP</p>
</li>
<li><p>如果此时允许任意读写，满足了可用性。但由于node3无法同步，导致数据不一致，牺牲了一致性。符合AP</p>
</li>
<li><p>可见，在分布式系统中，<code>A</code>和<code>C</code>之间只能满足一个。</p>
</li>
</ul>
<h2 id="34-2-BASE理论"><a href="#34-2-BASE理论" class="headerlink" title="34.2 BASE理论"></a>34.2 BASE理论</h2><ul>
<li><p>人们在总结系统设计经验时，最终得到了一些心得：</p>
<ul>
<li><strong>B</strong>asically <strong>A</strong>vailable <strong>（</strong>基本可用<strong>）</strong>：分布式系统在出现故障时，允许损失部分可用性，即保证核心可用。</li>
<li><strong>S</strong>oft State<strong>（</strong>软状态<strong>）：</strong>在一定时间内，允许出现中间状态，比如临时的不一致状态。</li>
<li><strong>Ev</strong>entually Consistent<strong>（</strong>最终一致性<strong>）</strong>：虽然无法保证强一致性，但是在软状态结束后，最终达到数据一致。</li>
</ul>
</li>
<li><p>以上就是BASE理论。</p>
</li>
<li><p>简单来说，BASE理论就是一种取舍的方案，不再追求完美，而是最终达成目标。因此解决分布式事务的思想也是这样，有两个方向：</p>
<ul>
<li>AP思想：各个子事务分别执行和提交，无需锁定数据。允许出现结果不一致，然后采用弥补措施恢复，实现最终一致即可。例如<code>AT</code>模式就是如此</li>
<li>CP思想：各个子事务执行后不要提交，而是等待彼此结果，然后同时提交或回滚。在这个过程中锁定资源，不允许其它人访问，数据处于不可用状态，但能保证一致性。例如<code>XA</code>模式</li>
</ul>
</li>
</ul>
<h2 id="34-3-AT模式的脏写问题"><a href="#34-3-AT模式的脏写问题" class="headerlink" title="34.3 AT模式的脏写问题"></a>34.3 AT模式的脏写问题</h2><h3 id="34-3-1-回顾AT模式"><a href="#34-3-1-回顾AT模式" class="headerlink" title="34.3.1 回顾AT模式"></a>34.3.1 回顾AT模式</h3><ul>
<li><p>第一阶段是记录数据快照，执行并提交事务。</p>
</li>
<li><p>第二阶段根据阶段一的结果来判断：</p>
<ul>
<li>如果每一个分支事务都成功，则事务已经结束（因为阶段一已经提交），因此删除阶段一的快照即可。</li>
<li>如果有任意分支事务失败，则需要根据快照恢复到更新前数据。然后删除快照。</li>
</ul>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027134938399.png"
                      alt="image-20241027134938399"
                ></p>
</li>
</ul>
<h3 id="34-3-2-脏写问题"><a href="#34-3-2-脏写问题" class="headerlink" title="34.3.2 脏写问题"></a>34.3.2 脏写问题</h3><ul>
<li><p>这种模式在大多数情况下（99%）并不会有什么问题，不过在极端情况下，特别是多线程并发访问AT模式的分布式事务时，有可能出现脏写问题，如图：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027140444229.png"
                      alt="image-20241027140444229"
                ></p>
</li>
</ul>
<h3 id="34-3-3-全局锁"><a href="#34-3-3-全局锁" class="headerlink" title="34.3.3 全局锁"></a>34.3.3 全局锁</h3><ul>
<li><p>解决思路就是引入了全局锁的概念。在释放DB锁之前，先拿到全局锁。避免同一时刻有另外一个事务来操作当前数据。</p>
</li>
<li><p><strong>注意</strong>：</p>
</li>
<li><p>全局锁，记录了事务操作某张表的某行数据，该行数据只能由这个事务操作。</p>
</li>
<li><p>全局锁如果未能获取成功，默认重试30次，每次等10毫秒，一共300毫秒。而DB锁的等待往往比较长。</p>
</li>
<li><p>和XA模式不就一样了？不都资源锁定了？</p>
</li>
<li><p>全局锁是由TC管理，而DB锁是由数据库管理，锁的粒度是不一样的。DB锁锁住的行，其他事务不可以增删改查；而全局锁，其他没有被seata管理的事务，仍然可以进行增删改查，如果对同一行的其他字段做处理，依然可以。这样的性能比XA模式高。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027140917776.png"
                      alt="image-20241027140917776"
                ></p>
</li>
<li><p>极端情况：上述的隔离依然不是很彻底，其他未被seata管理的事务如果也对同一行数据进行了修改，也会丢失更新？</p>
</li>
<li><p>seata在保存快照时，保存了两份，一份是更新前的数据用于恢复数据，一份是更新后的数据，用于判断事务一在阶段1和阶段2这个过程中是否有其他事务操作过这个数据，若经过对比发现与自己更新后的数据不同，则seata无法去回滚了，记录异常，由人工介入。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027141742778.png"
                      alt="image-20241027141742778"
                ></p>
</li>
</ul>
<h2 id="34-4-TCC模式"><a href="#34-4-TCC模式" class="headerlink" title="34.4 TCC模式"></a>34.4 TCC模式</h2><p>TCC模式与AT模式非常相似，每阶段都是独立事务，不同的是TCC通过人工编码来实现数据恢复。需要实现三个方法：</p>
<ul>
<li><code>try</code>：资源的检测和预留。</li>
<li><code>confirm</code>：完成资源操作业务；要求 <code>try</code> 成功 <code>confirm</code> 一定要能成功。 </li>
<li><code>cancel</code>：预留资源释放，可以理解为try的反向操作。</li>
</ul>
<h3 id="34-4-1-流程分析"><a href="#34-4-1-流程分析" class="headerlink" title="34.4.1 流程分析"></a>34.4.1 流程分析</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027145657283.png"
                      alt="image-20241027145657283"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027145933233.png"
                      alt="image-20241027145933233"
                ></p>
</li>
</ul>
<h3 id="34-4-2-事务悬挂和空回滚"><a href="#34-4-2-事务悬挂和空回滚" class="headerlink" title="34.4.2 事务悬挂和空回滚"></a>34.4.2 事务悬挂和空回滚</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027150346411.png"
                      alt="image-20241027150346411"
                ></p>
</li>
<li><p>假如一个分布式事务中包含两个分支事务，try阶段，一个分支成功执行，另一个分支事务<strong>阻塞</strong>。</p>
</li>
<li><p>如果阻塞时间太长，可能导致全局事务超时而触发二阶段的<code>cancel</code>操作。两个分支事务都会执行cancel操作。</p>
</li>
<li><p>要知道，其中一个分支是未执行<code>try</code>操作的，直接执行了<code>cancel</code>操作，反而会导致数据错误。因此，这种情况下，尽管<code>cancel</code>方法要执行，但其中不能做任何回滚操作，这就是<strong>空回滚</strong>。</p>
</li>
<li><p>对于整个空回滚的分支事务，将来try方法阻塞结束依然会执行。但是整个全局事务其实已经结束了，因此永远不会再有confirm或cancel，也就是说这个事务执行了一半，处于<strong>悬挂状态</strong>，这就是业务悬挂问题。</p>
</li>
<li><p>以上问题都需要我们在编写try、cancel方法时处理。</p>
</li>
</ul>
<h3 id="34-4-3-总结"><a href="#34-4-3-总结" class="headerlink" title="34.4.3 总结"></a>34.4.3 总结</h3><p>TCC模式的每个阶段是做什么的？</p>
<ul>
<li>Try：资源检查和预留</li>
<li>Confirm：业务执行和提交</li>
<li>Cancel：预留资源的释放</li>
</ul>
<p>TCC的优点是什么？</p>
<ul>
<li>一阶段完成直接提交事务，释放数据库资源，性能好</li>
<li>相比AT模型，无需生成快照，无需使用全局锁，性能最强</li>
<li>不依赖数据库事务，而是依赖补偿操作，可以用于非事务型数据库</li>
</ul>
<p>TCC的缺点是什么？</p>
<ul>
<li>有代码侵入，需要人为编写try、Confirm和Cancel接口，太麻烦</li>
<li>软状态，事务是最终一致</li>
<li>需要考虑Confirm和Cancel的失败情况，做好幂等处理、事务悬挂和空回滚处理</li>
</ul>
<h2 id="34-5-最大努力通知"><a href="#34-5-最大努力通知" class="headerlink" title="34.5 最大努力通知"></a>34.5 最大努力通知</h2><ul>
<li><p>最大努力通知，尽最大努力去通知，使得能够执行成功。但是也不会一直去重试，所以会有兜底方案。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027151024807.png"
                      alt="image-20241027151024807"
                ></p>
</li>
</ul>
<h1 id="35-注册中心"><a href="#35-注册中心" class="headerlink" title="35.注册中心"></a>35.注册中心</h1><h2 id="35-1-环境隔离"><a href="#35-1-环境隔离" class="headerlink" title="35.1 环境隔离"></a>35.1 环境隔离</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-27%20175526.png"
                      alt="屏幕截图 2024-10-27 175526"
                ></p>
</li>
<li><p>说明：</p>
<ul>
<li>Nacos中可以配置多个<code>namespace</code>，相互之间完全隔离。默认的<code>namespace</code>名为<code>public</code></li>
<li><code>namespace</code>下还可以继续分组，也就是group ，相互隔离。 默认的group是<code>DEFAULT_GROUP</code></li>
<li><code>group</code>之下就是服务和配置了</li>
</ul>
</li>
</ul>
<h3 id="35-1-1-创建namespace"><a href="#35-1-1-创建namespace" class="headerlink" title="35.1.1 创建namespace"></a>35.1.1 创建namespace</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027184317925.png"
                      alt="image-20241027184317925"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027184339709.png"
                      alt="image-20241027184339709"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-27%20184410.png"
                      alt="屏幕截图 2024-10-27 184410"
                ></p>
</li>
</ul>
<h3 id="35-1-2-微服务配置namespace"><a href="#35-1-2-微服务配置namespace" class="headerlink" title="35.1.2 微服务配置namespace"></a>35.1.2 微服务配置namespace</h3><ul>
<li><p>默认情况下，所有的微服务注册发现、配置管理都是走<code>public</code>这个命名空间。如果要指定命名空间则需要修改<code>application.yml</code>文件。</p>
</li>
<li><p>比如，我们修改<code>item-service</code>服务的bootstrap.yml文件，添加服务发现配置，指定其<code>namespace</code>：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027185552114.png"
                      alt="image-20241027185552114"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027185656140.png"
                      alt="image-20241027185656140"
                ></p>
</li>
<li><p>会发现<code>cart-service</code>服务在远程调用<code>item-service</code>时，并没有找到可用的实例。这证明不同namespace之间确实是相互隔离的，不可访问。</p>
</li>
<li><p>当我们把<code>namespace</code>切换回<code>public</code>，或者统一都是以<code>dev</code>时访问恢复正常。</p>
</li>
</ul>
<h2 id="35-2-分级模型"><a href="#35-2-分级模型" class="headerlink" title="35.2 分级模型"></a>35.2 分级模型</h2><ul>
<li><p>在一些大型应用中，同一个服务可以部署很多实例。而这些实例可能分布在全国各地的不同机房。由于存在地域差异，网络传输的速度会有很大不同，因此在做服务治理时需要区分不同机房的实例。</p>
</li>
<li><p>Nacos中提供了集群（<code>cluster</code>）的概念，来对应不同机房。也就是说，一个服务（<code>service</code>）下可以有很多集群（<code>cluster</code>），而一个集群（<code>cluster</code>）中下又可以包含很多实例（<code>instance</code>）。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027191058261.png"
                      alt="image-20241027191058261"
                ></p>
</li>
<li><p>nacos中的服务分级模型：任何一个微服务的实例在注册到Nacos时，都会生成以下几个信息，用来确认当前实例的身份，从外到内依次是：</p>
<ul>
<li>namespace：命名空间</li>
<li>group：分组</li>
<li>service：服务名</li>
<li>cluster：集群</li>
<li>instance：实例，包含ip和端口</li>
</ul>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027191204257.png"
                      alt="image-20241027191204257"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027191504004.png"
                      alt="image-20241027191504004"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027191540678.png"
                      alt="image-20241027191540678"
                ></p>
</li>
</ul>
<h2 id="35-3-Eureka和Nacos对比"><a href="#35-3-Eureka和Nacos对比" class="headerlink" title="35.3 Eureka和Nacos对比"></a>35.3 Eureka和Nacos对比</h2><p>Eureka和Nacos都能起到注册中心的作用，用法基本类似。但还是有一些区别的，例如：</p>
<ul>
<li>Nacos支持配置管理，而Eureka则不支持。</li>
</ul>
<p>而且服务注册发现上也有区别，我们来做一个实验：</p>
<p>我们停止<code>user-service</code>服务，然后观察Eureka控制台，你会发现很长一段时间过去后，Eureka服务依然没有察觉<code>user-service</code>的异常状态。</p>
<p>这与Eureka的健康检测机制有关。在Eureka中，健康检测的原理如下：</p>
<ul>
<li>微服务启动时注册信息到Eureka，这点与Nacos一致。</li>
<li>微服务每隔30秒向Eureka发送心跳请求，报告自己的健康状态。Nacos中默认是5秒一次。</li>
<li>Eureka如果90秒未收到心跳，则认为服务疑似故障，可能被剔除。Nacos中则是15秒超时，30秒剔除。</li>
<li>Eureka如果发现超过85%比例的服务都心跳异常，会认为是自己的网络异常，暂停剔除服务的功能。</li>
<li>Eureka每隔60秒执行一次服务检测和清理任务；Nacos是每隔5秒执行一次。</li>
</ul>
<p>综上，你会发现Eureka是尽量不剔除服务，避免“误杀”，宁可放过一千，也不错杀一个。这就导致当服务真的出现故障时，迟迟不会被剔除，给服务的调用者带来困扰。</p>
<p>不仅如此，当Eureka发现服务宕机并从服务列表中剔除以后，并不会将服务列表的变更消息推送给所有微服务。而是等待微服务自己来拉取时发现服务列表的变化。而微服务每隔30秒才会去Eureka更新一次服务列表，进一步推迟了服务宕机时被发现的时间。</p>
<p>而Nacos中微服务除了自己定时去Nacos中拉取服务列表以外，Nacos还会在服务列表变更时主动推送最新的服务列表给所有的订阅者。</p>
<p>Eureka和Nacos的相似点有：</p>
<ul>
<li>都支持服务注册发现功能</li>
<li>都有基于心跳的健康监测功能</li>
<li>都支持集群，集群间数据同步默认是AP模式，即最全高可用性</li>
</ul>
<p>Eureka和Nacos的区别有：</p>
<ul>
<li>Eureka的心跳是30秒一次，Nacos则是5秒一次</li>
<li>Eureka如果90秒未收到心跳，则认为服务疑似故障，可能被剔除。Nacos中则是15秒超时，30秒剔除。</li>
<li>Eureka每隔60秒执行一次服务检测和清理任务；Nacos是每隔5秒执行一次。</li>
<li>Eureka只能等微服务自己每隔30秒更新一次服务列表；Nacos即有定时更新，也有在服务变更时的广播推送</li>
<li>Eureka仅有注册中心功能，而Nacos同时支持注册中心、配置管理</li>
<li>Eureka和Nacos都支持集群，而且默认都是AP模式，Nacos还支持CP模式</li>
<li>Nacos支持服务端主动检测提供者状态：临时实例采用心跳模式，非临时实例采用主动检测模式</li>
</ul>
<h1 id="36-远程调用"><a href="#36-远程调用" class="headerlink" title="36.远程调用"></a>36.远程调用</h1><h2 id="36-1-负载均衡原理"><a href="#36-1-负载均衡原理" class="headerlink" title="36.1 负载均衡原理"></a>36.1 负载均衡原理</h2><p>根据之前的分析，我们会发现Spring在整合OpenFeign的时候，实现了<code>org.springframework.cloud.openfeign.loadbalancer.FeignBlockingLoadBalancerClient</code>类，其中定义了OpenFeign发起远程调用的核心流程。也就是四步：</p>
<ul>
<li>获取请求中的<code>serviceId</code></li>
<li>根据<code>serviceId</code>负载均衡，找出一个可用的服务实例</li>
<li>利用服务实例的<code>ip</code>和<code>port</code>信息重构url</li>
<li>向真正的url发起请求</li>
</ul>
<p>而具体的负载均衡则是不是由<code>OpenFeign</code>组件负责。而是分成了<strong>负载均衡的接口规范</strong>，以及<strong>负载均衡的具体实现</strong>两部分。</p>
<p>负载均衡的接口规范是定义在<code>Spring-Cloud-Common</code>模块中，包含下面的接口：</p>
<ul>
<li><code>LoadBalancerClient</code>：负载均衡客户端，职责是根据serviceId最终负载均衡，选出一个服务实例</li>
<li><code>ReactiveLoadBalancer</code>：负载均衡器，负责具体的负载均衡算法</li>
</ul>
<p>OpenFeign的负载均衡是基于<code>Spring-Cloud-Common</code>模块中的负载均衡规则接口，并没有写死具体实现。这就意味着以后还可以拓展其它各种负载均衡的实现。</p>
<p>不过目前<code>SpringCloud</code>中只有<code>Spring-Cloud-Loadbalancer</code>这一种实现。</p>
<p><code>Spring-Cloud-Loadbalancer</code>模块中，实现了<code>Spring-Cloud-Common</code>模块的相关接口，具体如下：</p>
<ul>
<li><code>BlockingLoadBalancerClient</code>：实现了<code>LoadBalancerClient</code>，会根据serviceId选出负载均衡器并调用其算法实现负载均衡。</li>
<li><code>RoundRobinLoadBalancer</code>：基于轮询算法实现了<code>ReactiveLoadBalancer</code></li>
<li><code>RandomLoadBalancer</code>：基于随机算法实现了<code>ReactiveLoadBalancer</code>，</li>
</ul>
<p>这样一来，整体思路就非常清楚了，流程图如下：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241027210921671.png"
                      alt="image-20241027210921671"
                ></li>
</ul>
<h2 id="36-2-切换负载均衡算法-NacosRule"><a href="#36-2-切换负载均衡算法-NacosRule" class="headerlink" title="36.2 切换负载均衡算法-NacosRule"></a>36.2 切换负载均衡算法-NacosRule</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030192625869.png"
                      alt="image-20241030192625869"
                ></li>
</ul>
<h3 id="36-2-1-修改负载均衡策略"><a href="#36-2-1-修改负载均衡策略" class="headerlink" title="36.2.1 修改负载均衡策略"></a>36.2.1 修改负载均衡策略</h3><ul>
<li><p>查看源码会发现，<code>Spring-Cloud-Loadbalancer</code>模块中有一个自动配置类：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030192912836.png"
                      alt="image-20241030192912836"
                ></p>
</li>
<li><p>其中定义了默认的负载均衡器：</p>
</li>
<li><p>这个Bean上添加了<code>@ConditionalOnMissingBean</code>注解，也就是说如果我们自定义了这个类型的bean，则负载均衡的策略就会被改变。即：自己定义了这个bean，则此处的bean就不生效了。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030192934628.png"
                      alt="image-20241030192934628"
                ></p>
</li>
<li><p>我们在<code>hm-cart</code>模块中添加一个配置类：com.hmall.cart &#x2F; config &#x2F; OpenFeignConfig</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.cart.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.cloud.nacos.NacosDiscoveryProperties;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.cloud.nacos.loadbalancer.NacosLoadBalancer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.ServiceInstance;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.loadbalancer.core.ReactorLoadBalancer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.loadbalancer.core.ServiceInstanceListSupplier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.loadbalancer.support.LoadBalancerClientFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenFeignConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ReactorLoadBalancer&lt;ServiceInstance&gt; <span class="title function_">reactorServiceInstanceLoadBalancer</span><span class="params">(</span></span><br><span class="line"><span class="params">            Environment environment, NacosDiscoveryProperties properties,</span></span><br><span class="line"><span class="params">            LoadBalancerClientFactory loadBalancerClientFactory)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NacosLoadBalancer</span>(</span><br><span class="line">                loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name, properties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p><strong>注意</strong>：</p>
</li>
<li><p>这个配置类千万不要加<code>@Configuration</code>注解，也不要被SpringBootApplication扫描到。</p>
</li>
<li><p>由于这个OpenFeignConfig没有加<code>@Configuration</code>注解，也就没有被Spring加载，因此是不会生效的。接下来，我们要在启动类上通过注解来声明这个配置。</p>
</li>
<li><p>有两种做法：</p>
</li>
<li><p>全局配置：对所有服务生效</p>
</li>
<li><p>意思是：只要是上面这个cart-Service远程调用的服务，负载均衡器都换成Nacos的负载均衡器</p>
</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@LoadBalancerClients(defaultConfiguration = OpenFeignConfig.class)</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>局部配置：只对某个服务生效</li>
<li>意思是：目前cart-Service远程调用item-Service采用的负载均衡器会更改为Nacos的负载均衡器</li>
</ul>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@LoadBalancerClients(&#123;</span></span><br><span class="line"><span class="meta">        @LoadBalancerClient(value = &quot;item-service&quot;, configuration = OpenFeignConfig.class)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>我们选择全局配置（在cartApplication）：</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030193916549.png"
                      alt="image-20241030193916549"
                ></li>
</ul>
<h3 id="36-2-2-集群优先"><a href="#36-2-2-集群优先" class="headerlink" title="36.2.2 集群优先"></a>36.2.2 集群优先</h3><ul>
<li><p><code>RoundRobinLoadBalancer</code>是轮询算法，<code>RandomLoadBalancer</code>是随机算法，那么<code>NacosLoadBalancer</code>是什么负载均衡算法呢？</p>
</li>
<li><p>通过源码来分析一下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030194512128.png"
                      alt="image-20241030194512128"
                ></p>
</li>
<li><p>这部分代码的大概流程如下：</p>
<ul>
<li>通过<code>ServiceInstanceListSupplier</code>获取服务实例列表</li>
<li>获取<code>NacosDiscoveryProperties</code>中的<code>clusterName</code>，也就是yml文件中的配置，代表当前服务实例所在集群信息（参考分级模型）（集群没有配置的情况下，默认都是default。同集群优先，然后加权随机。）</li>
<li>然后利用stream的filter过滤找到被调用的服务实例中与当前服务实例<code>clusterName</code>一致的。简单来说就是<strong>服务调用者与服务提供者要在一个集群</strong></li>
</ul>
</li>
<li><p>为什么？</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030194801247.png"
                      alt="image-20241030194801247"
                ></p>
</li>
<li><p>现在的情况是这样的：</p>
<ul>
<li><code>cart-service</code>所在集群是<code>default</code></li>
<li><code>item-service</code>的8081、8083所在集群的<code>default</code></li>
<li><code>item-service</code>的8084所在集群是<code>BJ</code></li>
</ul>
</li>
<li><p><code>cart-service</code>访问<code>item-service</code>时，应该优先访问8081和8083，我们重启<code>cart-service</code>，测试一下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030194901344.png"
                      alt="image-20241030194901344"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030194949784.png"
                      alt="image-20241030194949784"
                ></p>
</li>
</ul>
<h3 id="36-2-3-权重配置"><a href="#36-2-3-权重配置" class="headerlink" title="36.2.3 权重配置"></a>36.2.3 权重配置</h3><ul>
<li><p>同集群的实例还剩下两个，接下来就需要做负载均衡了，具体用的是什么算法呢？</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030195040929.png"
                      alt="image-20241030195040929"
                ></p>
</li>
<li><p>我们打开nacos控制台，进入<code>item-service</code>的服务详情页，可以看到每个实例后面都有一个<strong>编辑</strong>按钮：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030195124315.png"
                      alt="image-20241030195124315"
                ></p>
</li>
<li><p>点击，可以看到一个编辑表单：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030195147734.png"
                      alt="image-20241030195147734"
                ></p>
</li>
<li><p>我们将这里的权重修改为5。</p>
</li>
<li><p>访问10次购物车接口，可以发现大多数请求都访问到了8083这个实例。</p>
</li>
</ul>
<h1 id="37-服务保护"><a href="#37-服务保护" class="headerlink" title="37.服务保护"></a>37.服务保护</h1><h2 id="37-1-线程隔离"><a href="#37-1-线程隔离" class="headerlink" title="37.1 线程隔离"></a>37.1 线程隔离</h2><ul>
<li><p>首先我们来看下线程隔离功能，无论是Hystix还是Sentinel都支持线程隔离。不过其实现方式不同。</p>
</li>
<li><p>Sentinel的线程隔离就是基于信号量隔离实现的，而Hystix两种都支持，但默认是基于线程池隔离。</p>
</li>
<li><p>线程隔离有两种方式实现：</p>
</li>
<li><p><strong>线程池隔离</strong>：给每个服务调用业务分配一个线程池，利用线程池本身实现隔离效果</p>
</li>
<li><p><strong>信号量隔离</strong>：不创建线程池，而是计数器模式，记录业务使用的线程数量，达到信号量上限时，禁止新的请求</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030201146347.png"
                      alt="image-20241030201146347"
                ></p>
</li>
<li><p>两者的优缺点如下：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030201750650.png"
                      alt="image-20241030201750650"
                ></p>
</li>
<li><p><strong>面试题</strong></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030201916376.png"
                      alt="image-20241030201916376"
                ></p>
</li>
</ul>
<h2 id="37-2-滑动窗口算法"><a href="#37-2-滑动窗口算法" class="headerlink" title="37.2 滑动窗口算法"></a>37.2 滑动窗口算法</h2><p>- </p>
<ul>
<li>在熔断功能中，需要统计异常请求或慢请求比例，也就是计数。在限流的时候，要统计每秒钟的QPS，同样是计数。可见计数算法在熔断限流中的应用非常多。sentinel中采用的计数器算法就是滑动窗口计数算法。</li>
</ul>
<h3 id="37-2-1-固定窗口计数"><a href="#37-2-1-固定窗口计数" class="headerlink" title="37.2.1 固定窗口计数"></a>37.2.1 固定窗口计数</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030204004217.png"
                      alt="image-20241030204004217"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030210047904.png"
                      alt="image-20241030210047904"
                ></p>
</li>
<li><p>说明：</p>
<ul>
<li>第1、2秒，请求数量都小于3，没问题</li>
<li>第3秒，请求数量为5，超过阈值，超出的请求被拒绝</li>
<li>假如在第5、6秒，请求数量都为3，没有超过阈值，全部放行</li>
<li>但是，如果第5秒的三次请求都是在4.5<del>5秒之间进来；第6秒的请求是在5</del>5.5之间进来。那么从第4.5~5.之间就有6次请求！也就是说每秒的QPS达到了6，远超阈值。</li>
</ul>
</li>
<li><p>这就是固定窗口计数算法的问题，它只能统计当前某1个时间窗的请求数量是否到达阈值，无法结合前后的时间窗的数据做综合统计。</p>
</li>
<li><p>因此，我们就需要滑动时间窗口算法来解决。</p>
</li>
</ul>
<h3 id="37-2-2-滑动窗口计数"><a href="#37-2-2-滑动窗口计数" class="headerlink" title="37.2.2 滑动窗口计数"></a>37.2.2 滑动窗口计数</h3><ul>
<li><p>固定时间窗口算法中窗口有很多，其跨度和位置是与时间区间绑定，因此是很多固定不动的窗口。而滑动时间窗口算法中只包含1个固定跨度的窗口，但窗口是可移动动的，与时间区间无关。</p>
</li>
<li><p>具体规则如下：</p>
<ul>
<li>窗口时间跨度<code>Interval</code>大小固定，例如1秒</li>
<li>时间区间跨度为<code>Interval / n</code> ，例如n&#x3D;2，则时间区间跨度为500ms</li>
<li>窗口会随着当前请求所在时间<code>currentTime</code>移动，窗口范围从<code>currentTime-Interval</code>时刻之后的第一个时区开始，到<code>currentTime</code>所在时区结束。</li>
<li>划分的区间越小，那么精度就越细，准确度也会越高，sentinal内部默认就是2。</li>
</ul>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030210340368.png"
                      alt="image-20241030210340368"
                ></p>
</li>
<li><p>限流阈值依然为3，绿色小块就是请求，上面的数字是其<code>currentTime</code>值。</p>
</li>
<li><p>在第1300ms时接收到一个请求，其所在时区就是1000~1500</p>
</li>
<li><p>按照规则，currentTime-Interval值为300ms，300ms之后的第一个时区是500<del>1000，因此窗口范围包含两个时区：500</del>1000、1000~1500，也就是粉红色方框部分</p>
</li>
<li><p>统计窗口内的请求总数，发现是3，未达到上限。</p>
</li>
<li><p>若第1400ms又来一个请求，会落在1000~1500时区，虽然该时区请求总数是3，但滑动窗口内总数已经达到4，因此该请求会被拒绝。</p>
</li>
<li><p>假如第1600ms又来的一个请求，处于1500<del>2000时区，根据算法，滑动窗口位置应该是1000</del>1500和1500~2000这两个时区，也就是向后移动。</p>
</li>
</ul>
<h2 id="37-3-漏桶算法"><a href="#37-3-漏桶算法" class="headerlink" title="37.3 漏桶算法"></a>37.3 漏桶算法</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030211633638.png"
                      alt="image-20241030211633638"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030211810932.png"
                      alt="image-20241030211810932"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030211840109.png"
                      alt="image-20241030211840109"
                ></p>
</li>
</ul>
<h2 id="37-4-令牌桶算法"><a href="#37-4-令牌桶算法" class="headerlink" title="37.4 令牌桶算法"></a>37.4 令牌桶算法</h2><ul>
<li><p>限流的另一种常见算法是令牌桶算法。Sentinel中的热点参数限流正是基于令牌桶算法实现的。其基本思路如图：</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030213405172.png"
                      alt="image-20241030213405172"
                ></p>
</li>
<li><p>基于令牌桶算法，每秒产生的令牌数量基本就是QPS上限。</p>
</li>
<li><p>当然也有例外情况，例如：</p>
<ul>
<li>某一秒令牌桶中产生了很多令牌，达到令牌桶上限N，缓存在令牌桶中，但是这一秒没有请求进入。</li>
<li>下一秒的前半秒涌入了超过2N个请求，之前缓存的令牌桶的令牌耗尽，同时这一秒又生成了N个令牌，于是总共放行了2N个请求。超出了我们设定的QPS阈值。</li>
</ul>
</li>
<li><p>因此，在使用令牌桶算法时，尽量不要将令牌上限设定到服务能承受的QPS上限。而是预留一定的波动空间，这样我们才能应对突发流量。</p>
</li>
</ul>
<p><strong>注意</strong>：</p>
<ul>
<li><p>热点参数限流：</p>
</li>
<li><p>什么是针对参数限流？比如：</p>
<p>①商品 ID 为参数，统计一段时间内最常购买的商品 ID 并进行限制</p>
<p>②用户 ID 为参数，针对一段时间内频繁访问的用户 ID 进行限制</p>
</li>
<li><p>根据id查商品的接口，有几个商品正在参与秒杀，需要对参与秒杀的商品单独设置限流规则，每一个商品设置一个规则，其他商品设置不同的规则。</p>
</li>
</ul>
<p><strong>面试题</strong>：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241030214539311.png"
                      alt="image-20241030214539311"
                ></li>
</ul>
]]></content>
      <categories>
        <category>后端</category>
        <category>微服务</category>
      </categories>
      <tags>
        <tag>自研笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>单片机原理及应用</title>
    <url>/2024/02/26/%E5%8D%95%E7%89%87%E6%9C%BA%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/</url>
    <content><![CDATA[<h1 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1-介绍"></a>1-介绍</h1><ul>
<li>主讲：祁瑞丽</li>
<li>电话：15369155136</li>
<li>QQ：309222063</li>
<li>教研室：科技教研室 1#322</li>
</ul>
<h1 id="1-认识单片机"><a href="#1-认识单片机" class="headerlink" title="1- 认识单片机"></a>1- 认识单片机</h1><h2 id="1-1-介绍"><a href="#1-1-介绍" class="headerlink" title="1-1 介绍"></a>1-1 介绍</h2><h3 id="1-1-1-系统"><a href="#1-1-1-系统" class="headerlink" title="1-1-1 系统"></a>1-1-1 系统</h3><p>最小系统：单片机</p>
<ul>
<li>处理器内核(CPU)</li>
<li>存储器</li>
<li>I&#x2F;O控制电路</li>
</ul>
<p>扩展系统：单片机</p>
<ul>
<li>处理器内核(CPU)</li>
<li>存储器</li>
<li>I&#x2F;O控制电路</li>
<li>中断单元</li>
<li>定时单元</li>
<li>AD单元</li>
</ul>
<h3 id="1-1-2-特点和用途"><a href="#1-1-2-特点和用途" class="headerlink" title="1-1-2 特点和用途"></a>1-1-2 特点和用途</h3><p>特点：</p>
<ul>
<li>集成度高、体积小、功耗低、控制性强、易扩展、环境适应能力强</li>
</ul>
<p>用途：</p>
<ul>
<li>智能仪表、工业控制、民用及医疗等方面</li>
</ul>
<h3 id="1-1-3-容易混淆的名字"><a href="#1-1-3-容易混淆的名字" class="headerlink" title="1-1-3 容易混淆的名字"></a>1-1-3 容易混淆的名字</h3><p>51单片机：</p>
<ul>
<li>所有兼容MCS-51指令系统的单片机的总称。</li>
</ul>
<p>MCS-51单片机：</p>
<ul>
<li>INTEL生产的一系列内核兼容的单片机的总称。</li>
</ul>
<p>8051单片机：</p>
<ul>
<li>MCS-51中的一种基本类型</li>
</ul>
<h3 id="1-1-4-系列机"><a href="#1-1-4-系列机" class="headerlink" title="1-1-4 系列机"></a>1-1-4 系列机</h3><p>把4KROM换为EEPROM就是8751的结构，如去掉ROM&#x2F;EEPROM部分即为8031，如果将ROM置换为FLASH存贮器或EEPROM，或再省去某些I&#x2F;O，即可得到51系列的派生品种，如89C51、AT89C2051等单片机。</p>
<h3 id="1-1-5-MCS-51单片机的内部总体结构"><a href="#1-1-5-MCS-51单片机的内部总体结构" class="headerlink" title="1-1-5 MCS-51单片机的内部总体结构"></a>1-1-5 MCS-51单片机的内部总体结构</h3><p>8位CPU、片内振荡器、4K字节ROM、128字节RAM、21个特殊功能寄存器32根I&#x2F;O线、可寻址的64K字节外部数据、程序存贮空间、2个16位定时器计数器中断结构：具有二个优先级、五个中断源、一个全双工串行口、位寻址（即可寻找某位的内容）功能，适于按位进行逻辑运算的位处理器。除128字节RAM、4K字节ROM和中断、串行口及定时器模块外，还有4组I&#x2F;O日P0~P3，余下的就是CPU的全部组成。</p>
<h3 id="1-1-6-单片机内部三大资源"><a href="#1-1-6-单片机内部三大资源" class="headerlink" title="1-1-6 单片机内部三大资源"></a>1-1-6 单片机内部三大资源</h3><p>SFR（特殊功能寄存器）</p>
<p>RAM（内存）（速度快，无限次擦写）</p>
<p>FLASH（程序存储空间&lt; ROM &gt;重复擦写10万次以上）</p>
<h3 id="1-1-7-LED发光二极管"><a href="#1-1-7-LED发光二极管" class="headerlink" title="1-1-7 LED发光二极管"></a>1-1-7 LED发光二极管</h3><p>通常红色贴片LED：靠电流驱动，电压1.8V~2.2V，电流1到20MA；在1到5MA亮度有所变化，5MA以上亮度基本无变化。</p>
<h2 id="1-2-MCS-51单片机的工作原理初识"><a href="#1-2-MCS-51单片机的工作原理初识" class="headerlink" title="1-2 MCS-51单片机的工作原理初识"></a>1-2 MCS-51单片机的工作原理初识</h2><h3 id="1-2-1-CC2530-实物及相应套件"><a href="#1-2-1-CC2530-实物及相应套件" class="headerlink" title="1-2-1 CC2530 实物及相应套件"></a>1-2-1 CC2530 实物及相应套件</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318110910571.png"
                      alt="image-20240318110910571"
                ></li>
</ul>
<h3 id="1-2-2-CC2530-单片机节点底板"><a href="#1-2-2-CC2530-单片机节点底板" class="headerlink" title="1-2-2 CC2530 单片机节点底板"></a>1-2-2 CC2530 单片机节点底板</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318110951541.png"
                      alt="image-20240318110951541"
                ></li>
</ul>
<h3 id="1-2-3-图式"><a href="#1-2-3-图式" class="headerlink" title="1-2-3 图式"></a>1-2-3 图式</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318111058565.png"
                      alt="image-20240318111058565"
                ></li>
</ul>
<h3 id="1-2-4-CPU"><a href="#1-2-4-CPU" class="headerlink" title="1-2-4 CPU"></a>1-2-4 CPU</h3><p>内部包含 “运算器” 和 “控制器” 两大部件。</p>
<p>运算器负责执行“指令。这里的指令是机器语言，是由“0”和“1”组成的二进制数据。</p>
<p>控制器负责从存储器读取指令，将指令译码成机器语言送到运算器去运行，还要负责暂存运算过程中的中间结果等。</p>
<p>通常所说的单片机的内核，就是指单片机内部的CPU。</p>
<h3 id="1-2-5-时钟源-时钟电路"><a href="#1-2-5-时钟源-时钟电路" class="headerlink" title="1-2-5 时钟源 &lt;–&gt; 时钟电路"></a>1-2-5 时钟源 &lt;–&gt; 时钟电路</h3><p>石英晶体振荡器可以作为时钟源提供振荡频率，也叫晶振。</p>
<p>晶振与时钟电路结合，可以为CPU提供工作“节奏”，也叫CPU的主频。</p>
<p>CPU的主频越高，处理指令的速度越快。</p>
<h3 id="1-2-6-SFR和RAM"><a href="#1-2-6-SFR和RAM" class="headerlink" title="1-2-6 SFR和RAM"></a>1-2-6 SFR和RAM</h3><p>SFR和RAM整体是一块存储器。</p>
<p>SFR是RAM中的特定区域。</p>
<p>容量较大，64KB及以上。</p>
<h3 id="1-2-7-ROM"><a href="#1-2-7-ROM" class="headerlink" title="1-2-7 ROM"></a>1-2-7 ROM</h3><p>这里存放了很重要的系统指令。</p>
<p>单片机通电后，CPU首先从这里获取第一条需要执行的指令。</p>
<p>一般容量都不大，4KB。</p>
<p>通过JTAG接口将指令写入。</p>
<p>也叫程序存储器。</p>
<h3 id="1-2-8-存储单元"><a href="#1-2-8-存储单元" class="headerlink" title="1-2-8 存储单元"></a>1-2-8 存储单元</h3><p>在存储器中，数据是以8个二进制位为一个存储单元的，一个存储单元也叫一个字节，用B表示。8bit &#x3D; 1B。</p>
<h3 id="1-2-9-存储单元的地址"><a href="#1-2-9-存储单元的地址" class="headerlink" title="1-2-9 存储单元的地址"></a>1-2-9 存储单元的地址</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318112136291.png"
                      alt="image-20240318112136291"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318112159614.png"
                      alt="image-20240318112159614"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318112243225.png"
                      alt="image-20240318112243225"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318112310710.png"
                      alt="image-20240318112310710"
                ></li>
</ul>
<h1 id="2-GPIO"><a href="#2-GPIO" class="headerlink" title="2- GPIO"></a>2- GPIO</h1><h2 id="2-1-单片机中的GPIO"><a href="#2-1-单片机中的GPIO" class="headerlink" title="2-1 单片机中的GPIO"></a>2-1 单片机中的GPIO</h2><h3 id="2-1-1-图式"><a href="#2-1-1-图式" class="headerlink" title="2-1-1 图式"></a>2-1-1 图式</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318082108375.png"
                      alt="image-20240318082108375"
                ></li>
</ul>
<h3 id="2-1-2-介绍"><a href="#2-1-2-介绍" class="headerlink" title="2-1-2 介绍"></a>2-1-2 介绍</h3><p>GPIO (General-purpose input&#x2F;output)，中文直译为 ”通用IO“，是CPU与外部设备之间进行数据交互的通道。</p>
<p>GPIO中包含若干个pin (中文翻译为 “管脚”)。</p>
<p>这些pin可以是只连接一个外部设备的专用管脚，也可以是同时连接多个设备的复用管脚 (通过相应的控制器和软件代码来设置该pin当前为哪一个设备服务)。</p>
<ul>
<li><p>CPU可以通过GPIO向外部设备 “输出” 控制信号，这种情况下控制信号的方向是 “CPU→外设”，因而需要把与之有关的pin通过软件代码设置成 “output“。</p>
</li>
<li><p>外部设备也可以通过GPIO向CPU “输入” 状态信息，这种情况下状态信号的方向是“外设→CPU”，因而需要把与之有关的pin通过软件代码设置成 “input“。</p>
</li>
<li><p>以上两项描述说明 “input” (输入) 以及 “output” (输出) 是从CPU的角度来看待数据流向的。</p>
</li>
</ul>
<h2 id="2-2-CC2530中的GPIO"><a href="#2-2-CC2530中的GPIO" class="headerlink" title="2-2 CC2530中的GPIO"></a>2-2 CC2530中的GPIO</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318083059155.png"
                      alt="image-20240318083059155"
                ></li>
</ul>
<h2 id="2-3-通过SFR设置GPIO"><a href="#2-3-通过SFR设置GPIO" class="headerlink" title="2-3 通过SFR设置GPIO"></a>2-3 通过SFR设置GPIO</h2><h3 id="2-3-1-介绍"><a href="#2-3-1-介绍" class="headerlink" title="2-3-1 介绍"></a>2-3-1 介绍</h3><p>SFR在RAM的特定区域中。</p>
<p>每个SFR都与RAM中的惟一的一个存储单元连接。</p>
<p>存储单元的物理地址难记，不如SFR“见名知意“。</p>
<p>掌握的SFR有：P0、P1、P2、PxSEL和PxDIR(x&#x3D;0,1,2)。</p>
<h3 id="2-3-2-PxSEL"><a href="#2-3-2-PxSEL" class="headerlink" title="2-3-2 PxSEL"></a>2-3-2 PxSEL</h3><p>在CC2530中通过PxSEL(x&#x3D;0，1，2)来对GPIO的pin进行工作模式选择：</p>
<ul>
<li>某个二进制位取值为“0”——对应的pin工作在 “通用IO” 模式下。</li>
<li>某个二进制位取值为“1“——对应的pin工作在 “外设IO” 模式下。</li>
<li>例如：P1SEL &amp;&#x3D; ~0x02;</li>
</ul>
<h3 id="2-3-3-PxDIR"><a href="#2-3-3-PxDIR" class="headerlink" title="2-3-3 PxDIR"></a>2-3-3 PxDIR</h3><p>在CC2530中通过PxDIR(x&#x3D;0，1，2)的数据解释为：</p>
<ul>
<li><p>某个二进制位取值为“0”——对应的pin用作input。</p>
</li>
<li><p>某个二进制位取值为“1”——对应的pin用作output。</p>
</li>
<li><p>例如：P1DIR |&#x3D; 0x02;</p>
</li>
</ul>
<h1 id="3-外部中断"><a href="#3-外部中断" class="headerlink" title="3- 外部中断"></a>3- 外部中断</h1><h2 id="3-1-CPU执行指令的流程"><a href="#3-1-CPU执行指令的流程" class="headerlink" title="3-1 CPU执行指令的流程"></a>3-1 CPU执行指令的流程</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318095419992.png"
                      alt="image-20240318095419992"
                ></li>
</ul>
<h2 id="3-2-外部中断"><a href="#3-2-外部中断" class="headerlink" title="3-2 外部中断"></a>3-2 外部中断</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318095447307.png"
                      alt="image-20240318095447307"
                ></li>
</ul>
<p>中断系统中包含：</p>
<ul>
<li>中断源</li>
<li>中断服务程序</li>
<li>中断向量表</li>
<li>中断嵌套和中断判优机制</li>
<li>中断允许与屏蔽</li>
</ul>
<h3 id="3-2-1-中断源"><a href="#3-2-1-中断源" class="headerlink" title="3-2-1 中断源"></a>3-2-1 中断源</h3><p>也叫中断发生源，是指向CPU提交中断请求的设备，例如刚才说的按键就叫做中断源。</p>
<p>一个中断控制器可以连接多个中断源，就CC2530的中断控制器来说，它可以连接18个不同的中断源。</p>
<h3 id="3-2-2-中断服务程序"><a href="#3-2-2-中断服务程序" class="headerlink" title="3-2-2 中断服务程序"></a>3-2-2 中断服务程序</h3><p>也叫中断服务函数。</p>
<p>当一个中断源向CPU提交了中断请求后，它必定是希望CPU放下手头的工作，去执行它所希望的功能。</p>
<p>我们做为程序开发人员，可以对任何外部中断源编写属于它们各自的程序功能，这些功能就叫做中断服务函数。</p>
<p>对于CPU来说，这些中断服务函数与普通的函数一样都是main函数以外的函数。只不过中断服务函数在定义时需要另外指定存放地址。</p>
<h3 id="3-2-3-中断向量表"><a href="#3-2-3-中断向量表" class="headerlink" title="3-2-3 中断向量表"></a>3-2-3 中断向量表</h3><p>是一段连续的存储器空间，这段空间里存放的是所有中断服务函数的地址，也叫中断向量。</p>
<p>中断服务函数在定义以前需要明确指定存放地址，这是与普通函数定义不同的地方。</p>
<p>在CPU执行指令过程中调用普通函数时，只需要把函数名写在程序代码中进行调用就行了，什么时候调用就什么时候去写函数名。</p>
<p>但是中断服务函数是针对外部设备的请求提出来才执行的，这些<strong>中断服务函数只需要定义，不需要在main函数中调用它</strong>，当外部设备有中断请求提出后CPU自己能判断出来是谁提出的中断，然后就<strong>按中断向量表中约定的地址，去存储器里访问中断服务函数</strong>。</p>
<p>这样一来，只要是外部设备提交了中断请求，不管提交多少次，什么时候提交，CPU都能正确的找到这个中断服务函数的地址去执行。</p>
<h3 id="3-2-4-中断嵌套和中断判优机制"><a href="#3-2-4-中断嵌套和中断判优机制" class="headerlink" title="3-2-4 中断嵌套和中断判优机制"></a>3-2-4 中断嵌套和中断判优机制</h3><p>当CPU在处理一个外部中断的中断服务函数时，也同样是每执行完一条指令就去扫描是否还有中断请求发生。</p>
<p>如果有的话，就要判断一下当前正在执行的中断服务函数与刚刚提交中断请求的所要执行的功能哪个优先级高。</p>
<p>如果请求的高，那么停止当前的中断服务，跳到新的中断请求中去执行服务函数的功能，这就实现了中断嵌套。</p>
<p>当然能够实现中断嵌套的前提是有中断判优机制。</p>
<p>不同的单片机系统中断判优机制不同。有的单片机系统还允许程序员对中断判优进行编程，自行决定外部设备的优先级。</p>
<h3 id="3-2-5-中断允许与屏蔽"><a href="#3-2-5-中断允许与屏蔽" class="headerlink" title="3-2-5 中断允许与屏蔽"></a>3-2-5 中断允许与屏蔽</h3><p>CPU有时候执行的某些操作非常重要，这些操作必须连续执行不允许被外界干扰，这时就可以使用中断屏蔽机制把所有外部提交的中断请求屏蔽掉。</p>
<p>当CPU闭关修炼完成，就可以打开中断，允许接收外部的中断请求了。</p>
<h2 id="3-3-CC2530的外部中断及其配置"><a href="#3-3-CC2530的外部中断及其配置" class="headerlink" title="3-3 CC2530的外部中断及其配置"></a>3-3 CC2530的外部中断及其配置</h2><h3 id="3-3-1-介绍"><a href="#3-3-1-介绍" class="headerlink" title="3-3-1 介绍"></a>3-3-1 介绍</h3><p>CC2530 共有18个中断源。</p>
<p>每个中断源都有一个中断名，这个中断名就是中断向量。</p>
<p>每个中断源都有一个中断标志位。</p>
<p>每个中断源都有一个 “允许&#x2F;屏蔽“ 控制位。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318180418688.png"
                      alt="image-20240318180418688"
                ></li>
</ul>
<h3 id="3-3-2-IEN0、IEN1、IEN2"><a href="#3-3-2-IEN0、IEN1、IEN2" class="headerlink" title="3-3-2 IEN0、IEN1、IEN2"></a>3-3-2 IEN0、IEN1、IEN2</h3><p>I——Interrupt；EN——Enable。</p>
<p>IEN0、IEN1、IEN2 这三个 SFR每个都用了6个 bit 来分别管理 6个中断源的 “允许&#x2F;屏蔽” 功能。</p>
<p>这些 bit 都有自己专属的名字，“P0IE” 就是P0端口的中断请求 “允许&#x2F;屏蔽” 位名。</p>
<p>IEN0 中有一个bit叫 EA，用来控制系统所有的中断使能。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318192439100.png"
                      alt="image-20240318192439100"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318192501077.png"
                      alt="image-20240318192501077"
                ></li>
</ul>
<h3 id="3-3-3-中断标志位的作用"><a href="#3-3-3-中断标志位的作用" class="headerlink" title="3-3-3 中断标志位的作用"></a>3-3-3 中断标志位的作用</h3><p>当某个外部中断请求被允许，则对应的中断标志位被<strong>置位</strong> (这个操作由硬件自动完成)，表示希望CPU能够对其进行响应。</p>
<p>在决定响应这个中断请求的功能时CPU得到中断请求后，需要把中断标志位<strong>复位</strong> (这个操作需要程序员在代码中编写完成)，表示已经收到请求，正在对其进行服务。</p>
<p>只 “置位” 不 “复位” 会造成逻辑出错。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318193043126.png"
                      alt="image-20240318193043126"
                ></li>
</ul>
<h3 id="3-3-4-CC2530中断配置步骤"><a href="#3-3-4-CC2530中断配置步骤" class="headerlink" title="3-3-4 CC2530中断配置步骤"></a>3-3-4 CC2530中断配置步骤</h3><p>1.清除中断标志位</p>
<p>2.开启中断允许</p>
<p>3.打开全局中断允许</p>
<h2 id="3-4-实战与挑战"><a href="#3-4-实战与挑战" class="headerlink" title="3-4 实战与挑战"></a>3-4 实战与挑战</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318193739261.png"
                      alt="image-20240318193739261"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240318193759233.png"
                      alt="image-20240318193759233"
                ></p>
</li>
</ul>
<h1 id="4-定时器-计数器"><a href="#4-定时器-计数器" class="headerlink" title="4- 定时器&#x2F;计数器"></a>4- 定时器&#x2F;计数器</h1><h2 id="4-1-振荡器"><a href="#4-1-振荡器" class="headerlink" title="4-1 振荡器"></a>4-1 振荡器</h2><h3 id="4-1-1-介绍"><a href="#4-1-1-介绍" class="headerlink" title="4-1-1 介绍"></a>4-1-1 介绍</h3><p>晶振 (CrystalOscillator，简写为OSC) ：</p>
<ul>
<li>利用 “石英晶体” 制作的振荡器。</li>
</ul>
<p>RC振荡器：</p>
<ul>
<li>利用 电阻电容 的特性制作的振荡器。</li>
</ul>
<h3 id="4-1-2-振荡频率"><a href="#4-1-2-振荡频率" class="headerlink" title="4-1-2 振荡频率"></a>4-1-2 振荡频率</h3><p>振荡器可以产生一定Hz的频率。</p>
<p>振荡的频率 f 和 振荡的周期 T 之间的关系是：</p>
<ul>
<li>T &#x3D; 1 &#x2F; f</li>
<li>1s &#x3D; 1 &#x2F; 1Hz</li>
</ul>
<h3 id="4-1-3-振荡器的作用"><a href="#4-1-3-振荡器的作用" class="headerlink" title="4-1-3 振荡器的作用"></a>4-1-3 振荡器的作用</h3><p>振荡器所输出的振荡频率主要用于为单片机提供系统时钟。</p>
<p>单片机的CPU在系统时钟脉冲信号的驱使下 “有节奏” 的执行机器指令，系统时钟频率越高，单位时间内CPU可以处理的机器指令的条数也就越多，机器的运算速度就越快。</p>
<h2 id="4-2-分频"><a href="#4-2-分频" class="headerlink" title="4-2 分频"></a>4-2 分频</h2><h3 id="4-2-1-分频的作用"><a href="#4-2-1-分频的作用" class="headerlink" title="4-2-1 分频的作用"></a>4-2-1 分频的作用</h3><p>晶振的自然频率远远大于1Hz，需要将晶振频率降低实现。</p>
<p>单片机中CPU是 “快节奏” 部件，除此以外还有很多 “慢节奏” 部件需要相对较低的频率来控制它们的工作。</p>
<h3 id="4-2-2-分频的概念"><a href="#4-2-2-分频的概念" class="headerlink" title="4-2-2 分频的概念"></a>4-2-2 分频的概念</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401103004711.png"
                      alt="image-20240401103004711"
                ></li>
</ul>
<h3 id="4-2-3-如何实现分频"><a href="#4-2-3-如何实现分频" class="headerlink" title="4-2-3 如何实现分频"></a>4-2-3 如何实现分频</h3><p>定时器 &#x2F; 计数器是一种硬件装置，往往被内置在单片机内部。</p>
<p>定时器 &#x2F; 计数器兼有 “定时” 和 “计数” 两个功能。</p>
<p>通过设置定时器 &#x2F; 计数器的 “计数值” ，可以实现对输入的频率进行分频的效果。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401105929349.png"
                      alt="image-20240401105929349"
                ></li>
</ul>
<h2 id="4-3-CC2530中的振荡器和时钟"><a href="#4-3-CC2530中的振荡器和时钟" class="headerlink" title="4-3 CC2530中的振荡器和时钟"></a>4-3 CC2530中的振荡器和时钟</h2><h3 id="4-3-1-介绍"><a href="#4-3-1-介绍" class="headerlink" title="4-3-1 介绍"></a>4-3-1 介绍</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401111030050.png"
                      alt="image-20240401111030050"
                ></li>
</ul>
<h3 id="4-3-2-高频振荡器"><a href="#4-3-2-高频振荡器" class="headerlink" title="4-3-2 高频振荡器"></a>4-3-2 高频振荡器</h3><p>32MHz 晶体振荡器 和 16MHz RC振荡器</p>
<ul>
<li>晶体产生振荡是利用 “压电效应“，32MHz的晶体振荡器，从产生振荡到输出频率达到平稳状态的启动时间，对于某些应用来说可能太长了。</li>
<li>因此设备可以先运行在16MHz的RC振荡器中，直到晶体振荡器稳定后再使用32MHz晶体振荡器。</li>
<li>16MHz的RC振荡器功耗低但是不是很准，所以不能为RF模块提供服务，只能用32MHz的晶体振荡器。</li>
</ul>
<h3 id="4-3-3-低频振荡器"><a href="#4-3-3-低频振荡器" class="headerlink" title="4-3-3 低频振荡器"></a>4-3-3 低频振荡器</h3><p>32kHz 晶体振荡器 和 32kHz RC振荡器</p>
<ul>
<li>32kHz的XOSC被设计的工作频率频率是32.768KHz，并且可以为一些要求时钟准确子系统提供一个稳定的时钟信号。</li>
<li>低频振荡用作系统休眠时提供休眠时钟以降低功耗。</li>
</ul>
<h3 id="4-3-4-主时钟"><a href="#4-3-4-主时钟" class="headerlink" title="4-3-4 主时钟"></a>4-3-4 主时钟</h3><p>CC2530有一个内部时钟，也叫主时钟。</p>
<ul>
<li>主时钟频率一般在32MHz。</li>
<li>系统上电后默认使用的是 16MHz 的RC振荡器提供主时钟，当 32MHz 的晶振稳定后，可以选择由 32MHz 的晶振来提供主时钟。</li>
<li>开发人员可以根据实际应用需要来选择不同的时钟源提供主时钟。</li>
</ul>
<h3 id="4-3-5-应用案例"><a href="#4-3-5-应用案例" class="headerlink" title="4-3-5 应用案例"></a>4-3-5 应用案例</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401114638933.png"
                      alt="image-20240401114638933"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401114717233.png"
                      alt="image-20240401114717233"
                ></p>
</li>
</ul>
<h2 id="4-4-CC2530中的Timers"><a href="#4-4-CC2530中的Timers" class="headerlink" title="4-4 CC2530中的Timers"></a>4-4 CC2530中的Timers</h2><h3 id="4-4-1-介绍"><a href="#4-4-1-介绍" class="headerlink" title="4-4-1 介绍"></a>4-4-1 介绍</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401180710702.png"
                      alt="image-20240401180710702"
                ></li>
</ul>
<h3 id="4-4-2-Timer1"><a href="#4-4-2-Timer1" class="headerlink" title="4-4-2 Timer1"></a>4-4-2 Timer1</h3><ul>
<li><p>Timer1 是一个16位定时器，具有定时、计数、PWM (Pulse WidthModulation，脉冲宽度调制，简称脉宽调制) 功能。</p>
</li>
<li><p>它内置可编程分频器，可以对输入的时钟信号进行分频。</p>
</li>
<li><p>16位计数器可以实现从 0x0000 到 0xFFFF 之间任意间的计数。</p>
</li>
<li><p>Timer1拥有5个独立的均可编程的计数&#x2F;捕获通道，每个通道都能实现16位的计数或者输出PWM等功能。</p>
</li>
<li><p>Timer1还可以被设置为中断请求模式，在计数结束时向CPU提出中断请求。</p>
</li>
</ul>
<h3 id="4-4-3-Timer2"><a href="#4-4-3-Timer2" class="headerlink" title="4-4-3 Timer2"></a>4-4-3 Timer2</h3><ul>
<li><p>Timer2 也叫 MAC Timer，是专门用来为支持IEEE 802.15.4协议 (低速无线个人网络) 的MAC层提供时钟信号。</p>
</li>
<li><p>如果利用CC2530内置的RF (RadioFrequency，射频) 功能进行数据传输，也就是Zigbee通信，那就需要 Timer2 产生的时钟信号进行数据的收发控制。</p>
</li>
</ul>
<h3 id="4-4-4-Timer3-和-Timer4"><a href="#4-4-4-Timer3-和-Timer4" class="headerlink" title="4-4-4 Timer3 和 Timer4"></a>4-4-4 Timer3 和 Timer4</h3><ul>
<li><p>Timer3 和 Timer4 都是8位的定时器，它们同样具有定时、计数以及PWM功能。</p>
</li>
<li><p>它们跟 Timer1 一样也内置了可编程分频器，但他们内部的计数器是8位的，计数范围是 0x00 到 0xFF 。</p>
</li>
<li><p>Timer3 和 Timer4 都只有一个计数通道，这个通道同样可以产生PWM。</p>
</li>
</ul>
<h3 id="4-4-5-Sleep-Timer"><a href="#4-4-5-Sleep-Timer" class="headerlink" title="4-4-5 Sleep Timer"></a>4-4-5 Sleep Timer</h3><ul>
<li><p>Sleep Timer 是一个超低功耗定时器，可以对32kHz 晶振或者32kHz RC振荡器周期进行计数。</p>
</li>
<li><p>CC2530处于休眠状态时它可以用来作为实时时钟。</p>
</li>
<li><p>还可以作为CC2530从休眠到唤醒时的唤醒时钟。</p>
</li>
</ul>
<h2 id="4-5-CC2530中的Timer1-T1"><a href="#4-5-CC2530中的Timer1-T1" class="headerlink" title="4-5 CC2530中的Timer1 (T1)"></a>4-5 CC2530中的Timer1 (T1)</h2><h3 id="4-5-1-介绍"><a href="#4-5-1-介绍" class="headerlink" title="4-5-1 介绍"></a>4-5-1 介绍</h3><p>包含一个16位计数器，在每个活动时钟边沿递增或递减。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401183817394.png"
                      alt="image-20240401183817394"
                ></li>
</ul>
<p>系统时钟可以预先被1，8，32或128分频后再作为计数时钟。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401183905224.png"
                      alt="image-20240401183905224"
                ></li>
</ul>
<p>有自由运行、模计数、正计数&#x2F;倒计数 三种工作模式。</p>
<ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401183958530.png"
                      alt="image-20240401183958530"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401184023881.png"
                      alt="image-20240401184023881"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401184043996.png"
                      alt="image-20240401184043996"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401184105848.png"
                      alt="image-20240401184105848"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401184124022.png"
                      alt="image-20240401184124022"
                ></p>
</li>
</ul>
<p>有5个独立的捕获&#x2F;比较通道。</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401184205951.png"
                      alt="image-20240401184205951"
                ></li>
</ul>
<p>可提交中断请求。</p>
<p>DMA触发功能。</p>
<h3 id="4-5-2-初始化配置"><a href="#4-5-2-初始化配置" class="headerlink" title="4-5-2 初始化配置"></a>4-5-2 初始化配置</h3><ul>
<li><p>修改 T1CTL 的值来设置 Timer1 的计数频率、工作模式等。</p>
</li>
<li><p>如果工作在模计数模式或者正计数&#x2F;倒计数模式下时，需要配置对应通道的 T1CCn 的值，即先写 T1CCnL ，再写 T1CCnH 的值。</p>
</li>
<li><p>设置对应通道是比较还是捕获模式，即修改 T1CCTLn 的值。</p>
</li>
<li><p>如果需要使用中断还要配置相应的中断使能和中断标志位。</p>
</li>
</ul>
<h2 id="4-6-实战"><a href="#4-6-实战" class="headerlink" title="4-6 实战"></a>4-6 实战</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401201222603.png"
                      alt="image-20240401201222603"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401201339096.png"
                      alt="image-20240401201339096"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401201354732.png"
                      alt="image-20240401201354732"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240401201413185.png"
                      alt="image-20240401201413185"
                ></p>
</li>
</ul>
<h1 id="5-串行通信"><a href="#5-串行通信" class="headerlink" title="5- 串行通信"></a>5- 串行通信</h1><h2 id="5-1-通信介绍"><a href="#5-1-通信介绍" class="headerlink" title="5-1 通信介绍"></a>5-1 通信介绍</h2><h3 id="5-1-1-通信系统三要素"><a href="#5-1-1-通信系统三要素" class="headerlink" title="5-1-1 通信系统三要素"></a>5-1-1 通信系统三要素</h3><ul>
<li><p>信源、信道、信宿（发送端、传输介质、接收端）。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422082321987.png"
                      alt="image-20240422082321987"
                ></p>
</li>
</ul>
<h3 id="5-1-2-并行通信与串行通信"><a href="#5-1-2-并行通信与串行通信" class="headerlink" title="5-1-2 并行通信与串行通信"></a>5-1-2 并行通信与串行通信</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422082406929.png"
                      alt="image-20240422082406929"
                ></li>
</ul>
<h2 id="5-2-串行通信介绍"><a href="#5-2-串行通信介绍" class="headerlink" title="5-2 串行通信介绍"></a>5-2 串行通信介绍</h2><h3 id="5-2-1-串行通信中数据收发过程"><a href="#5-2-1-串行通信中数据收发过程" class="headerlink" title="5-2-1 串行通信中数据收发过程"></a>5-2-1 串行通信中数据收发过程</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422082843730.png"
                      alt="image-20240422082843730"
                ></li>
</ul>
<h3 id="5-2-2-同步串行通信介绍"><a href="#5-2-2-同步串行通信介绍" class="headerlink" title="5-2-2 同步串行通信介绍"></a>5-2-2 同步串行通信介绍</h3><ul>
<li><p>发送方在发送数据时，接收方必须也在时刻准备着接收数据。</p>
</li>
<li><p>发送方和接收方的时钟频率相同，否则会造成数据错误。</p>
</li>
<li><p>发送方所发送的数据帧中字符是一个挨着一个传递，字符之间没有间隙（空闲）。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422083031077.png"
                      alt="image-20240422083031077"
                ></p>
</li>
</ul>
<h3 id="5-2-3-异步串行通信介绍"><a href="#5-2-3-异步串行通信介绍" class="headerlink" title="5-2-3 异步串行通信介绍"></a>5-2-3 异步串行通信介绍</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422083335071.png"
                      alt="image-20240422083335071"
                ></li>
</ul>
<h3 id="5-2-4-常用异步串行通信接口-—-UART"><a href="#5-2-4-常用异步串行通信接口-—-UART" class="headerlink" title="5-2-4 常用异步串行通信接口 — UART"></a>5-2-4 常用异步串行通信接口 — UART</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422084048295.png"
                      alt="image-20240422084048295"
                ></li>
</ul>
<h3 id="5-2-5-波特率"><a href="#5-2-5-波特率" class="headerlink" title="5-2-5 波特率"></a>5-2-5 波特率</h3><p>概念：</p>
<ul>
<li>指每秒钟发生的信号或符号的变化的数量，这里的符号可以是 “电压、频率或相位” 。</li>
</ul>
<p>作用：</p>
<ul>
<li>用来在通信双方约定好 “数据” 的传输速率，这样发送端与接收端才能保持 “步调一致” 地进行 “发和收” ，否则就会出现 “发得快收得慢” 或者 “发得慢收得快” 的情况。</li>
</ul>
<h2 id="5-3-CC2530中的串行通信接口"><a href="#5-3-CC2530中的串行通信接口" class="headerlink" title="5-3 CC2530中的串行通信接口"></a>5-3 CC2530中的串行通信接口</h2><ul>
<li><p>CC2530中有两个独立的 USART 接口，分别是 USART0 和 USART1 。</p>
</li>
<li><p>它们可以分别工作在 “异步串行通信” 的 UART 模式下或者 “同步串行通信” 的 SPI 模式下。</p>
</li>
<li><p>UART 操作由 USART 控制和状态寄存器 UxCSR 以及 UART 控制寄存器 UxUCR 来控制。这里的 x 是 USART 的编号，其数值为 0 或者 1。当 UxCSR.MODE 设置为 1 时，就选择了 UART 模式。</p>
</li>
<li><p>UxDBUF 是双向缓冲寄存器，当执行数据发送时，首先将要发送的字符存入到 UxDBUF 中；当执行数据接收时，从 UxDBUF 中读取数据。</p>
</li>
<li><p>通过 UxUCR 来设置当前异步串行通信的配置，包括：起始位用高电平还是低电平、数据位位数、停止位位数、是否有奇偶校验位等。</p>
</li>
<li><p>通过 UxBAUD 和 UxGCR 的组合来配置 USARTx 的波特率。</p>
</li>
<li><p>CC2530中的两个 USART 都可以向 MCU 提出 “数据接收完成中断请求” 和 “数据发送完成中断请求” 。</p>
</li>
</ul>
<h2 id="5-4-CC2530中的串口编程应用"><a href="#5-4-CC2530中的串口编程应用" class="headerlink" title="5-4 CC2530中的串口编程应用"></a>5-4 CC2530中的串口编程应用</h2><h3 id="5-4-1-串口初始化"><a href="#5-4-1-串口初始化" class="headerlink" title="5-4-1 串口初始化"></a>5-4-1 串口初始化</h3><ul>
<li><p>初始化中包含对CC2530中 USARTn 的选择、同步异步选择、异步串行通信中数据帧格式的设置、波特率的设置等。</p>
</li>
<li><p>这里会涉及到 UxCSR、UxUCR 、UxBAUD和UxGCR 设置。</p>
</li>
<li><p>另外CC2530的 USARTn 控制器是连接在 GPIO 中的，还需要对相应的 pin 进行配置。</p>
</li>
</ul>
<h3 id="5-4-2-CC2530中外设引脚映射关系表"><a href="#5-4-2-CC2530中外设引脚映射关系表" class="headerlink" title="5-4-2 CC2530中外设引脚映射关系表"></a>5-4-2 CC2530中外设引脚映射关系表</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422093516963.png"
                      alt="image-20240422093516963"
                ></li>
</ul>
<h3 id="5-4-3-实例"><a href="#5-4-3-实例" class="headerlink" title="5-4-3 实例"></a>5-4-3 实例</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422094223264.png"
                      alt="image-20240422094223264"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-22%20094411.png"
                      alt="屏幕截图 2024-04-22 094411"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-22%20094527.png"
                      alt="屏幕截图 2024-04-22 094527"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-22%20094538.png"
                      alt="屏幕截图 2024-04-22 094538"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-22%20094655.png"
                      alt="屏幕截图 2024-04-22 094655"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422094918066.png"
                      alt="image-20240422094918066"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-22%20094715.png"
                      alt="屏幕截图 2024-04-22 094715"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-22%20094724.png"
                      alt="屏幕截图 2024-04-22 094724"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-22%20094735.png"
                      alt="屏幕截图 2024-04-22 094735"
                ></p>
</li>
</ul>
<h3 id="5-4-4-串口发送数据功能"><a href="#5-4-4-串口发送数据功能" class="headerlink" title="5-4-4 串口发送数据功能"></a>5-4-4 串口发送数据功能</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422095632562.png"
                      alt="image-20240422095632562"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422095703389.png"
                      alt="image-20240422095703389"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422095720690.png"
                      alt="image-20240422095720690"
                ></p>
</li>
</ul>
<h3 id="5-4-5-串口接收数据功能"><a href="#5-4-5-串口接收数据功能" class="headerlink" title="5-4-5 串口接收数据功能"></a>5-4-5 串口接收数据功能</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422104240441.png"
                      alt="image-20240422104240441"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422104258747.png"
                      alt="image-20240422104258747"
                ></p>
</li>
</ul>
<h2 id="5-5-实战"><a href="#5-5-实战" class="headerlink" title="5-5 实战"></a>5-5 实战</h2><h3 id="5-5-1-要求"><a href="#5-5-1-要求" class="headerlink" title="5-5-1 要求"></a>5-5-1 要求</h3><ul>
<li>将PC机与xLabGreenHouse的Node3 CC2530连接，当通过PC机的键盘输入一串以‘@’结束的字符串，通过串口工具发送给CC2530，CC2530将刚才接收到的内容原样输出到串口工具界面中。</li>
</ul>
<h3 id="5-5-2-实现"><a href="#5-5-2-实现" class="headerlink" title="5-5-2 实现"></a>5-5-2 实现</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422104809842.png"
                      alt="image-20240422104809842"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422104825549.png"
                      alt="image-20240422104825549"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422104847083.png"
                      alt="image-20240422104847083"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422104901820.png"
                      alt="image-20240422104901820"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240422104920269.png"
                      alt="image-20240422104920269"
                ></p>
</li>
</ul>
<h1 id="6-ADC"><a href="#6-ADC" class="headerlink" title="6- ADC"></a>6- ADC</h1><h2 id="6-1-模拟信号和数字信号"><a href="#6-1-模拟信号和数字信号" class="headerlink" title="6-1 模拟信号和数字信号"></a>6-1 模拟信号和数字信号</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513081142160.png"
                      alt="image-20240513081142160"
                ></li>
</ul>
<p>模拟量：</p>
<ul>
<li>任何两个数字之间都有无限个中间值，所以称之为连续变化的量，也就是模拟量。</li>
</ul>
<p>数字量：</p>
<ul>
<li>数字间有一定的间隔，不是连续的，即离散的量称之为数字量。</li>
</ul>
<p>A&#x2F;D：</p>
<ul>
<li>Analog to Digital Converter，用模数转换器实现模拟量到数字量的转换，简称ADC。</li>
</ul>
<p>D&#x2F;A：</p>
<ul>
<li>Digitalto Analog Converter，用数模转换器实现数字量到模拟量的转换，简称DAC。</li>
</ul>
<h2 id="6-2-ADC"><a href="#6-2-ADC" class="headerlink" title="6-2 ADC"></a>6-2 ADC</h2><h3 id="6-2-1-介绍"><a href="#6-2-1-介绍" class="headerlink" title="6-2-1 介绍"></a>6-2-1 介绍</h3><p>ADC ( analog to digital converter )：</p>
<ul>
<li>模数转换器，它是将连续变化的模拟信号转换为离散的数字信号的器件。</li>
</ul>
<h3 id="6-2-2-转换"><a href="#6-2-2-转换" class="headerlink" title="6-2-2 转换"></a>6-2-2 转换</h3><p>转换过程：</p>
<ul>
<li><p>采样 → 量化 → 编码</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513081950660.png"
                      alt="image-20240513081950660"
                ></p>
</li>
</ul>
<p>实例：</p>
<ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513082147734.png"
                      alt="image-20240513082147734"
                ></li>
</ul>
<h3 id="6-2-3-分辨率"><a href="#6-2-3-分辨率" class="headerlink" title="6-2-3 分辨率"></a>6-2-3 分辨率</h3><p>分辨率：</p>
<ul>
<li>能够分辨出模拟量之间变化的最小值。</li>
<li>1个二进制数据描述 0~5V 的电压变化，分辨率是 2.5V。</li>
<li>2个二进制数据描述 0~5V 的电压变化，分辨率是 1.25V。</li>
<li>3个二进制数据描述 0~5V 的电压变化，分辨率是 0.625V</li>
</ul>
<h3 id="6-2-4-重要参数"><a href="#6-2-4-重要参数" class="headerlink" title="6-2-4 重要参数"></a>6-2-4 重要参数</h3><p>ADC的位数：</p>
<ul>
<li><p>一个 n 位的 ADC 表示这个 ADC 共有 2的n次方 个刻度。</p>
</li>
<li><p>8 位的 ADC，输出的是从 0~255 一共256个数字量，也就是 2的8次方 个数据刻度。</p>
</li>
</ul>
<p>参考电压：</p>
<ul>
<li><p>也叫做基准电压，是 ADC 的参考基准，是指转换后满量程所对应的电压值，是 ADC 的一个重要指标。</p>
</li>
<li><p>要想把输入 ADC 的信号测量准确，那么基准源首先要准，基准源的偏差会直接导致转换结果的偏差。</p>
</li>
</ul>
<p>分辨率：</p>
<ul>
<li><p>数字量变化一个最小刻度，模拟信号的变化量，定义为满刻度量程与 2的n次方 的比值。</p>
</li>
<li><p>假定 5.10V 的电压系统，使用8位的 ADC 进行测量，那么相当于 0~255 一共 256 个刻度把 5.10V 平均分成了255 份，那么分辨率就是 5.10&#x2F;255 &#x3D; 0.02V。</p>
</li>
</ul>
<p>转换速率：</p>
<ul>
<li>是指 ADC 每秒能进行采样转换的最大次数单位是 sps ( samples per second )。</li>
</ul>
<h3 id="6-2-5-逐次逼近型ADC的原理"><a href="#6-2-5-逐次逼近型ADC的原理" class="headerlink" title="6-2-5 逐次逼近型ADC的原理"></a>6-2-5 逐次逼近型ADC的原理</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513084103073.png"
                      alt="image-20240513084103073"
                ></li>
</ul>
<h2 id="6-3-CC2530的ADC"><a href="#6-3-CC2530的ADC" class="headerlink" title="6-3 CC2530的ADC"></a>6-3 CC2530的ADC</h2><h3 id="6-3-1-介绍"><a href="#6-3-1-介绍" class="headerlink" title="6-3-1 介绍"></a>6-3-1 介绍</h3><ul>
<li>可选7~12位的分辨率</li>
<li>8个独立的输入通道，可接收单端或差分信号</li>
<li>转换结束时可选 中断触发 或 DMA触发</li>
<li>配有温度传感器输入</li>
<li>具有电池测量功能</li>
</ul>
<h3 id="6-3-2-CC2530的ADC方框图："><a href="#6-3-2-CC2530的ADC方框图：" class="headerlink" title="6-3-2 CC2530的ADC方框图："></a>6-3-2 CC2530的ADC方框图：</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513090712282.png"
                      alt="image-20240513090712282"
                ></li>
</ul>
<h3 id="6-3-3-与ADC有关的SFR"><a href="#6-3-3-与ADC有关的SFR" class="headerlink" title="6-3-3 与ADC有关的SFR"></a>6-3-3 与ADC有关的SFR</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513090939286.png"
                      alt="image-20240513090939286"
                ></li>
</ul>
<h2 id="6-4-CC2530的ADC编程应用"><a href="#6-4-CC2530的ADC编程应用" class="headerlink" title="6-4 CC2530的ADC编程应用"></a>6-4 CC2530的ADC编程应用</h2><h3 id="6-4-1-ADC初始化"><a href="#6-4-1-ADC初始化" class="headerlink" title="6-4-1 ADC初始化"></a>6-4-1 ADC初始化</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513094154578.png"
                      alt="image-20240513094154578"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513094230400.png"
                      alt="image-20240513094230400"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513094254375.png"
                      alt="image-20240513094254375"
                ></p>
</li>
</ul>
<h3 id="6-4-2-CC2530片内温度传感器数值计算"><a href="#6-4-2-CC2530片内温度传感器数值计算" class="headerlink" title="6-4-2 CC2530片内温度传感器数值计算"></a>6-4-2 CC2530片内温度传感器数值计算</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513094405881.png"
                      alt="image-20240513094405881"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513094428537.png"
                      alt="image-20240513094428537"
                ></p>
</li>
</ul>
<h2 id="6-5-实战"><a href="#6-5-实战" class="headerlink" title="6-5 实战"></a>6-5 实战</h2><h3 id="6-5-1-要求"><a href="#6-5-1-要求" class="headerlink" title="6-5-1 要求"></a>6-5-1 要求</h3><ul>
<li>实时获取 xLabGreenHouse 实验平台中任意一个 CC2530 节点的芯片温度，并将获取的温度数据实时输出到与之连接的 PC 机的串口调试助手的接收区中。</li>
<li>利用 CC2530 片上 ADC 获取片内温度传感器的数据</li>
<li>配置串口通信实现数据的实时传输</li>
</ul>
<h3 id="6-5-2-实现"><a href="#6-5-2-实现" class="headerlink" title="6-5-2 实现"></a>6-5-2 实现</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513100653396.png"
                      alt="image-20240513100653396"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240513100714797.png"
                      alt="image-20240513100714797"
                ></p>
</li>
</ul>
]]></content>
      <categories>
        <category>硬件</category>
        <category>单片机</category>
      </categories>
      <tags>
        <tag>课程笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络</title>
    <url>/2024/06/22/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
    <content><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1- 概述"></a>1- 概述</h1><h2 id="1-1-因特网的概述"><a href="#1-1-因特网的概述" class="headerlink" title="1-1 因特网的概述"></a>1-1 因特网的概述</h2><h3 id="1-1-1-网络、互联网和因特网"><a href="#1-1-1-网络、互联网和因特网" class="headerlink" title="1-1-1 网络、互联网和因特网"></a>1-1-1 网络、互联网和因特网</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623154313650.png"
                      alt="image-20240623154313650"
                ></li>
</ul>
<h3 id="1-1-2-因特网发展的三个阶段"><a href="#1-1-2-因特网发展的三个阶段" class="headerlink" title="1-1-2 因特网发展的三个阶段"></a>1-1-2 因特网发展的三个阶段</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623154513929.png"
                      alt="image-20240623154513929"
                ></li>
</ul>
<h3 id="1-1-3-因特网的标准化工作"><a href="#1-1-3-因特网的标准化工作" class="headerlink" title="1-1-3 因特网的标准化工作"></a>1-1-3 因特网的标准化工作</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623154922111.png"
                      alt="image-20240623154922111"
                ></li>
</ul>
<h3 id="1-3-4-因特网的组成"><a href="#1-3-4-因特网的组成" class="headerlink" title="1-3-4 因特网的组成"></a>1-3-4 因特网的组成</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623155102672.png"
                      alt="image-20240623155102672"
                ></li>
</ul>
<h2 id="1-2-三种交换方式"><a href="#1-2-三种交换方式" class="headerlink" title="1-2- 三种交换方式"></a>1-2- 三种交换方式</h2><h3 id="1-2-1-电路交换"><a href="#1-2-1-电路交换" class="headerlink" title="1-2-1 电路交换"></a>1-2-1 电路交换</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623155553848.png"
                      alt="image-20240623155553848"
                ></li>
</ul>
<h3 id="1-2-2-分组交换"><a href="#1-2-2-分组交换" class="headerlink" title="1-2-2 分组交换"></a>1-2-2 分组交换</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623160104789.png"
                      alt="image-20240623160104789"
                ></li>
</ul>
<h3 id="1-2-3-电路交换、报文交换、分组交换的对比"><a href="#1-2-3-电路交换、报文交换、分组交换的对比" class="headerlink" title="1-2-3 电路交换、报文交换、分组交换的对比"></a>1-2-3 电路交换、报文交换、分组交换的对比</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623160550729.png"
                      alt="image-20240623160550729"
                ></li>
</ul>
<h2 id="1-3-计算机网络的定义和分类"><a href="#1-3-计算机网络的定义和分类" class="headerlink" title="1-3 计算机网络的定义和分类"></a>1-3 计算机网络的定义和分类</h2><h3 id="1-3-1-定义"><a href="#1-3-1-定义" class="headerlink" title="1-3-1 定义"></a>1-3-1 定义</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623160837159.png"
                      alt="image-20240623160837159"
                ></li>
</ul>
<h3 id="1-3-2-分类"><a href="#1-3-2-分类" class="headerlink" title="1-3-2 分类"></a>1-3-2 分类</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623161211808.png"
                      alt="image-20240623161211808"
                ></li>
</ul>
<h2 id="1-4-计算机网络的性能指标"><a href="#1-4-计算机网络的性能指标" class="headerlink" title="1-4 计算机网络的性能指标"></a>1-4 计算机网络的性能指标</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623161947115.png"
                      alt="image-20240623161947115"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623162217046.png"
                      alt="image-20240623162217046"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623162444594.png"
                      alt="image-20240623162444594"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623162950356.png"
                      alt="image-20240623162950356"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623163214547.png"
                      alt="image-20240623163214547"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623163322940.png"
                      alt="image-20240623163322940"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623163549988.png"
                      alt="image-20240623163549988"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623163731182.png"
                      alt="image-20240623163731182"
                ></p>
</li>
</ul>
<h2 id="1-5-计算机网络体系结构"><a href="#1-5-计算机网络体系结构" class="headerlink" title="1-5 计算机网络体系结构"></a>1-5 计算机网络体系结构</h2><h3 id="1-5-1-常见的计算机网络体系结构"><a href="#1-5-1-常见的计算机网络体系结构" class="headerlink" title="1-5-1 常见的计算机网络体系结构"></a>1-5-1 常见的计算机网络体系结构</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623164032233.png"
                      alt="image-20240623164032233"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623164318159.png"
                      alt="image-20240623164318159"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623164339238.png"
                      alt="image-20240623164339238"
                ></p>
</li>
</ul>
<h3 id="1-5-2-计算机网络体系结构分层的必要性"><a href="#1-5-2-计算机网络体系结构分层的必要性" class="headerlink" title="1-5-2 计算机网络体系结构分层的必要性"></a>1-5-2 计算机网络体系结构分层的必要性</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623164902318.png"
                      alt="image-20240623164902318"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623164933343.png"
                      alt="image-20240623164933343"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623165005243.png"
                      alt="image-20240623165005243"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623165035247.png"
                      alt="image-20240623165035247"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623165100538.png"
                      alt="image-20240623165100538"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623165151818.png"
                      alt="image-20240623165151818"
                ></p>
</li>
</ul>
<h3 id="1-5-3-计算机网络体系结构分层思想举例"><a href="#1-5-3-计算机网络体系结构分层思想举例" class="headerlink" title="1-5-3 计算机网络体系结构分层思想举例"></a>1-5-3 计算机网络体系结构分层思想举例</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623165529381.png"
                      alt="image-20240623165529381"
                ></li>
</ul>
<h3 id="1-5-4-计算机网络体系结构中的专用术语"><a href="#1-5-4-计算机网络体系结构中的专用术语" class="headerlink" title="1-5-4 计算机网络体系结构中的专用术语"></a>1-5-4 计算机网络体系结构中的专用术语</h3><ul>
<li><p>实体</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623165801734.png"
                      alt="image-20240623165801734"
                ></p>
</li>
<li><p>协议</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623170635537.png"
                      alt="image-20240623170635537"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623170754118.png"
                      alt="image-20240623170754118"
                ></p>
</li>
<li><p>服务</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623170158203.png"
                      alt="image-20240623170158203"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623170404386.png"
                      alt="image-20240623170404386"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623170454549.png"
                      alt="image-20240623170454549"
                ></p>
</li>
</ul>
<h1 id="2-物理层"><a href="#2-物理层" class="headerlink" title="2- 物理层"></a>2- 物理层</h1><h2 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2-1 概述"></a>2-1 概述</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623171654653.png"
                      alt="image-20240623171654653"
                ></li>
</ul>
<h2 id="2-2-物理层下面的传输媒体"><a href="#2-2-物理层下面的传输媒体" class="headerlink" title="2-2 物理层下面的传输媒体"></a>2-2 物理层下面的传输媒体</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623182613312.png"
                      alt="image-20240623182613312"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623184933641.png"
                      alt="image-20240623184933641"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623184656173.png"
                      alt="image-20240623184656173"
                ></li>
</ul>
<h2 id="2-3-传输方式"><a href="#2-3-传输方式" class="headerlink" title="2-3 传输方式"></a>2-3 传输方式</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623183007249.png"
                      alt="image-20240623183007249"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623183150971.png"
                      alt="image-20240623183150971"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-06-23%20183252.png"
                      alt="屏幕截图 2024-06-23 183252"
                ></p>
</li>
</ul>
<h2 id="2-4-编码与调制"><a href="#2-4-编码与调制" class="headerlink" title="2-4 编码与调制"></a>2-4 编码与调制</h2><h3 id="2-4-1-概述"><a href="#2-4-1-概述" class="headerlink" title="2-4-1 概述"></a>2-4-1 概述</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623183559066.png"
                      alt="image-20240623183559066"
                ></li>
</ul>
<h3 id="2-4-2-编码"><a href="#2-4-2-编码" class="headerlink" title="2-4-2 编码"></a>2-4-2 编码</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623194307576.png"
                      alt="image-20240623194307576"
                ></li>
</ul>
<h3 id="2-4-3-调制"><a href="#2-4-3-调制" class="headerlink" title="2-4-3 调制"></a>2-4-3 调制</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623194442148.png"
                      alt="image-20240623194442148"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623212503544.png"
                      alt="image-20240623212503544"
                ></p>
</li>
</ul>
<h2 id="2-5-信道的极限容量"><a href="#2-5-信道的极限容量" class="headerlink" title="2-5 信道的极限容量"></a>2-5 信道的极限容量</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623195042558.png"
                      alt="image-20240623195042558"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623195137807.png"
                      alt="image-20240623195137807"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623195213928.png"
                      alt="image-20240623195213928"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623195238893.png"
                      alt="image-20240623195238893"
                ></li>
</ul>
<h1 id="3-数据链路层"><a href="#3-数据链路层" class="headerlink" title="3- 数据链路层"></a>3- 数据链路层</h1><h2 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3-1 概述"></a>3-1 概述</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623185341248.png"
                      alt="image-20240623185341248"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623185758675.png"
                      alt="image-20240623185758675"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623190148282.png"
                      alt="image-20240623190148282"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623190635242.png"
                      alt="image-20240623190635242"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623191604298.png"
                      alt="image-20240623191604298"
                ></p>
</li>
</ul>
<h2 id="3-2-封装成帧"><a href="#3-2-封装成帧" class="headerlink" title="3-2 封装成帧"></a>3-2 封装成帧</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623192504307.png"
                      alt="image-20240623192504307"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623192537504.png"
                      alt="image-20240623192537504"
                ></p>
</li>
</ul>
<h2 id="3-3-差错检测"><a href="#3-3-差错检测" class="headerlink" title="3-3 差错检测"></a>3-3 差错检测</h2><h3 id="3-3-1-概述"><a href="#3-3-1-概述" class="headerlink" title="3-3-1 概述"></a>3-3-1 概述</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623192712329.png"
                      alt="image-20240623192712329"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623194050867.png"
                      alt="image-20240623194050867"
                ></li>
</ul>
<h3 id="3-3-2-奇偶校验"><a href="#3-3-2-奇偶校验" class="headerlink" title="3-3-2 奇偶校验"></a>3-3-2 奇偶校验</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623193052601.png"
                      alt="image-20240623193052601"
                ></li>
</ul>
<h3 id="3-3-3-CRC校验"><a href="#3-3-3-CRC校验" class="headerlink" title="3-3-3 CRC校验"></a>3-3-3 CRC校验</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623193535453.png"
                      alt="image-20240623193535453"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623193739163.png"
                      alt="image-20240623193739163"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623193822424.png"
                      alt="image-20240623193822424"
                ></p>
</li>
</ul>
<h2 id="3-4-可靠传输"><a href="#3-4-可靠传输" class="headerlink" title="3-4 可靠传输"></a>3-4 可靠传输</h2><h3 id="3-4-1-概述"><a href="#3-4-1-概述" class="headerlink" title="3-4-1 概述"></a>3-4-1 概述</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623195551571.png"
                      alt="image-20240623195551571"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623195642624.png"
                      alt="image-20240623195642624"
                ></p>
</li>
</ul>
<h3 id="3-4-2-停止-等待协议SW"><a href="#3-4-2-停止-等待协议SW" class="headerlink" title="3-4-2 停止-等待协议SW"></a>3-4-2 停止-等待协议SW</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623204742143.png"
                      alt="image-20240623204742143"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623205121697.png"
                      alt="image-20240623205121697"
                ></p>
</li>
</ul>
<h3 id="3-4-3-回退N帧协议GBN"><a href="#3-4-3-回退N帧协议GBN" class="headerlink" title="3-4-3 回退N帧协议GBN"></a>3-4-3 回退N帧协议GBN</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240820203123550.png"
                      alt="image-20240820203123550"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240820203221247.png"
                      alt="image-20240820203221247"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240820202927917.png"
                      alt="image-20240820202927917"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623211106118.png"
                      alt="image-20240623211106118"
                ></li>
</ul>
<h3 id="3-4-4-选择重传协议SR"><a href="#3-4-4-选择重传协议SR" class="headerlink" title="3-4-4 选择重传协议SR"></a>3-4-4 选择重传协议SR</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240820215452476.png"
                      alt="image-20240820215452476"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240623211915441.png"
                      alt="image-20240623211915441"
                ></li>
</ul>
<h2 id="3-5-点对点协议PPP"><a href="#3-5-点对点协议PPP" class="headerlink" title="3-5 点对点协议PPP"></a>3-5 点对点协议PPP</h2><h3 id="3-5-1-概述"><a href="#3-5-1-概述" class="headerlink" title="3-5-1 概述"></a>3-5-1 概述</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240820220310962.png"
                      alt="image-20240820220310962"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240820220230577.png"
                      alt="image-20240820220230577"
                ></p>
</li>
</ul>
<h3 id="3-5-2-帧格式"><a href="#3-5-2-帧格式" class="headerlink" title="3-5-2 帧格式"></a>3-5-2 帧格式</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240820222434553.png"
                      alt="image-20240820222434553"
                ></li>
</ul>
<h3 id="3-5-3-透明传输"><a href="#3-5-3-透明传输" class="headerlink" title="3-5-3 透明传输"></a>3-5-3 透明传输</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240820222702185.png"
                      alt="image-20240820222702185"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240820230234322.png"
                      alt="image-20240820230234322"
                ></p>
</li>
</ul>
<h3 id="3-5-4-差错检测"><a href="#3-5-4-差错检测" class="headerlink" title="3-5-4 差错检测"></a>3-5-4 差错检测</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240820230514276.png"
                      alt="image-20240820230514276"
                ></li>
</ul>
<h3 id="3-5-5-工作状态"><a href="#3-5-5-工作状态" class="headerlink" title="3-5-5 工作状态"></a>3-5-5 工作状态</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240820230725169.png"
                      alt="image-20240820230725169"
                ></li>
</ul>
<h2 id="3-6-媒体接入控制"><a href="#3-6-媒体接入控制" class="headerlink" title="3-6 媒体接入控制"></a>3-6 媒体接入控制</h2><h3 id="3-6-1-概述"><a href="#3-6-1-概述" class="headerlink" title="3-6-1 概述"></a>3-6-1 概述</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240821202618817.png"
                      alt="image-20240821202618817"
                ></li>
</ul>
<h3 id="3-6-2-静态划分信道-信道复用"><a href="#3-6-2-静态划分信道-信道复用" class="headerlink" title="3-6-2 静态划分信道(信道复用)"></a>3-6-2 静态划分信道(信道复用)</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240821205935837.png"
                      alt="image-20240821205935837"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-08-21%20210331.png"
                      alt="屏幕截图 2024-08-21 210331"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240821210854479.png"
                      alt="image-20240821210854479"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240821211213614.png"
                      alt="image-20240821211213614"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240821211822459.png"
                      alt="image-20240821211822459"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240821213131396.png"
                      alt="image-20240821213131396"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240821214545456.png"
                      alt="image-20240821214545456"
                ></p>
</li>
</ul>
<h3 id="3-6-3-随机接入-CSMA-CD协议"><a href="#3-6-3-随机接入-CSMA-CD协议" class="headerlink" title="3-6-3 随机接入-CSMA&#x2F;CD协议"></a>3-6-3 随机接入-CSMA&#x2F;CD协议</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822192738230.png"
                      alt="image-20240822192738230"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822192949631.png"
                      alt="image-20240822192949631"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822193220795.png"
                      alt="image-20240822193220795"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822193614873.png"
                      alt="image-20240822193614873"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822193809459.png"
                      alt="image-20240822193809459"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822194027793.png"
                      alt="image-20240822194027793"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822194214332.png"
                      alt="image-20240822194214332"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822194318112.png"
                      alt="image-20240822194318112"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822194358306.png"
                      alt="image-20240822194358306"
                ></p>
</li>
</ul>
<h3 id="3-6-4-随机接入-CSMA-CA协议"><a href="#3-6-4-随机接入-CSMA-CA协议" class="headerlink" title="3-6-4 随机接入-CSMA&#x2F;CA协议"></a>3-6-4 随机接入-CSMA&#x2F;CA协议</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822201524151.png"
                      alt="image-20240822201524151"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822200659090.png"
                      alt="image-20240822200659090"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822201711149.png"
                      alt="image-20240822201711149"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822201802058.png"
                      alt="image-20240822201802058"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822201854319.png"
                      alt="image-20240822201854319"
                ></p>
</li>
</ul>
<h2 id="3-7-MAC地址、IP地址、ARP协议"><a href="#3-7-MAC地址、IP地址、ARP协议" class="headerlink" title="3-7 MAC地址、IP地址、ARP协议"></a>3-7 MAC地址、IP地址、ARP协议</h2><h3 id="3-7-1-概述"><a href="#3-7-1-概述" class="headerlink" title="3-7-1 概述"></a>3-7-1 概述</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822202407332.png"
                      alt="image-20240822202407332"
                ></li>
</ul>
<h3 id="3-7-2-MAC地址"><a href="#3-7-2-MAC地址" class="headerlink" title="3-7-2 MAC地址"></a>3-7-2 MAC地址</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822203303916.png"
                      alt="image-20240822203303916"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822203425025.png"
                      alt="image-20240822203425025"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822203517241.png"
                      alt="image-20240822203517241"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822203920971.png"
                      alt="image-20240822203920971"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822204145026.png"
                      alt="image-20240822204145026"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822204210441.png"
                      alt="image-20240822204210441"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822205002389.png"
                      alt="image-20240822205002389"
                ></p>
</li>
</ul>
<h3 id="3-7-3-IP地址"><a href="#3-7-3-IP地址" class="headerlink" title="3-7-3 IP地址"></a>3-7-3 IP地址</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822210652641.png"
                      alt="image-20240822210652641"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822210505187.png"
                      alt="image-20240822210505187"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822215240185.png"
                      alt="image-20240822215240185"
                ></p>
</li>
</ul>
<h3 id="3-7-4-ARP协议"><a href="#3-7-4-ARP协议" class="headerlink" title="3-7-4 ARP协议"></a>3-7-4 ARP协议</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822221919577.png"
                      alt="image-20240822221919577"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822222005222.png"
                      alt="image-20240822222005222"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822222133060.png"
                      alt="image-20240822222133060"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240822222443941.png"
                      alt="image-20240822222443941"
                ></p>
</li>
</ul>
<h2 id="3-8-集线器与交换机的区别"><a href="#3-8-集线器与交换机的区别" class="headerlink" title="3-8 集线器与交换机的区别"></a>3-8 集线器与交换机的区别</h2><h3 id="3-8-1-集线器"><a href="#3-8-1-集线器" class="headerlink" title="3-8-1 集线器"></a>3-8-1 集线器</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823204508349.png"
                      alt="image-20240823204508349"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823204604084.png"
                      alt="image-20240823204604084"
                ></p>
</li>
</ul>
<h3 id="3-8-2-交换机"><a href="#3-8-2-交换机" class="headerlink" title="3-8-2 交换机"></a>3-8-2 交换机</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823210552129.png"
                      alt="image-20240823210552129"
                ></li>
</ul>
<h3 id="3-8-3-集线器与交换机对比"><a href="#3-8-3-集线器与交换机对比" class="headerlink" title="3-8-3 集线器与交换机对比"></a>3-8-3 集线器与交换机对比</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823211419268.png"
                      alt="image-20240823211419268"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823211511899.png"
                      alt="image-20240823211511899"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823211826892.png"
                      alt="image-20240823211826892"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823211846330.png"
                      alt="image-20240823211846330"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823211916829.png"
                      alt="image-20240823211916829"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823211945417.png"
                      alt="image-20240823211945417"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823212138022.png"
                      alt="image-20240823212138022"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823212243296.png"
                      alt="image-20240823212243296"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823212321712.png"
                      alt="image-20240823212321712"
                ></p>
</li>
</ul>
<h2 id="3-9-以太网交换机自学习和转发帧"><a href="#3-9-以太网交换机自学习和转发帧" class="headerlink" title="3-9 以太网交换机自学习和转发帧"></a>3-9 以太网交换机自学习和转发帧</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823220209843.png"
                      alt="image-20240823220209843"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823213829268.png"
                      alt="image-20240823213829268"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823214955050.png"
                      alt="image-20240823214955050"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823215113355.png"
                      alt="image-20240823215113355"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823215303906.png"
                      alt="image-20240823215303906"
                ></p>
</li>
</ul>
<h2 id="3-10-以太网交换机生成树协议"><a href="#3-10-以太网交换机生成树协议" class="headerlink" title="3-10 以太网交换机生成树协议"></a>3-10 以太网交换机生成树协议</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823221902344.png"
                      alt="image-20240823221902344"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823221814772.png"
                      alt="image-20240823221814772"
                ></p>
</li>
</ul>
<h2 id="3-11-虚拟局域网VLAN"><a href="#3-11-虚拟局域网VLAN" class="headerlink" title="3-11 虚拟局域网VLAN"></a>3-11 虚拟局域网VLAN</h2><h3 id="3-11-1-概述"><a href="#3-11-1-概述" class="headerlink" title="3-11-1 概述"></a>3-11-1 概述</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823223003202.png"
                      alt="image-20240823223003202"
                ></li>
</ul>
<h3 id="3-11-2-实现机制"><a href="#3-11-2-实现机制" class="headerlink" title="3-11-2 实现机制"></a>3-11-2 实现机制</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824114606916.png"
                      alt="image-20240824114606916"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824115758670.png"
                      alt="image-20240824115758670"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824120102298.png"
                      alt="image-20240824120102298"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824121825200.png"
                      alt="image-20240824121825200"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824124313180.png"
                      alt="image-20240824124313180"
                ></p>
</li>
</ul>
<h1 id="4-网络层"><a href="#4-网络层" class="headerlink" title="4- 网络层"></a>4- 网络层</h1><h2 id="4-1-概述"><a href="#4-1-概述" class="headerlink" title="4-1 概述"></a>4-1 概述</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823224639296.png"
                      alt="image-20240823224639296"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240823224718549.png"
                      alt="image-20240823224718549"
                ></p>
</li>
</ul>
<h2 id="4-2-网络层提供的两种服务"><a href="#4-2-网络层提供的两种服务" class="headerlink" title="4-2 网络层提供的两种服务"></a>4-2 网络层提供的两种服务</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824191150507.png"
                      alt="image-20240824191150507"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824191439172.png"
                      alt="image-20240824191439172"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824191738661.png"
                      alt="image-20240824191738661"
                ></p>
</li>
</ul>
<h2 id="4-3-IPv4地址"><a href="#4-3-IPv4地址" class="headerlink" title="4-3 IPv4地址"></a>4-3 IPv4地址</h2><h3 id="4-3-1-概述"><a href="#4-3-1-概述" class="headerlink" title="4-3-1 概述"></a>4-3-1 概述</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824192829355.png"
                      alt="image-20240824192829355"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824193523646.png"
                      alt="image-20240824193523646"
                ></p>
</li>
</ul>
<h3 id="4-3-2-分类编址的IPv4地址"><a href="#4-3-2-分类编址的IPv4地址" class="headerlink" title="4-3-2 分类编址的IPv4地址"></a>4-3-2 分类编址的IPv4地址</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824200725909.png"
                      alt="image-20240824200725909"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824194746451.png"
                      alt="image-20240824194746451"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824195351234.png"
                      alt="image-20240824195351234"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824195911380.png"
                      alt="image-20240824195911380"
                ></p>
</li>
</ul>
<h3 id="4-3-3-划分子网的IPv4地址"><a href="#4-3-3-划分子网的IPv4地址" class="headerlink" title="4-3-3 划分子网的IPv4地址"></a>4-3-3 划分子网的IPv4地址</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824214514499.png"
                      alt="image-20240824214514499"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824215612878.png"
                      alt="image-20240824215612878"
                ></p>
</li>
</ul>
<h3 id="4-3-4-无分类编址的IPv4地址"><a href="#4-3-4-无分类编址的IPv4地址" class="headerlink" title="4-3-4 无分类编址的IPv4地址"></a>4-3-4 无分类编址的IPv4地址</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824220758027.png"
                      alt="image-20240824220758027"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824220625738.png"
                      alt="image-20240824220625738"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240824221648086.png"
                      alt="image-20240824221648086"
                ></p>
</li>
</ul>
<h3 id="4-3-5-IPv4地址的应用规划"><a href="#4-3-5-IPv4地址的应用规划" class="headerlink" title="4-3-5 IPv4地址的应用规划"></a>4-3-5 IPv4地址的应用规划</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825163000865.png"
                      alt="image-20240825163000865"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825162102816.png"
                      alt="image-20240825162102816"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825162849574.png"
                      alt="image-20240825162849574"
                ></p>
</li>
</ul>
<h2 id="4-4-IP数据报的发送和转发过程"><a href="#4-4-IP数据报的发送和转发过程" class="headerlink" title="4-4 IP数据报的发送和转发过程"></a>4-4 IP数据报的发送和转发过程</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825174311190.png"
                      alt="image-20240825174311190"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825171842367.png"
                      alt="image-20240825171842367"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825172221045.png"
                      alt="image-20240825172221045"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825172526714.png"
                      alt="image-20240825172526714"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825173022743.png"
                      alt="image-20240825173022743"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825174133732.png"
                      alt="image-20240825174133732"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825174200290.png"
                      alt="image-20240825174200290"
                ></p>
</li>
</ul>
<h2 id="4-5-静态路由配置"><a href="#4-5-静态路由配置" class="headerlink" title="4-5 静态路由配置"></a>4-5 静态路由配置</h2><h3 id="4-5-1-概述"><a href="#4-5-1-概述" class="headerlink" title="4-5-1 概述"></a>4-5-1 概述</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825181601148.png"
                      alt="image-20240825181601148"
                ></li>
</ul>
<h3 id="4-5-2-静态路由配置"><a href="#4-5-2-静态路由配置" class="headerlink" title="4-5-2 静态路由配置"></a>4-5-2 静态路由配置</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825182700785.png"
                      alt="image-20240825182700785"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825192024371.png"
                      alt="image-20240825192024371"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825201842053.png"
                      alt="image-20240825201842053"
                ></p>
</li>
</ul>
<h3 id="4-5-3-路由环路问题"><a href="#4-5-3-路由环路问题" class="headerlink" title="4-5-3 路由环路问题"></a>4-5-3 路由环路问题</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825202752187.png"
                      alt="image-20240825202752187"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825203729000.png"
                      alt="image-20240825203729000"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825204542433.png"
                      alt="image-20240825204542433"
                ></p>
</li>
</ul>
<h2 id="4-6-路由选择协议"><a href="#4-6-路由选择协议" class="headerlink" title="4-6 路由选择协议"></a>4-6 路由选择协议</h2><h3 id="4-6-1-概述"><a href="#4-6-1-概述" class="headerlink" title="4-6-1 概述"></a>4-6-1 概述</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825205616179.png"
                      alt="image-20240825205616179"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825205923959.png"
                      alt="image-20240825205923959"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825210440935.png"
                      alt="image-20240825210440935"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825210625222.png"
                      alt="image-20240825210625222"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240825211236367.png"
                      alt="image-20240825211236367"
                ></p>
</li>
</ul>
<h3 id="4-6-2-路由信息协议RIP"><a href="#4-6-2-路由信息协议RIP" class="headerlink" title="4-6-2 路由信息协议RIP"></a>4-6-2 路由信息协议RIP</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826155814075.png"
                      alt="image-20240826155814075"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826160619305.png"
                      alt="image-20240826160619305"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826162317618.png"
                      alt="image-20240826162317618"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826163204413.png"
                      alt="image-20240826163204413"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826164050457.png"
                      alt="image-20240826164050457"
                ></p>
</li>
</ul>
<h3 id="4-6-3-开放最短路径优先OSPF"><a href="#4-6-3-开放最短路径优先OSPF" class="headerlink" title="4-6-3 开放最短路径优先OSPF"></a>4-6-3 开放最短路径优先OSPF</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826171258399.png"
                      alt="image-20240826171258399"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826171812613.png"
                      alt="image-20240826171812613"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826172004467.png"
                      alt="image-20240826172004467"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826173309573.png"
                      alt="image-20240826173309573"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826173516874.png"
                      alt="image-20240826173516874"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826174107748.png"
                      alt="image-20240826174107748"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826175132943.png"
                      alt="image-20240826175132943"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826175628434.png"
                      alt="image-20240826175628434"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826180812349.png"
                      alt="image-20240826180812349"
                ></p>
</li>
</ul>
<h3 id="4-6-4-边界网关协议BGP"><a href="#4-6-4-边界网关协议BGP" class="headerlink" title="4-6-4 边界网关协议BGP"></a>4-6-4 边界网关协议BGP</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826182124232.png"
                      alt="image-20240826182124232"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826182443605.png"
                      alt="image-20240826182443605"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826182925115.png"
                      alt="image-20240826182925115"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826183431534.png"
                      alt="image-20240826183431534"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826183520707.png"
                      alt="image-20240826183520707"
                ></p>
</li>
</ul>
<h2 id="4-7-IPv4数据报的首部格式"><a href="#4-7-IPv4数据报的首部格式" class="headerlink" title="4-7 IPv4数据报的首部格式"></a>4-7 IPv4数据报的首部格式</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826200521961.png"
                      alt="image-20240826200521961"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826200716160.png"
                      alt="image-20240826200716160"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826201137458.png"
                      alt="image-20240826201137458"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826201447582.png"
                      alt="image-20240826201447582"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826202009233.png"
                      alt="image-20240826202009233"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826202723256.png"
                      alt="image-20240826202723256"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826203908671.png"
                      alt="image-20240826203908671"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826203950152.png"
                      alt="image-20240826203950152"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826205028621.png"
                      alt="image-20240826205028621"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826204815369.png"
                      alt="image-20240826204815369"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826204836926.png"
                      alt="image-20240826204836926"
                ></p>
</li>
</ul>
<h2 id="4-8-网际控制报文协议ICMP"><a href="#4-8-网际控制报文协议ICMP" class="headerlink" title="4-8 网际控制报文协议ICMP"></a>4-8 网际控制报文协议ICMP</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826205926524.png"
                      alt="image-20240826205926524"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826210159487.png"
                      alt="image-20240826210159487"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826210300046.png"
                      alt="image-20240826210300046"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826211101053.png"
                      alt="image-20240826211101053"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826211530983.png"
                      alt="image-20240826211530983"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826211941887.png"
                      alt="image-20240826211941887"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826212109545.png"
                      alt="image-20240826212109545"
                ></p>
</li>
</ul>
<h2 id="4-9-虚拟专用网VPN与网络地址转换NAT"><a href="#4-9-虚拟专用网VPN与网络地址转换NAT" class="headerlink" title="4-9 虚拟专用网VPN与网络地址转换NAT"></a>4-9 虚拟专用网VPN与网络地址转换NAT</h2><h3 id="4-9-1-虚拟专用网VPN"><a href="#4-9-1-虚拟专用网VPN" class="headerlink" title="4-9-1 虚拟专用网VPN"></a>4-9-1 虚拟专用网VPN</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826214057970.png"
                      alt="image-20240826214057970"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826214426936.png"
                      alt="image-20240826214426936"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826214534845.png"
                      alt="image-20240826214534845"
                ></p>
</li>
</ul>
<h3 id="4-9-2-网络地址转换NAT"><a href="#4-9-2-网络地址转换NAT" class="headerlink" title="4-9-2 网络地址转换NAT"></a>4-9-2 网络地址转换NAT</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826215455720.png"
                      alt="image-20240826215455720"
                ></li>
</ul>
<h1 id="5-运输层"><a href="#5-运输层" class="headerlink" title="5- 运输层"></a>5- 运输层</h1><h2 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5-1 概述"></a>5-1 概述</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826215942882.png"
                      alt="image-20240826215942882"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240826220020162.png"
                      alt="image-20240826220020162"
                ></p>
</li>
</ul>
<h2 id="5-2-运输层端口号、复用与分用"><a href="#5-2-运输层端口号、复用与分用" class="headerlink" title="5-2 运输层端口号、复用与分用"></a>5-2 运输层端口号、复用与分用</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827193527993.png"
                      alt="image-20240827193527993"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827194518371.png"
                      alt="image-20240827194518371"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827195100277.png"
                      alt="image-20240827195100277"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827200125145.png"
                      alt="image-20240827200125145"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827200232694.png"
                      alt="image-20240827200232694"
                ></p>
</li>
</ul>
<h2 id="5-3-UDP和TCP的对比"><a href="#5-3-UDP和TCP的对比" class="headerlink" title="5-3 UDP和TCP的对比"></a>5-3 UDP和TCP的对比</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827201607233.png"
                      alt="image-20240827201607233"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827201651352.png"
                      alt="image-20240827201651352"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827201721440.png"
                      alt="image-20240827201721440"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827201930656.png"
                      alt="image-20240827201930656"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827202102102.png"
                      alt="image-20240827202102102"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827202152211.png"
                      alt="image-20240827202152211"
                ></p>
</li>
</ul>
<h2 id="5-4-TCP的流量控制"><a href="#5-4-TCP的流量控制" class="headerlink" title="5-4 TCP的流量控制"></a>5-4 TCP的流量控制</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827203423383.png"
                      alt="image-20240827203423383"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827203735067.png"
                      alt="image-20240827203735067"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827204114666.png"
                      alt="image-20240827204114666"
                ></p>
</li>
</ul>
<h2 id="5-5-TCP的拥塞控制"><a href="#5-5-TCP的拥塞控制" class="headerlink" title="5-5 TCP的拥塞控制"></a>5-5 TCP的拥塞控制</h2><h3 id="5-5-1-概述"><a href="#5-5-1-概述" class="headerlink" title="5-5-1 概述"></a>5-5-1 概述</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827212149138.png"
                      alt="image-20240827212149138"
                ></li>
</ul>
<h3 id="5-5-2-慢开始与拥塞避免"><a href="#5-5-2-慢开始与拥塞避免" class="headerlink" title="5-5-2 慢开始与拥塞避免"></a>5-5-2 慢开始与拥塞避免</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827212636042.png"
                      alt="image-20240827212636042"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827221038445.png"
                      alt="image-20240827221038445"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827221125419.png"
                      alt="image-20240827221125419"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827220931325.png"
                      alt="image-20240827220931325"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827221511163.png"
                      alt="image-20240827221511163"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827221729264.png"
                      alt="image-20240827221729264"
                ></p>
</li>
</ul>
<h3 id="5-5-3-快重传与快恢复"><a href="#5-5-3-快重传与快恢复" class="headerlink" title="5-5-3 快重传与快恢复"></a>5-5-3 快重传与快恢复</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827223011089.png"
                      alt="image-20240827223011089"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827223422132.png"
                      alt="image-20240827223422132"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827223638474.png"
                      alt="image-20240827223638474"
                ></p>
</li>
</ul>
<h3 id="5-5-4-总结"><a href="#5-5-4-总结" class="headerlink" title="5-5-4 总结"></a>5-5-4 总结</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240827223831184.png"
                      alt="image-20240827223831184"
                ></li>
</ul>
<h2 id="5-6-TCP超时重传时间的选择"><a href="#5-6-TCP超时重传时间的选择" class="headerlink" title="5-6 TCP超时重传时间的选择"></a>5-6 TCP超时重传时间的选择</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828094253569.png"
                      alt="image-20240828094253569"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828095240075.png"
                      alt="image-20240828095240075"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828095914179.png"
                      alt="image-20240828095914179"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828100206175.png"
                      alt="image-20240828100206175"
                ></p>
</li>
</ul>
<h2 id="5-7-TCP可靠传输的实现"><a href="#5-7-TCP可靠传输的实现" class="headerlink" title="5-7 TCP可靠传输的实现"></a>5-7 TCP可靠传输的实现</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828102112300.png"
                      alt="image-20240828102112300"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828101844630.png"
                      alt="image-20240828101844630"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828191250694.png"
                      alt="image-20240828191250694"
                ></p>
</li>
</ul>
<h2 id="5-8-TCP的运输连接管理"><a href="#5-8-TCP的运输连接管理" class="headerlink" title="5-8 TCP的运输连接管理"></a>5-8 TCP的运输连接管理</h2><h3 id="5-8-1-TCP的连接建立"><a href="#5-8-1-TCP的连接建立" class="headerlink" title="5-8-1 TCP的连接建立"></a>5-8-1 TCP的连接建立</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828193859782.png"
                      alt="image-20240828193859782"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828193819637.png"
                      alt="image-20240828193819637"
                ></p>
</li>
</ul>
<h3 id="5-8-2-TCP的连接释放"><a href="#5-8-2-TCP的连接释放" class="headerlink" title="5-8-2 TCP的连接释放"></a>5-8-2 TCP的连接释放</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828195124353.png"
                      alt="image-20240828195124353"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828195323358.png"
                      alt="image-20240828195323358"
                ></p>
</li>
</ul>
<h2 id="5-9-TCP报文段的首部格式"><a href="#5-9-TCP报文段的首部格式" class="headerlink" title="5-9 TCP报文段的首部格式"></a>5-9 TCP报文段的首部格式</h2><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828195834759.png"
                      alt="image-20240828195834759"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828195927922.png"
                      alt="image-20240828195927922"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828200217556.png"
                      alt="image-20240828200217556"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828201230644.png"
                      alt="image-20240828201230644"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828201635687.png"
                      alt="image-20240828201635687"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828201836229.png"
                      alt="image-20240828201836229"
                ></p>
</li>
<li><p>确认标志位 ACK：取值为1时确认号字段才有效；取值为0时确认号字段无效。</p>
</li>
<li><p>同步标志位 SYN：在TCP连接建立时用来同步序号。</p>
</li>
<li><p>终止标志位 FIN：用来释放TCP连接。</p>
</li>
<li><p>复位标志位 RST：用来复位TCP连接。</p>
<ul>
<li>当RST&#x3D;1时，表明TCP连接出现了异常，必须释放连接，然后再重新建立连接。</li>
<li>RST置1还用来拒绝一个非法的报文段或拒绝打开一个TCP连接。</li>
</ul>
</li>
<li><p>推送标志位 PSH：接收方的TCP收到该标志位为1的报文段会尽快上交应用进程，而不必等到接收缓存都填满后再向上交付。</p>
</li>
<li><p>紧急标志位 URG：取值为1时紧急指针字段有效；取值为0时紧急指针字段无效。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828202057496.png"
                      alt="image-20240828202057496"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828202432628.png"
                      alt="image-20240828202432628"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828205613373.png"
                      alt="image-20240828205613373"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828211157120.png"
                      alt="image-20240828211157120"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828211559390.png"
                      alt="image-20240828211559390"
                ></p>
</li>
</ul>
<h1 id="6-应用层概述"><a href="#6-应用层概述" class="headerlink" title="6- 应用层概述"></a>6- 应用层概述</h1><h2 id="6-1-概述"><a href="#6-1-概述" class="headerlink" title="6-1 概述"></a>6-1 概述</h2><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828220241974.png"
                      alt="image-20240828220241974"
                ></li>
</ul>
<h2 id="6-2-客户-服务器方式和对等方式"><a href="#6-2-客户-服务器方式和对等方式" class="headerlink" title="6-2 客户-服务器方式和对等方式"></a>6-2 客户-服务器方式和对等方式</h2><h3 id="6-2-1-客户-服务器方式"><a href="#6-2-1-客户-服务器方式" class="headerlink" title="6-2-1 客户-服务器方式"></a>6-2-1 客户-服务器方式</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828220920864.png"
                      alt="image-20240828220920864"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828220951330.png"
                      alt="image-20240828220951330"
                ></p>
</li>
</ul>
<h3 id="6-2-2-对等方式"><a href="#6-2-2-对等方式" class="headerlink" title="6-2-2 对等方式"></a>6-2-2 对等方式</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828221310094.png"
                      alt="image-20240828221310094"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240828221332119.png"
                      alt="image-20240828221332119"
                ></p>
</li>
</ul>
<h2 id="6-3-动态主机配置协议DHCP"><a href="#6-3-动态主机配置协议DHCP" class="headerlink" title="6-3 动态主机配置协议DHCP"></a>6-3 动态主机配置协议DHCP</h2><h3 id="6-3-1-DHCP的作用"><a href="#6-3-1-DHCP的作用" class="headerlink" title="6-3-1 DHCP的作用"></a>6-3-1 DHCP的作用</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901163435602.png"
                      alt="image-20240901163435602"
                ></li>
</ul>
<h3 id="6-3-2-DHCP的工作过程"><a href="#6-3-2-DHCP的工作过程" class="headerlink" title="6-3-2 DHCP的工作过程"></a>6-3-2 DHCP的工作过程</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901164522598.png"
                      alt="image-20240901164522598"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901165029398.png"
                      alt="image-20240901165029398"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901165254178.png"
                      alt="image-20240901165254178"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901165943992.png"
                      alt="image-20240901165943992"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901170358700.png"
                      alt="image-20240901170358700"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901170531962.png"
                      alt="image-20240901170531962"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901170644340.png"
                      alt="image-20240901170644340"
                ></p>
</li>
</ul>
<h3 id="6-3-3-DHCP中继代理"><a href="#6-3-3-DHCP中继代理" class="headerlink" title="6-3-3 DHCP中继代理"></a>6-3-3 DHCP中继代理</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901170847598.png"
                      alt="image-20240901170847598"
                ></li>
</ul>
<h2 id="6-4-域名系统DNS"><a href="#6-4-域名系统DNS" class="headerlink" title="6-4 域名系统DNS"></a>6-4 域名系统DNS</h2><h3 id="6-4-1-域名系统DNS的作用"><a href="#6-4-1-域名系统DNS的作用" class="headerlink" title="6-4-1 域名系统DNS的作用"></a>6-4-1 域名系统DNS的作用</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901171150386.png"
                      alt="image-20240901171150386"
                ></li>
</ul>
<h3 id="6-4-2-因特网是否可以只使用一台DNS服务器"><a href="#6-4-2-因特网是否可以只使用一台DNS服务器" class="headerlink" title="6-4-2 因特网是否可以只使用一台DNS服务器"></a>6-4-2 因特网是否可以只使用一台DNS服务器</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901171421201.png"
                      alt="image-20240901171421201"
                ></li>
</ul>
<h3 id="6-4-3-层次树状结构的域名结构"><a href="#6-4-3-层次树状结构的域名结构" class="headerlink" title="6-4-3 层次树状结构的域名结构"></a>6-4-3 层次树状结构的域名结构</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901171610968.png"
                      alt="image-20240901171610968"
                ></p>
</li>
<li><p>例如：nic . hnust . edu . cn</p>
<ul>
<li>cn：是顶级域名，表示中国。</li>
<li>edu：是在其下注册的二级域名，表示教育机构。</li>
<li>hnust：是在 edu下注册的三级域名，表示湖南科技大学。</li>
<li>nic：是由我校自行管理的四级域名，表示网络信息中心。</li>
</ul>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901172032398.png"
                      alt="image-20240901172032398"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901172213341.png"
                      alt="image-20240901172213341"
                ></p>
</li>
</ul>
<h3 id="6-4-4-域名服务器"><a href="#6-4-4-域名服务器" class="headerlink" title="6-4-4 域名服务器"></a>6-4-4 域名服务器</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901172513472.png"
                      alt="image-20240901172513472"
                ></li>
</ul>
<h3 id="6-4-5-域名解析的过程"><a href="#6-4-5-域名解析的过程" class="headerlink" title="6-4-5 域名解析的过程"></a>6-4-5 域名解析的过程</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901172740186.png"
                      alt="image-20240901172740186"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901172951887.png"
                      alt="image-20240901172951887"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901173012146.png"
                      alt="image-20240901173012146"
                ></p>
</li>
</ul>
<h2 id="6-5-文件传送协议FTP"><a href="#6-5-文件传送协议FTP" class="headerlink" title="6-5 文件传送协议FTP"></a>6-5 文件传送协议FTP</h2><h3 id="6-5-1-概述"><a href="#6-5-1-概述" class="headerlink" title="6-5-1 概述"></a>6-5-1 概述</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901173301097.png"
                      alt="image-20240901173301097"
                ></li>
</ul>
<h3 id="6-5-2-应用"><a href="#6-5-2-应用" class="headerlink" title="6-5-2 应用"></a>6-5-2 应用</h3><ul>
<li><p>根据应用需求的不同，FTP服务器可能需要一台高性能和高可靠性的服务器计算机，也可能只需要一台普通的个人计算机即可。</p>
</li>
<li><p>在windows系统中添加了一个FTP站点（FTP服务器），请求为 ftp : &#x2F;&#x2F;192.168.124.16 。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901173530044.png"
                      alt="image-20240901173530044"
                ></p>
</li>
<li><p>FTP的常见用途是在计算机之间传输文件，尤其是用于批量传输文件。</p>
</li>
<li><p>FTP的另一个常见用途是让网站设计者将构成网站内容的大量文件批量上传到他们的Web服务器。</p>
</li>
</ul>
<h3 id="6-5-3-基本工作原理"><a href="#6-5-3-基本工作原理" class="headerlink" title="6-5-3 基本工作原理"></a>6-5-3 基本工作原理</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901174126795.png"
                      alt="image-20240901174126795"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240901174230943.png"
                      alt="image-20240901174230943"
                ></p>
</li>
</ul>
]]></content>
      <categories>
        <category>408</category>
        <category>计算机网络</category>
      </categories>
      <tags>
        <tag>自研笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统</title>
    <url>/2024/12/14/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<h1 id="1-操作系统引论"><a href="#1-操作系统引论" class="headerlink" title="1 操作系统引论"></a>1 操作系统引论</h1><h2 id="1-1-操作系统的概念"><a href="#1-1-操作系统的概念" class="headerlink" title="1.1 操作系统的概念"></a>1.1 操作系统的概念</h2><p>1、操作系统是一组控制和管理计算机硬件和软件资源，合理的对各类作业进行调度，以及方便用户使用计算机的程序的集合，是配置在计算机裸机上的第一层软件，是对硬件功能的首次扩充。</p>
<ul>
<li>软件（程序）</li>
<li>硬件之上第一层</li>
<li>用户和硬件之间的接口</li>
</ul>
<p>2、配置操作系统的<strong>主要目的就是提高系统资源的利用率</strong>。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241214205511924.png"
                      alt="image-20241214205511924"
                ></p>
<h2 id="1-2-操作系统的目标和作用"><a href="#1-2-操作系统的目标和作用" class="headerlink" title="1.2 操作系统的目标和作用"></a>1.2 操作系统的目标和作用</h2><h3 id="1-2-1-目标"><a href="#1-2-1-目标" class="headerlink" title="1.2.1 目标"></a>1.2.1 目标</h3><p>主要目标：方便性、有效性、可扩充性、开放性。</p>
<h3 id="1-2-2-作用"><a href="#1-2-2-作用" class="headerlink" title="1.2.2 作用"></a>1.2.2 作用</h3><p>主要作用：用户和机器之间的接口、管理资源、资源抽象。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241215130514317.png"
                      alt="image-20241215130514317"
                ></p>
<h3 id="1-2-3-发展的主要动力"><a href="#1-2-3-发展的主要动力" class="headerlink" title="1.2.3 发展的主要动力"></a>1.2.3 发展的主要动力</h3><p>主要动力：不断提高计算机资源利用率、方便用户、器件的不断更新换代（OS随之更新换代，如：8位 → 16位 → 32位 → 64 位）、计算机体系结构的不断发展（单处理机OS → 多处理机OS → 网络操作系统）、不断提出新的应用需求。</p>
<h2 id="1-3-操作系统的发展历程"><a href="#1-3-操作系统的发展历程" class="headerlink" title="1.3 操作系统的发展历程"></a>1.3 操作系统的发展历程</h2><p>1、发展过程：人工操作 → 脱机方式 → 单批道 → 多批道 → 分时系统（多路性、独立性、及时性、交互性）→ 实时系统（可靠性）→ 网络操作系统</p>
<p>2、 多道程序设计就是指有多个程序同时进入主存并行运行；多道程序设计技术，使得CPU可以和I&#x2F;O设备并行的工作。</p>
<p>3、批处理系统主要缺点是：失去了<strong>交互性</strong>。</p>
<p>4、分时系统采用了<strong>时间片轮转</strong>运行的分时技术，作业越多，用户数越多，响应时间越长。</p>
<p>5、实时系统在设计时，应首先考虑<strong>实时性</strong>和<strong>可靠性</strong>。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241215150430314.png"
                      alt="image-20241215150430314"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241215150701831.png"
                      alt="image-20241215150701831"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241215150731263.png"
                      alt="image-20241215150731263"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241215150813591.png"
                      alt="image-20241215150813591"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241215150838379.png"
                      alt="image-20241215150838379"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241215150856933.png"
                      alt="image-20241215150856933"
                ></p>
<h2 id="1-4-操作系统的基本特征"><a href="#1-4-操作系统的基本特征" class="headerlink" title="1.4 操作系统的基本特征"></a>1.4 操作系统的基本特征</h2><p>基本特征：并发性（并发：同一时间段；并行：同一时刻）、虚拟性、共享性、异步性（不确定性-走走停停）。</p>
<p>其中最基本的特征是并发性和共享性。</p>
<h2 id="1-5-操作系统的主要功能"><a href="#1-5-操作系统的主要功能" class="headerlink" title="1.5 操作系统的主要功能"></a>1.5 操作系统的主要功能</h2><p>主要功能：处理机管理、存储管理、设备管理、文件管理、OS与用户接口。</p>
<h2 id="1-6-操作系统的结构设计"><a href="#1-6-操作系统的结构设计" class="headerlink" title="1.6 操作系统的结构设计"></a>1.6 操作系统的结构设计</h2><p>传统：无结构 → 模块化（高内聚、低耦合）→ 层次化（无序-有序）。</p>
<p>微内核：足够小的内核、C&#x2F;S、机制与策略、面向对象。</p>
<h1 id="2-进程的描述与控制"><a href="#2-进程的描述与控制" class="headerlink" title="2 进程的描述与控制"></a>2 进程的描述与控制</h1><h2 id="2-1-进程的概念"><a href="#2-1-进程的概念" class="headerlink" title="2.1 进程的概念"></a>2.1 进程的概念</h2><p>程序：是静态的，就是个存放在磁盘里的可执行文件，就是一系列的指令集合。</p>
<p>进程（Process）：是动态的，是程序的一次执行过程。同一个程序多次执行会对应多个进程。</p>
<ul>
<li>其他：</li>
</ul>
<p>降低进程优先级的合理时机是：进程的时间片用完的时候。</p>
<p>操作系统负责进程调度的是处理机管理部分。</p>
<p>程序并发执行的特征：间断性、失去封闭性、不可再现性。</p>
<h2 id="2-2-进程的组成"><a href="#2-2-进程的组成" class="headerlink" title="2.2 进程的组成"></a>2.2 进程的组成</h2><h3 id="2-2-1-PCB"><a href="#2-2-1-PCB" class="headerlink" title="2.2.1 PCB"></a>2.2.1 PCB</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216203619344.png"
                      alt="image-20241216203619344"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216203716969.png"
                      alt="image-20241216203716969"
                ></p>
<h3 id="2-2-2-程序段、数据段"><a href="#2-2-2-程序段、数据段" class="headerlink" title="2.2.2 程序段、数据段"></a>2.2.2 程序段、数据段</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216204407533.png"
                      alt="image-20241216204407533"
                ></p>
<h2 id="2-3-进程的特征"><a href="#2-3-进程的特征" class="headerlink" title="2.3 进程的特征"></a>2.3 进程的特征</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216204711546.png"
                      alt="image-20241216204711546"
                ></p>
<h2 id="2-4-进程的状态与转换"><a href="#2-4-进程的状态与转换" class="headerlink" title="2.4 进程的状态与转换"></a>2.4 进程的状态与转换</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216210538373.png"
                      alt="image-20241216210538373"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216205640587.png"
                      alt="image-20241216205640587"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219202301650.png"
                      alt="image-20241219202301650"
                ></p>
<h2 id="2-5-进程的组织方式"><a href="#2-5-进程的组织方式" class="headerlink" title="2.5 进程的组织方式"></a>2.5 进程的组织方式</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216210819777.png"
                      alt="image-20241216210819777"
                ></p>
<h2 id="2-6-进程控制"><a href="#2-6-进程控制" class="headerlink" title="2.6 进程控制"></a>2.6 进程控制</h2><h3 id="2-6-1-基本概念"><a href="#2-6-1-基本概念" class="headerlink" title="2.6.1 基本概念"></a>2.6.1 基本概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216221106078.png"
                      alt="image-20241216221106078"
                ></p>
<h3 id="2-6-2-进程控制相关的原语"><a href="#2-6-2-进程控制相关的原语" class="headerlink" title="2.6.2 进程控制相关的原语"></a>2.6.2 进程控制相关的原语</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216221425954.png"
                      alt="image-20241216221425954"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216221603220.png"
                      alt="image-20241216221603220"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216221741117.png"
                      alt="image-20241216221741117"
                ></p>
<h3 id="2-6-3-总结"><a href="#2-6-3-总结" class="headerlink" title="2.6.3 总结"></a>2.6.3 总结</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241216222053603.png"
                      alt="image-20241216222053603"
                ></p>
<h2 id="2-7-进程通信"><a href="#2-7-进程通信" class="headerlink" title="2.7 进程通信"></a>2.7 进程通信</h2><h3 id="2-7-1-共享存储"><a href="#2-7-1-共享存储" class="headerlink" title="2.7.1 共享存储"></a>2.7.1 共享存储</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219112722167.png"
                      alt="image-20241219112722167"
                ></p>
<h3 id="2-7-2-消息传递"><a href="#2-7-2-消息传递" class="headerlink" title="2.7.2 消息传递"></a>2.7.2 消息传递</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219113014802.png"
                      alt="image-20241219113014802"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219113243926.png"
                      alt="image-20241219113243926"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219113344282.png"
                      alt="image-20241219113344282"
                ></p>
<h3 id="2-7-3-管道通信"><a href="#2-7-3-管道通信" class="headerlink" title="2.7.3 管道通信"></a>2.7.3 管道通信</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219113822006.png"
                      alt="image-20241219113822006"
                ></p>
<h3 id="2-7-4-总结"><a href="#2-7-4-总结" class="headerlink" title="2.7.4 总结"></a>2.7.4 总结</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219114512233.png"
                      alt="image-20241219114512233"
                ></p>
<h2 id="2-8-线程的概念"><a href="#2-8-线程的概念" class="headerlink" title="2.8 线程的概念"></a>2.8 线程的概念</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219162702540.png"
                      alt="image-20241219162702540"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219163017806.png"
                      alt="image-20241219163017806"
                ></p>
<h2 id="2-9-线程的属性"><a href="#2-9-线程的属性" class="headerlink" title="2.9 线程的属性"></a>2.9 线程的属性</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219163448774.png"
                      alt="image-20241219163448774"
                ></p>
<h2 id="2-10-线程的实现方式"><a href="#2-10-线程的实现方式" class="headerlink" title="2.10 线程的实现方式"></a>2.10 线程的实现方式</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219190008391.png"
                      alt="image-20241219190008391"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219190126860.png"
                      alt="image-20241219190126860"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219190327333.png"
                      alt="image-20241219190327333"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219190450315.png"
                      alt="image-20241219190450315"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219190537330.png"
                      alt="image-20241219190537330"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219190611054.png"
                      alt="image-20241219190611054"
                ></p>
<h2 id="2-11-线程的状态与转换、组织与控制"><a href="#2-11-线程的状态与转换、组织与控制" class="headerlink" title="2.11 线程的状态与转换、组织与控制"></a>2.11 线程的状态与转换、组织与控制</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219191600544.png"
                      alt="image-20241219191600544"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219191808635.png"
                      alt="image-20241219191808635"
                ></p>
<h1 id="3-处理机调度与死锁"><a href="#3-处理机调度与死锁" class="headerlink" title="3 处理机调度与死锁"></a>3 处理机调度与死锁</h1><h2 id="3-1-调度的概念、层次"><a href="#3-1-调度的概念、层次" class="headerlink" title="3.1 调度的概念、层次"></a>3.1 调度的概念、层次</h2><p>当有一堆任务要处理，但由于资源有限，这些事情没法同时处理。这就需要确定<strong>某种规则</strong>来<strong>决定</strong>处理这些任务的<strong>顺序</strong>，这就是“调度”研究的问题。</p>
<ul>
<li>高级调度</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219201143808.png"
                      alt="image-20241219201143808"
                ></p>
<ul>
<li>低级调度</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219201257740.png"
                      alt="image-20241219201257740"
                ></p>
<ul>
<li>中级调度</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219201542078.png"
                      alt="image-20241219201542078"
                ></p>
<ul>
<li>三层调度的联系、对比</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219202130808.png"
                      alt="image-20241219202130808"
                ></p>
<h2 id="3-2-进程调度的时机、切换与过程、方式"><a href="#3-2-进程调度的时机、切换与过程、方式" class="headerlink" title="3.2 进程调度的时机、切换与过程、方式"></a>3.2 进程调度的时机、切换与过程、方式</h2><h3 id="3-2-1-时机"><a href="#3-2-1-时机" class="headerlink" title="3.2.1 时机"></a>3.2.1 时机</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219210743964.png"
                      alt="image-20241219210743964"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219213730889.png"
                      alt="image-20241219213730889"
                ></p>
<h3 id="3-2-2-方式"><a href="#3-2-2-方式" class="headerlink" title="3.2.2 方式"></a>3.2.2 方式</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219221519557.png"
                      alt="image-20241219221519557"
                ></p>
<h3 id="3-2-3-切换与过程"><a href="#3-2-3-切换与过程" class="headerlink" title="3.2.3 切换与过程"></a>3.2.3 切换与过程</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241219221928612.png"
                      alt="image-20241219221928612"
                ></p>
<h2 id="3-3-调度器和闲逛进程"><a href="#3-3-调度器和闲逛进程" class="headerlink" title="3.3 调度器和闲逛进程"></a>3.3 调度器和闲逛进程</h2><h3 id="3-3-1-调度器"><a href="#3-3-1-调度器" class="headerlink" title="3.3.1 调度器"></a>3.3.1 调度器</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241223203049506.png"
                      alt="image-20241223203049506"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241223203113578.png"
                      alt="image-20241223203113578"
                ></p>
<h3 id="3-3-2-闲逛进程"><a href="#3-3-2-闲逛进程" class="headerlink" title="3.3.2 闲逛进程"></a>3.3.2 闲逛进程</h3><p>调度程序永远的备胎，没有其他就绪进程时，运行闲逛进程（idle）。</p>
<p>闲逛进程的特性：</p>
<ul>
<li>优先级最低</li>
<li>可以是0地址指令，占一个完整的指令周期（指令周期末尾例行检查中断）</li>
<li>能耗低</li>
</ul>
<h2 id="3-4-调度算法的评价指标"><a href="#3-4-调度算法的评价指标" class="headerlink" title="3.4 调度算法的评价指标"></a>3.4 调度算法的评价指标</h2><ul>
<li>CPU利用率</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241223204641506.png"
                      alt="image-20241223204641506"
                ></p>
<ul>
<li>系统吞吐量</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241223204739103.png"
                      alt="image-20241223204739103"
                ></p>
<ul>
<li>周转时间</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241223205100483.png"
                      alt="image-20241223205100483"
                ></p>
<ul>
<li>等待时间</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241223213115702.png"
                      alt="image-20241223213115702"
                ></p>
<p>等待时间 &#x3D; 周转时间 - 运行时间</p>
<ul>
<li>响应时间</li>
</ul>
<p>对于计算机用户来说，会希望自己的提交的请求（比如通过键盘输入了一个调试命令）尽早地开始被系统服务、回应。</p>
<p>响应时间，指从用户提交请求到首次产生响应所用的时间。</p>
<h2 id="3-5-调度算法"><a href="#3-5-调度算法" class="headerlink" title="3.5 调度算法"></a>3.5 调度算法</h2><h3 id="3-5-1-先来先服务（FCFS）"><a href="#3-5-1-先来先服务（FCFS）" class="headerlink" title="3.5.1 先来先服务（FCFS）"></a>3.5.1 先来先服务（FCFS）</h3><ul>
<li>考虑了I&#x2F;O请求到达的先后次序，有利于长作业和CPU繁忙型作业。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241223222340285.png"
                      alt="image-20241223222340285"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241223223542404.png"
                      alt="image-20241223223542404"
                ></p>
<h3 id="3-5-2-短作业优先（SJF）"><a href="#3-5-2-短作业优先（SJF）" class="headerlink" title="3.5.2 短作业优先（SJF）"></a>3.5.2 短作业优先（SJF）</h3><ul>
<li>能使平均周转时间为最小。</li>
<li>如果系统中所有的作业同时到达，平均周转时间最小的一定是短作业优先算法。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241227204751375.png"
                      alt="image-20241227204751375"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241227203828001.png"
                      alt="image-20241227203828001"
                ></p>
<h3 id="3-5-3-高响应比优先（HRRN）"><a href="#3-5-3-高响应比优先（HRRN）" class="headerlink" title="3.5.3 高响应比优先（HRRN）"></a>3.5.3 高响应比优先（HRRN）</h3><ul>
<li>综合考虑了进程等待时间和执行之间，其优先权是可以改变的。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241227213008251.png"
                      alt="image-20241227213008251"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241227213138782.png"
                      alt="image-20241227213138782"
                ></p>
<h3 id="3-5-4-时间片轮转"><a href="#3-5-4-时间片轮转" class="headerlink" title="3.5.4 时间片轮转"></a>3.5.4 时间片轮转</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229212134343.png"
                      alt="image-20241229212134343"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229213646609.png"
                      alt="image-20241229213646609"
                ></p>
<ul>
<li><strong>运行过程</strong>：</li>
</ul>
<p>0时刻（P1(5)）：0时刻只有P1到达就绪队列，让P1上处理机运行一个时间片。</p>
<p>2时刻（P2(4)→P1(3)）：2时刻P2到达就绪队列，P1运行完一个时间片，被剥夺处理机，重新放到队尾。此时P2排在队头，因此让P2上处理机。（注意：2时刻，P1下处理机，同一时刻新进程P2到达，如果在题目中遇到这种情况，默认新到达的进程先进入就绪队列）</p>
<p>4时刻（P1(3)→P3(1)→P2(2)）：4时刻，P3到达，先插到就绪队尾，紧接着，P2下处理机也插到队尾。</p>
<p>5时刻（P3(1)→P2(2)→P4(6)）：5时刻，P4到达插到就绪队尾。(注意：由于P1的时间片还没用完，因此暂时不调度。另外，此时P1处于运行态，并不在就绪队列中）</p>
<p>6时刻（P3(1)→P2(2)→P4(6)→P1(1)）：6时刻，P1时间片用完，下处理机，重新放回就绪队尾，发生调度。</p>
<p>7时刻（P2(2)→P4(6)→P1(1)）：虽然P3的时间片没用完，但是由于P3只需运行1个单位的时间，运行完了会主动放弃处理机，因此也会发生调度。队头进程P2上处理机。</p>
<p>9时刻（P4(6)→P1(1)）：进程P2时间片用完，并刚好运行完，发生调度，P4上处理机。</p>
<p>11时刻（P1(1)&gt;P4(4)）：P4时间片用完，重新回到就绪队列。P1上处理机。</p>
<p>12时刻（P4(4)）：P1运行完，主动放弃处理机，此时就绪队列中只剩P4，P4上处理机。</p>
<p>14时刻（）：就绪队列为空，因此让P4接着运行一个时间片。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229214408503.png"
                      alt="image-20241229214408503"
                ></p>
<ul>
<li><strong>时间片选择注意：</strong></li>
</ul>
<p>如果时间片太大，使得每个进程都可以在一个时间片内就完成，则时间片轮转调度算法退化为先来先服务调度算法，并且会增大进程响应时间。因此时间片不能太大。</p>
<p>另一方面，进程调度、切换是有时间代价的（保存、恢复运行环境），因此如果时间片太小，会导致进程切换过于频繁，系统会花大量的时饲来处理进程切换，从而导致实际用于进程执行的时间比例减少。可见时间片也不能太小。</p>
<p>一般来说，设计时间片时要让切换进程的开销占比不超过1%。</p>
<h3 id="3-5-5-优先级调度"><a href="#3-5-5-优先级调度" class="headerlink" title="3.5.5 优先级调度"></a>3.5.5 优先级调度</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229215920082.png"
                      alt="image-20241229215920082"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229215142172.png"
                      alt="image-20241229215142172"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229215356725.png"
                      alt="image-20241229215356725"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229215833893.png"
                      alt="image-20241229215833893"
                ></p>
<ul>
<li><strong>注意：</strong></li>
</ul>
<p>静态优先权是在创建进程时确定的，确定之后整个进程运行期间就不会再改变了。</p>
<h3 id="3-5-6-多级反馈队列调度"><a href="#3-5-6-多级反馈队列调度" class="headerlink" title="3.5.6 多级反馈队列调度"></a>3.5.6 多级反馈队列调度</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229221107396.png"
                      alt="image-20241229221107396"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229221153359.png"
                      alt="image-20241229221153359"
                ></p>
<h3 id="3-5-7-多级队列调度"><a href="#3-5-7-多级队列调度" class="headerlink" title="3.5.7 多级队列调度"></a>3.5.7 多级队列调度</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229221555843.png"
                      alt="image-20241229221555843"
                ></p>
<h2 id="3-6-进程同步"><a href="#3-6-进程同步" class="headerlink" title="3.6 进程同步"></a>3.6 进程同步</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229223045386.png"
                      alt="image-20241229223045386"
                ></p>
<h2 id="3-7-进程互斥"><a href="#3-7-进程互斥" class="headerlink" title="3.7 进程互斥"></a>3.7 进程互斥</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229223353413.png"
                      alt="image-20241229223353413"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229223526363.png"
                      alt="image-20241229223526363"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241229223552571.png"
                      alt="image-20241229223552571"
                ></p>
<h2 id="3-8-进程互斥的软件实现"><a href="#3-8-进程互斥的软件实现" class="headerlink" title="3.8 进程互斥的软件实现"></a>3.8 进程互斥的软件实现</h2><h3 id="3-8-1-单标志法"><a href="#3-8-1-单标志法" class="headerlink" title="3.8.1 单标志法"></a>3.8.1 单标志法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230133907003.png"
                      alt="image-20241230133907003"
                ></p>
<ul>
<li>注意：</li>
</ul>
<p>只能按 P0→ P1→P0→P1→ ……这样轮流访问。这种必须 ”轮流访问” 带来的问题是，如果此时允许进入临界区的进程是P0，而P0一直不访问临界区，那么虽然此时临界区空闲，但是并不允许P1访问。</p>
<p>因此，单标志法存在的主要问题是：违背 “空闲让进” 原则。</p>
<h3 id="3-8-2-双标志先检查法"><a href="#3-8-2-双标志先检查法" class="headerlink" title="3.8.2 双标志先检查法"></a>3.8.2 双标志先检查法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230135043134.png"
                      alt="image-20241230135043134"
                ></p>
<h3 id="3-8-3-双标志后检查法"><a href="#3-8-3-双标志后检查法" class="headerlink" title="3.8.3 双标志后检查法"></a>3.8.3 双标志后检查法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230135406453.png"
                      alt="image-20241230135406453"
                ></p>
<h3 id="3-8-4-Peterson算法"><a href="#3-8-4-Peterson算法" class="headerlink" title="3.8.4 Peterson算法"></a>3.8.4 Peterson算法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230140507079.png"
                      alt="image-20241230140507079"
                ></p>
<ul>
<li>注意：</li>
</ul>
<p>Peterson 算法用软件方法解决了进程互斥问题，遵循了 空闲让进、忙则等待、有限等待 三个原则，但是依然未遵循 让权等待 的原则。</p>
<h2 id="3-9-进程互斥的硬件实现"><a href="#3-9-进程互斥的硬件实现" class="headerlink" title="3.9 进程互斥的硬件实现"></a>3.9 进程互斥的硬件实现</h2><h3 id="3-9-1-中断屏蔽方法"><a href="#3-9-1-中断屏蔽方法" class="headerlink" title="3.9.1 中断屏蔽方法"></a>3.9.1 中断屏蔽方法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230141350891.png"
                      alt="image-20241230141350891"
                ></p>
<h3 id="3-9-2-TestAndset指令"><a href="#3-9-2-TestAndset指令" class="headerlink" title="3.9.2 TestAndset指令"></a>3.9.2 TestAndset指令</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230142643010.png"
                      alt="image-20241230142643010"
                ></p>
<h3 id="3-9-3-Swap指令"><a href="#3-9-3-Swap指令" class="headerlink" title="3.9.3 Swap指令"></a>3.9.3 Swap指令</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230143156669.png"
                      alt="image-20241230143156669"
                ></p>
<h2 id="3-10-互斥锁"><a href="#3-10-互斥锁" class="headerlink" title="3.10 互斥锁"></a>3.10 互斥锁</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230150459722.png"
                      alt="image-20241230150459722"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230150811173.png"
                      alt="image-20241230150811173"
                ></p>
<h2 id="3-11-信号量机制"><a href="#3-11-信号量机制" class="headerlink" title="3.11 信号量机制"></a>3.11 信号量机制</h2><h3 id="3-11-1-介绍"><a href="#3-11-1-介绍" class="headerlink" title="3.11.1 介绍"></a>3.11.1 介绍</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230153521143.png"
                      alt="image-20241230153521143"
                ></p>
<h3 id="3-11-2-整型信号量"><a href="#3-11-2-整型信号量" class="headerlink" title="3.11.2 整型信号量"></a>3.11.2 整型信号量</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230162116725.png"
                      alt="image-20241230162116725"
                ></p>
<h3 id="3-11-3-记录型信号量"><a href="#3-11-3-记录型信号量" class="headerlink" title="3.11.3 记录型信号量"></a>3.11.3 记录型信号量</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230165250246.png"
                      alt="image-20241230165250246"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230182725520.png"
                      alt="image-20241230182725520"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230182751247.png"
                      alt="image-20241230182751247"
                ></p>
<h2 id="3-12-用信号量机制实现进程互斥、同步、前驱关系"><a href="#3-12-用信号量机制实现进程互斥、同步、前驱关系" class="headerlink" title="3.12 用信号量机制实现进程互斥、同步、前驱关系"></a>3.12 用信号量机制实现进程互斥、同步、前驱关系</h2><h3 id="3-12-1-实现进程互斥"><a href="#3-12-1-实现进程互斥" class="headerlink" title="3.12.1 实现进程互斥"></a>3.12.1 实现进程互斥</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230184726404.png"
                      alt="image-20241230184726404"
                ></p>
<h3 id="3-12-2-实现进程同步"><a href="#3-12-2-实现进程同步" class="headerlink" title="3.12.2 实现进程同步"></a>3.12.2 实现进程同步</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230185428960.png"
                      alt="image-20241230185428960"
                ></p>
<h3 id="3-12-3-实现前驱关系"><a href="#3-12-3-实现前驱关系" class="headerlink" title="3.12.3 实现前驱关系"></a>3.12.3 实现前驱关系</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230191222289.png"
                      alt="image-20241230191222289"
                ></p>
<h2 id="3-13-生产者-消费者问题"><a href="#3-13-生产者-消费者问题" class="headerlink" title="3.13 生产者-消费者问题"></a>3.13 生产者-消费者问题</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230194047252.png"
                      alt="image-20241230194047252"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230194111033.png"
                      alt="image-20241230194111033"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230194520516.png"
                      alt="image-20241230194520516"
                ></p>
<h2 id="3-14-多生产者-多消费者问题"><a href="#3-14-多生产者-多消费者问题" class="headerlink" title="3.14 多生产者-多消费者问题"></a>3.14 多生产者-多消费者问题</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230195135400.png"
                      alt="image-20241230195135400"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230211207530.png"
                      alt="image-20241230211207530"
                ></p>
<ul>
<li>注意：</li>
</ul>
<p>在生产者-消费者问题中，如果缓冲区大小为1，那么有可能不需要设置互斥信号量就可以实现互斥访问缓冲区的功能。当然，这不是绝对的，要具体问题具体分析。</p>
<p>建议：在考试中如果来不及仔细分析，可以加上互斥信号量，保证各进程一定会互斥地访问缓冲区但需要注意的是，实现互斥的P操作一定要在实现同步的P操作之后，否则可能引起 “死锁”。</p>
<h2 id="3-15-哲学家进餐问题"><a href="#3-15-哲学家进餐问题" class="headerlink" title="3.15 哲学家进餐问题"></a>3.15 哲学家进餐问题</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230212948551.png"
                      alt="image-20241230212948551"
                ></p>
<ul>
<li><strong>如何防止死锁的发生呢?</strong></li>
</ul>
<p>①可以对哲学家进程施加一些限制条件，比如最多允许四个哲学家同时进餐。这样可以保证至少有一个哲学家是可以拿到左右两只筷子的</p>
<p>②要求奇数号哲学家先拿左边的筷子，然后再拿右边的筷子，而偶数号哲学家刚好相反。用这种方法可以保证如果相邻的两个奇偶号哲学家都想吃饭，那么只会有其中一个可以拿起第一只筷子，另一个会直接阻塞。这就避免了占有一支后再等待另一只的情况。</p>
<p>③仅当一个哲学家左右两支筷子都可用时才允许他抓起筷子。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230213607449.png"
                      alt="image-20241230213607449"
                ></p>
<h2 id="3-16-管程"><a href="#3-16-管程" class="headerlink" title="3.16 管程"></a>3.16 管程</h2><h3 id="3-16-1-定义和基本特征"><a href="#3-16-1-定义和基本特征" class="headerlink" title="3.16.1 定义和基本特征"></a>3.16.1 定义和基本特征</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230215538837.png"
                      alt="image-20241230215538837"
                ></p>
<h3 id="3-16-2-用管程解决生产者消费者问题"><a href="#3-16-2-用管程解决生产者消费者问题" class="headerlink" title="3.16.2 用管程解决生产者消费者问题"></a>3.16.2 用管程解决生产者消费者问题</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230220523482.png"
                      alt="image-20241230220523482"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241230220822843.png"
                      alt="image-20241230220822843"
                ></p>
<h2 id="3-17-死锁的概念"><a href="#3-17-死锁的概念" class="headerlink" title="3.17 死锁的概念"></a>3.17 死锁的概念</h2><h3 id="3-17-1-什么是死锁"><a href="#3-17-1-什么是死锁" class="headerlink" title="3.17.1 什么是死锁"></a>3.17.1 什么是死锁</h3><p>每个人都占有一个资源，同时又在等待另一个人手里的资源。发生 “死锁“。</p>
<p>在并发环境下，各进程因竞争资源而造成的一种<strong>互相等待对方手里的资源，导致各进程都阻塞，都无法向前推进</strong>的现象，就是 “死锁“。发生死锁后若无外力干涉，这些进程都将无法向前推进。</p>
<h3 id="3-17-2-死锁、饥饿、死循环的区别"><a href="#3-17-2-死锁、饥饿、死循环的区别" class="headerlink" title="3.17.2 死锁、饥饿、死循环的区别"></a>3.17.2 死锁、饥饿、死循环的区别</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231132514021.png"
                      alt="image-20241231132514021"
                ></p>
<h3 id="3-17-3-死锁产生的必要条件"><a href="#3-17-3-死锁产生的必要条件" class="headerlink" title="3.17.3 死锁产生的必要条件"></a>3.17.3 死锁产生的必要条件</h3><p>四个必要条件：<strong>互斥条件、不可抢占条件、请求和保持条件、循环等待条件</strong>。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231133340996.png"
                      alt="image-20241231133340996"
                ></p>
<h3 id="3-17-4-什么时候会发生死锁"><a href="#3-17-4-什么时候会发生死锁" class="headerlink" title="3.17.4 什么时候会发生死锁"></a>3.17.4 什么时候会发生死锁</h3><p>1、对系统资源的竞争。各进程对不可剥夺的资源（如打印机）的竞争可能引起死锁，对可剥夺的资源（CPU）的竞争是不会引起死锁的。</p>
<p>2、进程推进顺序非法。请求和释放资源的顺序不当，也同样会导致死锁。例如，并发执行的进程P1、P2分别申请并占有了资源 R1、R2，之后进程P1又紧接着申请资源R2，而进程P2又申请资源R1，两者会因为申请的资源被对方占有而阻塞，从而发生死锁。</p>
<p>3、信号量的使用不当也会造成死锁。如生产者-消费者问题中，如果实现互斥的P操作在实现同步的P操作之前，就有可能导致死锁。（可以把互斥信号量、同步信号量也看做是一种抽象的系统资源）</p>
<p>总之，对不可剥夺资源的不合理分配，可能导致死锁。</p>
<p>即：<strong>竞争不可抢占性资源引起死锁、竞争可消耗资源引起死锁、进程推进顺序不当引起死锁</strong>。</p>
<h3 id="3-17-5-死锁的处理策略"><a href="#3-17-5-死锁的处理策略" class="headerlink" title="3.17.5 死锁的处理策略"></a>3.17.5 死锁的处理策略</h3><p>1、<strong>预防死锁</strong>。破坏死锁产生的四个必要条件中的一个或几个。</p>
<p>2、<strong>避免死锁</strong>。用某种方法防止系统进入不安全状态，从而避免死锁（银行家算法）。</p>
<p>3、<strong>死锁的检测和解除</strong>。允许死锁的发生，不过操作系统会负责检测出死锁的发生，然后采取某种措施解除死锁。</p>
<h2 id="3-18-预防死锁"><a href="#3-18-预防死锁" class="headerlink" title="3.18 预防死锁"></a>3.18 预防死锁</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231135427782.png"
                      alt="image-20241231135427782"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231135507249.png"
                      alt="image-20241231135507249"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231135536063.png"
                      alt="image-20241231135536063"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231140159221.png"
                      alt="image-20241231140159221"
                ></p>
<h2 id="3-19-避免死锁"><a href="#3-19-避免死锁" class="headerlink" title="3.19 避免死锁"></a>3.19 避免死锁</h2><h3 id="3-19-1-安全序列、不安全状态、死锁的联系"><a href="#3-19-1-安全序列、不安全状态、死锁的联系" class="headerlink" title="3.19.1 安全序列、不安全状态、死锁的联系"></a>3.19.1 安全序列、不安全状态、死锁的联系</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231151450576.png"
                      alt="image-20241231151450576"
                ></p>
<h3 id="3-19-2-银行家算法"><a href="#3-19-2-银行家算法" class="headerlink" title="3.19.2 银行家算法"></a>3.19.2 银行家算法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231153828608.png"
                      alt="image-20241231153828608"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231154142437.png"
                      alt="image-20241231154142437"
                ></p>
<h2 id="3-20-检测和解除"><a href="#3-20-检测和解除" class="headerlink" title="3.20 检测和解除"></a>3.20 检测和解除</h2><h3 id="3-20-1-死锁的检测"><a href="#3-20-1-死锁的检测" class="headerlink" title="3.20.1 死锁的检测"></a>3.20.1 死锁的检测</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231163115529.png"
                      alt="image-20241231163115529"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231163500322.png"
                      alt="image-20241231163500322"
                ></p>
<h3 id="3-20-2-死锁的解除"><a href="#3-20-2-死锁的解除" class="headerlink" title="3.20.2 死锁的解除"></a>3.20.2 死锁的解除</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231163637618.png"
                      alt="image-20241231163637618"
                ></p>
<h1 id="4-存储器管理"><a href="#4-存储器管理" class="headerlink" title="4 存储器管理"></a>4 存储器管理</h1><h2 id="4-1-内存的基础知识"><a href="#4-1-内存的基础知识" class="headerlink" title="4.1 内存的基础知识"></a>4.1 内存的基础知识</h2><h3 id="4-1-1-内存的概念和作用"><a href="#4-1-1-内存的概念和作用" class="headerlink" title="4.1.1 内存的概念和作用"></a>4.1.1 内存的概念和作用</h3><p>内存可存放数据。程序执行前**需要先放到内存中才能被CPU处理 **– 缓和CPU与硬盘之间的速度矛盾。</p>
<p>内存地址从0开始，<strong>每个地址对应一个存储单元</strong>。</p>
<p>内存中也有一个一个的 “小房间”，每个小房间就是一个 “<strong>存储单元</strong>“。</p>
<p>如果计算机 “<strong>按字节编址</strong>” 则每个存储单元大小为 <strong>1字节</strong>，即 1B，即 8个二进制位。</p>
<p>如果<strong>字长为16位</strong>的计算机 ”<strong>按字编址</strong>”，则每个存储单元大小为 <strong>1个字</strong>，每个字的大小为 16 个二进制位。</p>
<h3 id="4-1-2-程序从写到运行"><a href="#4-1-2-程序从写到运行" class="headerlink" title="4.1.2 程序从写到运行"></a>4.1.2 程序从写到运行</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231201933728.png"
                      alt="image-20241231201933728"
                ></p>
<h3 id="4-1-3-程序的装入"><a href="#4-1-3-程序的装入" class="headerlink" title="4.1.3 程序的装入"></a>4.1.3 程序的装入</h3><ul>
<li>绝对装入</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231193053483.png"
                      alt="image-20241231193053483"
                ></p>
<ul>
<li>可重定位装入</li>
</ul>
<p>将作业相对地址空间的相对地址转换成内存中的绝对地址的过程就是<strong>地址重定位</strong>。</p>
<p>地址变换通常是在程序装入时一次完成的，以后不再改变，故称为<strong>静态重定位</strong>。</p>
<p>静态重定位（装入时由重定位装入程序一次性完成）。</p>
<p><strong>固定分区分配</strong>是静态重定位。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231195347394.png"
                      alt="image-20241231195347394"
                ></p>
<ul>
<li>动态运行时装入</li>
</ul>
<p>动态重定位（程序真正执行时进行）。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231200633059.png"
                      alt="image-20241231200633059"
                ></p>
<h3 id="4-1-4-链接的三种方式"><a href="#4-1-4-链接的三种方式" class="headerlink" title="4.1.4 链接的三种方式"></a>4.1.4 链接的三种方式</h3><p>1、静态链接：在程序运行之前先将各目标模块及它们所需的库函数连接成一个完整的可执行文件（装入模块），之后不再拆开。</p>
<p>2、装入时动态链接：将各目标模块装入内存时，边装入边链接的链接方式。</p>
<p>3、运行时动态链接：在程序执行中需要该目标模块时，才对它进行链接。其优点是便于修改和更新，便于实现对目标模块的共享。</p>
<h2 id="4-2-内存管理的概念"><a href="#4-2-内存管理的概念" class="headerlink" title="4.2 内存管理的概念"></a>4.2 内存管理的概念</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231203550277.png"
                      alt="image-20241231203550277"
                ></p>
<ul>
<li>内存保护可采取两种方法：</li>
</ul>
<p>方法一：在CPU中设置一对上、下限寄存器，存放进程的上、下限地址。进程的指令要访问某个地址时，CPU检查是否越界。</p>
<p>方法二：采用重定位寄存器（又称基址寄存器）和界地址寄存器（又称限长寄存器）进行越界检查。重定位寄存器中存放的是进程的起始物理地址。界地址寄存器中存放的是进程的最大逻辑地址。</p>
<h2 id="4-3-覆盖与交换"><a href="#4-3-覆盖与交换" class="headerlink" title="4.3 覆盖与交换"></a>4.3 覆盖与交换</h2><h3 id="4-3-1-覆盖"><a href="#4-3-1-覆盖" class="headerlink" title="4.3.1 覆盖"></a>4.3.1 覆盖</h3><p>覆盖技术的思想：将<strong>程序分为多个段</strong>（多个模块）常用的段常驻内存，不常用的段在需要时调入内存。</p>
<p>内存中分为<strong>一个 “固定区”</strong> 和<strong>若干个 “覆盖区“</strong>。</p>
<p>需要常驻内存的段放在“固定区”中，<strong>调入后就不再调出</strong>（除非运行结束）；不常用的段放在“覆盖区”，<strong>需要用到时调入内存，用不到时调出内存</strong>。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231205930376.png"
                      alt="image-20241231205930376"
                ></p>
<h3 id="4-3-2-交换（对换）"><a href="#4-3-2-交换（对换）" class="headerlink" title="4.3.2 交换（对换）"></a>4.3.2 交换（对换）</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231210741475.png"
                      alt="image-20241231210741475"
                ></p>
<h3 id="4-3-3-区别"><a href="#4-3-3-区别" class="headerlink" title="4.3.3 区别"></a>4.3.3 区别</h3><p>覆盖是在同一个程序或进程中的。</p>
<p>交换是在不同进程（或作业）之间的。</p>
<h2 id="4-4-连续分配存储管理方式"><a href="#4-4-连续分配存储管理方式" class="headerlink" title="4.4 连续分配存储管理方式"></a>4.4 连续分配存储管理方式</h2><h3 id="4-4-1-单一连续分配"><a href="#4-4-1-单一连续分配" class="headerlink" title="4.4.1 单一连续分配"></a>4.4.1 单一连续分配</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231220326620.png"
                      alt="image-20241231220326620"
                ></p>
<h3 id="4-4-2-固定分区分配"><a href="#4-4-2-固定分区分配" class="headerlink" title="4.4.2 固定分区分配"></a>4.4.2 固定分区分配</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231220529891.png"
                      alt="image-20241231220529891"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20241231220652792.png"
                      alt="image-20241231220652792"
                ></p>
<h3 id="4-4-3-动态分区分配"><a href="#4-4-3-动态分区分配" class="headerlink" title="4.4.3 动态分区分配"></a>4.4.3 动态分区分配</h3><p><strong>动态分区分配</strong>又称为<strong>可变分区分配</strong>。这种分配方式<strong>不会预先划分内存分区</strong>，而是在进程装入内存时<strong>根据进程的大小动态地建立分区</strong>，并使分区的大小正好适合进程的需要。因此系统分区的大小和数目是可变的。</p>
<p>（eg：假设某计算机内存大小为64MB，系统区8MB，用户区共56MB…）</p>
<ul>
<li>系统要用什么样的数据结构记录内存的使用情况?</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101150217375.png"
                      alt="image-20250101150217375"
                ></p>
<ul>
<li>当很多个空闲分区都能满足需求时，应该选择哪个分区进行分配?</li>
</ul>
<p>把一个新作业装入内存时，须按照一定的<strong>动态分区分配算法</strong>，从空闲分区表（或空闲分区链）中选出一个分区分配给该作业。由于分配算法算法对系统性能有很大的影响，因此人们对它进行了广泛的研究。</p>
<ul>
<li>如何进行分区的分配与回收操作?</li>
<li>分配</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101150932317.png"
                      alt="image-20250101150932317"
                ></p>
<ul>
<li>回收</li>
</ul>
<p>情况一：回收区的后面有一个相邻的空闲分区——两个相邻的空闲分区合并为一个。</p>
<p>情况二：回收区的前面有一个相邻的空闲分区——两个相邻的空闲分区合并为一个。</p>
<p>情况三：回收区的前、后各有一个相邻的空闲分区——三个相邻的空闲分区合并为一个。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101151648438.png"
                      alt="image-20250101151648438"
                ></p>
<ul>
<li>紧凑技术</li>
</ul>
<p>动态分区分配<strong>没有内部碎片</strong>，但是<strong>有外部碎片</strong>。</p>
<p><strong>内部碎片</strong>，分配给某进程的内存区域中，如果有些部分没有用上。</p>
<p><strong>外部碎片</strong>，是指内存中的某些空闲分区由于太小而难以利用。</p>
<p>如果内存中空闲空间的总和本来可以满足某进程的要求但由于进程需要的是一整块连续的内存空间，因此这些 “碎片” 不能满足进程的需求。可以通过<strong>紧凑（拼凑，Compaction）技术</strong>来解决外部碎片。</p>
<h2 id="4-5-动态分区分配算法"><a href="#4-5-动态分区分配算法" class="headerlink" title="4.5 动态分区分配算法"></a>4.5 动态分区分配算法</h2><h3 id="4-5-1-首次适应算法"><a href="#4-5-1-首次适应算法" class="headerlink" title="4.5.1 首次适应算法"></a>4.5.1 首次适应算法</h3><p>空闲分区链以地址递增的次序链接，分配内存时，从链首开始顺序查找，直至找到一个大小能满足要求的空闲分区为止。</p>
<p>首次适应算法的效果是更好的。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101153257219.png"
                      alt="image-20250101153257219"
                ></p>
<h3 id="4-5-2-最佳适应算法"><a href="#4-5-2-最佳适应算法" class="headerlink" title="4.5.2 最佳适应算法"></a>4.5.2 最佳适应算法</h3><p>将所有的空闲分区按容量从小到大的顺序形成一个空闲分区链，第一次找到的能满足要求的空闲区必然是最佳的。</p>
<p>（进行若干次空间分配和回收后，能够计算出主存中空闲分区的大小。）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101153954364.png"
                      alt="image-20250101153954364"
                ></p>
<h3 id="4-5-3-最坏适应算法"><a href="#4-5-3-最坏适应算法" class="headerlink" title="4.5.3 最坏适应算法"></a>4.5.3 最坏适应算法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101154243082.png"
                      alt="image-20250101154243082"
                ></p>
<h3 id="4-5-4-邻近适应算法"><a href="#4-5-4-邻近适应算法" class="headerlink" title="4.5.4 邻近适应算法"></a>4.5.4 邻近适应算法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101154851476.png"
                      alt="image-20250101154851476"
                ></p>
<h3 id="4-5-6-总结"><a href="#4-5-6-总结" class="headerlink" title="4.5.6 总结"></a>4.5.6 总结</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101155017999.png"
                      alt="image-20250101155017999"
                ></p>
<h2 id="4-6-分页存储管理方式"><a href="#4-6-分页存储管理方式" class="headerlink" title="4.6 分页存储管理方式"></a>4.6 分页存储管理方式</h2><h3 id="4-6-1-分页存储"><a href="#4-6-1-分页存储" class="headerlink" title="4.6.1 分页存储"></a>4.6.1 分页存储</h3><p>分页存储管理系统中，CPU每存取一个数据，都要访问2次内存。</p>
<p>在分页式存储管理中，如果页面置换算法选择不当，就会出现抖动现象，使系统的命中率降低。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101163200910.png"
                      alt="image-20250101163200910"
                ></p>
<h3 id="4-6-2-页表"><a href="#4-6-2-页表" class="headerlink" title="4.6.2 页表"></a>4.6.2 页表</h3><p>分页存储管理方式中，页表实现了页号到块号的地址映像。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101165411590.png"
                      alt="image-20250101165411590"
                ></p>
<ul>
<li>每个页表项占多少字节?</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101170931318.png"
                      alt="image-20250101170931318"
                ></p>
<h3 id="4-6-3-地址的转换"><a href="#4-6-3-地址的转换" class="headerlink" title="4.6.3 地址的转换"></a>4.6.3 地址的转换</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101171118002.png"
                      alt="image-20250101171118002"
                ></p>
<ul>
<li>如何确定一个逻辑地址对应的页号、页内偏移量?</li>
</ul>
<p>如果每个页面大小为2的k次方B ，用二进制数表示逻辑地址则末尾K位即为页内偏移量，其余部分就是页号。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101172110285.png"
                      alt="image-20250101172110285"
                ></p>
<ul>
<li>为何页面大小要取2的整数幂?</li>
</ul>
<p>①逻辑地址的拆分更加迅速– 如果每个页面大小为2的k次方B，用二进制数表示逻辑地址，则末尾K位即为页内偏移量，其余部分就是页号。因此，如果让每个页面的大小为2的整数幂，计算机硬件就可以很方便地得出一个逻辑地址对应的页号和页内偏移量，而无需进行除法运算，从而提升了运行速度。</p>
<p>②物理地址的计算更加迅速– 根据逻辑地址得到页号，根据页号查询页表从而找到页面存放的内存块号，将二进制表示的内存块号和页内偏移量拼接起来，就可以得到最终的物理地址。</p>
<h3 id="4-6-4-逻辑地址结构"><a href="#4-6-4-逻辑地址结构" class="headerlink" title="4.6.4 逻辑地址结构"></a>4.6.4 逻辑地址结构</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101172456945.png"
                      alt="image-20250101172456945"
                ></p>
<h3 id="4-6-5-基本地址变换机构"><a href="#4-6-5-基本地址变换机构" class="headerlink" title="4.6.5 基本地址变换机构"></a>4.6.5 基本地址变换机构</h3><ul>
<li>过程</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101174153357.png"
                      alt="image-20250101174153357"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101174233788.png"
                      alt="image-20250101174233788"
                ></p>
<ul>
<li>例子</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101174639953.png"
                      alt="image-20250101174639953"
                ></p>
<h3 id="4-6-6-有快表的地址变换机构"><a href="#4-6-6-有快表的地址变换机构" class="headerlink" title="4.6.6 有快表的地址变换机构"></a>4.6.6 有快表的地址变换机构</h3><ul>
<li>快表</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101184124662.png"
                      alt="image-20250101184124662"
                ></p>
<ul>
<li>引入快表后的地址变换过程</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101184305319.png"
                      alt="image-20250101184305319"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101184341166.png"
                      alt="image-20250101184341166"
                ></p>
<ul>
<li>局部性原理</li>
</ul>
<p><strong>基本地址变换机构</strong>中，每次要访问一个逻辑地址，都需要<strong>查询内存中的页表</strong>。由于局部性原理，<strong>可能连续很多次查到的都是同一个页表项</strong>。</p>
<h2 id="4-7-基本分段存储管理方式"><a href="#4-7-基本分段存储管理方式" class="headerlink" title="4.7 基本分段存储管理方式"></a>4.7 基本分段存储管理方式</h2><h3 id="4-7-1-分段"><a href="#4-7-1-分段" class="headerlink" title="4.7.1 分段"></a>4.7.1 分段</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101191839168.png"
                      alt="image-20250101191839168"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101192309738.png"
                      alt="image-20250101192309738"
                ></p>
<h3 id="4-7-2-段表"><a href="#4-7-2-段表" class="headerlink" title="4.7.2 段表"></a>4.7.2 段表</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101192839925.png"
                      alt="image-20250101192839925"
                ></p>
<h3 id="4-7-3-地址变换"><a href="#4-7-3-地址变换" class="headerlink" title="4.7.3 地址变换"></a>4.7.3 地址变换</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101193305851.png"
                      alt="image-20250101193305851"
                ></p>
<h3 id="4-7-4-分段、分页管理的对比"><a href="#4-7-4-分段、分页管理的对比" class="headerlink" title="4.7.4 分段、分页管理的对比"></a>4.7.4 分段、分页管理的对比</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101193805054.png"
                      alt="image-20250101193805054"
                ></p>
<h2 id="4-8-段页式管理方式"><a href="#4-8-段页式管理方式" class="headerlink" title="4.8 段页式管理方式"></a>4.8 段页式管理方式</h2><h3 id="4-8-1-分页、分段的优缺点"><a href="#4-8-1-分页、分段的优缺点" class="headerlink" title="4.8.1 分页、分段的优缺点"></a>4.8.1 分页、分段的优缺点</h3><table>
<thead>
<tr>
<th></th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>分页</td>
<td>内存空间利用率高，不会产生外部碎片，只会有少量的页内碎片</td>
<td>不方便按照逻辑模块实现信息的共享和保护</td>
</tr>
<tr>
<td>分段</td>
<td>很方便按照逻辑模块实现信息的共享和保护</td>
<td>如果段长过大，为其分配很大的连续空间会很不方便。另外，段式管理会产生外部碎片（分段管理中产生的外部碎片也可以用“紧凑”来解决，只是需要付出较大的时间代价）</td>
</tr>
</tbody></table>
<h3 id="4-8-2-概念"><a href="#4-8-2-概念" class="headerlink" title="4.8.2 概念"></a>4.8.2 概念</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101195104097.png"
                      alt="image-20250101195104097"
                ></p>
<h3 id="4-8-3-逻辑地址结构"><a href="#4-8-3-逻辑地址结构" class="headerlink" title="4.8.3 逻辑地址结构"></a>4.8.3 逻辑地址结构</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101195324009.png"
                      alt="image-20250101195324009"
                ></p>
<h3 id="4-8-4-段表、页表"><a href="#4-8-4-段表、页表" class="headerlink" title="4.8.4 段表、页表"></a>4.8.4 段表、页表</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101195436218.png"
                      alt="image-20250101195436218"
                ></p>
<h3 id="4-8-5-地址变换"><a href="#4-8-5-地址变换" class="headerlink" title="4.8.5 地址变换"></a>4.8.5 地址变换</h3><p> <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101195525459.png"
                      alt="image-20250101195525459"
                ></p>
<h1 id="5-虚拟存储器"><a href="#5-虚拟存储器" class="headerlink" title="5 虚拟存储器"></a>5 虚拟存储器</h1><h2 id="5-1-传统存储管理方式的特征、缺点"><a href="#5-1-传统存储管理方式的特征、缺点" class="headerlink" title="5.1 传统存储管理方式的特征、缺点"></a>5.1 传统存储管理方式的特征、缺点</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101200254244.png"
                      alt="image-20250101200254244"
                ></p>
<h2 id="5-2-局部性原理"><a href="#5-2-局部性原理" class="headerlink" title="5.2 局部性原理"></a>5.2 局部性原理</h2><p><strong>时间局部性</strong>：如果执行了程序中的某条指令，那么不久后这条指令很有可能再次执行；如果某个数据被访问过，不久之后该数据很可能再次被访问。</p>
<p><strong>空间局部性</strong>：一旦程序访问了某个存储单元，在不久之后，其附近的存储单元也很有可能被访问。(因为很多数据在内存中都是连续存放的)</p>
<h2 id="5-3-虚拟内存的定义和特征"><a href="#5-3-虚拟内存的定义和特征" class="headerlink" title="5.3 虚拟内存的定义和特征"></a>5.3 虚拟内存的定义和特征</h2><p><strong>虚拟存储器的定义</strong>：是指具有请求调入功能和置换功能，能从逻辑上对内存容量加以扩充的一种存储器系统。其逻辑容量由内存容量和外存容量之和所决定，其运行速度接近于内存速度，而每位的成本却又接近于外存。</p>
<p><strong>虚拟性</strong>是实现虚拟存储器的目标。</p>
<p>实现虚拟存储器的<strong>目的</strong>是<strong>扩充主存容量</strong>，是扩充主存逻辑地址的空间技术。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101200737884.png"
                      alt="image-20250101200737884"
                ></p>
<h2 id="5-4-如何实现虚拟内存技术"><a href="#5-4-如何实现虚拟内存技术" class="headerlink" title="5.4 如何实现虚拟内存技术"></a>5.4 如何实现虚拟内存技术</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101201452901.png"
                      alt="image-20250101201452901"
                ></p>
<h2 id="5-5-页面置换算法"><a href="#5-5-页面置换算法" class="headerlink" title="5.5 页面置换算法"></a>5.5 页面置换算法</h2><h3 id="5-5-1-最佳置换算法-OPT"><a href="#5-5-1-最佳置换算法-OPT" class="headerlink" title="5.5.1 最佳置换算法(OPT)"></a>5.5.1 最佳置换算法(OPT)</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101204645239.png"
                      alt="image-20250101204645239"
                ></p>
<ul>
<li>注意：</li>
</ul>
<p>最佳置换算法可以保证<strong>最低的缺页率</strong>，但实际上，只有在进程执行的过程中才能知道接下来会访问到的是哪个页面。操作系统无法提前预判页面访问序列。因此，最佳置换算法是<strong>无法实现</strong>的。</p>
<h3 id="5-5-2-先进先出置换算法-FIFO"><a href="#5-5-2-先进先出置换算法-FIFO" class="headerlink" title="5.5.2 先进先出置换算法(FIFO)"></a>5.5.2 先进先出置换算法(FIFO)</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101205313747.png"
                      alt="image-20250101205313747"
                ></p>
<h3 id="5-5-3-最近最久未使用置换算法-LRU"><a href="#5-5-3-最近最久未使用置换算法-LRU" class="headerlink" title="5.5.3 最近最久未使用置换算法(LRU)"></a>5.5.3 最近最久未使用置换算法(LRU)</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101205907312.png"
                      alt="image-20250101205907312"
                ></p>
<h3 id="5-5-4-时钟置换算法-CLOCK"><a href="#5-5-4-时钟置换算法-CLOCK" class="headerlink" title="5.5.4 时钟置换算法(CLOCK)"></a>5.5.4 时钟置换算法(CLOCK)</h3><ul>
<li>原始</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101210617712.png"
                      alt="image-20250101210617712"
                ></p>
<ul>
<li>改良</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250101211839121.png"
                      alt="image-20250101211839121"
                ></p>
<h1 id="6-输入输出系统"><a href="#6-输入输出系统" class="headerlink" title="6 输入输出系统"></a>6 输入输出系统</h1><h2 id="6-1-I-O系统"><a href="#6-1-I-O系统" class="headerlink" title="6.1 I&#x2F;O系统"></a>6.1 I&#x2F;O系统</h2><ul>
<li>基本功能</li>
</ul>
<p>隐藏物理设备的细节</p>
<p>与设备的无关性</p>
<p>提高处理机和I&#x2F;O设备的利用率</p>
<p>对I&#x2F;O设备进行控制</p>
<p>确保对设备的正确共享</p>
<p>错误处理</p>
<h2 id="6-2-I-O设备的基本概念"><a href="#6-2-I-O设备的基本概念" class="headerlink" title="6.2 I&#x2F;O设备的基本概念"></a>6.2 I&#x2F;O设备的基本概念</h2><ul>
<li>概念</li>
</ul>
<p>“I&#x2F;O” 就是 “输入&#x2F;输出” (Input&#x2F;Output)。I&#x2F;O设备就是可以将数据输入到计算机，或者可以接收计算机输出数据的外部设备，属于计算机中的硬件部件。</p>
<ul>
<li><p>分类</p>
</li>
<li><p>按<strong>使用特性</strong>分类：</p>
</li>
</ul>
<p>人机交互类外部设备；存储设备；网络通信设备</p>
<ul>
<li>按<strong>传输速率</strong>分类：</li>
</ul>
<p>低速设备；中速设备；高速设备</p>
<ul>
<li>按<strong>信息交换的单位</strong>分类：</li>
</ul>
<p>块设备（传输快，可寻址）</p>
<p>字符设备（传输慢，不可寻址，常采用中断驱动方式）</p>
<ul>
<li>按<strong>分配特性</strong>分类</li>
</ul>
<p>独享设备；共享设备；虚拟设备</p>
<h2 id="6-3-I-O控制方式"><a href="#6-3-I-O控制方式" class="headerlink" title="6.3 I&#x2F;O控制方式"></a>6.3 I&#x2F;O控制方式</h2><h3 id="6-3-1-程序直接控制方式"><a href="#6-3-1-程序直接控制方式" class="headerlink" title="6.3.1 程序直接控制方式"></a>6.3.1 程序直接控制方式</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102133742369.png"
                      alt="image-20250102133742369"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102133809130.png"
                      alt="image-20250102133809130"
                ></p>
<h3 id="6-3-2-中断驱动方式"><a href="#6-3-2-中断驱动方式" class="headerlink" title="6.3.2 中断驱动方式"></a>6.3.2 中断驱动方式</h3><ul>
<li>思想：</li>
</ul>
<p>引入<strong>中断机制</strong>。由于I&#x2F;O设备速度很慢，因此在CPU发出读&#x2F;写命令后，可<strong>将等待I&#x2F;O的进程阻塞</strong>，先切换到别的进程执行。当I&#x2F;O完成后，控制器会向CPU发出一个中断信号，CPU<strong>检测到中断信号后</strong>，会保存当前进程的运行环境信息，转去执行中断处理程序处理该中断。处理中断的过程中，CPU从I&#x2F;O控制器读一个字的数据传送到CPU寄存器，再写入主存。接着，<strong>CPU恢复等待I&#x2F;O的进程（或其他进程）的运行环境，然后继续执行</strong>。</p>
<ul>
<li>注意：</li>
</ul>
<p>CPU会在每个指令周期的末尾检查中断。</p>
<p>中断处理过程中需要保存、恢复进程的运行环境这个过程是需要一定时间开销的。可见，如果中断发生的频率太高，也会降低系统性能。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102135108366.png"
                      alt="image-20250102135108366"
                ></p>
<h3 id="6-3-3-DMA方式"><a href="#6-3-3-DMA方式" class="headerlink" title="6.3.3 DMA方式"></a>6.3.3 DMA方式</h3><ul>
<li>思想：</li>
</ul>
<p>与 “中断驱动方式” 相比，DMA方式（Direct Memory Access，<strong>直接存储器存取</strong>。主要用于块设备的I&#x2F;O控制）有这样几个改进：</p>
<p>①数据的传送单位是“块”。不再是一个字、一个字的传送；</p>
<p>②数据的流向是从设备直接放入内存，或者从内存直接到设备。不再需要CPU作为 “快递小哥”；</p>
<p>③仅在传送一个或多个数据块的开始和结束时，才需要CPU干预。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102140000904.png"
                      alt="image-20250102140000904"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102140159134.png"
                      alt="image-20250102140159134"
                ></p>
<h3 id="6-3-4-通道控制方式"><a href="#6-3-4-通道控制方式" class="headerlink" title="6.3.4 通道控制方式"></a>6.3.4 通道控制方式</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102141123354.png"
                      alt="image-20250102141123354"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102141157875.png"
                      alt="image-20250102141157875"
                ></p>
<h2 id="6-4-磁盘的结构"><a href="#6-4-磁盘的结构" class="headerlink" title="6.4 磁盘的结构"></a>6.4 磁盘的结构</h2><ul>
<li>磁盘、磁道、扇区</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102143927687.png"
                      alt="image-20250102143927687"
                ></p>
<ul>
<li>如何在磁盘中读&#x2F;写数据</li>
</ul>
<p>需要把 “磁头” 移动到想要读&#x2F;写的扇区所在的磁道。磁盘会转起来，让目标扇区从磁头下面划过，才能完成对扇区的读&#x2F;写操作。</p>
<ul>
<li>盘面、柱面</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102144201694.png"
                      alt="image-20250102144201694"
                ></p>
<ul>
<li>磁盘的物理地址</li>
</ul>
<p>可用（柱面号，盘面号，扇区号）来定位任意一个“磁盘块”。在“文件的物理结构”小节中，我们经常提到文件数据存放在外存中的几号块，这个块号就可以转换成（柱面号，盘面号，扇区号）的地址形式。</p>
<p>可根据该地址读取一个“块”：</p>
<p>①根据 “柱面号” 移动磁臂，让磁头指向指定柱面；</p>
<p>②激活指定盘面对应的磁头;</p>
<p>③磁盘旋转的过程中，指定的扇区会从磁头下面划过，这样就完成了对指定扇区的读&#x2F;写。</p>
<ul>
<li>分类</li>
<li>根据磁头是否可移动：</li>
</ul>
<p>固定头磁盘（每个磁道有一个磁头）；移动头磁盘（每个盘面只有一个磁头）</p>
<ul>
<li>根据盘片是否可更换：</li>
</ul>
<p>固定盘磁盘；可换盘磁盘</p>
<h2 id="6-5-磁盘调度算法"><a href="#6-5-磁盘调度算法" class="headerlink" title="6.5 磁盘调度算法"></a>6.5 磁盘调度算法</h2><h3 id="6-5-1-磁盘读-写操作需要的时间"><a href="#6-5-1-磁盘读-写操作需要的时间" class="headerlink" title="6.5.1 磁盘读&#x2F;写操作需要的时间"></a>6.5.1 磁盘读&#x2F;写操作需要的时间</h3><p><strong>磁盘的访问时间 &#x3D; 磁盘寻道时间 + 旋转延迟时间 + 数据传输时间</strong></p>
<p>即：总的平均存取时间T &#x3D; Ts + 1&#x2F;2r + b&#x2F;(rN)</p>
<ul>
<li>磁盘寻道时间</li>
</ul>
<p>寻找时间（寻道时间）Ts：在读&#x2F;写数据前，将磁头移动到指定磁道所花的时间。</p>
<p>①启动磁头臂是需要时间的。假设耗时为s;</p>
<p>②移动磁头也是需要时间的。假设磁头匀速移动，每跨越一个磁道耗时为m，总共需要跨越n条磁道。</p>
<p>则：寻道时间Ts &#x3D; s + m*n</p>
<ul>
<li>旋转延迟时间</li>
</ul>
<p>延迟时间Tr：通过旋转磁盘，使磁头定位到目标扇区所需要的时间。</p>
<p>设磁盘转速为r（单位:转&#x2F;秒，或转&#x2F;分），则平均所需的延迟时间Tr &#x3D; (1&#x2F;2)*(1&#x2F;r) &#x3D; 1&#x2F;(2r)</p>
<p>补充：</p>
<p>1&#x2F;r 就是转一圈需要的时间。找到目标扇区平均需要转半圈，因此再乘以 1&#x2F;2。</p>
<p>硬盘的典型转速为5400 转&#x2F;分，或7200 转&#x2F;分。</p>
<ul>
<li>数据传输时间</li>
</ul>
<p>传输时间Tt：从磁盘读出或向磁盘写入数据所经历的时间。</p>
<p>假设磁盘转速为r，此次读&#x2F;写的字节数为b，每个磁道上的字节数为N。则：传输时间Tt &#x3D; (1&#x2F;r)*(b&#x2F;N) &#x3D; b&#x2F;(rN)</p>
<ul>
<li>注意：</li>
</ul>
<p>延迟时间和传输时间都与磁盘转速相关，且为线性相关。而转速是硬件的固有属性，因此操作系统也无法优化延迟时间和传输时间。</p>
<h3 id="6-5-2-先来先服务算法-FCFS"><a href="#6-5-2-先来先服务算法-FCFS" class="headerlink" title="6.5.2 先来先服务算法(FCFS)"></a>6.5.2 先来先服务算法(FCFS)</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102150954819.png"
                      alt="image-20250102150954819"
                ></p>
<h3 id="6-5-3-最短寻找时间优先-SSTF"><a href="#6-5-3-最短寻找时间优先-SSTF" class="headerlink" title="6.5.3 最短寻找时间优先(SSTF)"></a>6.5.3 最短寻找时间优先(SSTF)</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102151622451.png"
                      alt="image-20250102151622451"
                ></p>
<h3 id="6-5-4-扫描算法-SCAN"><a href="#6-5-4-扫描算法-SCAN" class="headerlink" title="6.5.4 扫描算法(SCAN)"></a>6.5.4 扫描算法(SCAN)</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102152423492.png"
                      alt="image-20250102152423492"
                ></p>
<h3 id="6-5-5-循环扫描算法-C-SCAN"><a href="#6-5-5-循环扫描算法-C-SCAN" class="headerlink" title="6.5.5 循环扫描算法(C-SCAN)"></a>6.5.5 循环扫描算法(C-SCAN)</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102155452497.png"
                      alt="image-20250102155452497"
                ></p>
<h1 id="7-文件管理"><a href="#7-文件管理" class="headerlink" title="7 文件管理"></a>7 文件管理</h1><h2 id="7-1-基础"><a href="#7-1-基础" class="headerlink" title="7.1 基础"></a>7.1 基础</h2><p>文件名是由文件创建者在<strong>创建文件</strong>时给出的，每个系统有自己的文件命名规则。</p>
<p>文件系统的主要目的就是实现对文件的<strong>按名存取</strong>。</p>
<p>文件属性包括文件类型、文件长度、文件物理位置、文件建立时间等。</p>
<p>打开文件来获得已有文件的使用权</p>
<p>关闭文件即可以归还文件的使用权。</p>
<p>按文件的逻辑结构划分，文件主要有两类：流式文件和记录式文件。</p>
<p>根据在辅存上的不同存储方式，文件可以有<strong>顺序、链接和索引</strong>三种不同的物理结构。其中顺序访问效率最高的是<strong>顺序</strong>结构，随机访问效率最高的是<strong>索引</strong>结构。</p>
<p>文件控制块与文件一一对应。</p>
<p>多级目录结构形式为树型结构。</p>
<ul>
<li>操作系统通过什么来感知文件的存在？</li>
</ul>
<p><strong>文件控制块</strong>（FCB）。</p>
<ul>
<li>什么是绝对路径，相对路径？</li>
</ul>
<p>从<strong>根目录</strong>出发的路径称为绝对路径。</p>
<p>从<strong>当前目录</strong>出发的路径称为相对路径。</p>
<p>各级目录之间用 “**&#x2F;**” 隔开。</p>
<h1 id="8-磁盘存储器的管理"><a href="#8-磁盘存储器的管理" class="headerlink" title="8 磁盘存储器的管理"></a>8 磁盘存储器的管理</h1><h2 id="8-1-基础"><a href="#8-1-基础" class="headerlink" title="8.1 基础"></a>8.1 基础</h2><ul>
<li>文件在外存上的组织方式有哪三种？</li>
</ul>
<p>连续组织方式；链接组织方式；索引组织方式</p>
<h2 id="8-2-文件存储空间管理"><a href="#8-2-文件存储空间管理" class="headerlink" title="8.2 文件存储空间管理"></a>8.2 文件存储空间管理</h2><h3 id="8-2-1-存储空间的划分与初始化"><a href="#8-2-1-存储空间的划分与初始化" class="headerlink" title="8.2.1 存储空间的划分与初始化"></a>8.2.1 存储空间的划分与初始化</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102172733203.png"
                      alt="image-20250102172733203"
                ></p>
<h3 id="8-2-2-空闲表法"><a href="#8-2-2-空闲表法" class="headerlink" title="8.2.2 空闲表法"></a>8.2.2 空闲表法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102173556418.png"
                      alt="image-20250102173556418"
                ></p>
<h3 id="8-2-3-空闲链表法"><a href="#8-2-3-空闲链表法" class="headerlink" title="8.2.3 空闲链表法"></a>8.2.3 空闲链表法</h3><ul>
<li>空闲盘块链</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102174034018.png"
                      alt="image-20250102174034018"
                ></p>
<ul>
<li>空闲盘区链</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102174336773.png"
                      alt="image-20250102174336773"
                ></p>
<h3 id="8-2-4-位示图法"><a href="#8-2-4-位示图法" class="headerlink" title="8.2.4 位示图法"></a>8.2.4 位示图法</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20250102175134999.png"
                      alt="image-20250102175134999"
                ></p>
<p>如何分配：若文件需要K个块，①顺序扫描位示图，找到K个相邻或不相邻的“0”；②根据字号、位号算出对应的盘块号，将相应盘块分配给文件；③将相应位设置为“1”。</p>
<p>如何回收：①根据回收的盘块号计算出对应的字号、位号；②将相应二进制位设为“0”。</p>
]]></content>
      <categories>
        <category>408</category>
        <category>操作系统</category>
      </categories>
      <tags>
        <tag>自研笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机组成原理</title>
    <url>/2024/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1 id="1-存储器"><a href="#1-存储器" class="headerlink" title="1- 存储器"></a>1- 存储器</h1><h2 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1-1 概述"></a>1-1 概述</h2><h3 id="1-1-1-存储器分类"><a href="#1-1-1-存储器分类" class="headerlink" title="1-1-1 存储器分类"></a>1-1-1 存储器分类</h3><h4 id="1-1-1-1-按存储介质分类"><a href="#1-1-1-1-按存储介质分类" class="headerlink" title="1-1-1-1 按存储介质分类"></a>1-1-1-1 按存储介质分类</h4><p>1、半导体存储器		TTL、MOS		易失</p>
<p>2、磁表面存储器		磁头、载磁体		非易失</p>
<p>3、磁芯存储器		硬磁材料、环状元件		非易失</p>
<p>4、光盘存储器		激光、磁光材料		非易失</p>
<h4 id="1-1-1-2-按存取方式分类"><a href="#1-1-1-2-按存取方式分类" class="headerlink" title="1-1-1-2 按存取方式分类"></a>1-1-1-2 按存取方式分类</h4><p>1、存取时间与物理地址无关（随机访问）</p>
<ul>
<li>随机存储器		在程序的执行过程中		可读可写</li>
<li>只读存储器        在程序的执行过程中		只读</li>
</ul>
<p>2、存取时间与物理地址有关（串行访问）</p>
<ul>
<li>顺序存取存储器		磁带</li>
<li>直接存取存储器		磁盘</li>
</ul>
<h4 id="1-1-1-3-按在计算机中的作用分类"><a href="#1-1-1-3-按在计算机中的作用分类" class="headerlink" title="1-1-1-3 按在计算机中的作用分类"></a>1-1-1-3 按在计算机中的作用分类</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501154448708.png"
                      alt="image-20240501154448708"
                ></li>
</ul>
<h3 id="1-1-2-存储器的层次结构"><a href="#1-1-2-存储器的层次结构" class="headerlink" title="1-1-2 存储器的层次结构"></a>1-1-2 存储器的层次结构</h3><h4 id="1-1-2-1-存储器三个主要特性的关系"><a href="#1-1-2-1-存储器三个主要特性的关系" class="headerlink" title="1-1-2-1 存储器三个主要特性的关系"></a>1-1-2-1 存储器三个主要特性的关系</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501154934996.png"
                      alt="image-20240501154934996"
                ></li>
</ul>
<h4 id="1-1-2-2-缓存一主存层次和主存一辅存层次"><a href="#1-1-2-2-缓存一主存层次和主存一辅存层次" class="headerlink" title="1-1-2-2 缓存一主存层次和主存一辅存层次"></a>1-1-2-2 缓存一主存层次和主存一辅存层次</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501160415479.png"
                      alt="image-20240501160415479"
                ></li>
</ul>
<p>缓存一主存层次	主要解决CPU和主存速度不匹配的问题。</p>
<p>主存一辅存层次	主要解决存储系统的容量问题。</p>
<p>注意：</p>
<ul>
<li>辅存的速度比主存的速度低，容量比主存大的多，且不能和CPU直接交换信息。</li>
<li>主存和辅存共同构成虚拟存储器，用虚地址，即逻辑地址。</li>
<li>缓存和主存共同构成主存储器，用实地址，即物理地址。</li>
</ul>
<h2 id="1-2-主存储器"><a href="#1-2-主存储器" class="headerlink" title="1-2 主存储器"></a>1-2 主存储器</h2><h3 id="1-2-1-概述"><a href="#1-2-1-概述" class="headerlink" title="1-2-1 概述"></a>1-2-1 概述</h3><h4 id="1-2-1-1-主存的基本组成"><a href="#1-2-1-1-主存的基本组成" class="headerlink" title="1-2-1-1 主存的基本组成"></a>1-2-1-1 主存的基本组成</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501161203442.png"
                      alt="image-20240501161203442"
                ></li>
</ul>
<h4 id="1-2-1-2-主存和CPU的联系"><a href="#1-2-1-2-主存和CPU的联系" class="headerlink" title="1-2-1-2 主存和CPU的联系"></a>1-2-1-2 主存和CPU的联系</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501161405812.png"
                      alt="image-20240501161405812"
                ></li>
</ul>
<h4 id="1-2-1-3-主存中存储单元地址的分配"><a href="#1-2-1-3-主存中存储单元地址的分配" class="headerlink" title="1-2-1-3 主存中存储单元地址的分配"></a>1-2-1-3 主存中存储单元地址的分配</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501164042442.png"
                      alt="image-20240501164042442"
                ></li>
</ul>
<h4 id="1-2-1-4-主存的技术指标"><a href="#1-2-1-4-主存的技术指标" class="headerlink" title="1-2-1-4 主存的技术指标"></a>1-2-1-4 主存的技术指标</h4><p>1、存储容量		主存存放二进制代码的总位数</p>
<p>2、存储速度</p>
<ul>
<li>存取时间		存储器的访问时间		读出时间、写入时间</li>
<li>存取周期		连续两次独立的存储器操作（读或写）所需的 最小间隔时间		读周期、写周期</li>
</ul>
<p>3、存储器的带宽		位&#x2F;秒</p>
<h3 id="1-2-2-半导体存储芯片简介"><a href="#1-2-2-半导体存储芯片简介" class="headerlink" title="1-2-2 半导体存储芯片简介"></a>1-2-2 半导体存储芯片简介</h3><h4 id="1-2-2-1-半导体存储芯片的基本结构"><a href="#1-2-2-1-半导体存储芯片的基本结构" class="headerlink" title="1-2-2-1 半导体存储芯片的基本结构"></a>1-2-2-1 半导体存储芯片的基本结构</h4><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501170522545.png"
                      alt="image-20240501170522545"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-05-01%20170824.png"
                      alt="屏幕截图 2024-05-01 170824"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501171250938.png"
                      alt="image-20240501171250938"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501172625363.png"
                      alt="image-20240501172625363"
                ></p>
</li>
</ul>
<h4 id="1-2-2-2-半导体存储芯片的译码驱动方式"><a href="#1-2-2-2-半导体存储芯片的译码驱动方式" class="headerlink" title="1-2-2-2 半导体存储芯片的译码驱动方式"></a>1-2-2-2 半导体存储芯片的译码驱动方式</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501174037281.png"
                      alt="image-20240501174037281"
                ></li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501180954195.png"
                      alt="image-20240501180954195"
                ></li>
</ul>
<h3 id="1-2-3-随机存取存储器（RAM）"><a href="#1-2-3-随机存取存储器（RAM）" class="headerlink" title="1-2-3 随机存取存储器（RAM）"></a>1-2-3 随机存取存储器（RAM）</h3><h4 id="1-2-3-1-静态RAM（SRAM）"><a href="#1-2-3-1-静态RAM（SRAM）" class="headerlink" title="1-2-3-1 静态RAM（SRAM）"></a>1-2-3-1 静态RAM（SRAM）</h4><ul>
<li><p>（1）</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501183002847.png"
                      alt="image-20240501183002847"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501183636169.png"
                      alt="image-20240501183636169"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501202323787.png"
                      alt="image-20240501202323787"
                ></p>
</li>
<li><p>（2）</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501202850951.png"
                      alt="image-20240501202850951"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501203253664.png"
                      alt="image-20240501203253664"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240501203403471.png"
                      alt="image-20240501203403471"
                ></p>
</li>
</ul>
<h4 id="1-2-3-2-动态RAM（DRAM）"><a href="#1-2-3-2-动态RAM（DRAM）" class="headerlink" title="1-2-3-2 动态RAM（DRAM）"></a>1-2-3-2 动态RAM（DRAM）</h4><ul>
<li><p>（1）动态RAM基本单元电路</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240502213650982.png"
                      alt="image-20240502213650982"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240502214639674.png"
                      alt="image-20240502214639674"
                ></p>
</li>
<li><p>（2）动态RAM芯片举例</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240502215549112.png"
                      alt="image-20240502215549112"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240502215644971.png"
                      alt="image-20240502215644971"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240502215901289.png"
                      alt="image-20240502215901289"
                ></p>
</li>
<li><p>注意：读放大器 起跷跷板的作用，左侧为1，右侧为0；左侧为0，右侧为1。</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240503213329774.png"
                      alt="image-20240503213329774"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240503214043486.png"
                      alt="image-20240503214043486"
                ></p>
</li>
<li><p>（4）动态RAM刷新（刷新与行地址有关）</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240503215448102.png"
                      alt="image-20240503215448102"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240503215844691.png"
                      alt="image-20240503215844691"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240503221118229.png"
                      alt="image-20240503221118229"
                ></p>
</li>
</ul>
<h4 id="1-2-3-3-动态RAM和静态RAM的比较"><a href="#1-2-3-3-动态RAM和静态RAM的比较" class="headerlink" title="1-2-3-3 动态RAM和静态RAM的比较"></a>1-2-3-3 动态RAM和静态RAM的比较</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240503221804668.png"
                      alt="image-20240503221804668"
                ></li>
</ul>
<h3 id="1-2-4-只读存储器（ROM）"><a href="#1-2-4-只读存储器（ROM）" class="headerlink" title="1-2-4 只读存储器（ROM）"></a>1-2-4 只读存储器（ROM）</h3><h4 id="1-2-4-1-掩模ROM（MROM）"><a href="#1-2-4-1-掩模ROM（MROM）" class="headerlink" title="1-2-4-1 掩模ROM（MROM）"></a>1-2-4-1 掩模ROM（MROM）</h4><p>行列选择线交叉处有 MOS 管为“1”。</p>
<p>行列选择线交叉处无 MOS 管为“0”。</p>
<h4 id="1-2-4-2-PROM（一次性编程）"><a href="#1-2-4-2-PROM（一次性编程）" class="headerlink" title="1-2-4-2 PROM（一次性编程）"></a>1-2-4-2 PROM（一次性编程）</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240504212752736.png"
                      alt="image-20240504212752736"
                ></li>
</ul>
<h4 id="1-2-4-3-EPROM（多次性编程）"><a href="#1-2-4-3-EPROM（多次性编程）" class="headerlink" title="1-2-4-3 EPROM（多次性编程）"></a>1-2-4-3 EPROM（多次性编程）</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240504213808890.png"
                      alt="image-20240504213808890"
                ></li>
</ul>
<h4 id="1-2-4-4-EEPROM（多次性编程）"><a href="#1-2-4-4-EEPROM（多次性编程）" class="headerlink" title="1-2-4-4 EEPROM（多次性编程）"></a>1-2-4-4 EEPROM（多次性编程）</h4><p>电可擦写</p>
<p>局部擦写</p>
<p>全部擦写</p>
<h4 id="1-2-4-5-Flash-Memory（闪速型存储器）"><a href="#1-2-4-5-Flash-Memory（闪速型存储器）" class="headerlink" title="1-2-4-5 Flash Memory（闪速型存储器）"></a>1-2-4-5 Flash Memory（闪速型存储器）</h4><p>既有	EPROM	价格便宜 集成度高，</p>
<p>又有	EEPROM	电可擦洗重写，</p>
<p>而且	比EEPROM快	还具备RAM功能。</p>
<h3 id="1-2-5-主存储器–存储器与CPU的连接"><a href="#1-2-5-主存储器–存储器与CPU的连接" class="headerlink" title="1-2-5 主存储器–存储器与CPU的连接"></a>1-2-5 主存储器–存储器与CPU的连接</h3><h4 id="1-2-5-1-存储器容量的扩展"><a href="#1-2-5-1-存储器容量的扩展" class="headerlink" title="1-2-5-1 存储器容量的扩展"></a>1-2-5-1 存储器容量的扩展</h4><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240504222116832.png"
                      alt="image-20240504222116832"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240504223359589.png"
                      alt="image-20240504223359589"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240505151701412.png"
                      alt="image-20240505151701412"
                ></p>
</li>
</ul>
<h4 id="1-2-5-2-存储器与CPU的连接"><a href="#1-2-5-2-存储器与CPU的连接" class="headerlink" title="1-2-5-2 存储器与CPU的连接"></a>1-2-5-2 存储器与CPU的连接</h4><p>1、地址线的连接</p>
<ul>
<li>设CPU的地址线为16位 A15<del>A0，1k * 4位的存储芯片为10位 A9</del>A0，此时，可将CPU的低位地址 A9<del>A0 与存储芯片 A9</del>A0 相连。</li>
</ul>
<p>2、数据线的连接</p>
<ul>
<li>对存储芯片扩位，使其数据位数与CPU的数据位数相等。</li>
</ul>
<p>3、读&#x2F;写命令线的连接</p>
<ul>
<li>CPU读&#x2F;写命令线一般可直接与存储芯片的读&#x2F;写控制端相连；高电平为读，低电平为写。</li>
</ul>
<p>4、片选线的连接</p>
<p>5、合理选择存储芯片</p>
<p>6、其他</p>
<ul>
<li>时序、负载</li>
</ul>
<h4 id="1-2-5-3-实例"><a href="#1-2-5-3-实例" class="headerlink" title="1-2-5-3 实例"></a>1-2-5-3 实例</h4><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240505171445776.png"
                      alt="image-20240505171445776"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240505173035824.png"
                      alt="image-20240505173035824"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240505195708077.png"
                      alt="image-20240505195708077"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240505205310527.png"
                      alt="image-20240505205310527"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240505205523360.png"
                      alt="image-20240505205523360"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240505210305604.png"
                      alt="image-20240505210305604"
                ></p>
</li>
</ul>
<h3 id="1-2-6-主存储器–存储器的校验"><a href="#1-2-6-主存储器–存储器的校验" class="headerlink" title="1-2-6 主存储器–存储器的校验"></a>1-2-6 主存储器–存储器的校验</h3><h4 id="1-2-6-1-合法代码集合"><a href="#1-2-6-1-合法代码集合" class="headerlink" title="1-2-6-1 合法代码集合"></a>1-2-6-1 合法代码集合</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240506215821189.png"
                      alt="image-20240506215821189"
                ></li>
</ul>
<h4 id="1-2-6-2-编码的最小距离"><a href="#1-2-6-2-编码的最小距离" class="headerlink" title="1-2-6-2 编码的最小距离"></a>1-2-6-2 编码的最小距离</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240506220252347.png"
                      alt="image-20240506220252347"
                ></li>
</ul>
<h4 id="1-2-6-3-汉明码的组成"><a href="#1-2-6-3-汉明码的组成" class="headerlink" title="1-2-6-3 汉明码的组成"></a>1-2-6-3 汉明码的组成</h4><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240507150004146.png"
                      alt="image-20240507150004146"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240507150313337.png"
                      alt="image-20240507150313337"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240507150918713.png"
                      alt="image-20240507150918713"
                ></p>
</li>
</ul>
<h4 id="1-2-6-4-汉明码的组成-计算"><a href="#1-2-6-4-汉明码的组成-计算" class="headerlink" title="1-2-6-4 汉明码的组成 计算"></a>1-2-6-4 汉明码的组成 计算</h4><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240507151332105.png"
                      alt="image-20240507151332105"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240507151628234.png"
                      alt="image-20240507151628234"
                ></p>
</li>
</ul>
<h4 id="1-2-6-5-汉明码的纠错"><a href="#1-2-6-5-汉明码的纠错" class="headerlink" title="1-2-6-5 汉明码的纠错"></a>1-2-6-5 汉明码的纠错</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240507152942309.png"
                      alt="image-20240507152942309"
                ></li>
</ul>
<h4 id="1-2-6-6-汉明码的纠错-计算"><a href="#1-2-6-6-汉明码的纠错-计算" class="headerlink" title="1-2-6-6 汉明码的纠错 计算"></a>1-2-6-6 汉明码的纠错 计算</h4><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240507155950070.png"
                      alt="image-20240507155950070"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240507160222825.png"
                      alt="image-20240507160222825"
                ></p>
</li>
</ul>
<h3 id="1-2-7-提高访存速度的措施"><a href="#1-2-7-提高访存速度的措施" class="headerlink" title="1-2-7 提高访存速度的措施"></a>1-2-7 提高访存速度的措施</h3><ul>
<li>采用高速器件</li>
<li>采用层次结构	Cache-主存</li>
<li>调整主存结构</li>
</ul>
<h4 id="1-2-7-1-单体多字系统"><a href="#1-2-7-1-单体多字系统" class="headerlink" title="1-2-7-1 单体多字系统"></a>1-2-7-1 单体多字系统</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240508090851983.png"
                      alt="image-20240508090851983"
                ></li>
</ul>
<h4 id="1-2-7-2-多体并行系统"><a href="#1-2-7-2-多体并行系统" class="headerlink" title="1-2-7-2 多体并行系统"></a>1-2-7-2 多体并行系统</h4><ul>
<li><p>高位交叉用来提高存储容量，低位交叉用来提高访问速度</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240508091933945.png"
                      alt="image-20240508091933945"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240508092309255.png"
                      alt="image-20240508092309255"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240508103941697.png"
                      alt="image-20240508103941697"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240508104012951.png"
                      alt="image-20240508104012951"
                ></p>
</li>
</ul>
<h4 id="1-2-7-3-高性能存储芯片"><a href="#1-2-7-3-高性能存储芯片" class="headerlink" title="1-2-7-3 高性能存储芯片"></a>1-2-7-3 高性能存储芯片</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240508104843320.png"
                      alt="image-20240508104843320"
                ></li>
</ul>
<h2 id="1-3-高速缓冲存储器"><a href="#1-3-高速缓冲存储器" class="headerlink" title="1-3 高速缓冲存储器"></a>1-3 高速缓冲存储器</h2><h3 id="1-3-1-为什么用-Cache"><a href="#1-3-1-为什么用-Cache" class="headerlink" title="1-3-1 为什么用 Cache"></a>1-3-1 为什么用 Cache</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622193350801.png"
                      alt="image-20240622193350801"
                ></li>
</ul>
<h3 id="1-3-2-Cache-的工作原理"><a href="#1-3-2-Cache-的工作原理" class="headerlink" title="1-3-2 Cache 的工作原理"></a>1-3-2 Cache 的工作原理</h3><h4 id="1-3-2-1-主存和缓存的编址"><a href="#1-3-2-1-主存和缓存的编址" class="headerlink" title="1-3-2-1 主存和缓存的编址"></a>1-3-2-1 主存和缓存的编址</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622194750156.png"
                      alt="image-20240622194750156"
                ></li>
</ul>
<h4 id="1-3-2-2-命中与未命中"><a href="#1-3-2-2-命中与未命中" class="headerlink" title="1-3-2-2 命中与未命中"></a>1-3-2-2 命中与未命中</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622195632743.png"
                      alt="image-20240622195632743"
                ></li>
</ul>
<h4 id="1-3-2-3-Cache-的命中率"><a href="#1-3-2-3-Cache-的命中率" class="headerlink" title="1-3-2-3 Cache 的命中率"></a>1-3-2-3 Cache 的命中率</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622200233409.png"
                      alt="image-20240622200233409"
                ></li>
</ul>
<h4 id="1-3-2-4-Cache-主存系统的效率"><a href="#1-3-2-4-Cache-主存系统的效率" class="headerlink" title="1-3-2-4 Cache-主存系统的效率"></a>1-3-2-4 Cache-主存系统的效率</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622200719486.png"
                      alt="image-20240622200719486"
                ></li>
</ul>
<h3 id="1-3-3-Cache-的基本结构"><a href="#1-3-3-Cache-的基本结构" class="headerlink" title="1-3-3 Cache 的基本结构"></a>1-3-3 Cache 的基本结构</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622201346286.png"
                      alt="image-20240622201346286"
                ></li>
</ul>
<h3 id="1-3-4-Cache-的读写操作"><a href="#1-3-4-Cache-的读写操作" class="headerlink" title="1-3-4 Cache 的读写操作"></a>1-3-4 Cache 的读写操作</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622201546727.png"
                      alt="image-20240622201546727"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622201946504.png"
                      alt="image-20240622201946504"
                ></p>
</li>
</ul>
<h3 id="1-3-5-Cache-的改进"><a href="#1-3-5-Cache-的改进" class="headerlink" title="1-3-5 Cache 的改进"></a>1-3-5 Cache 的改进</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622202222588.png"
                      alt="image-20240622202222588"
                ></li>
</ul>
<h3 id="1-3-6-Cache-主存的地址映射【重点】"><a href="#1-3-6-Cache-主存的地址映射【重点】" class="headerlink" title="1-3-6 Cache-主存的地址映射【重点】"></a>1-3-6 Cache-主存的地址映射【重点】</h3><h4 id="1-3-6-1-直接映射"><a href="#1-3-6-1-直接映射" class="headerlink" title="1-3-6-1 直接映射"></a>1-3-6-1 直接映射</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622202903536.png"
                      alt="image-20240622202903536"
                ></li>
</ul>
<h4 id="1-3-6-2-全相联映射"><a href="#1-3-6-2-全相联映射" class="headerlink" title="1-3-6-2 全相联映射"></a>1-3-6-2 全相联映射</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622203149537.png"
                      alt="image-20240622203149537"
                ></li>
</ul>
<h4 id="1-3-6-3-组相联映射"><a href="#1-3-6-3-组相联映射" class="headerlink" title="1-3-6-3 组相联映射"></a>1-3-6-3 组相联映射</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622203432068.png"
                      alt="image-20240622203432068"
                ></li>
</ul>
<h3 id="1-3-7-替换算法"><a href="#1-3-7-替换算法" class="headerlink" title="1-3-7 替换算法"></a>1-3-7 替换算法</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622203524920.png"
                      alt="image-20240622203524920"
                ></li>
</ul>
<h2 id="1-4-辅助存储器"><a href="#1-4-辅助存储器" class="headerlink" title="1-4 辅助存储器"></a>1-4 辅助存储器</h2><h3 id="1-4-1-概述"><a href="#1-4-1-概述" class="headerlink" title="1-4-1 概述"></a>1-4-1 概述</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622203735872.png"
                      alt="image-20240622203735872"
                ></li>
</ul>
<h3 id="1-4-2-磁记录原理"><a href="#1-4-2-磁记录原理" class="headerlink" title="1-4-2 磁记录原理"></a>1-4-2 磁记录原理</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622203841845.png"
                      alt="image-20240622203841845"
                ></li>
</ul>
<h3 id="1-4-3-硬磁盘存储器"><a href="#1-4-3-硬磁盘存储器" class="headerlink" title="1-4-3 硬磁盘存储器"></a>1-4-3 硬磁盘存储器</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622203928787.png"
                      alt="image-20240622203928787"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622204121313.png"
                      alt="image-20240622204121313"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622204139199.png"
                      alt="image-20240622204139199"
                ></p>
</li>
</ul>
<h3 id="1-4-4-软磁盘存储器"><a href="#1-4-4-软磁盘存储器" class="headerlink" title="1-4-4 软磁盘存储器"></a>1-4-4 软磁盘存储器</h3><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622204225934.png"
                      alt="image-20240622204225934"
                ></p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622204250839.png"
                      alt="image-20240622204250839"
                ></p>
</li>
</ul>
<h3 id="1-4-5-光盘存储器"><a href="#1-4-5-光盘存储器" class="headerlink" title="1-4-5 光盘存储器"></a>1-4-5 光盘存储器</h3><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://image-1324607906.cos.ap-beijing.myqcloud.com/bokeimage/image-20240622204333945.png"
                      alt="image-20240622204333945"
                ></li>
</ul>
]]></content>
      <categories>
        <category>408</category>
        <category>计算机组成原理</category>
      </categories>
      <tags>
        <tag>自研笔记</tag>
      </tags>
  </entry>
</search>
